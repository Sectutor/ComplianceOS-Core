import{ab as F,b as z,r as m,t as g,i as T,j as e,c,k as G,S as M,C as I,d as O,e as $,f as H,m as k,L as l,I as f,E as K,G as Q,H as V,J as W,K as j,T as J}from"./index-DOc7Nwb7.js";import{T as i}from"./textarea-BtxBxzdY.js";import{P as _}from"./PageGuide-CPKKXXS6.js";import{A as X}from"./arrow-left-CpuUojG-.js";import{S as Y}from"./save-CvVmWchr.js";import{C as D}from"./circle-check-big-BSqJVrgh.js";import{G as Z}from"./globe-BMGZmoaJ.js";import{S as L}from"./scale-BCebIfgE.js";import{L as P}from"./lock-czWF3qbC.js";import{I as ee}from"./info-By5wLOUH.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";const v=[{id:"mapping",title:"1. Transfer Mapping",icon:Z},{id:"safeguards",title:"2. Legal Safeguards",icon:M},{id:"country",title:"3. Local Law Assessment",icon:L},{id:"measures",title:"4. Supplementary Measures",icon:P},{id:"conclusion",title:"5. Conclusion & Risk",icon:D}];function ge(){var A;const{id:o,transferId:p}=F(),[N,R]=z(),y=parseInt(o||"0"),b=parseInt(p||"0"),[t,u]=m.useState(0),{data:a,isLoading:q}=g.transfers.get.useQuery({id:b}),{data:C}=g.transfers.getAdequacy.useQuery({countryCode:(a==null?void 0:a.destinationCountry)||""},{enabled:!!(a!=null&&a.destinationCountry)}),[r,w]=m.useState({}),[x,S]=m.useState("low"),U=g.transfers.saveTIA.useMutation({onSuccess:()=>T.success("Assessment saved"),onError:s=>T.error(`Save failed: ${s.message}`)});m.useEffect(()=>{a!=null&&a.latestTia&&(w(a.latestTia.questionnaireData||{}),S(a.latestTia.riskLevel||"low"))},[a]);const n=(s,d)=>{w(B=>({...B,[s]:d}))},h=(s="draft")=>{U.mutate({transferId:b,clientId:y,responses:r,riskLevel:x,status:s})};return q?e.jsx("div",{className:"p-10 text-center",children:"Loading Transfer Details..."}):a?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsxs("div",{className:"bg-white border-b p-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"ghost",onClick:()=>R(`/clients/${y}/privacy/transfers`),children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center",children:["TIA: ",a.title,e.jsx(G,{variant:"outline",className:"ml-3 font-mono uppercase bg-slate-50",children:a.destinationCountry})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transfer Impact Assessment (EDPB 6-Step process)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>h("draft"),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Save Draft"]}),e.jsxs(c,{onClick:()=>h("completed"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(D,{className:"w-4 h-4 mr-2"})," Complete Assessment"]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-72 border-r bg-slate-50 p-4 shrink-0 overflow-y-auto",children:[e.jsx("div",{className:"space-y-1",children:v.map((s,d)=>e.jsxs("button",{onClick:()=>u(d),className:`w-full flex items-center gap-3 p-3 rounded-lg text-sm font-medium transition-colors ${t===d?"bg-white shadow-sm text-blue-600 border":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(s.icon,{className:`w-4 h-4 ${t===d?"text-blue-600":"text-slate-400"}`}),s.title]},s.id))}),e.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 rounded-lg border border-yellow-100",children:[e.jsxs("h3",{className:"text-xs font-bold text-yellow-800 uppercase flex items-center mb-2",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"})," Adequacy Info"]}),C?e.jsxs("div",{className:"text-xs text-yellow-800 leading-relaxed",children:[e.jsxs("p",{className:"font-bold",children:[a.destinationCountry," is ADEQUATE."]}),e.jsx("p",{className:"mt-1 opacity-80",children:C.scope})]}):e.jsxs("div",{className:"text-xs text-yellow-800 leading-relaxed",children:[e.jsx("p",{className:"font-bold",children:"Not Adequate."}),e.jsx("p",{className:"mt-1 opacity-80",children:"Full TIA and supplementary measures required under Art. 46."})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-100 p-8",children:[e.jsx("div",{className:"max-w-4xl mx-auto mb-6 animate-slide-down",children:e.jsx(_,{title:"Transfer Impact Assessment (TIA)",description:" Assess validity of transfer tools for third-country data flows.",rationale:"Schrems II requires verifying if local laws impinge on SCC effectiveness.",howToUse:[{step:"Map",description:"Detail exporter, importer, and data flows."},{step:"Assess",description:"Evaluate third-country laws and surveillance risks."},{step:"Mitigate",description:"Implement supplementary measures if necessary."}]})}),e.jsxs(I,{className:"max-w-4xl mx-auto shadow-sm",children:[e.jsxs(O,{children:[e.jsx($,{children:v[t].title}),e.jsxs(H,{children:[t===0&&"Describe the details of the data flow and the parties involved.",t===1&&"Identify the legal instrument relied upon for the transfer.",t===2&&"Assess whether the laws in the destination country provide an essentially equivalent level of protection.",t===3&&"Identify and implement any necessary supplementary measures (Technical, Organizational, Contractual).",t===4&&"Final summary and risk determination for this transfer."]})]}),e.jsxs(k,{className:"space-y-6",children:[t===0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Data Exporter (Entity Name)"}),e.jsx(f,{value:r.exporterName||"",onChange:s=>n("exporterName",s.target.value),placeholder:"e.g. Acme Corp EU"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Data Importer (Entity Name)"}),e.jsx(f,{value:r.importerName||"",onChange:s=>n("importerName",s.target.value),placeholder:"e.g. AWS Inc. (US)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Description of Data Transferred"}),e.jsx(i,{value:r.dataDescription||"",onChange:s=>n("dataDescription",s.target.value),placeholder:"Identify categories of data subjects and types of personal data (e.g., customer names, emails, billing info)..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Purpose of Transfer"}),e.jsx(i,{value:r.transferPurpose||"",onChange:s=>n("transferPurpose",s.target.value),placeholder:"e.g. Provision of cloud storage services, Technical Support, etc."})]})]}),t===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-100 rounded-lg flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-blue-800",children:["Transfer Tool: ",a.transferTool.replace("_"," ").toUpperCase()]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"This tool was defined during the transfer setup. Confirm if it remains appropriate for the current flow."})]})]}),a.transferTool==="scc_2021"&&e.jsx(I,{className:"border-dashed border-2",children:e.jsxs(k,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"text-blue-700 font-bold",children:["Selected Module: ",((A=a.sccModule)==null?void 0:A.toUpperCase())||"None"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.sccModule==="c2c"&&"Controller-to-Controller: Exporter and Importer are both controllers.",a.sccModule==="c2p"&&"Controller-to-Processor: Exporter is a controller, Importer is their processor.",a.sccModule==="p2p"&&"Processor-to-Processor: Exporter is a processor, Importer is a sub-processor.",a.sccModule==="p2c"&&"Processor-to-Controller: Exporter is processor, Importer is its controller (Return Flow)."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Are supplementary clauses included? (e.g. UK Addendum)"}),e.jsx(f,{value:r.supplementaryClauses||"",onChange:s=>n("supplementaryClauses",s.target.value),placeholder:"e.g. UK IDTA Addendum attached"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Formal Contractual Basis"}),e.jsx(i,{value:r.contractualBasis||"",onChange:s=>n("contractualBasis",s.target.value),placeholder:"Detail the agreement name, date, and sections covering Chapter V compliance..."})]})]}),t===2&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-slate-500"}),"Third Country Legal Analysis"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Government Surveillance Laws"}),e.jsx(E,{text:"State whether local laws allow government bodies broad access to personal data (e.g. US FISA 702, Executive Order 12333)."}),e.jsx(i,{value:r.surveillanceLaws||"",onChange:s=>n("surveillanceLaws",s.target.value),placeholder:"Describe the legal landscape regarding government access..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Independent Oversight & Remedies"}),e.jsx(E,{text:"Is there an independent authority (like an ombudsperson) or judicial remedy for data subjects?"}),e.jsx(i,{value:r.legalRemedies||"",onChange:s=>n("legalRemedies",s.target.value),placeholder:"Detail the availability of legal redress for EEA individuals..."})]})]})}),t===3&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-3 h-3 text-blue-500"}),"Technical Measures (Encryption)"]}),e.jsx(i,{value:r.technicalMeasures||"",onChange:s=>n("technicalMeasures",s.target.value),placeholder:"e.g. Data encrypted in transit via TLS 1.3 and at rest via AES-256 where keys are held by the exporter..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Organizational Measures"}),e.jsx(i,{value:r.organizationalMeasures||"",onChange:s=>n("organizationalMeasures",s.target.value),placeholder:"e.g. Access restricted on need-to-know basis, internal policy for handling government data requests..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Contractual Measures"}),e.jsx(i,{value:r.additionalContractualMeasures||"",onChange:s=>n("additionalContractualMeasures",s.target.value),placeholder:"e.g. Commitment to challenge unlawful access requests, transparency reporting..."})]})]})}),t===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 bg-slate-50 border rounded-xl space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Overall Risk Rating"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Based on the factors assessed above"})]}),e.jsxs(K,{value:x,onValueChange:S,children:[e.jsx(Q,{className:"w-40 capitalize",children:e.jsx(V,{})}),e.jsxs(W,{children:[e.jsx(j,{value:"low",children:"Low Risk"}),e.jsx(j,{value:"medium",children:"Medium Risk"}),e.jsx(j,{value:"high",children:"High Risk"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(l,{children:"Final Justification / Conclusion"}),e.jsx(i,{className:"mt-2 min-h-[120px]",value:r.finalConclusion||"",onChange:s=>n("finalConclusion",s.target.value),placeholder:"Summarize why this transfer is considered compliant..."})]})]}),x==="high"&&e.jsxs("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg flex gap-3 text-sm border border-red-100",children:[e.jsx(J,{className:"w-5 h-5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold uppercase tracking-tight",children:"Warning: High Risk Transfer"}),e.jsx("p",{children:"Assessments resulting in high residual risk must be flagged, and local DPA consultation might be required if supplementary measures are not effective."})]})]})]})]}),e.jsxs(se,{className:"bg-slate-50 flex justify-between p-4 rounded-b-lg border-t",children:[e.jsx(c,{variant:"outline",disabled:t===0,onClick:()=>u(s=>s-1),children:"Previous Step"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",className:"text-xs text-muted-foreground",onClick:()=>h("draft"),children:"Save Progress"}),e.jsx(c,{className:"px-8",disabled:t===v.length-1,onClick:()=>u(s=>s+1),children:"Next Step"})]})]})]})]})]})]}):e.jsx("div",{className:"p-10 text-center text-red-500",children:"Transfer not found."})}function E({text:o}){return e.jsx("p",{className:"text-xs text-muted-foreground italic mb-1",children:o})}function se({children:o,className:p,...N}){return e.jsx("div",{className:`flex items-center p-6 pt-0 ${p}`,...N,children:o})}export{ge as default};
