import{t as x,j as e,k as p,c as h,S as g}from"./index-DOc7Nwb7.js";import{E as u}from"./enhanced-dialog-CeRPsI16.js";import{S as c,a as o}from"./slotNames-XB2IFQPg.js";import{W as f}from"./wand-sparkles-BtekNLFr.js";const m={"Very High":"bg-red-600 text-white",High:"bg-orange-500 text-white",Medium:"bg-yellow-400 text-black",Low:"bg-green-400 text-black","Very Low":"bg-green-200 text-black",Critical:"bg-red-700 text-white",Moderate:"bg-yellow-400 text-black",Minor:"bg-green-400 text-black",Insignificant:"bg-green-200 text-black"};function y({open:d,onOpenChange:n,risk:s,clientId:i}){const{data:a}=x.risks.getRiskTreatments.useQuery({riskAssessmentId:s==null?void 0:s.id},{enabled:!!(s!=null&&s.id)&&d}),r=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return[t]}return t||[]};return s?e.jsx(u,{open:d,onOpenChange:n,title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-primary"}),"Risk Details: ",s.assessmentId]}),description:"Comprehensive view of identified risk, analysis, and treatment plan.",size:"xl",className:"max-h-[85vh]",footer:e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Close Details"}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Inherent Risk"}),e.jsx("p",{className:`text-lg font-bold mt-1 px-2 py-1 rounded inline-block ${m[s.inherentRisk||""]||"bg-gray-100"}`,children:s.inherentRisk||"-"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Residual Risk"}),e.jsx("p",{className:`text-lg font-bold mt-1 px-2 py-1 rounded inline-block ${m[s.residualRisk||""]||"bg-gray-100"}`,children:s.residualRisk||"-"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Status"}),e.jsx("p",{className:"text-lg font-bold mt-1 capitalize",children:s.status||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Threat Description"}),e.jsx("p",{className:"text-muted-foreground",children:s.threatDescription||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vulnerability"}),e.jsx("p",{className:"text-muted-foreground",children:s.vulnerabilityDescription||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Affected Assets"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r(s.affectedAssets).map((t,l)=>e.jsx(p,{variant:"secondary",children:t},l))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Risk Owner"}),e.jsx("p",{className:"text-muted-foreground",children:s.riskOwner||"Not assigned"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Existing Controls"}),e.jsx("p",{className:"text-muted-foreground",children:s.existingControls||"None documented"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Control Effectiveness"}),e.jsx("p",{className:"text-muted-foreground capitalize",children:s.controlEffectiveness||"Not evaluated"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Treatment Option & Recommended Actions"}),e.jsxs("p",{className:"text-muted-foreground",children:[e.jsxs("strong",{className:"capitalize",children:[s.treatmentOption||"Not decided",":"]})," ",s.recommendedActions||"No actions specified"]})]})]}),a&&a.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["Active Treatments (",a.length,")"]}),e.jsx("div",{className:"space-y-2",children:a.map(t=>{var l;return e.jsxs("div",{className:"border rounded-lg p-4 bg-muted/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize ${t.treatmentType==="mitigate"?"bg-blue-100 text-blue-800":t.treatmentType==="transfer"?"bg-purple-100 text-purple-800":t.treatmentType==="accept"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.treatmentType}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize ${t.status==="implemented"?"bg-green-100 text-green-800":t.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"}`,children:(l=t.status)==null?void 0:l.replace("_"," ")})]}),e.jsx("p",{className:"text-sm",children:t.strategy}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.owner&&e.jsxs("span",{children:["Owner: ",t.owner]}),t.dueDate&&e.jsxs("span",{children:["Due: ",new Date(t.dueDate).toLocaleDateString()]})]})]},t.id)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-dashed",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2 text-purple-700",children:[e.jsx(f,{className:"w-4 h-4"}),"AI Power Tools"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(c,{name:o.RISK_AUTO_TRIAGE,props:{clientId:i,threatDescription:s.threatDescription||"",vulnerabilityDescription:s.vulnerabilityDescription||"",affectedAssets:r(s.affectedAssets),onAnalysisComplete:t=>{console.log("AI Analysis complete:",t)}}}),e.jsx(c,{name:o.RISK_CONTROL_SUGGESTION,props:{clientId:i,threat:s.threatDescription||"",vulnerability:s.vulnerabilityDescription||"",selectedControlIds:[],onAddControl:t=>{console.log("Would add control:",t)}}})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Date Identified"}),e.jsx("p",{className:"font-medium",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Review"}),e.jsx("p",{className:"font-medium",children:s.assessmentDate?new Date(s.assessmentDate).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Next Review"}),e.jsx("p",{className:"font-medium",children:s.nextReviewDate?new Date(s.nextReviewDate).toLocaleDateString():"Not scheduled"})]})]}),s.notes&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-muted-foreground",children:s.notes})]})]})}):null}export{y as R};
