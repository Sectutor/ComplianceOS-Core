import{b as D,ac as w,r as C,t as b,i as R,j as e,D as P,ap as E,c as S,o as M,p as L,q as I,s as T,C as m,d as x,e as u,m as h,L as d,E as j,G as p,H as g,J as f,K as r,I as v,U as A,k as N}from"./index-DOc7Nwb7.js";import{B as q}from"./Breadcrumb-CRi3LAxS.js";import{P as O}from"./PageGuide-CPKKXXS6.js";import{P as V}from"./plus-BaQ35Jcx.js";import{f as y}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function _(){D();const{selectedClientId:t}=w(),[o,a]=C.useState(!1),{data:s,isLoading:i,refetch:c}=b.privacy.getDsarRequests.useQuery({clientId:t},{enabled:!!t}),n=b.privacy.createDsarRequest.useMutation({onSuccess:()=>{R.success("DSAR Request Logged"),a(!1),c()}});return e.jsxs("div",{className:"w-full max-w-full p-6 space-y-6 h-full flex flex-col",children:[e.jsx(q,{items:[{label:"Dashboard",path:"/dashboard"},{label:"Privacy",path:`/clients/${t}/privacy`},{label:"DSAR Manager"}]}),e.jsxs("div",{className:"flex items-center justify-between animate-slide-down",children:[e.jsx(O,{title:"DSAR Manager",description:"Handle Data Subject Access Requests within statutory timelines.",rationale:"Fulfil individual rights (access, deletion) under GDPR/CCPA.",howToUse:[{step:"Log",description:"Record new requests from emails or portals."},{step:"Verify",description:"Confirm identity to prevent data leakage."},{step:"Respond",description:"Gather data and generate response packages."}]}),e.jsxs(P,{open:o,onOpenChange:a,children:[e.jsx(E,{asChild:!0,children:e.jsxs(S,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Log New Request"]})}),e.jsxs(M,{children:[e.jsxs(L,{children:[e.jsx(I,{children:"Log New DSAR"}),e.jsx(T,{children:"Enter details of the request received from a data subject."})]}),e.jsx(k,{onSubmit:l=>n.mutate({...l,clientId:t}),loading:n.isPending})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(m,{children:[e.jsx(x,{className:"py-4",children:e.jsx(u,{className:"text-sm font-medium",children:"New Requests"})}),e.jsx(h,{className:"text-2xl font-bold",children:(s==null?void 0:s.filter(l=>l.status==="New").length)||0})]}),e.jsxs(m,{children:[e.jsx(x,{className:"py-4",children:e.jsx(u,{className:"text-sm font-medium",children:"In Progress"})}),e.jsx(h,{className:"text-2xl font-bold",children:(s==null?void 0:s.filter(l=>["In Progress","Verifying Identity","Review"].includes(l.status||"")).length)||0})]}),e.jsxs(m,{children:[e.jsx(x,{className:"py-4",children:e.jsx(u,{className:"text-sm font-medium",children:"Overdue"})}),e.jsx(h,{className:"text-2xl font-bold text-red-600",children:(s==null?void 0:s.filter(l=>l.dueDate&&new Date(l.dueDate)<new Date&&!["Completed","Rejected"].includes(l.status||"")).length)||0})]}),e.jsxs(m,{children:[e.jsx(x,{className:"py-4",children:e.jsx(u,{className:"text-sm font-medium",children:"Completed (YTD)"})}),e.jsx(h,{className:"text-2xl font-bold text-green-600",children:(s==null?void 0:s.filter(l=>l.status==="Completed").length)||0})]})]}),e.jsxs(m,{className:"flex-1 flex flex-col",children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-lg",children:"Request Queue"})}),e.jsx(h,{children:i?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading requests..."}):!s||s.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No requests found."}):e.jsx("div",{className:"space-y-4",children:s.map(l=>e.jsx(B,{request:l,onSuccess:()=>c()},l.id))})})]})]})}function k({onSubmit:t,loading:o}){const[a,s]=C.useState({requestType:"Access",subjectEmail:"",subjectName:"",requestDate:y(new Date,"yyyy-MM-dd"),dueDate:y(new Date(Date.now()+2592e6),"yyyy-MM-dd"),submissionMethod:"email",priority:"medium"});return e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Request Type"}),e.jsxs(j,{value:a.requestType,onValueChange:i=>s({...a,requestType:i}),children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(r,{value:"Access",children:"Right to Access"}),e.jsx(r,{value:"Deletion",children:"Right to Erasure (Deletion)"}),e.jsx(r,{value:"Rectification",children:"Rectification"}),e.jsx(r,{value:"Portability",children:"Data Portability"}),e.jsx(r,{value:"Restriction",children:"Restriction of Processing"}),e.jsx(r,{value:"Objection",children:"Objection"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Received Date"}),e.jsx(v,{type:"date",value:a.requestDate,onChange:i=>s({...a,requestDate:i.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Submission Method"}),e.jsxs(j,{value:a.submissionMethod,onValueChange:i=>s({...a,submissionMethod:i}),children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(r,{value:"email",children:"Email"}),e.jsx(r,{value:"form",children:"Web Form"}),e.jsx(r,{value:"portal",children:"Privacy Portal"}),e.jsx(r,{value:"manual",children:"Manual Entry"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Priority"}),e.jsxs(j,{value:a.priority,onValueChange:i=>s({...a,priority:i}),children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"critical",children:"Critical"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Subject Email"}),e.jsx(v,{value:a.subjectEmail,onChange:i=>s({...a,subjectEmail:i.target.value}),placeholder:"requester@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Subject Name (Optional)"}),e.jsx(v,{value:a.subjectName,onChange:i=>s({...a,subjectName:i.target.value}),placeholder:"John Doe"})]}),e.jsx(S,{className:"w-full mt-2",onClick:()=>{const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.subjectEmail||!i.test(a.subjectEmail)){R.error("Valid Subject Email is required");return}t(a)},disabled:o,children:o?"Creating...":"Create Request"})]})}function B({request:t,onSuccess:o}){const[,a]=D(),{selectedClientId:s}=w(),i=({status:c})=>{let n="bg-slate-100 text-slate-700";return c==="New"&&(n="bg-blue-100 text-blue-700"),c==="In Progress"&&(n="bg-purple-100 text-purple-700"),c==="Completed"&&(n="bg-green-100 text-green-700"),c==="Rejected"&&(n="bg-red-100 text-red-700"),e.jsx(N,{className:`${n} border-none`,children:c})};return e.jsxs("div",{onClick:()=>a(`/clients/${s}/privacy/dsar/${t.id}`),className:"flex items-center justify-between p-4 border rounded-lg hover:shadow-md transition-shadow cursor-pointer bg-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center",children:e.jsx(A,{className:"h-5 w-5 text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:t.requestId}),e.jsx(N,{variant:"outline",children:t.requestType}),t.priority==="critical"&&e.jsx(N,{variant:"destructive",className:"ml-1",children:"Critical"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.subjectEmail," â€¢ ",new Date(t.requestDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider mb-1",children:"Due By"}),e.jsx("div",{className:`font-semibold ${t.dueDate&&new Date(t.dueDate)<new Date&&t.status!=="Completed"?"text-red-600":""}`,children:t.dueDate?new Date(t.dueDate).toLocaleDateString():"-"})]}),e.jsx(i,{status:t.status})]})]})}export{_ as default};
