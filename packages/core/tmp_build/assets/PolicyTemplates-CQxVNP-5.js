import{r as m,ad as oe,j as e,ae,af as qe,R as w,ag as Qe,ah as ye,ai as Ue,aj as Je,ak as Ke,al as We,am as ie,u as Ne,t as F,i as S,L as b,I as E,E as z,G as $,H,J as B,K as N,c as j,C as L,d as te,e as he,an as Xe,a3 as Ye,m as M,A as re,f as Ze,F as ge,N as es,O as ss,P as fe,Q as D,V as ts,W as _,k as rs,ac as as,b as ls}from"./index-DOc7Nwb7.js";import{D as ns,C as os}from"./DashboardLayout-aHnUqq57.js";import{E as q}from"./enhanced-dialog-CeRPsI16.js";import{T as ce}from"./textarea-BtxBxzdY.js";import{B as is}from"./Breadcrumb-CRi3LAxS.js";import{A as cs,a as ds,b as ms,c as us,d as xs,e as ps,f as hs,g as gs}from"./alert-dialog-V7xGXdVc.js";import{R as we}from"./RichTextEditor-NQxhVz6n.js";import{d as Ce}from"./marked.esm-DajSjiQI.js";import{T as fs}from"./turndown.browser.es-DScDaalG.js";import{P as le}from"./plus-BaQ35Jcx.js";import{S as js}from"./search-CwuIBBPE.js";import{F as vs}from"./filter-Ceo--4mb.js";import{L as bs}from"./layout-grid-CGqkIAJU.js";import{L as ys}from"./list-BZOuFwEg.js";import{C as Ns}from"./circle-check-C5kiwRoG.js";import{T as je}from"./trash-2-CFEfisbM.js";import{A as ws}from"./arrow-right-M96iV-v9.js";import{E as Cs}from"./eye-CIq9q9s6.js";import{S as Ss}from"./square-pen-ClRv15cM.js";import"./index--2vFva6Y.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";var Se="Toggle",de=m.forwardRef((t,a)=>{const{pressed:l,defaultPressed:n,onPressedChange:r,...u}=t,[i,o]=oe({prop:l,onChange:r,defaultProp:n??!1,caller:Se});return e.jsx(ae.button,{type:"button","aria-pressed":i,"data-state":i?"on":"off","data-disabled":t.disabled?"":void 0,...u,ref:a,onClick:qe(t.onClick,()=>{t.disabled||o(!i)})})});de.displayName=Se;var Te=de,I="ToggleGroup",[Ie]=Ke(I,[ye]),Pe=ye(),me=w.forwardRef((t,a)=>{const{type:l,...n}=t;if(l==="single"){const r=n;return e.jsx(Ts,{...r,ref:a})}if(l==="multiple"){const r=n;return e.jsx(Is,{...r,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${I}\``)});me.displayName=I;var[ke,Ge]=Ie(I),Ts=w.forwardRef((t,a)=>{const{value:l,defaultValue:n,onValueChange:r=()=>{},...u}=t,[i,o]=oe({prop:l,defaultProp:n??"",onChange:r,caller:I});return e.jsx(ke,{scope:t.__scopeToggleGroup,type:"single",value:w.useMemo(()=>i?[i]:[],[i]),onItemActivate:o,onItemDeactivate:w.useCallback(()=>o(""),[o]),children:e.jsx(Oe,{...u,ref:a})})}),Is=w.forwardRef((t,a)=>{const{value:l,defaultValue:n,onValueChange:r=()=>{},...u}=t,[i,o]=oe({prop:l,defaultProp:n??[],onChange:r,caller:I}),p=w.useCallback(d=>o((f=[])=>[...f,d]),[o]),y=w.useCallback(d=>o((f=[])=>f.filter(P=>P!==d)),[o]);return e.jsx(ke,{scope:t.__scopeToggleGroup,type:"multiple",value:i,onItemActivate:p,onItemDeactivate:y,children:e.jsx(Oe,{...u,ref:a})})});me.displayName=I;var[Ps,ks]=Ie(I),Oe=w.forwardRef((t,a)=>{const{__scopeToggleGroup:l,disabled:n=!1,rovingFocus:r=!0,orientation:u,dir:i,loop:o=!0,...p}=t,y=Pe(l),d=Ue(i),f={role:"group",dir:d,...p};return e.jsx(Ps,{scope:l,rovingFocus:r,disabled:n,children:r?e.jsx(Je,{asChild:!0,...y,orientation:u,dir:d,loop:o,children:e.jsx(ae.div,{...f,ref:a})}):e.jsx(ae.div,{...f,ref:a})})}),Q="ToggleGroupItem",Ae=w.forwardRef((t,a)=>{const l=Ge(Q,t.__scopeToggleGroup),n=ks(Q,t.__scopeToggleGroup),r=Pe(t.__scopeToggleGroup),u=l.value.includes(t.value),i=n.disabled||t.disabled,o={...t,pressed:u,disabled:i},p=w.useRef(null);return n.rovingFocus?e.jsx(Qe,{asChild:!0,...r,focusable:!i,active:u,ref:p,children:e.jsx(ve,{...o,ref:a})}):e.jsx(ve,{...o,ref:a})});Ae.displayName=Q;var ve=w.forwardRef((t,a)=>{const{__scopeToggleGroup:l,value:n,...r}=t,u=Ge(Q,l),i={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},o=u.type==="single"?i:void 0;return e.jsx(de,{...o,...r,ref:a,onPressedChange:p=>{p?u.onItemActivate(n):u.onItemDeactivate(n)}})}),Fe=me,De=Ae;const _e=We("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),Gs=m.forwardRef(({className:t,variant:a,size:l,...n},r)=>e.jsx(Te,{ref:r,className:ie(_e({variant:a,size:l,className:t})),...n}));Gs.displayName=Te.displayName;const Ee=m.createContext({size:"default",variant:"default"}),Re=m.forwardRef(({className:t,variant:a,size:l,children:n,...r},u)=>e.jsx(Fe,{ref:u,className:ie("flex items-center justify-center gap-1",t),...r,children:e.jsx(Ee.Provider,{value:{variant:a,size:l},children:n})}));Re.displayName=Fe.displayName;const ne=m.forwardRef(({className:t,children:a,variant:l,size:n,...r},u)=>{const i=m.useContext(Ee);return e.jsx(De,{ref:u,className:ie(_e({variant:i.variant||l,size:i.size||n}),t),...r,children:a})});ne.displayName=De.displayName;const Os=["Purpose","Scope","Roles & Responsibilities","Policy Statement","Procedures","Review & Approval"];function St(){var pe;const{user:t}=Ne(),[a,l]=m.useState(""),[n,r]=m.useState("all"),[u,i]=m.useState(!1),[o,p]=m.useState(null),[y,d]=m.useState(null),[f,P]=m.useState(""),[C,U]=m.useState("grid"),[k,G]=m.useState(!1),[J,c]=m.useState(!1),[Ve,K]=m.useState(null),[O,R]=m.useState(null),[ue,W]=m.useState(""),{data:T,isLoading:Le,refetch:X}=F.policyTemplates.list.useQuery({framework:n});m.useMemo(()=>new fs,[]);const Y=F.policyTemplates.create.useMutation({onSuccess:()=>{S.success("Template created successfully"),i(!1),W(""),X()},onError:s=>S.error(s.message)}),Z=F.policyTemplates.update.useMutation({onSuccess:()=>{S.success("Template updated successfully"),p(null),X()},onError:s=>S.error(s.message)}),ee=F.policyTemplates.delete.useMutation({onSuccess:()=>{S.success("Template deleted"),R(null),X()},onError:s=>S.error(s.message)}),V=T==null?void 0:T.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())||s.templateId.toLowerCase().includes(a.toLowerCase())),Me=()=>{if(!T||T.length===0)return"POL-001";const s=Math.max(...T.map(g=>{const v=g.templateId.match(/(\d+)$/);return v?parseInt(v[1]):0}));return`POL-${String(s+1).padStart(3,"0")}`},ze=s=>{if(s.preventDefault(),!f){S.error("Please select a framework");return}const g=new FormData(s.currentTarget),x=g.get("sections").split(`
`).filter(se=>se.trim()),A=ue;Y.mutate({templateId:g.get("templateId"),name:g.get("name"),framework:f,sections:x,content:A})},xe=(s,g,v)=>{s.preventDefault();const x=new FormData(s.currentTarget),se=x.get("sections").split(`
`).filter(Be=>Be.trim()),He=v;Z.mutate({id:g,templateId:x.get("templateId"),name:x.get("name"),framework:x.get("framework"),sections:se,content:He})},h=T==null?void 0:T.find(s=>s.id===y),$e=s=>{if(!s)return"";if(/<[a-z][\s\S]*>/i.test(s))return s;try{return Ce.parse(s,{async:!1})}catch{return s}};return e.jsx(ns,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(is,{items:[{label:"Policy Templates"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Policy Templates"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage reusable policy templates for ISO 27001 and SOC 2"})]}),e.jsx(q,{open:u,onOpenChange:i,title:"Create Policy Template",description:"Create a reusable policy template with placeholders for client-specific details.",size:"xl",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(j,{onClick:()=>{const s=document.getElementById("create-template-form");s&&s.requestSubmit()},disabled:Y.isPending,children:Y.isPending?"Creating...":"Create Template"})]}),trigger:e.jsxs(j,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Create Template"]}),children:e.jsx("form",{id:"create-template-form",onSubmit:ze,onReset:()=>{P(""),W("")},children:e.jsxs("div",{className:"grid gap-4 py-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"templateId",children:"Template ID *"}),e.jsx(E,{id:"templateId",name:"templateId",required:!0,defaultValue:Me()})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"framework",children:"Framework *"}),e.jsxs(z,{value:f,onValueChange:P,children:[e.jsx($,{className:f?"":"border-red-500",children:e.jsx(H,{placeholder:"Select"})}),e.jsxs(B,{children:[e.jsx(N,{value:"ISO 27001",children:"ISO 27001"}),e.jsx(N,{value:"SOC 2",children:"SOC 2"}),e.jsx(N,{value:"ISO 27001 / SOC 2",children:"ISO 27001 / SOC 2"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"name",children:"Template Name *"}),e.jsx(E,{id:"name",name:"name",required:!0,placeholder:"Access Control Policy"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"sections",children:"Sections (one per line)"}),e.jsx(ce,{name:"sections",rows:4,defaultValue:Os.join(`
`),placeholder:`Purpose
Scope
Policy Statement...`})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Template Content"}),e.jsx(we,{value:ue,onChange:W,className:"min-h-[300px]"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Available placeholders: ","{{company_name}}",", ","{{system_scope}}",", ","{{policy_name}}",", ","{{effective_date}}",", ","{{review_date}}"]})]})]})})})]}),e.jsxs(L,{className:"border-blue-100 bg-blue-50/30 overflow-hidden transition-all duration-300",children:[e.jsxs(te,{className:"py-3 px-4 flex flex-row items-center justify-between cursor-pointer hover:bg-blue-50/50",onClick:()=>G(!k),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(he,{className:"text-base font-semibold text-blue-900",children:"How to use Policy Templates"})]}),e.jsx(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-100/50",children:k?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(Ye,{className:"h-4 w-4"})})]}),e.jsx("div",{className:k?"block":"hidden",children:e.jsx(M,{className:"px-4 pb-4 pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-medium text-sm",children:[e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-[10px] text-white",children:"1"}),"Strategic Taxonomy"]}),e.jsxs("p",{className:"text-xs text-blue-700/80 leading-relaxed",children:["Link templates to frameworks like ISO 27001 or SOC 2. This creates a ",e.jsx("strong",{children:"cross-mappable library"}),", allowing one policy to satisfy multiple control requirements simultaneously."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-medium text-sm",children:[e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-[10px] text-white",children:"2"}),"Contextual Automation"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-blue-700/80",children:["Use placeholders to convert generic text into ",e.jsx("strong",{children:"client-specific legal records"}),":"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("code",{className:"text-[10px] bg-blue-100/50 px-1 rounded text-blue-700 font-mono",children:"{{company_name}}"}),e.jsx("code",{className:"text-[10px] bg-blue-100/50 px-1 rounded text-blue-700 font-mono",children:"{{system_scope}}"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-medium text-sm",children:[e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-[10px] text-white",children:"3"}),"Drafting Standards"]}),e.jsxs("p",{className:"text-xs text-blue-700/80 leading-relaxed",children:["Maintain ",e.jsx("strong",{children:"formatting consistency"})," across your entire library. Standardized headers and tables ensure that every client export looks professional and follows regulatory layout norms."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-medium text-sm",children:[e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-[10px] text-white",children:"4"}),"Validation Cycles"]}),e.jsxs("p",{className:"text-xs text-blue-700/80 leading-relaxed",children:["Before deploying a template, use ",e.jsx("strong",{children:'"Preview"'})," to verify that your logic holds. Ensure all placeholders are correctly formatted so they resolve perfectly during policy generation."]})]})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search templates...",value:a,onChange:s=>l(s.target.value),className:"pl-10"})]}),e.jsxs(z,{value:n,onValueChange:r,children:[e.jsxs($,{className:"w-48",children:[e.jsx(vs,{className:"mr-2 h-4 w-4"}),e.jsx(H,{})]}),e.jsxs(B,{children:[e.jsx(N,{value:"all",children:"All Frameworks"}),e.jsx(N,{value:"ISO 27001",children:"ISO 27001"}),e.jsx(N,{value:"SOC 2",children:"SOC 2"}),e.jsx(N,{value:"ISO 27001 / SOC 2",children:"ISO 27001 / SOC 2"})]})]}),e.jsx("div",{className:"flex items-center gap-2 border rounded-md p-1 bg-muted/50",children:e.jsxs(Re,{type:"single",value:C,onValueChange:s=>s&&U(s),children:[e.jsx(ne,{value:"grid","aria-label":"Grid view",className:"h-8 w-8 p-0",children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx(ne,{value:"table","aria-label":"Table view",className:"h-8 w-8 p-0",children:e.jsx(ys,{className:"h-4 w-4"})})]})})]}),Le?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsxs(L,{children:[e.jsxs(te,{children:[e.jsx(re,{className:"h-6 w-32"}),e.jsx(re,{className:"h-4 w-24"})]}),e.jsx(M,{children:e.jsx(re,{className:"h-20 w-full"})})]},s))}):V&&V.length>0?C==="grid"?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:V.map(s=>{var v;const g=Array.isArray(s.sections)?s.sections:[];return e.jsxs(L,{className:"card-interactive card-accent-left group cursor-pointer",onClick:()=>d(s.id),children:[e.jsxs(te,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground uppercase tracking-tight",children:s.templateId})}),e.jsx(he,{className:"text-xl font-bold",children:s.name}),e.jsx(Ze,{className:"text-xs font-medium text-muted-foreground",children:(v=s.frameworks)==null?void 0:v.join(" / ")})]}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),e.jsx(M,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest opacity-70",children:"Sections Included"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[g.slice(0,4).map((x,A)=>e.jsx("div",{className:"bg-secondary px-2 py-1 rounded text-[10px] font-medium border border-transparent group-hover:border-secondary-foreground/20 transition-colors",children:typeof x=="object"&&x!==null?x.title||"Section":String(x)},A)),g.length>4&&e.jsxs("div",{className:"bg-secondary px-2 py-1 rounded text-[10px] font-medium border border-transparent group-hover:border-secondary-foreground/20 transition-colors",children:["+",g.length-4," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border/50",children:[e.jsxs("span",{className:"text-[10px] font-semibold text-muted-foreground flex items-center gap-1.5 uppercase tracking-tighter",children:[e.jsx(Ns,{className:"h-3 w-3 text-primary"}),"Template Ready"]}),e.jsxs("div",{className:"flex gap-2",onClick:x=>x.stopPropagation(),children:[e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10 group/trash",onClick:()=>R(s),children:e.jsx(je,{className:"h-4 w-4 text-muted-foreground group-hover/trash:text-destructive transition-colors"})}),e.jsx(be,{template:s,editingTemplate:o,setEditingTemplate:p,updateMutation:Z,handleUpdate:xe,onGenerate:x=>{K(x),c(!0)}}),e.jsxs(j,{size:"sm",variant:"outline",className:"h-8 gap-1.5 border-primary/20 bg-primary/5 text-primary hover:bg-primary/10 hover:text-primary hover:border-primary/30 transition-all font-semibold text-xs px-3",onClick:()=>{K(s),c(!0)},children:["Generate",e.jsx(ws,{className:"h-3 w-3"})]})]})]})]})})]},s.id)})}):e.jsx("div",{className:"border rounded-lg overflow-hidden shadow-xl bg-white",children:e.jsxs(es,{className:"table-fancy",children:[e.jsx(ss,{children:e.jsxs(fe,{children:[e.jsx(D,{className:"w-[120px]",children:"ID"}),e.jsx(D,{children:"Template Name"}),e.jsx(D,{children:"Frameworks"}),e.jsx(D,{children:"Sections"}),e.jsx(D,{className:"text-right",children:"Actions"})]})}),e.jsx(ts,{children:V.map(s=>{var v;const g=Array.isArray(s.sections)?s.sections:[];return e.jsxs(fe,{children:[e.jsx(_,{className:"font-mono text-sm",children:s.templateId}),e.jsx(_,{className:"font-medium",children:s.name}),e.jsx(_,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(v=s.frameworks)==null?void 0:v.map((x,A)=>e.jsx(rs,{variant:"outline",className:"text-[10px] uppercase",children:x},A))})}),e.jsx(_,{children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:[g.length," sections"]})}),e.jsx(_,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(s.id),children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx(be,{template:s,editingTemplate:o,setEditingTemplate:p,updateMutation:Z,handleUpdate:xe,onGenerate:x=>{K(x),c(!0)}}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>R(s),children:e.jsx(je,{className:"h-4 w-4"})})]})})]},s.id)})})]})}):e.jsx(L,{className:"py-12",children:e.jsxs(M,{className:"text-center",children:[e.jsx(ge,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No templates found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a?"Try adjusting your search":"Get started by creating your first template"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="owner"||(t==null?void 0:t.role)==="super_admin")&&!a&&e.jsxs(j,{onClick:()=>i(!0),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Create First Template"]})]})}),e.jsx(q,{open:!!y,onOpenChange:()=>d(null),title:h==null?void 0:h.name,description:`${h==null?void 0:h.templateId} â€¢ ${(pe=h==null?void 0:h.frameworks)==null?void 0:pe.join(" / ")}`,size:"xl",children:e.jsxs("div",{className:"max-h-[80vh] overflow-y-auto space-y-4 py-4 pr-2",children:[(()=>{const s=h==null?void 0:h.sections;return!s||!Array.isArray(s)||s.length===0?null:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Sections"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((g,v)=>e.jsx("span",{className:"px-3 py-1 bg-muted rounded-full text-sm",children:String(g)},v))})]})})(),(h==null?void 0:h.content)&&e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-slate-200",children:[e.jsx("h4",{className:"font-medium mb-4 text-sm text-slate-500 uppercase tracking-wider",children:"Preview"}),e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:$e(h.content)}})]})]})}),e.jsx(cs,{open:!!O,onOpenChange:s=>!s&&R(null),children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(us,{children:"Are you sure?"}),e.jsxs(xs,{children:["This action cannot be undone. This will permanently delete the policy template",e.jsxs("span",{className:"font-semibold text-foreground",children:[' "',O==null?void 0:O.name,'"']}),"."]})]}),e.jsxs(ps,{children:[e.jsx(hs,{children:"Cancel"}),e.jsx(gs,{className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",onClick:()=>{O&&ee.mutate({id:O.id})},disabled:ee.isPending,children:ee.isPending?"Deleting...":"Delete Template"})]})]})}),e.jsx(As,{open:J,onOpenChange:c,template:Ve})]})})}function As({open:t,onOpenChange:a,template:l}){const{selectedClientId:n}=as(),{user:r}=Ne(),[u,i]=ls(),[o,p]=m.useState(null),[y,d]=m.useState(""),[f,P]=m.useState(!0),{data:C,isLoading:U}=F.clients.list.useQuery({},{enabled:t});m.useEffect(()=>{t&&(n?p(n):C&&C.length===1&&p(C[0].id))},[t,n,C]);const k=(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="owner"||(r==null?void 0:r.role)==="super_admin",G=F.clientPolicies.create.useMutation({onSuccess:c=>{S.success("Policy generated successfully"),a(!1),c!=null&&c.id&&(c!=null&&c.clientId)&&i(`/clients/${c.clientId}/policies/${c.id}`)},onError:c=>S.error(c.message)}),J=()=>{if(!o){S.error("Please select a client");return}G.mutate({clientId:o,templateId:l.id,name:l.name,tailor:f,instruction:y||void 0,status:"draft",module:"general"})};return e.jsx(q,{open:t,onOpenChange:a,title:"Generate Client Policy",description:`Create a new policy for a client based on "${l==null?void 0:l.name}"`,size:"lg",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(j,{onClick:J,disabled:G.isPending||!o,children:G.isPending?"Generating...":"Generate Policy"})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Select Client *"}),e.jsxs(z,{value:o==null?void 0:o.toString(),onValueChange:c=>p(parseInt(c)),disabled:!k&&!!o,children:[e.jsx($,{children:e.jsx(H,{placeholder:U?"Loading clients...":"Select a client"})}),e.jsx(B,{children:C==null?void 0:C.map(c=>e.jsx(N,{value:c.id.toString(),children:c.name},c.id))})]}),!k&&o&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Policy will be generated for your active organization."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"instruction",children:"Custom Instructions (Optional)"}),e.jsx(ce,{id:"instruction",placeholder:"e.g. Include specific requirements for our cloud infrastructure...",value:y,onChange:c=>d(c.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"tailor",checked:f,onChange:c=>P(c.target.checked),className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx(b,{htmlFor:"tailor",className:"text-sm font-normal",children:"Tailor content to client's industry and context"})]}),G.isPending&&e.jsx("div",{className:"p-4 bg-muted rounded-lg animate-pulse text-sm text-center",children:"AI is generating your policy... This may take a few seconds."})]})})}function be({template:t,editingTemplate:a,setEditingTemplate:l,updateMutation:n,handleUpdate:r,onGenerate:u}){var y;const i=Array.isArray(t.sections)?t.sections:[],[o,p]=m.useState(()=>{const d=t.content||"";if(/<[a-z][\s\S]*>/i.test(d))return d;try{return Ce.parse(d,{async:!1})}catch{return d}});return e.jsx(q,{open:a===t.id,onOpenChange:d=>l(d?t.id:null),title:"Edit Template",size:"xl",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsxs(j,{type:"button",variant:"secondary",className:"mr-auto bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100",onClick:()=>u(t),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Generate Policy From Template"]}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>l(null),children:"Cancel"}),e.jsx(j,{onClick:()=>{const d=document.getElementById(`edit-template-form-${t.id}`);d&&d.requestSubmit()},disabled:n.isPending,children:n.isPending?"Saving...":"Save Changes"})]}),trigger:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ss,{className:"h-4 w-4"})}),children:e.jsx("form",{id:`edit-template-form-${t.id}`,onSubmit:d=>r(d,t.id,o),children:e.jsxs("div",{className:"grid gap-4 py-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"templateId",children:"Template ID"}),e.jsx(E,{name:"templateId",defaultValue:t.templateId,className:"border-2 border-slate-300 bg-slate-50 focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"framework",children:"Framework"}),e.jsxs(z,{name:"framework",defaultValue:((y=t.frameworks)==null?void 0:y[0])||"",children:[e.jsx($,{className:"border-2 border-slate-300 bg-slate-50 focus:ring-2 focus:ring-primary/20",children:e.jsx(H,{})}),e.jsxs(B,{children:[e.jsx(N,{value:"ISO 27001",children:"ISO 27001"}),e.jsx(N,{value:"SOC 2",children:"SOC 2"}),e.jsx(N,{value:"ISO 27001 / SOC 2",children:"ISO 27001 / SOC 2"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"name",children:"Template Name"}),e.jsx(E,{name:"name",defaultValue:t.name,className:"border-2 border-slate-300 bg-slate-50 focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"sections",children:"Sections (one per line)"}),e.jsx(ce,{name:"sections",rows:4,className:"font-mono text-sm border-2 border-slate-300 bg-slate-50 focus:ring-2 focus:ring-primary/20",defaultValue:i.join(`
`)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Template Content"}),e.jsx(we,{value:o,onChange:p,className:"min-h-[400px]"})]})]})})})}export{St as default};
