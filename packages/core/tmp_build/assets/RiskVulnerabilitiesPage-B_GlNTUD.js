import{ab as M,u as P,b as E,r as v,t as b,R as A,j as e,c as O,I as R,aA as U,aB as Q,k as $,aC as z}from"./index-DOc7Nwb7.js";import{D as J}from"./DashboardLayout-aHnUqq57.js";import{A as B,a as F,b as H}from"./alert-BudCfM-X.js";import{P as G}from"./PageGuide-CPKKXXS6.js";import{P as q}from"./plus-BaQ35Jcx.js";import{I as W}from"./info-By5wLOUH.js";import{F as S}from"./flame-BhFhwlpV.js";import{S as X}from"./search-CwuIBBPE.js";import{A as Y,a as Z}from"./arrow-up-B1n-fuue.js";import{A as _}from"./arrow-up-down-BDk2lJRe.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";function Fe(){const y=M(),D=y.id?Number(y.id):null,{user:ee,client:c}=P(),[te,j]=E(),[n,I]=v.useState(""),[r,k]=v.useState(null),w=D||(c==null?void 0:c.id),{data:C,isLoading:se}=b.clients.get.useQuery({id:w||0},{enabled:!!w&&!c}),g=c||C,x=(g==null?void 0:g.id)||0,{data:p,isLoading:L,refetch:re}=b.risks.getVulnerabilities.useQuery({clientId:x},{enabled:!!x}),{data:d}=b.adversaryIntel.getSecurityFeeds.useQuery({limit:200},{staleTime:1e3*60*15}),h=A.useMemo(()=>{const t=new Map;return d!=null&&d.items&&d.items.forEach(s=>{s.cveIds&&s.cveIds.length>0&&s.cveIds.forEach(a=>{const i=t.get(a)||[];i.includes(s.title)||(i.push(s.title),t.set(a,i))})}),t},[d]),N=A.useMemo(()=>{let t=(p==null?void 0:p.filter(s=>{var a;return s.name.toLowerCase().includes(n.toLowerCase())||s.vulnerabilityId.toLowerCase().includes(n.toLowerCase())||((a=s.cveId)==null?void 0:a.toLowerCase().includes(n.toLowerCase()))}))||[];return r!==null&&t.sort((s,a)=>{var m,f;let i=s[r.key],o=a[r.key];if(r.key==="severity"){const u={Critical:4,High:3,Medium:2,Low:1,Info:0};i=u[i]||-1,o=u[o]||-1}return r.key==="affectedAssets"&&(i=typeof s.affectedAssets=="string"?JSON.parse(s.affectedAssets).length:((m=s.affectedAssets)==null?void 0:m.length)||0,o=typeof a.affectedAssets=="string"?JSON.parse(a.affectedAssets).length:((f=a.affectedAssets)==null?void 0:f.length)||0),i<o?r.direction==="asc"?-1:1:i>o?r.direction==="asc"?1:-1:0}),t},[p,n,r]),V=t=>{let s="asc";r&&r.key===t&&r.direction==="asc"&&(s="desc"),k({key:t,direction:s})},l=({label:t,sortKey:s})=>{const a=(r==null?void 0:r.key)===s;return e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors select-none group",onClick:()=>V(s),children:e.jsxs("div",{className:"flex items-center gap-2",children:[t,a?(r==null?void 0:r.direction)==="asc"?e.jsx(Y,{className:"w-3.5 h-3.5"}):e.jsx(Z,{className:"w-3.5 h-3.5"}):e.jsx(_,{className:"w-3.5 h-3.5 opacity-0 group-hover:opacity-50 transition-opacity"})]})})},T=()=>{j(`/clients/${x}/risks/vulnerabilities/new`)},K=t=>{j(`/clients/${x}/risks/vulnerabilities/${t.id}`)};return e.jsx(J,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Vulnerability Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track and manage vulnerabilities across your assets."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{onClick:T,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Record Vulnerability"]}),e.jsx(G,{title:"Vulnerability Management",description:"Centrally track, prioritize, and remediate technical security flaws.",rationale:"Unpatched vulnerabilities are a leading cause of data breaches. Systematic tracking ensures critical issues aren't ignored.",howToUse:[{step:"Review Live Threats",description:"Check for the flame icon to see vulnerabilities actively being exploited in the wild."},{step:"Search & Filter",description:"Use the search bar to find specific CVEs or filter by asset name."},{step:"Prioritize",description:"Sort by 'Severity' or 'Due Date' to focus on the most urgent fixes first."}],integrations:[{name:"Threat Intelligence",description:"Automatically flags vulnerabilities associated with active malware campaigns."},{name:"Risk Assessments",description:"Vulnerabilities listed here serve as inputs for detailed risk scenarios."}]})]})]}),e.jsxs(B,{className:"bg-blue-50 border-blue-200",children:[e.jsx(W,{className:"h-4 w-4 text-blue-600"}),e.jsx(F,{className:"text-blue-800",children:"Live Threat Integration Active"}),e.jsxs(H,{className:"text-blue-700 text-sm mt-1",children:["Vulnerabilities marked with the ",e.jsx(S,{className:"w-3 h-3 inline text-red-600 mx-1"})," icon match active security threats in the wild (CISA KEV, etc.). Prioritize remediation for these items immediately."]})]}),e.jsx("div",{className:"flex gap-4 items-center bg-card p-4 rounded-xl border shadow-sm",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(R,{placeholder:"Search vulnerabilities...",value:n,onChange:t=>I(t.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#1C4D8D]",children:[e.jsx(l,{label:"ID",sortKey:"vulnerabilityId"}),e.jsx(l,{label:"Name",sortKey:"name"}),e.jsx(l,{label:"Severity",sortKey:"severity"}),e.jsx(l,{label:"CVSS",sortKey:"cvssScore"}),e.jsx(l,{label:"Affected Assets",sortKey:"affectedAssets"}),e.jsx(l,{label:"Status",sortKey:"status"}),e.jsx(l,{label:"Discovery",sortKey:"discoveryDate"}),e.jsx(l,{label:"Owner",sortKey:"owner"}),e.jsx(l,{label:"Due Date",sortKey:"dueDate"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 bg-white",children:"Loading vulnerabilities..."})}):N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 bg-white",children:"No vulnerabilities found."})}):N.map(t=>{var s,a,i,o,m;return e.jsxs("tr",{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm cursor-pointer group",onDoubleClick:()=>K(t),children:[e.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-500",children:t.vulnerabilityId}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-black flex items-center gap-2",children:[t.name,t.cveId&&h.has(t.cveId)&&e.jsxs(U,{children:[e.jsx(Q,{asChild:!0,children:e.jsx($,{className:"bg-red-50 text-red-600 hover:bg-red-100 border-red-200 cursor-help p-1 h-6 w-6 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 shadow-sm",children:e.jsx(S,{className:"w-3.5 h-3.5 fill-red-500 animate-pulse"})})}),e.jsxs(z,{className:"max-w-[300px]",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Active Threats Detected:"}),e.jsxs("ul",{className:"list-disc list-inside text-xs space-y-1",children:[(s=h.get(t.cveId))==null?void 0:s.slice(0,3).map((f,u)=>e.jsx("li",{children:f},u)),(((a=h.get(t.cveId))==null?void 0:a.length)||0)>3&&e.jsxs("li",{children:["...and ",(((i=h.get(t.cveId))==null?void 0:i.length)||0)-3," more"]})]})]})]})]}),t.cveId&&e.jsx("div",{className:"text-xs text-gray-500",children:t.cveId})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${t.severity==="Critical"?"bg-red-50 text-red-700 border-red-200":t.severity==="High"?"bg-orange-50 text-orange-700 border-orange-200":t.severity==="Medium"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-green-50 text-green-700 border-green-200"}`,children:t.severity||"Unknown"})}),e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-800",children:t.cvssScore}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 max-w-[200px] truncate",title:typeof t.affectedAssets=="string"?JSON.parse(t.affectedAssets).join(", "):(o=t.affectedAssets)==null?void 0:o.join(", "),children:typeof t.affectedAssets=="string"?JSON.parse(t.affectedAssets).join(", "):((m=t.affectedAssets)==null?void 0:m.join(", "))||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize border ${t.status==="open"?"bg-blue-50 text-blue-700 border-blue-200":t.status==="remediated"?"bg-green-50 text-green-700 border-green-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.discoveryDate?new Date(t.discoveryDate).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.owner||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.dueDate?new Date(t.dueDate).toLocaleDateString():"-"})]},t.id)})})]})})})]})})}export{Fe as default};
