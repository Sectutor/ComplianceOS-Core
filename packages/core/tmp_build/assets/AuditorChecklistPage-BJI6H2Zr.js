import{ab as L,r as f,t as u,i as j,j as e,x as b,k as i,c as v,C as p,z as A,I as F,m as O}from"./index-DOc7Nwb7.js";import{S as N}from"./separator-BWuYil37.js";import{S as R}from"./shield-check-ETs8j4-d.js";import{D}from"./download-ByfWg1Mi.js";import{C as M}from"./circle-check-C5kiwRoG.js";import{S as Q}from"./search-CwuIBBPE.js";import{F as w}from"./file-check-De1wUTh7.js";const U=["ISO 27001","SOC 2","GDPR","HIPAA"];function q(){const k=L(),l=parseInt(k.id||"0"),[n,y]=f.useState("ISO 27001"),[d,C]=f.useState(""),{data:t,isLoading:S}=u.auditors.getScope.useQuery({clientId:l}),c=t==null?void 0:t.client,o=t==null?void 0:t.stats,{data:m,isLoading:E}=u.evidence.list.useQuery({clientId:l,framework:n}),P=S||E,x=u.evidence.pack.useMutation({onSuccess:s=>{j.success("Evidence Pack Generated",{description:`Ready for download: ${s.filename}`}),window.open(s.url,"_blank")},onError:s=>{j.error("Failed to generate pack",{description:s.message})}}),I=()=>{x.mutate({clientId:l,framework:n})};if(P)return e.jsx("div",{className:"flex h-screen items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(b,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Loading Auditor Workspace..."})]})});const g=(m==null?void 0:m.filter(s=>{var r,a;return((r=s.description)==null?void 0:r.toLowerCase().includes(d.toLowerCase()))||((a=s.controlId)==null?void 0:a.toLowerCase().includes(d.toLowerCase()))}))||[],h=g.reduce((s,r)=>{const a=r.controlId||"Unmapped";return s[a]||(s[a]=[]),s[a].push(r),s},{});return e.jsxs("div",{className:"min-h-screen bg-slate-50/50 dark:bg-slate-950",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-16 items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(R,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Auditor Workspace"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Read-Only Access • ",(c==null?void 0:c.name)||`Client #${l}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[o&&e.jsxs("div",{className:"flex gap-2 mr-4 hidden md:flex items-center",children:[e.jsxs(i,{variant:"secondary",className:"bg-blue-50 text-blue-700 border-blue-200 h-8 px-3",children:[o.complianceScore,"% Compliant"]}),e.jsxs(i,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200 h-8 px-3",children:[o.evidenceStatus.verified," Verified Proofs"]})]}),e.jsxs(v,{onClick:I,disabled:x.isPending,className:"gap-2 shadow-lg shadow-primary/20 transition-all hover:shadow-primary/40",children:[x.isPending?e.jsx(b,{className:"h-4 w-4 animate-spin"}):e.jsx(D,{className:"h-4 w-4"}),"Download Evidence Pack"]})]})]})}),e.jsx("main",{className:"container py-8",children:e.jsx("div",{className:"grid gap-6",children:e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row",children:[e.jsxs(p,{className:"h-fit w-full md:w-64 shrink-0 border-none shadow-sm bg-transparent",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"mb-2 px-2 text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Frameworks"}),e.jsx("nav",{className:"flex flex-col space-y-1",children:U.map(s=>e.jsxs("button",{onClick:()=>y(s),className:`flex items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors ${n===s?"bg-primary text-primary-foreground shadow-md":"text-muted-foreground hover:bg-slate-200/50 dark:hover:bg-slate-800/50"}`,children:[s,n===s&&e.jsx(M,{className:"h-4 w-4"})]},s))})]}),e.jsx(N,{className:"my-4"}),e.jsx("div",{className:"px-2",children:e.jsxs("div",{className:"rounded-lg border bg-card p-4 text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(A,{className:"h-4 w-4 text-blue-500"}),"Audit Instructions"]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground leading-relaxed",children:`This workspace provides a scoped view of the client's compliance posture. Use the "Download Evidence Pack" button to get a verified archive of all evidence.`})]})})]}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Q,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search controls or evidence...",className:"pl-9 bg-background border-slate-200 dark:border-slate-800",value:d,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[g.length," Evidence Items"]}),e.jsx(N,{orientation:"vertical",className:"h-4"}),e.jsxs("span",{children:[Object.keys(h).length," Controls Covered"]})]})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(h).length===0?e.jsxs(p,{className:"flex flex-col items-center justify-center p-12 text-center border-dashed",children:[e.jsx("div",{className:"rounded-full bg-slate-100 p-4 dark:bg-slate-800 mb-4",children:e.jsx(w,{className:"h-8 w-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Evidence Found"}),e.jsxs("p",{className:"text-sm text-muted-foreground max-w-sm mt-2",children:["There is no evidence mapped to ",n," controls yet, or your search query returned no results."]})]}):Object.entries(h).map(([s,r])=>e.jsxs(p,{className:"overflow-hidden transition-all hover:shadow-md border-l-4 border-l-primary/50",children:[e.jsxs("div",{className:"border-b bg-slate-50/50 px-6 py-3 dark:bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"secondary",className:"font-mono bg-slate-200 dark:bg-slate-800",children:s}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["Mapped Items: ",r.length]})]}),e.jsx(i,{variant:r.some(a=>a.status==="verified")?"default":"outline",children:r.some(a=>a.status==="verified")?"Verified":"Pending Review"})]}),e.jsx(O,{className:"p-0",children:e.jsx("ul",{className:"divide-y",children:r.map(a=>e.jsxs("li",{className:"flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-slate-900/20 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-8 w-8 shrink-0 items-center justify-center rounded bg-blue-50 text-blue-600 dark:bg-blue-950/30 dark:text-blue-400",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:a.description||"Untitled Evidence"}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground line-clamp-1",children:["Source: ",a.source||"Manual Upload"," • ",new Date(a.createdAt).toLocaleDateString()]})]})]}),e.jsx(v,{variant:"ghost",size:"sm",className:"h-8 text-xs",children:"View"})]},a.id))})})]},s))})]})]})})})]})}export{q as default};
