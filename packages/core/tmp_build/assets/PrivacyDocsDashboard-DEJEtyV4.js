import{ab as X,u as Z,b as _,t as d,r as i,i as m,j as e,A as g,c as n,F as I,S as ee,L as A,I as se,N as te,O as ae,P as O,Q as j,V as re,W as f,k as ie,C as ne,m as oe}from"./index-DOc7Nwb7.js";import{PrivacyLayout as E}from"./PrivacyLayout-DsfVWdDj.js";import{E as ce}from"./enhanced-dialog-CeRPsI16.js";import{S as le}from"./switch-B74-5eCi.js";import{T as de}from"./textarea-BtxBxzdY.js";import{B as me}from"./Breadcrumb-CRi3LAxS.js";import{u as ue}from"./useStreamingAI-BxE0sscp.js";import{P as pe}from"./PageGuide-CPKKXXS6.js";import{A as xe,a as he,b as ge,c as je,d as fe,e as ve,f as be,g as ye}from"./alert-dialog-V7xGXdVc.js";import{P as z}from"./plus-BaQ35Jcx.js";import{S as B}from"./sparkles-CoQ80pK2.js";import{S as Ne}from"./square-pen-ClRv15cM.js";import{T as we}from"./trash-2-CFEfisbM.js";import"./DashboardLayout-aHnUqq57.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./utils-BC5CVi_C.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function ys(){const T=X(),G=T.clientId||T.id,t=parseInt(G||"0"),{user:Pe}=Z(),[De,k]=_(),{data:r,isLoading:M}=d.clients.get.useQuery({id:t},{enabled:t>0}),{data:v,isLoading:q,refetch:L}=d.clientPolicies.list.useQuery({clientId:t,module:"privacy"},{enabled:t>0}),{data:b}=d.policyTemplates.list.useQuery(),[F,c]=i.useState(!1),[Ce,Se]=i.useState(!1),[l,y]=i.useState("select"),[N,u]=i.useState(),[R,Q]=i.useState(!1),[p,x]=i.useState(""),[w,P]=i.useState(null),{text:h,isLoading:D,generate:W,reset:H}=ue(),C=d.clientPolicies.create.useMutation({onSuccess:()=>{m.success("Document created"),c(!1),L(),H(),y("select"),u(void 0),x("")},onError:s=>m.error(s.message)}),U=d.clientPolicies.delete.useMutation({onSuccess:()=>{m.success("Document deleted"),L(),P(null)},onError:s=>m.error(s.message)}),V=s=>{s.preventDefault();const o=new FormData(s.currentTarget).get("name"),S=N?parseInt(N):void 0;C.mutate({clientId:t,templateId:S||void 0,name:o,content:h||"",tailor:R,instruction:p||"",module:"privacy"})};if(M)return e.jsx(E,{clientId:t,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{className:"h-8 w-64"}),e.jsx(g,{className:"h-32 w-full"})]})});if(!r)return null;const K=["privacy","gdpr","data protection","data retention","data breach","dsar","dpa","lia","legitimate interests","data processing","subject rights","consent","data subject"],Y=[{name:"Privacy Policy / Notice",description:"External-facing transparency document for data subjects."},{name:"Legitimate Interests Assessment (LIA)",description:"Assessment for processing based on legitimate interests."},{name:"Data Retention Schedule",description:"Policy defining how long data types are kept."},{name:"Data Subject Rights Procedure",description:"Internal procedure for handling SARs/DSARs."}],$=(b==null?void 0:b.filter(s=>K.some(a=>s.name.toLowerCase().includes(a))))||[],J=$.length>0?$.map(s=>({id:s.id,name:s.name,description:"GDPR/Privacy Template"})):Y;return e.jsx(E,{clientId:t,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Privacy",href:`/clients/${t}/privacy`},{label:"Documentation"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 animate-slide-down",children:[e.jsx(pe,{title:"Privacy Documentation",description:"Manage and autogenerate privacy policies and notices.",rationale:"Demonstrate accountability with documented procedures (GDPR Art. 24).",howToUse:[{step:"Create",description:"Use AI templates for Notices, LIAs, and Procedures."},{step:"Review",description:"Tailor content to your specific processing activities."},{step:"Publish",description:"Approve versioned documents for compliance evidence."}]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(n,{onClick:()=>c(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Create Document"]})})]}),e.jsxs(ce,{open:F,onOpenChange:c,title:l==="select"?"Select Document Type":"Configure Document",description:l==="select"?"Choose a common privacy document type or start blank.":"Customize your document.",size:"xl",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),l==="config"&&e.jsx(n,{onClick:()=>{const s=document.getElementById("add-privacy-doc-form");s&&s.requestSubmit()},disabled:C.isPending,children:C.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-pulse"}),"Generating..."]}):"Create Document"})]}),children:[l==="select"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all hover:border-blue-500 hover:bg-blue-50/50 ${N===void 0?"border-primary ring-2 ring-primary/30":""}`,onClick:()=>{u(void 0),x(""),y("config")},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-md",children:e.jsx(I,{className:"h-6 w-6 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Blank Document"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start from scratch"})]})]})}),J.map((s,a)=>e.jsx("div",{className:"border rounded-lg p-4 cursor-pointer transition-all hover:border-blue-500 hover:bg-blue-50/50",onClick:()=>{s.id?u(s.id.toString()):u(void 0),x(`Create a comprehensive ${s.name}.`),y("config"),setTimeout(()=>{const o=document.querySelector('input[name="name"]');o&&(o.value=s.name)},100)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-md",children:e.jsx(ee,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description||"compliance template"})]})]})},a))]})}),l==="config"&&e.jsxs("form",{id:"add-privacy-doc-form",onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Document Name"}),e.jsx(se,{name:"name",placeholder:"e.g. Data Retention Policy",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-3 bg-muted/30",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium",children:"Tailor to Industry"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Customize for ",(r==null?void 0:r.industry)||"industry standards"]})]}),e.jsx(le,{checked:R,onCheckedChange:Q})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-xs text-muted-foreground mb-1.5 block",children:"AI Instructions (Optional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(de,{placeholder:"e.g., 'Ensure it covers California residents specifically'",value:p,onChange:s=>x(s.target.value),className:"h-20 text-sm resize-none"})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(n,{type:"button",size:"sm",onClick:()=>{const s=document.querySelector('input[name="name"]');if(!(s!=null&&s.value)){m.error("Please enter a name first");return}const a=(r==null?void 0:r.industry)||"technology",o=`You are an expert Privacy Officer writing a ${s.value} for a company in the ${a} industry. Write in Markdown. Do NOT wrap in code blocks.`,S=p?`Instructions: ${p}`:`Write a standard, comprehensive ${s.value}.`;W({systemPrompt:o,userPrompt:S,temperature:.7})},disabled:D,className:"w-full bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(B,{className:"h-3 w-3 mr-2"}),D?"Generating...":"Generate Preview"]})}),(D||h)&&e.jsx("div",{className:"border rounded-md p-3 max-h-[200px] overflow-y-auto bg-background text-xs font-mono",children:h?e.jsx("div",{className:"whitespace-pre-wrap",children:h}):e.jsx("div",{className:"flex items-center justify-center text-muted-foreground h-16",children:e.jsx("span",{className:"animate-pulse",children:"Waiting for AI..."})})})]})]})]}),e.jsx(xe,{open:!!w,onOpenChange:()=>P(null),children:e.jsxs(he,{children:[e.jsxs(ge,{children:[e.jsx(je,{children:"Delete Document?"}),e.jsx(fe,{children:"Accidental deletion cannot be undone."})]}),e.jsxs(ve,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(ye,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>w&&U.mutate({id:w}),children:"Delete"})]})]})}),q?e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{className:"h-12 w-full"}),e.jsx(g,{className:"h-12 w-full"})]}):v&&v.length>0?e.jsx("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden bg-white",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(O,{className:"bg-slate-50",children:[e.jsx(j,{className:"w-[400px]",children:"Document Name"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"text-center",children:"Version"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:(v||[]).map(s=>e.jsxs(O,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>k(`/clients/${t}/privacy/documents/${s.id}`),children:[e.jsx(f,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100/50",children:e.jsx(I,{className:"h-4 w-4 text-blue-600"})}),e.jsx("span",{children:s.name})]})}),e.jsx(f,{children:e.jsx(ie,{variant:s.status==="approved"?"default":"outline",children:s.status})}),e.jsx(f,{className:"text-center",children:e.jsxs("span",{className:"text-xs bg-slate-100 px-2 py-1 rounded",children:["v",s.version]})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(n,{size:"icon",variant:"ghost",onClick:a=>{a.stopPropagation(),k(`/clients/${t}/privacy/documents/${s.id}`)},children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:a=>{a.stopPropagation(),P(s.id)},children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id))})]})}):e.jsx(ne,{className:"py-12 border-dashed",children:e.jsxs(oe,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"h-8 w-8 text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-900",children:"No Privacy Documents"}),e.jsx("p",{className:"text-slate-500 max-w-sm mx-auto mb-6",children:"Create your Privacy Policy, Retention Schedule, and other key documents here."}),e.jsxs(n,{onClick:()=>c(!0),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Create Document"]})]})})]})})}export{ys as default};
