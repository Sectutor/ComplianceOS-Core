import{j as e,I as g,c as p,N as q,O as k,P as b,Q as j,V as A,W as v,E,G as L,H as Q,J as $,K as N,v as P,ab as F,ac as D,b as z,r as S,t as w,i as f,C as M,m as R,L as T}from"./index-DOc7Nwb7.js";import{T as _}from"./trash-Dn_qaYuR.js";import{P as C}from"./plus-BaQ35Jcx.js";import{P as G}from"./PageGuide-CPKKXXS6.js";import{A as H}from"./arrow-left-CpuUojG-.js";import{S as O}from"./save-CvVmWchr.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";function U({sections:r,onChange:l}){const u=(t,s,a,c)=>{const i=[...r];i[t].questions[s]={...i[t].questions[s],[a]:c},l(i)},h=(t,s)=>{const a=[...r];a[t].questions.splice(s,1),l(a)},d=t=>{const s=[...r];s[t].questions.push({id:`q_${Date.now()}`,text:"",type:"yes_no",required:!0}),l(s)},m=(t,s)=>{const a=[...r];a[t].title=s,l(a)},x=()=>{l([...r,{title:"New Section",questions:[]}])},n=t=>{const s=[...r];s.splice(t,1),l(s)};return e.jsxs("div",{className:"space-y-8",children:[r.map((t,s)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(g,{value:t.title,onChange:a=>m(s,a.target.value),className:"font-bold text-lg border-transparent hover:border-input focus:border-input w-full md:w-1/2",placeholder:"Section Title"}),e.jsx("div",{className:"flex-1"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>n(s),className:"text-destructive hover:bg-destructive/10",children:"Remove Section"})]}),e.jsx("div",{className:"rounded-md border bg-white",children:e.jsxs(q,{children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(j,{className:"w-[100px]",children:"ID"}),e.jsx(j,{children:"Question Text"}),e.jsx(j,{className:"w-[150px]",children:"Type"}),e.jsx(j,{className:"w-[80px]",children:"Req."}),e.jsx(j,{className:"w-[50px]"})]})}),e.jsx(A,{children:t.questions.map((a,c)=>e.jsxs(b,{children:[e.jsx(v,{children:e.jsx(g,{value:a.id,onChange:i=>u(s,c,"id",i.target.value),className:"h-8 text-xs font-mono"})}),e.jsx(v,{children:e.jsx(g,{value:a.text,onChange:i=>u(s,c,"text",i.target.value),className:"h-8",placeholder:"Enter question..."})}),e.jsx(v,{children:e.jsxs(E,{value:a.type,onValueChange:i=>u(s,c,"type",i),children:[e.jsx(L,{className:"h-8",children:e.jsx(Q,{})}),e.jsxs($,{children:[e.jsx(N,{value:"yes_no",children:"Yes/No"}),e.jsx(N,{value:"text",children:"Text"}),e.jsx(N,{value:"file_upload",children:"File Upload"}),e.jsx(N,{value:"multiple_choice",children:"Multi-Choice"})]})]})}),e.jsx(v,{children:e.jsx(P,{checked:a.required,onCheckedChange:i=>u(s,c,"required",!!i)})}),e.jsx(v,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>h(s,c),children:e.jsx(_,{className:"h-4 w-4"})})})]},`${s}-${c}`))})]})}),e.jsxs(p,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>d(s),children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," Add Question"]})]},s)),e.jsxs(p,{className:"w-full border-dashed",variant:"outline",onClick:x,children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," Add New Section"]})]})}function te(){const{id:r,templateId:l}=F(),{selectedClientId:u}=D(),[,h]=z(),d=u||(r?parseInt(r):null),m=l==="new",x=!m&&l?parseInt(l):null,[n,t]=S.useState({name:"",description:"",content:{sections:[{title:"General Information",questions:[{id:"q1",text:"Company Name",type:"text",required:!0}]}]}}),{data:s,isLoading:a}=w.vendorAssessments.getTemplate.useQuery({id:x},{enabled:!!x});S.useEffect(()=>{s&&t({name:s.name,description:s.description||"",content:typeof s.content=="string"?JSON.parse(s.content):s.content})},[s]);const c=w.vendorAssessments.createTemplate.useMutation({onSuccess:()=>{f.success("Template created successfully"),h(`/clients/${d}/vendors/templates`)},onError:o=>f.error(`Failed to create: ${o.message}`)}),i=w.vendorAssessments.updateTemplate.useMutation({onSuccess:()=>{f.success("Template updated successfully"),h(`/clients/${d}/vendors/templates`)},onError:o=>f.error(`Failed to update: ${o.message}`)}),y=()=>{d&&(m?c.mutate({clientId:d,name:n.name,description:n.description,content:n.content}):i.mutate({id:x,name:n.name,description:n.description,content:n.content}))};return a?e.jsx("div",{className:"p-8",children:"Loading template..."}):e.jsxs("div",{className:"p-8 space-y-6 max-w-[1600px] mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>h(`/clients/${d}/vendors/templates`),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(G,{title:m?"Create Assessment Template":"Edit Assessment Template",description:m?"Design a new questionnaire from scratch.":`Editing "${(s==null?void 0:s.name)||"..."}"`,rationale:"Tailor assessments to your specific risk appetite and compliance requirements.",howToUse:[{step:"Structure",description:"Organize questions into logical sections."},{step:"Configure",description:"Set question types (Text, Yes/No, File Upload)."},{step:"Save",description:"Publish the template for immediate use."}]})]}),e.jsxs(p,{onClick:y,disabled:c.isLoading||i.isLoading,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),m?"Create Template":"Save Changes"]})]}),e.jsx(M,{children:e.jsxs(R,{className:"pt-6 grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"name",children:"Template Name"}),e.jsx(g,{id:"name",value:n.name,onChange:o=>t({...n,name:o.target.value}),placeholder:"e.g., Annual Security Review 2024"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"desc",children:"Description"}),e.jsx(g,{id:"desc",value:n.description,onChange:o=>t({...n,description:o.target.value}),placeholder:"Purpose of this questionnaire..."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Questionnaire Content"})}),e.jsx("div",{className:"bg-white rounded-lg border shadow-sm p-6 min-h-[500px]",children:e.jsx(U,{sections:n.content.sections,onChange:o=>t({...n,content:{sections:o}})})})]})]})}export{te as default};
