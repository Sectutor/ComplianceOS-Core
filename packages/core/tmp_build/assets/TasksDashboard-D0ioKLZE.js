import{ac as H,r as v,t as u,i as x,j as e,E as w,G as T,H as I,J as S,K as p,D as O,ap as R,c as l,o as $,p as E,q as V,I as q,w as z,C as Q,m as U,N as W,O as G,P as f,Q as h,V as J,W as n,X as K,Y as X,k as Y,ab as Z,b as ee}from"./index-DOc7Nwb7.js";import{T as se}from"./textarea-BtxBxzdY.js";import{C as te}from"./calendar-CRg26W4I.js";import{P as ae,g as ie,h as ne,D as re}from"./DashboardLayout-aHnUqq57.js";import{c as k}from"./utils-BC5CVi_C.js";import{P as le}from"./plus-BaQ35Jcx.js";import{C as oe}from"./calendar-BlLJlGbj.js";import{f as P}from"./format-H2tx8_vS.js";import{B as ce}from"./Breadcrumb-CRi3LAxS.js";import{A as de}from"./arrow-left-CpuUojG-.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./endOfWeek-tX_WdcBG.js";import"./en-US-Bfz1jvxT.js";import"./startOfMonth-BTb_IeTV.js";import"./isSameDay-CGHMiO64.js";import"./chevron-left-DZH-lUm7.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function me(){const{selectedClientId:a}=H(),[o,g]=v.useState(!1),[c,A]=v.useState("all"),[t,d]=v.useState({title:"",description:"",assigneeId:"",dueDate:void 0,priority:"medium"}),y=u.useContext(),{data:r,isLoading:B}=u.businessContinuity.collaboration.listTasks.useQuery({clientId:a,status:c==="all"?void 0:c},{enabled:!!a}),{data:N}=u.businessContinuity.callTree.list.useQuery({clientId:a},{enabled:!!a}),j=(N==null?void 0:N.internal)||[],C=u.businessContinuity.collaboration.assignTask.useMutation({onSuccess:()=>{x.success("Task assigned successfully"),g(!1),d({title:"",description:"",assigneeId:"",dueDate:void 0,priority:"medium"}),y.businessContinuity.collaboration.listTasks.invalidate()},onError:s=>x.error(s.message)}),L=u.businessContinuity.collaboration.updateTask.useMutation({onSuccess:()=>{y.businessContinuity.collaboration.listTasks.invalidate(),x.success("Task updated")}}),M=()=>{var s;if(a){if(!t.title)return x.error("Title is required");if(!t.assigneeId)return x.error("Assignee is required");C.mutate({clientId:a,title:t.title,description:t.description,assigneeId:parseInt(t.assigneeId),dueDate:(s=t.dueDate)==null?void 0:s.toISOString()})}},_=(s,i)=>{const b=i==="pending"?"in_progress":i==="in_progress"?"completed":"pending";L.mutate({id:s,status:b})},F=s=>s.split(" ").map(i=>i[0]).join("").toUpperCase().substring(0,2);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Tasks & Workflow"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage Business Continuity Plan assignments and track progress across your team."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{value:c,onValueChange:A,children:[e.jsx(T,{className:"w-[180px] bg-white",children:e.jsx(I,{placeholder:"Filter Status"})}),e.jsxs(S,{children:[e.jsx(p,{value:"all",children:"All Status"}),e.jsx(p,{value:"pending",children:"Pending"}),e.jsx(p,{value:"in_progress",children:"In Progress"}),e.jsx(p,{value:"completed",children:"Completed"})]})]}),e.jsxs(O,{open:o,onOpenChange:g,children:[e.jsx(R,{asChild:!0,children:e.jsxs(l,{className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Assign Task"]})}),e.jsxs($,{children:[e.jsx(E,{children:e.jsx(V,{children:"Create New Task"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Task Title"}),e.jsx(q,{placeholder:"e.g. Review BIA for HR",value:t.title,onChange:s=>d({...t,title:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Assign To"}),e.jsxs(w,{value:t.assigneeId,onValueChange:s=>d({...t,assigneeId:s}),children:[e.jsx(T,{children:e.jsx(I,{placeholder:"Select team member"})}),e.jsx(S,{children:j.map(s=>e.jsxs(p,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Due Date"}),e.jsxs(ae,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:k("w-full justify-start text-left font-normal",!t.dueDate&&"text-muted-foreground"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),t.dueDate?P(t.dueDate,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ne,{className:"w-auto p-0",children:e.jsx(te,{mode:"single",selected:t.dueDate,onSelect:s=>d({...t,dueDate:s}),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx(se,{placeholder:"Details about the task...",value:t.description,onChange:s=>d({...t,description:s.target.value})})]})]}),e.jsxs(z,{children:[e.jsx(l,{variant:"ghost",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{onClick:M,disabled:C.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Assign Task"})]})]})]})]})]}),e.jsx(Q,{className:"border shadow-sm",children:e.jsx(U,{className:"p-0",children:e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(W,{children:[e.jsx(G,{children:e.jsxs(f,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(h,{className:"w-[300px] text-white font-semibold py-4",children:"Task"}),e.jsx(h,{className:"text-white font-semibold py-4",children:"Assignee"}),e.jsx(h,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(h,{className:"text-white font-semibold py-4",children:"Due Date"}),e.jsx(h,{className:"text-right text-white font-semibold py-4",children:"Actions"})]})}),e.jsx(J,{children:B?e.jsx(f,{children:e.jsx(n,{colSpan:5,className:"text-center py-8 text-gray-500 bg-white",children:"Loading tasks..."})}):(r==null?void 0:r.length)===0?e.jsx(f,{children:e.jsx(n,{colSpan:5,className:"text-center py-8 text-gray-500 bg-white",children:"No tasks found."})}):r==null?void 0:r.map(s=>{var i,b,D;return e.jsxs(f,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsxs(n,{className:"py-4",children:[e.jsx("div",{className:"font-medium text-black",children:s.title}),s.description&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[280px]",children:s.description})]}),e.jsx(n,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-6 w-6",children:e.jsx(X,{className:"text-[10px]",children:(i=j.find(m=>m.id===s.assigneeId))!=null&&i.name?F((b=j.find(m=>m.id===s.assigneeId))==null?void 0:b.name):"?"})}),e.jsx("span",{className:"text-sm text-gray-600",children:((D=j.find(m=>m.id===s.assigneeId))==null?void 0:D.name)||`User ${s.assigneeId}`})]})}),e.jsx(n,{className:"py-4",children:e.jsx(Y,{variant:s.status==="completed"?"success":s.status==="in_progress"?"default":"secondary",className:"capitalize",children:s.status.replace("_"," ")})}),e.jsx(n,{className:"py-4",children:s.dueDate?e.jsx("span",{className:k("text-sm",new Date(s.dueDate)<new Date&&s.status!=="completed"?"text-red-500 font-medium":"text-gray-600"),children:P(new Date(s.dueDate),"MMM d, yyyy")}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),e.jsx(n,{className:"text-right py-4",children:e.jsx(l,{variant:"ghost",size:"sm",className:"hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",onClick:()=>_(s.id,s.status),children:s.status==="completed"?"Reopen":s.status==="pending"?"Start":"Complete"})})]},s.id)})})]})})})})]})}function as(){const o=Z().id,[g,c]=ee();return e.jsx(re,{children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(ce,{items:[{label:"Clients",href:"/clients"},{label:"Business Continuity",href:`/clients/${o}/business-continuity`},{label:"Tasks",href:`/clients/${o}/business-continuity/tasks`}]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"mt-2 -ml-3 text-muted-foreground hover:text-foreground",onClick:()=>c(`/clients/${o}/business-continuity`),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Back to BC Dashboard"]})]}),e.jsx(me,{})]})})}export{as as default};
