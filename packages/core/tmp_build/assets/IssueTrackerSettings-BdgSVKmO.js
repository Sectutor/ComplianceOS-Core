import{r as u,t as g,i as p,j as e,D as K,ap as M,c as b,o as R,p as U,q as Q,s as V,L as h,E as S,G as T,H as k,J as I,K as w,I as N,w as q,C as P,N as A,O as L,P as m,Q as t,V as E,W as a,k as i}from"./index-DOc7Nwb7.js";import{D as F}from"./DashboardLayout-aHnUqq57.js";import{B as _}from"./Breadcrumb-CRi3LAxS.js";import{A as z,a as G,b as W,c as X,d as Y,e as Z,f as $,g as ee}from"./alert-dialog-V7xGXdVc.js";import{P as se}from"./plus-BaQ35Jcx.js";import{C as re}from"./circle-check-C5kiwRoG.js";import{T as ae}from"./trash-2-CFEfisbM.js";import{E as te}from"./external-link-C3PXjBR9.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function Fe(){const[n,x]=u.useState(!1),[o,r]=u.useState(""),[y,B]=u.useState(""),[c,v]=u.useState(null),{data:j,isLoading:ne,refetch:D}=g.issueTrackers.list.useQuery({}),{data:d}=g.clients.list.useQuery(),f=g.issueTrackers.create.useMutation({onSuccess:()=>{p.success("Issue tracker connected"),x(!1),D()},onError:s=>p.error(s.message)}),C=g.issueTrackers.delete.useMutation({onSuccess:()=>{p.success("Connection removed"),v(null),D()},onError:s=>p.error(s.message)}),J=s=>{if(s.preventDefault(),!o||!y){p.error("Please select provider and client");return}const l=new FormData(s.currentTarget);f.mutate({clientId:parseInt(y),provider:o,name:l.get("name"),baseUrl:l.get("baseUrl")||void 0,credentials:l.get("credentials"),projectKey:l.get("projectKey")||void 0})},O=s=>s==="jira"?e.jsx("span",{className:"text-blue-600 font-bold text-lg",children:"Jira"}):e.jsx("span",{className:"text-purple-600 font-bold text-lg",children:"Linear"});return e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{items:[{label:"Admin"},{label:"Issue Trackers"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Issue Tracker Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect Jira or Linear to sync remediation tasks"})]}),e.jsxs(K,{open:n,onOpenChange:x,children:[e.jsx(M,{asChild:!0,children:e.jsxs(b,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Add Connection"]})}),e.jsx(R,{children:e.jsxs("form",{onSubmit:J,children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Connect Issue Tracker"}),e.jsx(V,{children:"Link Jira or Linear to automatically create and sync remediation tasks."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Client *"}),e.jsxs(S,{value:y,onValueChange:B,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Select client"})}),e.jsx(I,{children:d==null?void 0:d.map(s=>e.jsx(w,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Provider *"}),e.jsxs(S,{value:o,onValueChange:r,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Select provider"})}),e.jsxs(I,{children:[e.jsx(w,{value:"jira",children:"Jira (Atlassian)"}),e.jsx(w,{value:"linear",children:"Linear"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Connection Name *"}),e.jsx(N,{name:"name",placeholder:"e.g. Production Jira",required:!0})]}),o==="jira"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Jira Base URL"}),e.jsx(N,{name:"baseUrl",placeholder:"https://yourcompany.atlassian.net"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"API Token / Credentials *"}),e.jsx(N,{name:"credentials",type:"password",placeholder:"Enter API token",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Default Project Key"}),e.jsx(N,{name:"projectKey",placeholder:"e.g. COMP or SEC"})]})]}),e.jsxs(q,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:f.isPending,children:f.isPending?"Connecting...":"Connect"})]})]})})]})]}),e.jsx(P,{children:e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(A,{children:[e.jsx(L,{children:e.jsxs(m,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(t,{className:"text-white font-semibold py-4",children:"Provider"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Name"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Client"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Project"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(t,{className:"w-24 text-white font-semibold py-4",children:"Actions"})]})}),e.jsxs(E,{children:[j==null?void 0:j.map(s=>{var l;return e.jsxs(m,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(a,{className:"py-4",children:O(s.provider)}),e.jsx(a,{className:"font-medium text-black py-4",children:s.name}),e.jsx(a,{className:"text-gray-600 py-4",children:((l=d==null?void 0:d.find(H=>H.id===s.clientId))==null?void 0:l.name)||"-"}),e.jsx(a,{className:"py-4",children:e.jsx(i,{variant:"outline",className:"bg-white border-gray-300 text-gray-700",children:s.projectKey||"Default"})}),e.jsx(a,{className:"py-4",children:e.jsxs(i,{className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 border border-green-200",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Connected"]})}),e.jsx(a,{className:"py-4",children:e.jsx(b,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50 transition-colors duration-200",onClick:()=>v(s),children:e.jsx(ae,{className:"h-4 w-4"})})})]},s.id)}),(!j||j.length===0)&&e.jsx(m,{children:e.jsx(a,{colSpan:6,className:"text-center py-8 text-gray-500 bg-white",children:"No issue trackers connected"})})]})]})})}),e.jsx(ie,{}),e.jsx(z,{open:!!c,onOpenChange:s=>!s&&v(null),children:e.jsxs(G,{children:[e.jsxs(W,{children:[e.jsx(X,{children:"Disconnect Issue Tracker?"}),e.jsxs(Y,{children:["Are you sure you want to disconnect ",e.jsx("b",{children:c==null?void 0:c.name}),"? Existing synced tasks will remain but no longer update."]})]}),e.jsxs(Z,{children:[e.jsx($,{children:"Cancel"}),e.jsx(ee,{className:"bg-red-600 hover:bg-red-700",onClick:()=>{c&&C.mutate({id:c.id})},disabled:C.isPending,children:C.isPending?"Disconnecting...":"Disconnect"})]})]})})]})})}function ie(){const{data:n}=g.remediationTasks.list.useQuery({}),x=r=>{switch(r){case"critical":return e.jsx(i,{variant:"destructive",children:"Critical"});case"high":return e.jsx(i,{className:"bg-orange-100 text-orange-800",children:"High"});case"medium":return e.jsx(i,{variant:"secondary",children:"Medium"});default:return e.jsx(i,{variant:"outline",children:"Low"})}},o=r=>{switch(r){case"resolved":case"closed":return e.jsx(i,{className:"bg-green-100 text-green-800",children:"Resolved"});case"in_progress":return e.jsx(i,{className:"bg-blue-100 text-blue-800",children:"In Progress"});default:return e.jsx(i,{variant:"secondary",children:"Open"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Remediation Tasks"}),e.jsx(P,{children:e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(A,{children:[e.jsx(L,{children:e.jsxs(m,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(t,{className:"text-white font-semibold py-4",children:"Title"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Priority"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"External Link"}),e.jsx(t,{className:"text-white font-semibold py-4",children:"Created"})]})}),e.jsxs(E,{children:[n==null?void 0:n.map(r=>e.jsxs(m,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(a,{className:"font-medium text-black py-4",children:r.title}),e.jsx(a,{className:"py-4",children:x(r.priority)}),e.jsx(a,{className:"py-4",children:o(r.status)}),e.jsx(a,{className:"py-4",children:r.externalIssueUrl?e.jsxs("a",{href:r.externalIssueUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:underline",children:[r.externalIssueId,e.jsx(te,{className:"h-3 w-3"})]}):"-"}),e.jsx(a,{className:"text-gray-500 py-4",children:r.createdAt?new Date(r.createdAt).toLocaleDateString():"-"})]},r.id)),(!n||n.length===0)&&e.jsx(m,{children:e.jsx(a,{colSpan:5,className:"text-center py-8 text-gray-500 bg-white",children:"No remediation tasks created yet"})})]})]})})})]})}export{Fe as default};
