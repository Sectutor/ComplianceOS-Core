import{ac as te,u as le,r as x,t as g,i as h,j as e,c,E as v,G as b,H as f,J as y,K as l,C as re,d as ne,e as ce,f as de,m as oe,N as me,O as xe,P as T,Q as u,V as he,W as d,x as S,X as ue,Y as pe,k as o,a6 as E,a7 as B,bu as R,a8 as G,a9 as Q,L as r,I as O,by as $,z as je,n as ge}from"./index-DOc7Nwb7.js";import{D as Ne}from"./DashboardLayout-aHnUqq57.js";import{T as ve}from"./textarea-BtxBxzdY.js";import{c as be}from"./utils-BC5CVi_C.js";import{A as fe,a as ye,b as we,c as Ce,d as De,e as Te,f as Se,g as ke}from"./alert-dialog-V7xGXdVc.js";import{F as Ie}from"./filter-Ceo--4mb.js";import{P as q}from"./plus-BaQ35Jcx.js";import{C as Ae}from"./calendar-BlLJlGbj.js";import{T as J}from"./trash-2-CFEfisbM.js";import{S as Pe}from"./save-CvVmWchr.js";import{C as Me}from"./circle-check-C5kiwRoG.js";import{C as Le}from"./clock-osbacZli.js";import{f as Oe}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./differenceInCalendarDays-nctqlg7V.js";function ws(){var z;const{selectedClientId:m}=te(),{user:V}=le(),[k,K]=x.useState("all"),[I,F]=x.useState("all"),[a,w]=x.useState(null),[W,N]=x.useState(!1),[p,C]=x.useState(null),A=g.useContext(),{data:P,isLoading:X}=g.actions.listAll.useQuery({clientId:m},{enabled:!!m}),{data:n}=g.actions.listAssignees.useQuery({clientId:m},{enabled:!!m}),M=g.actions.updateStatus.useMutation({onSuccess:()=>{h.success("Task updated"),A.actions.listAll.invalidate(),N(!1)},onError:s=>{h.error("Failed to update task: "+s.message)}}),H=g.actions.delete.useMutation({onSuccess:()=>{h.success("Task deleted"),A.actions.listAll.invalidate(),C(null)},onError:s=>{h.error("Failed to delete task: "+s.message)}}),U=(P==null?void 0:P.filter(s=>!(k!=="all"&&s.type!==k||I==="mine"&&V&&s.assigneeId!==V.id)))||[],Y=s=>{const i=n==null?void 0:n.find(ie=>ie.id===s);return i?`${i.firstName} ${i.lastName}`:`User ${s}`},_=s=>{const i=(s==null?void 0:s.toLowerCase())||"pending";return i.includes("done")||i.includes("complete")||i.includes("verified")||i==="closed"||i==="approved"||i==="implemented"?e.jsxs(o,{variant:"success",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"})," ",s]}):i.includes("progress")||i==="todo"||i==="active"?e.jsxs(o,{variant:"info",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"})," ",s]}):i.includes("review")||i==="resolved"?e.jsxs(o,{variant:"warning",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(je,{className:"w-3 h-3 mr-1"})," ",s]}):e.jsxs(o,{variant:"secondary",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"})," ",s]})},Z=(s,i)=>{switch(s){case"remediation":return e.jsx(o,{variant:"outline",className:"border-red-200 text-red-700 bg-red-50",children:"Remediation"});case"poam":return e.jsx(o,{variant:"outline",className:"border-blue-200 text-blue-700 bg-blue-50",children:"POA&M"});default:return e.jsx(o,{variant:"outline",className:"border-slate-200 text-slate-700",children:"General"})}},[ee,D]=x.useState(!1),[t,j]=x.useState({title:"",description:"",priority:"medium",assigneeId:void 0,dueDate:""}),L=g.actions.create.useMutation({onSuccess:()=>{h.success("Task created"),A.actions.listAll.invalidate(),D(!1),j({title:"",description:"",priority:"medium",assigneeId:void 0,dueDate:""})},onError:s=>{h.error("Failed to create task: "+s.message)}}),se=()=>{if(!t.title){h.error("Title is required");return}L.mutate({clientId:m,title:t.title,description:t.description,priority:t.priority,dueDate:t.dueDate||void 0,assigneeId:t.assigneeId})},ae=s=>{w(s),N(!0)};return e.jsx(Ne,{children:e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Tasks Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Universal view of all tasks, remediation items, and assignments."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center border rounded-lg p-1 bg-white",children:[e.jsx(c,{variant:I==="all"?"secondary":"ghost",size:"sm",onClick:()=>F("all"),className:"text-xs h-8",children:"All Tasks"}),e.jsx(c,{variant:I==="mine"?"secondary":"ghost",size:"sm",onClick:()=>F("mine"),className:"text-xs h-8",children:"My Tasks"})]}),e.jsxs(v,{value:k,onValueChange:K,children:[e.jsxs(b,{className:"w-[180px] bg-white",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2 text-muted-foreground"}),e.jsx(f,{placeholder:"Source"})]}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Sources"}),e.jsx(l,{value:"generic",children:"General Tasks"}),e.jsx(l,{value:"remediation",children:"Remediation"}),e.jsx(l,{value:"poam",children:"POA&M"})]})]}),e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700 text-white shadow-sm",onClick:()=>D(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," Create Task"]})]})]}),e.jsxs(re,{className:"border shadow-lg rounded-xl overflow-hidden bg-white",children:[e.jsx(ne,{className:"pb-3 border-b bg-white",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(ce,{className:"text-lg text-black",children:"Active Tasks"}),e.jsx(de,{children:"Double-click a task to view details and manage."})]})})}),e.jsx(oe,{className:"p-0",children:e.jsxs(me,{className:"table-fancy",children:[e.jsx(xe,{children:e.jsxs(T,{className:"border-none",children:[e.jsx(u,{className:"w-[400px] text-white font-semibold py-4",children:"Task Details"}),e.jsx(u,{className:"text-white font-semibold py-4",children:"Source"}),e.jsx(u,{className:"text-white font-semibold py-4",children:"Assignee"}),e.jsx(u,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(u,{className:"text-white font-semibold py-4",children:"Due Date"}),e.jsx(u,{className:"text-right text-white font-semibold py-4",children:"Priority"}),e.jsx(u,{className:"w-[50px]"})]})}),e.jsx(he,{children:X?e.jsx(T,{children:e.jsx(d,{colSpan:6,className:"h-24 text-center",children:e.jsxs("div",{className:"flex items-center justify-center text-muted-foreground",children:[e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading tasks..."]})})}):U.length===0?e.jsx(T,{children:e.jsx(d,{colSpan:6,className:"h-32 text-center text-muted-foreground",children:"No tasks found."})}):U.map(s=>e.jsxs(T,{className:"bg-white border-b border-slate-200 hover:bg-slate-50 cursor-pointer transition-all duration-200 hover:shadow-sm group",onDoubleClick:()=>ae(s),children:[e.jsxs(d,{className:"py-4",children:[e.jsx("div",{className:"font-medium text-black",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 flex gap-2",children:[e.jsx("span",{children:s.sourceLabel}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Created ",(s.originalId,"-")]})]})]}),e.jsx(d,{className:"py-4",children:Z(s.type,s.sourceLabel)}),e.jsx(d,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-6 w-6 border",children:e.jsx(pe,{className:"text-[10px] bg-white border border-gray-200 text-gray-600",children:s.assigneeId?"U":"?"})}),e.jsx("span",{className:"text-sm text-gray-700",children:s.assigneeId?Y(s.assigneeId):e.jsx("span",{className:"text-gray-400 italic",children:"Unassigned"})})]})}),e.jsx(d,{className:"py-4",children:_(s.status)}),e.jsx(d,{className:"py-4",children:s.dueDate?e.jsxs("div",{className:be("flex items-center text-sm",new Date(s.dueDate)<new Date?"text-red-600 font-medium":"text-gray-600"),children:[e.jsx(Ae,{className:"w-3 h-3 mr-1.5 opacity-70"}),Oe(new Date(s.dueDate),"MMM d, yyyy")]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),e.jsx(d,{className:"text-right py-4",children:e.jsx(o,{variant:s.priority==="critical"?"error":s.priority==="high"?"warning":"secondary",className:"capitalize text-[10px] font-bold px-2.5",children:s.priority||"medium"})}),e.jsx(d,{className:"py-4",children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-600 transition-colors",onClick:i=>{i.stopPropagation(),C(s)},children:e.jsx(J,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(E,{open:ee,onOpenChange:D,children:e.jsxs(B,{className:"sm:max-w-md w-full",children:[e.jsxs(R,{className:"mb-6",children:[e.jsx(G,{children:"Create New Task"}),e.jsx(Q,{children:"Add a new task to your list."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{placeholder:"Task title",value:t.title,onChange:s=>j({...t,title:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Description"}),e.jsx(ve,{placeholder:"Details about the task...",value:t.description,onChange:s=>j({...t,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority"}),e.jsxs(v,{value:t.priority,onValueChange:s=>j({...t,priority:s}),children:[e.jsx(b,{children:e.jsx(f,{})}),e.jsxs(y,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Due Date"}),e.jsx(O,{type:"date",value:t.dueDate,onChange:s=>j({...t,dueDate:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Assignee"}),e.jsxs(v,{value:((z=t.assigneeId)==null?void 0:z.toString())||"",onValueChange:s=>j({...t,assigneeId:parseInt(s)}),children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Unassigned"})}),e.jsx(y,{children:n==null?void 0:n.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))})]})]}),e.jsxs($,{className:"mt-8",children:[e.jsx(c,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",onClick:se,disabled:L.isPending,children:[L.isPending?e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(q,{className:"w-4 h-4 mr-2"}),"Create Task"]})]})]})]})}),e.jsx(E,{open:W,onOpenChange:N,children:e.jsxs(B,{className:"sm:max-w-md w-full",children:[e.jsxs(R,{className:"mb-6",children:[e.jsx(G,{children:"Manage Task"}),e.jsx(Q,{children:a==null?void 0:a.sourceLabel})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Title"}),e.jsx("div",{className:"text-sm font-medium p-2 bg-slate-50 border rounded-md",children:a.title}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(v,{defaultValue:a.status,onValueChange:s=>w({...a,status:s}),children:[e.jsx(b,{children:e.jsx(f,{})}),e.jsxs(y,{children:[e.jsx(l,{value:"open",children:"Open / To Do"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"review",children:"Review"}),e.jsx(l,{value:"done",children:"Done / Completed"}),e.jsx(l,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority"}),e.jsx("div",{className:"flex items-center h-10 px-3 border rounded-md bg-slate-50 text-sm text-gray-500",children:a.priority})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Assignee"}),e.jsxs(v,{value:a.assigneeId?a.assigneeId.toString():"unassigned",onValueChange:s=>{const i=parseInt(s);w({...a,assigneeId:isNaN(i)||s==="unassigned"?null:i})},disabled:a.type==="poam",children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Unassigned"})}),e.jsxs(y,{children:[e.jsx(l,{value:"unassigned",children:"Unassigned"}),n==null?void 0:n.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Due Date"}),e.jsx(O,{type:"date",defaultValue:a.dueDate?new Date(a.dueDate).toISOString().split("T")[0]:"",onChange:s=>w({...a,dueDate:s.target.value}),disabled:a.type==="remediation"})]}),e.jsxs($,{className:"mt-8 flex justify-between sm:justify-between",children:[e.jsx(c,{variant:"destructive",size:"icon",onClick:()=>{N(!1),C(a)},title:"Delete Task",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(c,{onClick:()=>M.mutate({id:a.id,status:a.status,priority:a.priority,dueDate:a.dueDate,assigneeId:a.assigneeId,clientId:m}),disabled:M.isPending,className:"bg-blue-600 hover:bg-blue-700",children:[M.isPending?e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})]})]})}),e.jsx(fe,{open:!!p,onOpenChange:s=>!s&&C(null),children:e.jsxs(ye,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Are you sure?"}),e.jsxs(De,{children:['This action cannot be undone. This will permanently delete the task "',p==null?void 0:p.title,'".']})]}),e.jsxs(Te,{children:[e.jsx(Se,{children:"Cancel"}),e.jsx(ke,{className:"bg-red-600 hover:bg-red-700",onClick:()=>p&&H.mutate({id:p.id,clientId:m}),children:H.isPending?e.jsx(S,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})})]})})}export{ws as default};
