import{ab as T,r as g,t as u,i as h,j as e,aq as C,c as n,k as d,C as F,m as R,v as y,S as z,Z as B,_ as U,$ as W,a1 as k}from"./index-DOc7Nwb7.js";import{D as K}from"./DashboardLayout-aHnUqq57.js";import{P}from"./PageGuide-CPKKXXS6.js";import{A as Z}from"./arrow-left-CpuUojG-.js";import{R as f}from"./refresh-cw-Cjym1DSW.js";import{S as O}from"./search-CwuIBBPE.js";import{C as _}from"./circle-check-C5kiwRoG.js";import{C as q}from"./circle-x-DxtMpzS7.js";import{Z as v}from"./zap-B01fFOkT.js";import{T as G}from"./terminal-DNh7vxOm.js";import{I as Q}from"./info-By5wLOUH.js";import{S as X}from"./shield-alert-iAruRy4W.js";import{E as H}from"./external-link-C3PXjBR9.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";function Be(){const S=T(),r=parseInt(S.id||"0"),[b,I]=g.useState(""),[c,j]=g.useState("suggested"),[o,p]=g.useState([]),N=u.useUtils(),{data:m,isLoading:A}=u.threatIntel.getClientSuggestions.useQuery({clientId:r},{enabled:!!r}),D=u.threatIntel.bulkUpdateMatchStatus.useMutation({onSuccess:s=>{h.success(`Successfully updated ${s.count} items`),p([]),N.threatIntel.getClientSuggestions.invalidate()},onError:s=>h.error(s.message)}),V=u.threatIntel.importCveAsVulnerability.useMutation({onSuccess:()=>{h.success("Vulnerability imported successfully"),N.threatIntel.getClientSuggestions.invalidate()},onError:s=>h.error(s.message)}),x=u.threatIntel.scanAllAssets.useMutation({onSuccess:s=>{var l,i;const a=((l=s.results)==null?void 0:l.reduce(($,M)=>$+M.count,0))||0;h.success(`Scan complete! Found ${a} new matches across ${((i=s.results)==null?void 0:i.length)||0} assets.`),N.threatIntel.getClientSuggestions.invalidate()},onError:s=>h.error(s.message)}),t=m==null?void 0:m.filter(s=>{var i;const a=s.cveId.toLowerCase().includes(b.toLowerCase())||s.assetName.toLowerCase().includes(b.toLowerCase())||((i=s.description)==null?void 0:i.toLowerCase().includes(b.toLowerCase())),l=c==="all"||s.status===c;return a&&l}),L=s=>{p(s&&t?t.map(a=>a.matchId):[])},E=(s,a)=>{p(a?l=>[...l,s]:l=>l.filter(i=>i!==s))},w=s=>{o.length!==0&&D.mutate({matchIds:o,status:s})};return e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{href:`/clients/${r}/risks`,children:e.jsxs(n,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Back to Risks"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900",children:"Vulnerability Workbench"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Review and action automated CVE scans across all assets"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"bg-white hover:bg-slate-50 gap-2 border-slate-200",onClick:()=>x.mutate({clientId:r}),disabled:x.isLoading,children:[x.isLoading?e.jsx(f,{className:"w-4 h-4 animate-spin text-blue-600"}):e.jsx(f,{className:"w-4 h-4 text-blue-600"}),"Re-Scan All Assets"]}),e.jsxs(d,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200 h-9",children:[(m==null?void 0:m.length)||0," Total Suggestions"]}),e.jsx(P,{title:"Vulnerability Workbench",description:"Triage CVE matches from automated technical scans.",howToUse:[{step:"Review Matches",description:"Filter by 'Suggested' to see new findings."},{step:"Bulk Action",description:"Select multiple items to Accept or Dismiss them."},{step:"Import",description:"Accepted items can be imported as tracked vulnerabilities."}]})]})]}),e.jsx(F,{className:"border-slate-200 shadow-sm",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-[300px]",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by CVE, Asset, or Description...",className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20",value:b,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:`cursor-pointer ${c==="suggested"?"bg-blue-600":"bg-slate-200 text-slate-600 hover:bg-slate-300"}`,onClick:()=>j("suggested"),children:"Suggested"}),e.jsx(d,{className:`cursor-pointer ${c==="accepted"?"bg-green-600":"bg-slate-200 text-slate-600 hover:bg-slate-300"}`,onClick:()=>j("accepted"),children:"Accepted"}),e.jsx(d,{className:`cursor-pointer ${c==="dismissed"?"bg-slate-600":"bg-slate-200 text-slate-600 hover:bg-slate-300"}`,onClick:()=>j("dismissed"),children:"Dismissed"}),e.jsx(d,{className:`cursor-pointer ${c==="all"?"bg-slate-900":"bg-slate-200 text-slate-600 hover:bg-slate-300"}`,onClick:()=>j("all"),children:"All"})]})]}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-right-4 duration-200",children:[e.jsxs("span",{className:"text-sm font-medium text-slate-600 mr-2",children:[o.length," selected"]}),e.jsxs(n,{size:"sm",className:"bg-green-600 hover:bg-green-700 h-8 gap-1.5",onClick:()=>w("accepted"),children:[e.jsx(_,{className:"w-3.5 h-3.5"})," Accept"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 gap-1.5 text-slate-600",onClick:()=>w("dismissed"),children:[e.jsx(q,{className:"w-3.5 h-3.5"})," Dismiss"]})]})]})})}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-[#1C4D8D]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx(y,{checked:o.length===((t==null?void 0:t.length)||0)&&((t==null?void 0:t.length)||0)>0,onCheckedChange:L,className:"border-white/50 data-[state=checked]:bg-white data-[state=checked]:text-blue-900"})}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"CVE ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Affected Asset"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Score"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-white uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:A?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-12 text-center text-slate-400",children:[e.jsx(v,{className:"w-6 h-6 animate-pulse mx-auto mb-2"}),"Scanning intelligence feeds..."]})}):(t==null?void 0:t.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-24 text-center",children:e.jsxs("div",{className:"max-w-sm mx-auto space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto",children:e.jsx(z,{className:"w-8 h-8 text-slate-300"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-slate-900 font-bold",children:"No vulnerabilities found"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"We haven't found any CVE matches for your assets in this view."})]}),c==="suggested"&&e.jsx(n,{onClick:()=>x.mutate({clientId:r}),disabled:x.isLoading,className:"bg-blue-600 hover:bg-blue-700 h-10 px-6",children:x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 animate-spin mr-2"}),"Scanning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Run Intelligence Scan"]})})]})})}):t==null?void 0:t.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/80 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx(y,{checked:o.includes(s.matchId),onCheckedChange:a=>E(s.matchId,!!a)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-bold text-slate-900 flex items-center gap-1.5",children:[s.cveId,s.isKev&&e.jsx(d,{className:"bg-red-100 text-red-700 border-red-200 text-[10px] px-1 h-4",children:"KEV"})]}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:["Discovered ",new Date(s.discoveredAt).toLocaleDateString()]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-3.5 h-3.5 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600 truncate max-w-[150px]",children:s.assetName})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(d,{variant:"outline",className:`
                                                    ${parseFloat(s.cvssScore||"0")>=9?"bg-red-50 text-red-700 border-red-200":parseFloat(s.cvssScore||"0")>=7?"bg-orange-50 text-orange-700 border-orange-200":parseFloat(s.cvssScore||"0")>=4?"bg-amber-50 text-amber-700 border-amber-200":"bg-blue-50 text-blue-700 border-blue-200"}
                                                `,children:s.cvssScore||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-[11px] font-semibold uppercase px-2 py-0.5 rounded ${s.status==="suggested"?"bg-blue-100 text-blue-700":s.status==="accepted"?"bg-green-100 text-green-700":s.status==="dismissed"?"bg-slate-100 text-slate-500":"bg-purple-100 text-purple-700"}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 max-w-[300px]",children:e.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 italic",title:s.description,children:s.description||"No description available in NVD cache."})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(B,{children:[e.jsx(U,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Q,{className:"h-4 w-4 text-slate-400"})})}),e.jsxs(W,{align:"end",className:"w-[200px]",children:[e.jsxs(k,{className:"text-green-600",onClick:()=>V.mutate({clientId:r,assetId:s.assetId,cveId:s.cveId,matchId:s.matchId}),children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Import as Vuln"]}),e.jsx(k,{asChild:!0,children:e.jsxs("a",{href:`https://nvd.nist.gov/vuln/detail/${s.cveId}`,target:"_blank",rel:"noreferrer",className:"w-full flex",children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," View NVD"]})})]})]})})]},s.matchId))})]})}),e.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 text-white overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-500/10 blur-3xl -mr-32 -mt-32 rounded-full"}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-blue-400"}),"Intelligence Automated"]}),e.jsx("p",{className:"text-slate-400 text-sm max-w-xl",children:"ComplianceOS automatically cross-references your asset technologies with live NVD and CISA records every 24 hours. Action items here to move them into your formal Vulnerability Management process."})]}),e.jsx(n,{className:"bg-blue-100 hover:bg-blue-200 text-blue-900 border-0",asChild:!0,children:e.jsx(C,{href:`/clients/${r}/risks/adversary-intel`,children:"Explore MITRE ATT&CK"})})]})]})]})})}export{Be as VulnerabilityWorkbench,Be as default};
