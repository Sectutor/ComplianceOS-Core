import{u as le,b as ie,r as n,t as w,j as e,E as z,G as B,H as F,J as Q,K as i,c as N,C as h,d as u,e as p,T as I,m as j,aa as ne,f as U,k as W,S as q,F as ce}from"./index-DOc7Nwb7.js";import{i as de,j as oe,D as me}from"./DashboardLayout-aHnUqq57.js";import{B as xe}from"./Breadcrumb-CRi3LAxS.js";import{T as he,a as ue,b as k,c as _}from"./tabs-CBDTXbEn.js";import{a as G,s as pe}from"./startOfMonth-BTb_IeTV.js";import{e as je}from"./eachDayOfInterval-N9Sq06pl.js";import{L as ge}from"./layout-grid-CGqkIAJU.js";import{L as Ne}from"./list-BZOuFwEg.js";import{C as be}from"./clock-osbacZli.js";import{C}from"./calendar-BlLJlGbj.js";import{C as fe}from"./chevron-left-DZH-lUm7.js";import{i as H}from"./isSameDay-CGHMiO64.js";import{C as O}from"./circle-check-big-BSqJVrgh.js";import{f as b}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./differenceInCalendarDays-nctqlg7V.js";function ve(g){return H(g,de(g))}function ye(g,A){return G(g,-1)}function us(){const{user:g,loading:A}=le(),[J]=ie(),[c,T]=n.useState(new Date),[d,K]=n.useState("all"),[L,$]=n.useState("calendar"),[f,X]=n.useState("all"),[E,Y]=n.useState(""),R=J.match(/\/clients\/(\d+)/),a=R?parseInt(R[1],10):null,{data:o}=w.clients.list.useQuery();n.useEffect(()=>{if(a&&o){const s=o.find(t=>t.id===a);Y((s==null?void 0:s.name)||"")}},[a,o]);const M=pe(c),D=oe(c),S=a||(d!=="all"?parseInt(d):void 0),{data:v,isLoading:we}=w.calendar.events.useQuery({startDate:M.toISOString(),endDate:D.toISOString(),clientId:S},{enabled:a?!0:d!=="all"}),{data:r}=w.calendar.upcoming.useQuery({clientId:S,days:30},{enabled:a?!0:d!=="all"}),{data:l}=w.calendar.overdue.useQuery({clientId:S},{enabled:a?!0:d!=="all"}),y=n.useMemo(()=>v?f==="all"?v:v.filter(s=>s.type===f):[],[v,f]),Z=je({start:M,end:D}),ee=s=>y.filter(t=>H(new Date(t.date),s)),se=()=>T(ye(c)),te=()=>T(G(c,1)),ae=()=>T(new Date),P=s=>{switch(s){case"control_review":return e.jsx(q,{className:"h-3 w-3"});case"policy_renewal":return e.jsx(ce,{className:"h-3 w-3"});case"evidence_expiration":return e.jsx(O,{className:"h-3 w-3"});case"project_task":return e.jsx(O,{className:"h-3 w-3"});case"remediation":return e.jsx(I,{className:"h-3 w-3"});case"poam":return e.jsx(q,{className:"h-3 w-3"});default:return e.jsx(C,{className:"h-3 w-3"})}},re=s=>{switch(s){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=s=>{switch(s){case"control_review":return"bg-primary";case"policy_renewal":return"bg-purple-500";case"evidence_expiration":return"bg-orange-500";case"project_task":return"bg-emerald-500";case"remediation":return"bg-amber-500";case"poam":return"bg-rose-600";default:return"bg-gray-500"}};return A?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx(me,{children:e.jsxs("div",{className:"space-y-6",children:[a&&E&&e.jsx(xe,{items:[{label:"Clients",href:"/clients"},{label:E,href:`/clients/${a}`},{label:"Calendar"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Compliance Calendar"}),e.jsx("p",{className:"text-muted-foreground",children:"Track upcoming reviews, renewals, and expirations"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(z,{value:d,onValueChange:K,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(F,{placeholder:"All Clients"})}),e.jsxs(Q,{children:[e.jsx(i,{value:"all",children:"All Clients"}),o==null?void 0:o.map(s=>e.jsx(i,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs(z,{value:f,onValueChange:X,children:[e.jsx(B,{className:"w-[180px]",children:e.jsx(F,{placeholder:"All Types"})}),e.jsxs(Q,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"control_review",children:"Control Reviews"}),e.jsx(i,{value:"policy_renewal",children:"Policy Renewals"}),e.jsx(i,{value:"evidence_expiration",children:"Evidence Expirations"}),e.jsx(i,{value:"project_task",children:"Project Tasks"}),e.jsx(i,{value:"remediation",children:"Remediation Items"}),e.jsx(i,{value:"poam",children:"POA&M Items"})]})]}),e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(N,{variant:L==="calendar"?"default":"ghost",size:"sm",onClick:()=>$("calendar"),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(N,{variant:L==="list"?"default":"ghost",size:"sm",onClick:()=>$("list"),children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(h,{className:"border-red-200 bg-red-50",children:[e.jsx(u,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2 text-red-800",children:[e.jsx(I,{className:"h-4 w-4"}),"Overdue Items"]})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-900",children:(l==null?void 0:l.length)||0}),e.jsx("p",{className:"text-xs text-red-700",children:"Require immediate attention"})]})]}),e.jsxs(h,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(u,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2 text-yellow-800",children:[e.jsx(be,{className:"h-4 w-4"}),"Due This Week"]})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-900",children:(r==null?void 0:r.filter(s=>{const t=new Date(s.date),m=new Date;return m.setDate(m.getDate()+7),t<=m}).length)||0}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Items due within 7 days"})]})]}),e.jsxs(h,{className:"border-blue-200 bg-blue-50",children:[e.jsx(u,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2 text-blue-800",children:[e.jsx(C,{className:"h-4 w-4"}),"This Month"]})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:(y==null?void 0:y.length)||0}),e.jsxs("p",{className:"text-xs text-blue-700",children:["Total events in ",b(c,"MMMM")]})]})]})]}),e.jsxs(he,{defaultValue:"calendar",className:"space-y-4",children:[e.jsxs(ue,{children:[e.jsx(k,{value:"calendar",children:"Calendar View"}),e.jsxs(k,{value:"upcoming",children:["Upcoming (",(r==null?void 0:r.length)||0,")"]}),e.jsxs(k,{value:"overdue",className:"text-red-600",children:["Overdue (",(l==null?void 0:l.length)||0,")"]})]}),e.jsx(_,{value:"calendar",children:e.jsxs(h,{className:"border-blue-100 shadow-sm",children:[e.jsx(u,{className:"pb-4 border-b border-blue-100 bg-blue-50/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(p,{className:"text-xl text-blue-900 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-blue-600"}),b(c,"MMMM yyyy")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:ae,className:"border-blue-200 hover:bg-blue-50 text-blue-700",children:"Today"}),e.jsx(N,{variant:"outline",size:"icon",onClick:se,className:"border-blue-200 hover:bg-blue-50 text-blue-700",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(N,{variant:"outline",size:"icon",onClick:te,className:"border-blue-200 hover:bg-blue-50 text-blue-700",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}),e.jsxs(j,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-blue-200 rounded-lg overflow-hidden border border-blue-200",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"bg-blue-600 p-3 text-center text-sm font-semibold text-white uppercase tracking-wider",children:s},s)),Array.from({length:M.getDay()}).map((s,t)=>e.jsx("div",{className:"bg-background p-2 min-h-[100px]"},`empty-start-${t}`)),Z.map(s=>{const t=ee(s),m=ve(s);return e.jsxs("div",{className:`bg-background p-2 min-h-[100px] ${m?"ring-2 ring-primary ring-inset":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${m?"text-primary":""}`,children:b(s,"d")}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,3).map(x=>e.jsxs("div",{className:`text-xs p-1 rounded truncate flex items-center gap-1 ${V(x.type)} text-white`,title:`${x.title} - ${x.clientName}`,children:[P(x.type),e.jsx("span",{className:"truncate",children:x.title})]},x.id)),t.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",t.length-3," more"]})]})]},s.toISOString())}),Array.from({length:6-D.getDay()}).map((s,t)=>e.jsx("div",{className:"bg-background p-2 min-h-[100px]"},`empty-end-${t}`))]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary"}),e.jsx("span",{children:"Control Reviews"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-purple-500"}),e.jsx("span",{children:"Policy Renewals"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-orange-500"}),e.jsx("span",{children:"Evidence Expirations"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500"}),e.jsx("span",{children:"Project Tasks"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-amber-500"}),e.jsx("span",{children:"Remediation"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-rose-600"}),e.jsx("span",{children:"POA&M"})]})]})]})]})}),e.jsx(_,{value:"upcoming",children:e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Upcoming Deadlines (Next 30 Days)"}),e.jsx(U,{children:"Items requiring attention soon"})]}),e.jsx(j,{children:r&&r.length>0?e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{className:`p-4 rounded-lg border ${re(s.priority)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${V(s.type)} text-white`,children:P(s.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",s.clientName]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(W,{variant:s.priority==="high"?"destructive":s.priority==="medium"?"default":"secondary",children:s.priority}),e.jsx("p",{className:"text-sm mt-1 font-medium",children:b(new Date(s.date),"MMM d, yyyy")})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No upcoming deadlines in the next 30 days"})]})})]})}),e.jsx(_,{value:"overdue",children:e.jsxs(h,{className:"border-red-200",children:[e.jsxs(u,{children:[e.jsx(p,{className:"text-red-800",children:"Overdue Items"}),e.jsx(U,{children:"Items that have passed their due date"})]}),e.jsx(j,{children:l&&l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsx("div",{className:"p-4 rounded-lg border border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-red-500 text-white",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:s.title}),e.jsx("p",{className:"text-sm text-red-700",children:s.description}),e.jsxs("p",{className:"text-sm mt-1 text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",s.clientName]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(W,{variant:"destructive",children:"OVERDUE"}),e.jsxs("p",{className:"text-sm mt-1 font-medium text-red-800",children:["Was due: ",b(new Date(s.date),"MMM d, yyyy")]})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-8 text-green-600",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{className:"font-medium",children:"No overdue items!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All compliance items are up to date"})]})})]})})]})]})})}export{us as default};
