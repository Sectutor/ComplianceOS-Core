import{ab as T,b as G,r as n,t as A,i as C,j as e,S as $,c as x,aa as B,k as b,E as F,G as z,H as D,J as R,K as S}from"./index-DOc7Nwb7.js";import{D as q}from"./DashboardLayout-aHnUqq57.js";import{B as U}from"./Breadcrumb-CRi3LAxS.js";import{P as O}from"./PageGuide-CPKKXXS6.js";import{T as Q}from"./trending-up-eUiO956o.js";import{E as W}from"./external-link-C3PXjBR9.js";import{S as H}from"./search-CwuIBBPE.js";import{T as J}from"./target-cfAj3L6j.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function Te(){const{id:j}=T(),[,k]=G(),m=parseInt(j||"0"),[t,a]=n.useState(null),[r,u]=n.useState("all"),[p,f]=n.useState(""),{data:l,isLoading:N}=A.asvs.getCategories.useQuery(),h=A.asvs.pushGapsToImplementation.useMutation({onSuccess:s=>{C.success(s.message,{action:{label:"Go to Plan",onClick:()=>k(`/clients/${m}/implementation/plan/${s.planId}`)}})},onError:s=>{C.error(`Failed to push gaps: ${s.message}`)}}),g=()=>{h.mutate({clientId:m})},{data:o,refetch:w,isLoading:L}=A.asvs.getCategoryAssessment.useQuery({clientId:m,categoryCode:t||""},{enabled:!!t&&!!m});n.useEffect(()=>{l&&l.length>0&&!t&&a(l[0].code)},[l,t]);const c=n.useMemo(()=>l==null?void 0:l.find(s=>s.code===t),[l,t]),[E,I]=n.useState({});n.useEffect(()=>{if(o){const s={};o.forEach(i=>{i.assessment&&(s[i.requirementId]=i.assessment)}),I(s)}},[o]);const M=n.useCallback((s,i,d)=>{I(v=>({...v,[s]:{...v[s],status:i,notes:d}})),w()},[w]),P=n.useMemo(()=>{if(!o)return{total:0,completed:0,passed:0,percent:0};const s=o.length;let i=0,d=0;return o.forEach(v=>{const y=E[v.requirementId]||v.assessment;y&&y.status!=="unanswered"&&(i++,(y.status==="pass"||y.status==="na")&&d++)}),{total:s,completed:i,passed:d,percent:s>0?Math.round(d/s*100):0}},[o,E]),V=n.useMemo(()=>o?o.filter(s=>{var i;if(r!=="all"&&(r==="1"&&!s.level1||r==="2"&&!s.level2||r==="3"&&!s.level3))return!1;if(p){const d=p.toLowerCase();return s.requirementId.toLowerCase().includes(d)||s.description.toLowerCase().includes(d)||((i=s.chapterName)==null?void 0:i.toLowerCase().includes(d))}return!0}):[],[o,r,p]);return N?e.jsx(q,{children:e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col space-y-6 pb-12",children:[e.jsx(U,{items:[{label:"Assurance",href:`/clients/${m}/assurance`},{label:"OWASP ASVS 4.0",active:!0}]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-4xl font-black tracking-tight text-slate-900 flex items-center gap-3",children:[e.jsx($,{className:"w-10 h-10 text-primary"}),"OWASP ASVS ",e.jsx("span",{className:"text-primary",children:"v4.0.3"})]}),e.jsx("p",{className:"text-slate-500 font-medium max-w-2xl",children:"Application Security Verification Standard. Validate your application's security controls against industry standards."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{title:"ASVS Assessment Guide",description:"Use the Application Security Verification Standard (ASVS) to verify technical security controls.",rationale:"ASVS provides a basis for testing web application technical security controls and also provides developers with a list of requirements for secure development.",howToUse:[{step:"Select Level",description:"Filter requirements by assurance level (L1: Basic, L2: Standard, L3: Advanced)."},{step:"Assess",description:"Review each requirement and mark as Pass, Fail, or N/A. Add evidence for verification."},{step:"Track Progress",description:"Monitor compliance per category to identify weak areas in your application security."}]}),e.jsxs(x,{variant:"outline",className:"gap-2 border-primary text-primary hover:bg-primary/10",onClick:g,disabled:h.isPending,children:[e.jsx(Q,{className:"w-4 h-4"}),h.isPending?"Pushing...":"Push Gaps to Implementation"]}),e.jsxs(x,{variant:"outline",className:"gap-2",onClick:()=>window.open("https://github.com/OWASP/ASVS/tree/v4.0.3","_blank"),children:[e.jsx(W,{className:"w-4 h-4"}),"ASVS Docs"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-8",children:[e.jsx("div",{className:"col-span-12 lg:col-span-3 space-y-4",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden p-2",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 mb-2",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Categories"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select a category to assess"})]}),e.jsx("div",{className:"space-y-1 max-h-[70vh] overflow-y-auto custom-scrollbar",children:l==null?void 0:l.map(s=>{const i=t===s.code;return e.jsxs("button",{onClick:()=>a(s.code),className:`w-full text-left p-3 rounded-2xl transition-all flex items-center justify-between group ${i?"bg-slate-900 text-white shadow-lg":"hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center font-black text-xs ${i?"bg-primary text-white":"bg-slate-100 text-slate-500 group-hover:bg-slate-200"}`,children:s.code}),e.jsx("span",{className:"text-sm font-bold truncate max-w-[180px]",children:s.name})]}),i&&e.jsx(B,{className:"w-4 h-4 text-primary"})]},s.code)})})]})}),e.jsx("div",{className:"col-span-12 lg:col-span-9 space-y-6",children:c&&e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm p-8 space-y-8 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-6 pb-6 border-b border-slate-100",children:[e.jsxs("div",{className:"space-y-2 max-w-2xl",children:[e.jsx(b,{className:"bg-primary/10 text-primary border-primary/20 font-black px-3 py-1",children:c.code}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 tracking-tight",children:c.name}),e.jsx("p",{className:"text-slate-500 font-medium leading-relaxed",children:c.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs uppercase tracking-widest font-black text-slate-400 block mb-1",children:"Compliance"}),e.jsxs("span",{className:"text-4xl font-black text-primary",children:[P.percent,"%"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-slate-400",children:[e.jsxs("span",{children:[P.passed," Passed"]}),e.jsx("span",{children:"/"}),e.jsxs("span",{children:[P.total," Total"]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between bg-slate-50 p-4 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search requirements...",className:"bg-transparent border-none outline-none text-sm font-medium w-full md:w-64",value:p,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm font-bold text-slate-600",children:"Level:"})]}),e.jsxs(F,{value:r,onValueChange:u,children:[e.jsx(z,{className:"w-[140px] bg-white border-slate-200",children:e.jsx(D,{placeholder:"Level"})}),e.jsxs(R,{children:[e.jsx(S,{value:"all",children:"All Levels"}),e.jsx(S,{value:"1",children:"Level 1 (Basic)"}),e.jsx(S,{value:"2",children:"Level 2 (Standard)"}),e.jsx(S,{value:"3",children:"Level 3 (Advanced)"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:L?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):V.length===0?e.jsx("div",{className:"py-12 text-center text-slate-400",children:e.jsx("p",{children:"No requirements found matching your filters."})}):V.map(s=>e.jsx(K,{data:s,clientId:m,onUpdate:M},s.requirementId))})]})})]})]})})}function K({data:j,clientId:k,onUpdate:m}){const t=j,a=j.assessment,[r,u]=n.useState((a==null?void 0:a.status)||"unanswered"),[p,f]=n.useState(!1),[l,N]=n.useState((a==null?void 0:a.notes)||""),[h,g]=n.useState(!1);n.useEffect(()=>{u((a==null?void 0:a.status)||"unanswered"),N((a==null?void 0:a.notes)||"")},[a]);const o=A.asvs.updateAssessment.useMutation({onSuccess:()=>{m(t.requirementId,r,l),C.success("Assessment updated"),g(!1),f(!1)},onError:c=>{C.error(`Failed to update: ${c.message}`),g(!1)}}),w=()=>{g(!0),o.mutate({clientId:k,requirementId:t.requirementId,status:r,notes:l})},L=({s:c})=>{switch(c){case"pass":return e.jsx(b,{className:"bg-emerald-500 hover:bg-emerald-600 text-white border-none",children:"Pass"});case"fail":return e.jsx(b,{className:"bg-red-500 hover:bg-red-600 text-white border-none",children:"Fail"});case"na":return e.jsx(b,{className:"bg-slate-400 hover:bg-slate-500 text-white border-none",children:"N/A"});default:return e.jsx(b,{variant:"outline",className:"text-slate-400 border-slate-200",children:"Pending"})}};return e.jsxs("div",{className:`rounded-2xl border transition-all duration-300 ${p?"border-primary bg-white shadow-lg ring-1 ring-primary/20":"border-slate-100 bg-white hover:border-slate-200"}`,children:[e.jsxs("div",{className:"p-5 flex items-start gap-4 cursor-pointer",onClick:()=>f(!p),children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[60px]",children:[e.jsx("span",{className:"text-xs font-black text-slate-400 font-mono",children:t.requirementId}),e.jsxs("div",{className:"flex gap-0.5",children:[t.level1&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-300",title:"L1"}),t.level2&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400",title:"L2"}),t.level3&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-500",title:"L3"})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 leading-relaxed pr-8",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-400",children:[t.cwe&&e.jsxs("span",{className:"bg-slate-50 px-2 py-0.5 rounded border border-slate-100",children:["CWE-",t.cwe]}),t.nist&&e.jsxs("span",{className:"bg-slate-50 px-2 py-0.5 rounded border border-slate-100",children:["NIST ",t.nist]})]})]}),e.jsx("div",{className:"min-w-[80px] flex justify-end",children:e.jsx(L,{s:r})})]}),p&&e.jsxs("div",{className:"px-5 pb-5 pt-0 border-t border-slate-50 mt-2 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Verdict"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",variant:r==="pass"?"default":"outline",onClick:()=>u("pass"),className:r==="pass"?"bg-emerald-500 hover:bg-emerald-600 border-none":"hover:text-emerald-600 hover:border-emerald-200",children:"Pass"}),e.jsx(x,{size:"sm",variant:r==="fail"?"default":"outline",onClick:()=>u("fail"),className:r==="fail"?"bg-red-500 hover:bg-red-600 border-none":"hover:text-red-600 hover:border-red-200",children:"Fail"}),e.jsx(x,{size:"sm",variant:r==="na"?"default":"outline",onClick:()=>u("na"),children:"N/A"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-slate-500",children:"Evidence & Notes"}),e.jsx("textarea",{className:"w-full h-20 rounded-xl bg-slate-50 border border-slate-100 p-3 text-xs font-medium focus:ring-2 focus:ring-primary/20 outline-none resize-none",placeholder:"Add implementation details or justification...",value:l,onChange:c=>N(c.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>f(!1),children:"Cancel"}),e.jsx(x,{size:"sm",onClick:w,disabled:h,className:"bg-primary shadow-lg shadow-primary/20",children:h?"Saving...":"Save Assessment"})]})]})]})}export{Te as default};
