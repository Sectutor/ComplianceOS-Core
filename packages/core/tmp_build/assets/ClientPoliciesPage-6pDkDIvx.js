import{r as m,t as f,j as e,L as N,I as le,F as G,C as L,m as U,v as Se,k as X,x as ae,T as de,N as je,O as fe,P as J,Q as v,V as ye,W as w,i as d,c as o,ab as ke,u as Ie,b as Ae,A as B}from"./index-DOc7Nwb7.js";import{D as re}from"./DashboardLayout-aHnUqq57.js";import{d as De}from"./marked.esm-DajSjiQI.js";import{E as Ne}from"./enhanced-dialog-CeRPsI16.js";import{S as Re}from"./switch-B74-5eCi.js";import{T as ve}from"./textarea-BtxBxzdY.js";import{D as Te}from"./DistributionDialog-CHNqqf_x.js";import{P as me}from"./progress-B-1k4ZZX.js";import{T as xe,a as ue,b as E,c as q}from"./tabs-CBDTXbEn.js";import{A as ie}from"./arrow-right-M96iV-v9.js";import{U as he}from"./upload-BBmUECj8.js";import{C as ne}from"./circle-check-big-BSqJVrgh.js";import{S as K}from"./sparkles-CoQ80pK2.js";import{C as Fe}from"./circle-x-DxtMpzS7.js";import{B as ze}from"./Breadcrumb-CRi3LAxS.js";import{u as Me}from"./useStreamingAI-BxE0sscp.js";import{A as $e,a as Oe,b as Be,c as Ee,d as qe,e as Ge,f as Le,g as Ue}from"./alert-dialog-V7xGXdVc.js";import{A as He}from"./arrow-left-CpuUojG-.js";import{F as Qe}from"./file-search-CO4qFJ7G.js";import{P as pe}from"./plus-BaQ35Jcx.js";import{S as Ve}from"./square-pen-ClRv15cM.js";import{S as _e}from"./send-FW7-3cjH.js";import{T as We}from"./trash-2-CFEfisbM.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./user-CqRnJLgW.js";import"./utils-BC5CVi_C.js";const ge=[{id:"SOC2",name:"SOC 2",description:"Service Organization Control 2"},{id:"GDPR",name:"GDPR",description:"General Data Protection Regulation (EU)"},{id:"ISO27001",name:"ISO 27001",description:"Information Security Management"},{id:"HIPAA",name:"HIPAA",description:"Health Insurance Portability and Accountability Act"},{id:"PCI-DSS",name:"PCI-DSS",description:"Payment Card Industry Data Security Standard"},{id:"NIST-CSF",name:"NIST CSF",description:"Cybersecurity Framework"},{id:"CCPA",name:"CCPA",description:"California Consumer Privacy Act"},{id:"NIS2",name:"NIS2",description:"Network and Information Security Directive (EU)"}];function Xe({clientId:x,open:Y,onOpenChange:I}){var R,T;const[n,i]=m.useState("upload"),[c,H]=m.useState(""),[u,l]=m.useState(""),[g,y]=m.useState([]),[Q,A]=m.useState(null),[r,V]=m.useState(null),j=f.policyReview.create.useMutation(),M=f.policyReview.analyze.useMutation(),D=f.policyReview.applyRecommendations.useMutation(),b=f.useContext(),_=s=>{var F;const a=(F=s.target.files)==null?void 0:F[0];if(!a)return;if(a.size>10*1024*1024){d.error("File size must be less than 10MB");return}const p=new FileReader;p.onload=ee=>{var z;const se=(z=ee.target)==null?void 0:z.result;l(se),c||H(a.name.replace(/\.[^/.]+$/,"")),d.success("Policy document loaded")},p.readAsText(a)},h=async()=>{if(n==="upload"){if(!c.trim()||!u.trim()){d.error("Please provide policy name and content");return}i("requirements")}else if(n==="requirements"){if(g.length===0){d.error("Please select at least one compliance requirement");return}try{const s=await j.mutateAsync({clientId:x,policyName:c,policyContent:u,selectedRequirements:g});A(s.policyReviewId),i("analyzing");const a=await M.mutateAsync({policyReviewId:s.policyReviewId});V(a),i("results"),d.success("Analysis complete!")}catch(s){d.error(s.message||"Failed to analyze policy"),i("requirements")}}},$=async()=>{if(Q)try{const s=await D.mutateAsync({clientId:x,policyReviewId:Q});d.success(`Improved policy created: ${s.policyName}`),b.clientPolicies.list.invalidate({clientId:x}),C(),I(!1)}catch(s){d.error(s.message||"Failed to apply changes")}},C=()=>{i("upload"),H(""),l(""),y([]),A(null),V(null)},Z=s=>{switch(s.toLowerCase()){case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}},O=s=>{switch(s.toLowerCase()){case"compliant":return e.jsx(ne,{className:"h-4 w-4 text-green-600"});case"non-compliant":return e.jsx(Fe,{className:"h-4 w-4 text-red-600"});case"partial":return e.jsx(de,{className:"h-4 w-4 text-yellow-600"});default:return null}},W=()=>e.jsxs(e.Fragment,{children:[n==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsxs(o,{onClick:h,disabled:!c||!u,children:["Next",e.jsx(ie,{className:"h-4 w-4 ml-2"})]})]}),n==="requirements"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:()=>i("upload"),children:"Back"}),e.jsx(o,{onClick:h,disabled:g.length===0||j.isPending||M.isPending,children:j.isPending||M.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Analyze Policy"]})})]}),n==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:C,children:"New Review"}),e.jsx(o,{onClick:$,disabled:D.isPending,className:"bg-green-600 hover:bg-green-700",children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}),"Applying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Apply Changes & Create Improved Policy"]})})]})]});return e.jsxs(Ne,{open:Y,onOpenChange:s=>{s||C(),I(s)},title:"AI-Powered Policy Review",description:"Analyze existing policies against compliance requirements and get AI-powered improvement recommendations",size:"lg",className:"sm:max-w-5xl",footer:W(),children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 my-4",children:[e.jsxs("div",{className:`flex items-center ${n==="upload"?"text-primary font-semibold":"text-muted-foreground"}`,children:[e.jsx("div",{className:`rounded-full h-8 w-8 flex items-center justify-center border-2 ${n==="upload"?"border-primary bg-primary text-white":"border-muted"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Upload"})]}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:`flex items-center ${n==="requirements"?"text-primary font-semibold":"text-muted-foreground"}`,children:[e.jsx("div",{className:`rounded-full h-8 w-8 flex items-center justify-center border-2 ${n==="requirements"?"border-primary bg-primary text-white":"border-muted"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Requirements"})]}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:`flex items-center ${n==="analyzing"||n==="results"?"text-primary font-semibold":"text-muted-foreground"}`,children:[e.jsx("div",{className:`rounded-full h-8 w-8 flex items-center justify-center border-2 ${n==="analyzing"||n==="results"?"border-primary bg-primary text-white":"border-muted"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Review"})]})]}),n==="upload"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"policyName",children:"Policy Name *"}),e.jsx(le,{id:"policyName",value:c,onChange:s=>H(s.target.value),placeholder:"e.g., Information Security Policy"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Policy Content *"}),e.jsxs(xe,{defaultValue:"paste",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-2",children:[e.jsxs(E,{value:"paste",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Paste Text"]}),e.jsxs(E,{value:"upload",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Upload File"]})]}),e.jsx(q,{value:"paste",className:"mt-4",children:e.jsx(ve,{value:u,onChange:s=>l(s.target.value),placeholder:"Paste your policy content here...",className:"min-h-[300px] font-mono text-sm"})}),e.jsxs(q,{value:"upload",className:"mt-4",children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload a policy document (.txt, .docx, .pdf)"}),e.jsx(le,{type:"file",accept:".txt,.docx,.pdf",onChange:_,className:"max-w-xs mx-auto"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Maximum file size: 10MB"})]}),u&&e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm font-medium",children:["Policy loaded (",u.length," characters)"]})})]})]})]})]}),n==="requirements"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Select Compliance Requirements *"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Choose the compliance frameworks to evaluate your policy against"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:ge.map(s=>e.jsx(L,{className:`cursor-pointer transition-all ${g.includes(s.id)?"border-primary bg-primary/5":"hover:border-primary/50"}`,onClick:()=>{y(a=>a.includes(s.id)?a.filter(p=>p!==s.id):[...a,s.id])},children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{checked:g.includes(s.id),onCheckedChange:()=>{},className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]})})},s.id))}),g.length>0&&e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium",children:"Selected:"}),g.map(s=>{const a=ge.find(p=>p.id===s);return e.jsx(X,{variant:"secondary",children:a==null?void 0:a.name},s)})]})]}),n==="analyzing"&&e.jsxs("div",{className:"py-12 text-center space-y-4",children:[e.jsx(ae,{className:"h-16 w-16 animate-spin mx-auto text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Policy..."}),e.jsxs("p",{className:"text-muted-foreground",children:["Our AI is reviewing your policy against ",g.length," compliance requirement(s)"]}),e.jsx(me,{value:void 0,className:"w-64 mx-auto"})]}),n==="results"&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{children:e.jsx(U,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Overall Compliance Score"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Based on selected requirements"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-primary",children:[r.overallScore,"%"]}),e.jsx(me,{value:r.overallScore,className:"w-32 mt-2"})]})]})})}),e.jsxs(xe,{defaultValue:"gaps",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-3",children:[e.jsxs(E,{value:"gaps",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Gaps (",((R=r.gaps)==null?void 0:R.length)||0,")"]}),e.jsxs(E,{value:"compliance",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Compliance Status"]}),e.jsxs(E,{value:"recommendations",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Recommendations (",((T=r.recommendations)==null?void 0:T.length)||0,")"]})]}),e.jsx(q,{value:"gaps",className:"mt-4",children:r.gaps&&r.gaps.length>0?e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(J,{children:[e.jsx(v,{children:"Requirement"}),e.jsx(v,{children:"Issue"}),e.jsx(v,{children:"Severity"})]})}),e.jsx(ye,{children:r.gaps.map((s,a)=>e.jsxs(J,{children:[e.jsx(w,{className:"font-medium",children:s.requirement}),e.jsx(w,{children:s.issue}),e.jsx(w,{children:e.jsx(X,{variant:Z(s.severity),children:s.severity})})]},a))})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No gaps identified!"})}),e.jsx(q,{value:"compliance",className:"mt-4",children:e.jsx("div",{className:"space-y-3",children:r.compliance&&r.compliance.map((s,a)=>e.jsx(L,{children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[O(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:s.requirement}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.details})]}),e.jsx(X,{variant:s.status==="compliant"?"default":"outline",children:s.status})]})})},a))})}),e.jsx(q,{value:"recommendations",className:"mt-4",children:e.jsx("div",{className:"space-y-4",children:r.recommendations&&r.recommendations.map((s,a)=>e.jsx(L,{children:e.jsxs(U,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:s.section}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-xs text-muted-foreground",children:"Current"}),e.jsx("p",{className:"text-sm mt-1 p-2 bg-muted/50 rounded",children:s.current})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-xs text-muted-foreground",children:"Improved"}),e.jsx("p",{className:"text-sm mt-1 p-2 bg-green-50 dark:bg-green-900/20 rounded border border-green-200 dark:border-green-800",children:s.improved})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Reasoning:"})," ",s.reasoning]})]})},a))})})]})]})]})}function Ws({hideLayout:x=!1,clientId:Y}){var ce;const I=ke(),n=I.clientId||I.id,i=Y||parseInt(n||"0"),{user:c}=Ie(),[H,u]=Ae(),{data:l,isLoading:g}=f.clients.get.useQuery({id:i},{enabled:i>0&&!!c}),{data:y,isLoading:Q,refetch:A}=f.clientPolicies.list.useQuery({clientId:i},{enabled:i>0&&!!c}),{data:r}=f.policyTemplates.list.useQuery(),[V,j]=m.useState(!1),[M,D]=m.useState(!1),[b,_]=m.useState("select"),[h,$]=m.useState(),[C,Z]=m.useState(!0),[O,W]=m.useState(""),[R,T]=m.useState(null),[s,a]=m.useState(null),{text:p,isLoading:F,generate:ee,reset:se}=Me();m.useEffect(()=>{const t=typeof window<"u"?new URLSearchParams(window.location.search):null;if((t==null?void 0:t.get("create"))==="true"){j(!0);const P=new URLSearchParams(window.location.search);P.delete("create");const S=P.toString();u(`/clients/${i}/policies${S?"?"+S:""}`,{replace:!0})}},[i,u]);const z=f.clientPolicies.create.useMutation({onSuccess:()=>{d.success("Policy created"),j(!1),A(),se(),_("select"),$(void 0),W("")},onError:t=>d.error(t.message)}),we=f.clientPolicies.delete.useMutation({onSuccess:()=>{d.success("Policy deleted"),A(),T(null)},onError:t=>d.error(t.message)}),te=f.clientPolicies.generateBulk.useMutation({onSuccess:()=>{d.success("All policies generated!"),A()},onError:t=>d.error(t.message)}),be=()=>{if(!(l!=null&&l.name)){d.error("Client name is required");return}te.mutate({clientId:i,companyName:l.name})},Ce=t=>{t.preventDefault();const S=new FormData(t.currentTarget).get("name"),k=h?parseInt(h):void 0,Pe={clientId:i,name:S,templateId:k,content:p||void 0,tailor:C,instruction:O||void 0,status:"draft",module:"general"};z.mutate(Pe)};if(g&&!x)return e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"h-8 w-64"}),e.jsx(B,{className:"h-32 w-full"})]})});if(!l&&!x)return e.jsx(re,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Client not found"}),e.jsxs(o,{variant:"outline",onClick:()=>u("/clients"),children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Back to Clients"]})]})});const oe=e.jsxs("div",{className:x?"":"space-y-6",children:[!x&&e.jsx(ze,{items:[{label:"Clients",href:"/clients"},{label:(l==null?void 0:l.name)||"Client",href:`/clients/${i}/governance`},{label:"Policies"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:x?"Policies":"Client Policies"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[!x&&e.jsxs(o,{variant:"outline",onClick:()=>D(!0),children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Load Policy for Review"]}),((c==null?void 0:c.role)==="admin"||(c==null?void 0:c.role)==="owner"||(c==null?void 0:c.role)==="super_admin")&&!x&&e.jsx(o,{variant:"outline",onClick:be,disabled:te.isPending,children:te.isPending?"Generating...":"Generate All Policies"}),e.jsxs(o,{onClick:()=>j(!0),size:x?"sm":"default",className:"bg-sky-600 hover:bg-sky-700 text-white",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Create Policy"]})]})]}),e.jsxs(Ne,{open:V,onOpenChange:j,title:b==="select"?"Select Framework Template":"Configure Policy",description:b==="select"?"Choose a template to start with, or continue without one.":"Customize your policy settings and AI instructions.",size:"xl",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),b==="config"&&e.jsx(o,{onClick:()=>{const t=document.getElementById("add-policy-form");t&&t.requestSubmit()},disabled:z.isPending,children:z.isPending?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-pulse"}),"Generating..."]}):"Create Policy"})]}),children:[b==="select"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 max-h-[350px] overflow-y-auto pr-2",children:[e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${h===void 0?"border-primary ring-2 ring-primary/30":"hover:border-muted-foreground/50"}`,onClick:()=>$(void 0),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-6 w-6 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Blank Policy"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start from scratch with AI assistance"})]})]})}),r==null?void 0:r.map(t=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${h===t.id.toString()?"border-primary ring-2 ring-primary/30":"hover:border-muted-foreground/50"}`,onClick:()=>$(t.id.toString()),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.framework})]})]})},t.id))]}),e.jsx(o,{className:"w-full",onClick:()=>_("config"),children:"Continue"})]}),b==="config"&&e.jsxs("form",{id:"add-policy-form",onSubmit:Ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Policy Name"}),e.jsx(le,{name:"name",placeholder:"e.g. Access Control Policy",defaultValue:h?(ce=r==null?void 0:r.find(t=>t.id.toString()===h))==null?void 0:ce.name:"",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-3 bg-muted/30",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-sm font-medium",children:"Tailor to Industry"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Customize content for ",(l==null?void 0:l.industry)||"your industry"]})]}),e.jsx(Re,{checked:C,onCheckedChange:Z})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-xs text-muted-foreground mb-1.5 block",children:"Custom Instructions (Optional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(ve,{placeholder:"e.g., 'Make it strict regarding password complexity'",value:O,onChange:t=>W(t.target.value),className:"h-20 text-sm resize-none bg-background flex-1"})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(o,{type:"button",size:"sm",onClick:()=>{const t=document.querySelector('input[name="name"]');if(!(t!=null&&t.value)){d.error("Please enter a policy name first");return}r==null||r.find(P=>P.id.toString()===h),l!=null&&l.industry,ee({clientId:i,templateId:h?parseInt(h):void 0,tailor:C,instruction:O,temperature:.7})},disabled:F,className:"w-full bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(K,{className:"h-3 w-3 mr-2"}),F?"Generating...":"Generate Preview"]})}),(F||p)&&e.jsx("div",{className:"border rounded-md p-3 max-h-[200px] overflow-y-auto bg-background",children:p?e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:De.parse(p,{async:!1})}})}):e.jsx("div",{className:"flex items-center justify-center text-muted-foreground h-16",children:e.jsx("span",{className:"animate-pulse",children:"Waiting for AI..."})})})]})]})]}),s&&e.jsx(Te,{open:!!s,onOpenChange:t=>!t&&a(null),clientId:i,policyId:s}),!x&&e.jsx(Xe,{open:M,onOpenChange:D,clientId:i}),e.jsx($e,{open:!!R,onOpenChange:()=>T(null),children:e.jsxs(Oe,{children:[e.jsxs(Be,{children:[e.jsx(Ee,{children:"Delete Policy?"}),e.jsx(qe,{children:"This action cannot be undone. This will permanently delete the policy."})]}),e.jsxs(Ge,{children:[e.jsx(Le,{children:"Cancel"}),e.jsx(Ue,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>R&&we.mutate({id:R}),children:"Delete"})]})]})}),Q?e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{className:"h-12 w-full"}),e.jsx(B,{className:"h-12 w-full"}),e.jsx(B,{className:"h-12 w-full"})]}):y&&y.length>0?e.jsx("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 shadow-lg overflow-hidden bg-white dark:bg-slate-900",children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(J,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(v,{className:"w-[300px] text-white font-semibold py-4",children:"Policy Name"}),e.jsx(v,{className:"w-[150px] text-white font-semibold py-4",children:"Framework"}),e.jsx(v,{className:"w-[100px] text-white font-semibold py-4",children:"Status"}),e.jsx(v,{className:"w-[80px] text-white font-semibold py-4 text-center",children:"Version"}),e.jsx(v,{className:"w-[120px] text-white font-semibold py-4 text-right",children:"Actions"})]})}),e.jsx(ye,{children:y==null?void 0:y.map((t,P)=>{var S;return t!=null&&t.clientPolicy?e.jsxs(J,{className:"cursor-pointer bg-white dark:bg-white border-b border-slate-200 transition-all duration-200 ease-in-out hover:bg-slate-50 hover:shadow-sm group",onClick:()=>u(`/clients/${i}/policies/${t.clientPolicy.id}`),style:{animationDelay:`${P*50}ms`},children:[e.jsx(w,{className:"font-medium text-black py-4",children:e.jsxs("div",{className:"flex items-center gap-3 group-hover:translate-x-1 transition-transform duration-200",children:[e.jsx("div",{className:"p-2 rounded-lg bg-[#1C4D8D]/10 group-hover:bg-[#1C4D8D]/20 transition-colors duration-200",children:e.jsx(G,{className:"h-4 w-4 text-[#1C4D8D]"})}),e.jsx("span",{children:t.clientPolicy.name})]})}),e.jsx(w,{className:"text-gray-600 py-4",children:((S=t.template)==null?void 0:S.framework)||"Custom"}),e.jsx(w,{className:"py-4",children:e.jsx(X,{variant:t.clientPolicy.status==="review"?"secondary":"outline",className:t.clientPolicy.status==="approved"?"bg-emerald-500 text-white hover:bg-emerald-600 shadow-sm":t.clientPolicy.status==="draft"?"bg-slate-100 text-slate-700 border-slate-300":"",children:t.clientPolicy.status||"draft"})}),e.jsx(w,{className:"text-gray-600 text-center py-4",children:e.jsxs("span",{className:"inline-flex items-center justify-center min-w-[32px] px-2 py-1 rounded-md bg-white border border-gray-300 text-gray-700 text-xs font-medium",children:["v",t.clientPolicy.version||1]})}),e.jsx(w,{className:"text-right py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-70 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",onClick:k=>{k.stopPropagation(),u(`/clients/${i}/policies/${t.clientPolicy.id}`)},children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",title:"Distribute Policy",onClick:k=>{k.stopPropagation(),a(t.clientPolicy.id)},children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50 transition-colors duration-200",onClick:k=>{k.stopPropagation(),T(t.clientPolicy.id)},children:e.jsx(We,{className:"h-4 w-4"})})]})})]},t.clientPolicy.id):null})})]})}):e.jsx(L,{className:"py-8",children:e.jsxs(U,{className:"text-center",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No policies created yet"}),e.jsxs(o,{onClick:()=>j(!0),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Create First Policy"]})]})})]});return x?oe:e.jsx(re,{children:oe})}export{Ws as default};
