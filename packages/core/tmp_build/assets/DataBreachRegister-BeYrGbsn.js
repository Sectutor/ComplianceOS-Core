import{ab as U,r,t as h,i as o,j as e,c as u,I as A,C as m,d as p,e as j,m as g,N as X,O as Y,P as f,Q as x,V as Z,W as d,k as O,D as _,o as ee,p as se,q as te,s as ae,L as l,E as ie,G as le,H as re,J as de,K as N,v as H,w as ce}from"./index-DOc7Nwb7.js";import{T as P}from"./textarea-BtxBxzdY.js";import{A as ne,a as oe,b as ue,c as xe,d as he,e as me,f as pe,g as je}from"./alert-dialog-V7xGXdVc.js";import{P as ge}from"./PageGuide-CPKKXXS6.js";import{P as fe}from"./plus-BaQ35Jcx.js";import{S as Ne}from"./search-CwuIBBPE.js";import{S as De}from"./shield-alert-iAruRy4W.js";import{S as ve}from"./square-pen-ClRv15cM.js";import{T as be}from"./trash-2-CFEfisbM.js";import{f as Se}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function Qe(){const{id:q}=U(),D=parseInt(q||"0"),[v,G]=r.useState(""),[Q,c]=r.useState(!1),[t,i]=r.useState({description:"",effects:"",remedialActions:"",dateOccurred:"",dateDetected:"",status:"open",isNotifiableToDpa:!1,isNotifiableToSubjects:!1}),{data:a,isLoading:V,refetch:b}=h.dataBreaches.list.useQuery({clientId:D}),[k,F]=r.useState(!1),[I,E]=r.useState(null),[L,B]=r.useState(null),[W,S]=r.useState(!1),y=h.dataBreaches.update.useMutation({onSuccess:()=>{o.success("Breach record updated successfully"),c(!1),T(),b()},onError:s=>{o.error(`Failed to update breach: ${s.message}`)}}),C=h.dataBreaches.create.useMutation({onSuccess:()=>{o.success("Breach record created successfully"),c(!1),T(),b()},onError:s=>{o.error(`Failed to create breach: ${s.message}`)}}),R=h.dataBreaches.delete.useMutation({onSuccess:()=>{o.success("Breach record deleted successfully"),S(!1),B(null),b()},onError:s=>{o.error(`Failed to delete breach: ${s.message}`)}}),T=()=>{i({description:"",effects:"",remedialActions:"",dateOccurred:"",dateDetected:"",status:"open",isNotifiableToDpa:!1,isNotifiableToSubjects:!1}),F(!1),E(null)},$=()=>{const s={clientId:D,...t};k&&I?y.mutate({id:I,...s}):C.mutate(s)},M=s=>{F(!0),E(s.id),i({description:s.description,effects:s.effects,remedialActions:s.remedialActions,dateOccurred:s.dateOccurred?new Date(s.dateOccurred).toISOString().split("T")[0]:"",dateDetected:s.dateDetected?new Date(s.dateDetected).toISOString().split("T")[0]:"",status:s.status,isNotifiableToDpa:s.isNotifiableToDpa,isNotifiableToSubjects:s.isNotifiableToSubjects}),c(!0)},z=s=>{B(s),S(!0)},J=()=>{L&&R.mutate({id:L,clientId:D})},n=a==null?void 0:a.filter(s=>s.description.toLowerCase().includes(v.toLowerCase())||s.status.toLowerCase().includes(v.toLowerCase())),K=s=>{switch(s){case"open":return"bg-red-100 text-red-800";case"investigating":return"bg-yellow-100 text-yellow-800";case"closed":return"bg-green-100 text-green-800";case"reported":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center animate-slide-down",children:[e.jsx(ge,{title:"Data Breach Register",description:"Log, track, and manage personal data breaches.",rationale:"GDPR Art. 33 requires documenting all breaches, even non-notifiable ones.",howToUse:[{step:"Log",description:"Record facts, effects, and remedial actions immediately."},{step:"Assess",description:"Determine risk to rights and freedoms of individuals."},{step:"Notify",description:"Report to DPA (72h) and data subjects if high risk."}]}),e.jsxs(u,{onClick:()=>{T(),c(!0)},children:[e.jsx(fe,{className:"mr-2 h-4 w-4"})," Log New Breach"]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search incidents...",value:v,onChange:s=>G(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Total Incidents"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.length)||0})})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Open / Investigating"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(a==null?void 0:a.filter(s=>["open","investigating"].includes(s.status)).length)||0})})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Notifiable to DPA"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(a==null?void 0:a.filter(s=>s.isNotifiableToDpa).length)||0})})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:"Closed"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(a==null?void 0:a.filter(s=>s.status==="closed").length)||0})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(f,{children:[e.jsx(x,{children:"Date Detected"}),e.jsx(x,{children:"Description (Facts)"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Notifiable?"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Z,{children:V?e.jsx(f,{children:e.jsx(d,{colSpan:5,className:"text-center py-8",children:"Loading records..."})}):(n==null?void 0:n.length)===0?e.jsx(f,{children:e.jsx(d,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data breach records found. Hopefully that stays true!"})}):n==null?void 0:n.map(s=>e.jsxs(f,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>M(s),children:[e.jsx(d,{children:s.dateDetected?Se(new Date(s.dateDetected),"MMM d, yyyy"):"-"}),e.jsx(d,{className:"max-w-[300px] truncate",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-orange-500"}),s.description]})}),e.jsx(d,{children:e.jsx(O,{className:K(s.status),children:s.status})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2",children:[s.isNotifiableToDpa&&e.jsx(O,{variant:"outline",className:"border-purple-200 text-purple-700 bg-purple-50",children:"DPA"}),s.isNotifiableToSubjects&&e.jsx(O,{variant:"outline",className:"border-orange-200 text-orange-700 bg-orange-50",children:"Subjects"}),!s.isNotifiableToDpa&&!s.isNotifiableToSubjects&&e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})]})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:w=>{w.stopPropagation(),M(s)},children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:w=>{w.stopPropagation(),z(s.id)},children:e.jsx(be,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(_,{open:Q,onOpenChange:c,children:e.jsxs(ee,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(se,{children:[e.jsxs(te,{children:[k?"Edit":"Log"," Data Breach"]}),e.jsx(ae,{children:"Enter the details of the personal data breach as required by GDPR Art. 33."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dateOccurred",children:"Date Occurred"}),e.jsx(A,{id:"dateOccurred",type:"date",value:t.dateOccurred,onChange:s=>i({...t,dateOccurred:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dateDetected",children:"Date Detected"}),e.jsx(A,{id:"dateDetected",type:"date",value:t.dateDetected,onChange:s=>i({...t,dateDetected:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Facts and Description *"}),e.jsx(P,{id:"description",value:t.description,onChange:s=>i({...t,description:s.target.value}),placeholder:"Describe what happened...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"effects",children:"Effects and Consequences *"}),e.jsx(P,{id:"effects",value:t.effects,onChange:s=>i({...t,effects:s.target.value}),placeholder:"What is the impact on data subjects?",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"remedialActions",children:"Remedial Actions Taken *"}),e.jsx(P,{id:"remedialActions",value:t.remedialActions,onChange:s=>i({...t,remedialActions:s.target.value}),placeholder:"What steps have been taken to address the breach?",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"status",children:"Status"}),e.jsxs(ie,{value:t.status,onValueChange:s=>i({...t,status:s}),children:[e.jsx(le,{children:e.jsx(re,{})}),e.jsxs(de,{children:[e.jsx(N,{value:"open",children:"Open"}),e.jsx(N,{value:"investigating",children:"Investigating"}),e.jsx(N,{value:"reported",children:"Reported"}),e.jsx(N,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"dpa",checked:t.isNotifiableToDpa,onCheckedChange:s=>i({...t,isNotifiableToDpa:s})}),e.jsx(l,{htmlFor:"dpa",children:"Notifiable to DPA"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(H,{id:"subjects",checked:t.isNotifiableToSubjects,onCheckedChange:s=>i({...t,isNotifiableToSubjects:s})}),e.jsx(l,{htmlFor:"subjects",children:"Notifiable to Data Subjects"})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(u,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(u,{onClick:$,disabled:C.isPending||y.isPending||!t.description,children:C.isPending||y.isPending?"Saving...":"Save Log"})]})]})}),e.jsx(ne,{open:W,onOpenChange:S,children:e.jsxs(oe,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Are you absolutely sure?"}),e.jsx(he,{children:"This will permanently delete this breach record. This might violate accountability principles if done incorrectly."})]}),e.jsxs(me,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(je,{onClick:J,className:"bg-red-600 hover:bg-red-700",children:R.isPending?"Deleting...":"Delete"})]})]})})]})}export{Qe as default};
