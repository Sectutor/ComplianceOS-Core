import{ab as V,ac as _,r as w,t as v,i as j,j as e,C as l,m as r,z as A,c as i,d as o,e as c,A as a,f as Q,F as P,k as R,D as J,o as K,p as W,q as X,s as Y,w as Z,x as ee}from"./index-DOc7Nwb7.js";import{D as G}from"./DashboardLayout-aHnUqq57.js";import{R as se}from"./refresh-cw-Cjym1DSW.js";import{C as ae}from"./calendar-BlLJlGbj.js";import{S as te}from"./square-pen-ClRv15cM.js";import{D as le}from"./download-ByfWg1Mi.js";import{T as y}from"./trash-2-CFEfisbM.js";import{f as re}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./differenceInCalendarDays-nctqlg7V.js";function Ve(){const C=V(),M=C.id?parseInt(C.id,10):null,{selectedClientId:S}=_(),m=M||S,[f,D]=w.useState(!1),[T,u]=w.useState(!1),[x,$]=w.useState(null),{data:F,isLoading:n,refetch:I}=v.reports.getReportHistory.useQuery({clientId:m,limit:50},{enabled:!!m}),t=v.reports.deleteReport.useMutation({onSuccess:()=>{j.success("Report deleted successfully"),I()},onError:s=>{j.error(`Failed to delete report: ${s.message}`)}}),d=F||[],z=async(s,N,q)=>{try{const h=await v.reports.downloadReport.query({reportId:s}),b=atob(h.data),L=new Array(b.length);for(let g=0;g<b.length;g++)L[g]=b.charCodeAt(g);const B=new Uint8Array(L),H=new Blob([B],{type:h.mimeType}),k=window.URL.createObjectURL(H),p=document.createElement("a");p.href=k,p.download=h.fileName||`${N.replace(/\s+/g,"_")}_${q}.docx`,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(k),document.body.removeChild(p),j.success("Report downloaded successfully")}catch(h){console.error("Download failed:",h),j.error("Failed to download report")}},E=(s,N)=>{$({id:s,title:N}),u(!0)},O=()=>{x&&(t.mutate({reportId:x.id}),u(!1))},U=async()=>{D(!0),await I(),D(!1),j.success("Reports refreshed")};return m?e.jsx(G,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Report Management"}),e.jsx("p",{className:"text-muted-foreground",children:"View, download, and delete all generated reports"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(i,{variant:"outline",onClick:U,disabled:f||n,children:[e.jsx(se,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),f?"Refreshing...":"Refresh"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Total Reports"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?e.jsx(a,{className:"h-8 w-16"}):d.length})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Roadmap Reports"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?e.jsx(a,{className:"h-8 w-16"}):d.filter(s=>s.roadmapId!==null).length})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Implementation Reports"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?e.jsx(a,{className:"h-8 w-16"}):d.filter(s=>s.implementationPlanId!==null).length})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"General Reports"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?e.jsx(a,{className:"h-8 w-16"}):d.filter(s=>s.roadmapId===null&&s.implementationPlanId===null).length})})]})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(c,{children:"All Generated Reports"}),e.jsx(Q,{children:"Manage all generated reports - roadmap, implementation, and general"})]}),e.jsx(r,{children:n?e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"h-10 w-10 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{className:"h-4 w-48"}),e.jsx(a,{className:"h-3 w-32"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{className:"h-9 w-20"}),e.jsx(a,{className:"h-9 w-20"})]})]},s))}):d.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No reports generated yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Generate reports from the Roadmap Dashboard or Implementation Dashboard"}),e.jsx(i,{variant:"outline",onClick:()=>window.location.href=`/clients/${m}/roadmap/dashboard`,children:"Go to Roadmap Dashboard"})]}):e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.roadmapId?"bg-emerald-50":s.implementationPlanId?"bg-blue-50":"bg-slate-50"}`,children:e.jsx(P,{className:`h-4 w-4 ${s.roadmapId?"text-emerald-600":s.implementationPlanId?"text-blue-600":"text-slate-600"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:s.title}),s.roadmapId&&e.jsx(R,{variant:"outline",className:"text-xs bg-emerald-50 text-emerald-700 border-emerald-200",children:"Roadmap"}),s.implementationPlanId&&e.jsx(R,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:"Implementation"}),!s.roadmapId&&!s.implementationPlanId&&e.jsx(R,{variant:"outline",className:"text-xs bg-slate-50 text-slate-700 border-slate-200",children:"General"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),e.jsx("span",{children:re(new Date(s.generatedAt),"MMM d, yyyy")})]}),s.version&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-muted rounded-full",children:s.version}),s.fileSize&&e.jsxs("span",{className:"text-xs",children:[(s.fileSize/1024/1024).toFixed(2)," MB"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/clients/${m}/roadmap/reports/${s.id}`,disabled:t.isLoading,children:[e.jsx(te,{className:"h-3 w-3 mr-2"}),"Edit"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>z(s.id,s.title,s.version||"v1.0"),disabled:t.isLoading,children:[e.jsx(le,{className:"h-3 w-3 mr-2"}),"Download"]}),e.jsxs(i,{variant:"destructive",size:"sm",onClick:()=>E(s.id,s.title),disabled:t.isLoading,children:[e.jsx(y,{className:"h-3 w-3 mr-2"}),"Delete"]})]})]},s.id))})})]}),e.jsxs(l,{className:"bg-muted/50",children:[e.jsx(o,{children:e.jsxs(c,{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"About Report Management"]})}),e.jsx(r,{children:e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-1",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Create Reports:"})," Generate reports from the Roadmap Dashboard or Implementation Dashboard"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-1",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Manage Reports:"})," View, download, or delete ALL generated reports here"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-1",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Roadmap Reports:"})," Generated from specific strategic roadmaps (green badge)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-1",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Implementation Reports:"})," Generated from implementation plans (blue badge)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-1",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"General Reports:"})," Generated without specific roadmap or plan (gray badge)"]})]})]})})]}),e.jsx(J,{open:T,onOpenChange:u,children:e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-destructive"}),"Delete Report"]}),e.jsxs(Y,{children:['Are you sure you want to delete "',x==null?void 0:x.title,'"?',e.jsx("br",{}),e.jsx("span",{className:"font-semibold text-destructive",children:"This action cannot be undone."}),e.jsx("br",{}),e.jsx("br",{}),"This will permanently delete the report from the database and remove the generated file from storage."]})]}),e.jsxs(Z,{children:[e.jsx(i,{variant:"outline",onClick:()=>u(!1),disabled:t.isLoading,children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:O,disabled:t.isLoading,className:"bg-red-600 hover:bg-red-700",children:t.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Delete Report"]})})]})]})})]})}):e.jsx(G,{children:e.jsx("div",{className:"space-y-6 w-full max-w-full p-6",children:e.jsx(l,{className:"border-destructive/20 bg-destructive/5",children:e.jsxs(r,{className:"p-8 text-center",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Client Access Required"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a client to view roadmap reports."})]})})})})}export{Ve as default};
