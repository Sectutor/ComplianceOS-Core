import{M as L,ab as T,r as b,t as x,i as o,j as e,c as i,I as y,x as k,k as w,C as E,m as q,Z as $,_ as F,$ as O,a1 as n,aq as S,z as B}from"./index-DOc7Nwb7.js";import{E as Q}from"./enhanced-dialog-CeRPsI16.js";import{c as N}from"./utils-BC5CVi_C.js";import{P as U}from"./PageGuide-CPKKXXS6.js";import{P as V}from"./plus-BaQ35Jcx.js";import{S as z}from"./search-CwuIBBPE.js";import{F as G}from"./filter-Ceo--4mb.js";import{E as H}from"./ellipsis-BXWwt8ER.js";import{C as Z}from"./clock-osbacZli.js";import{A as _}from"./arrow-right-M96iV-v9.js";import{d as J}from"./differenceInDays-Cx1Pp66P.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=L("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]),W=["Planned","Sent","In Progress","In Review","Completed"],X=l=>{switch(l){case"Planned":return"bg-slate-100 text-slate-600";case"Sent":return"bg-blue-50 text-blue-600";case"In Progress":return"bg-amber-50 text-amber-600";case"In Review":return"bg-purple-50 text-purple-600";case"Completed":return"bg-emerald-50 text-emerald-600";default:return"bg-slate-100 text-slate-600"}},Y=l=>{switch(l){case"High":return"text-rose-600 bg-rose-50 border-rose-200";case"Medium":return"text-amber-600 bg-amber-50 border-amber-200";default:return"text-emerald-600 bg-emerald-50 border-emerald-200"}};function je(){const{id:l}=T(),a=parseInt(l||"0"),[m,I]=b.useState(""),{data:p,isLoading:M,refetch:C}=x.vendorAssessments.listAll.useQuery({clientId:a},{enabled:!!a}),D=x.vendorAssessments.update.useMutation({onSuccess:()=>{o.success("Status updated"),C()}}),d=(s,r)=>{D.mutate({id:s,status:r})},h=p==null?void 0:p.filter(s=>{var r;return((r=s.vendorName)==null?void 0:r.toLowerCase().includes(m.toLowerCase()))||s.type.toLowerCase().includes(m.toLowerCase())}),v=s=>(h==null?void 0:h.filter(r=>(r.status||"Planned")===s))||[],A=s=>{const r=s.dueDate?J(new Date(s.dueDate),new Date):null,g=r!==null&&r<0;return e.jsx(E,{className:"mb-3 hover:shadow-md transition-all border-l-4",style:{borderLeftColor:s.vendorCriticality==="High"?"#e11d48":s.vendorCriticality==="Medium"?"#d97706":"#10b981"},children:e.jsxs(q,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm line-clamp-1",title:s.vendorName,children:s.vendorName}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.type})]}),e.jsxs($,{children:[e.jsx(F,{asChild:!0,children:e.jsx(i,{variant:"ghost",className:"h-6 w-6 p-0",children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs(O,{align:"end",children:[e.jsx(n,{onClick:()=>d(s.id,"Planned"),children:"Move to Planned"}),e.jsx(n,{onClick:()=>d(s.id,"Sent"),children:"Move to Sent"}),e.jsx(n,{onClick:()=>d(s.id,"In Progress"),children:"Move to In Progress"}),e.jsx(n,{onClick:()=>d(s.id,"In Review"),children:"Move to In Review"}),e.jsx(n,{onClick:()=>d(s.id,"Completed"),children:"Mark Completed"}),e.jsx(n,{asChild:!0,children:e.jsx(S,{href:`/clients/${a}/vendors/${s.vendorId}?tab=assessments`,children:"View Details"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",className:N("text-[10px] px-1.5 py-0",Y(s.vendorCriticality)),children:[s.vendorCriticality," Risk"]}),s.score&&e.jsxs(w,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:["Score: ",s.score]})]}),s.dueDate&&e.jsxs("div",{className:N("flex items-center gap-1.5 text-xs",g?"text-rose-600 font-medium":"text-slate-500"),children:[g?e.jsx(B,{className:"w-3 h-3"}):e.jsx(Z,{className:"w-3 h-3"}),g?`${Math.abs(r)} days overdue`:`${r} days left`]}),e.jsxs("div",{className:"pt-2 flex justify-between items-center text-xs text-muted-foreground border-t mt-2",children:[e.jsxs("div",{className:"flex -space-x-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-blue-100 border border-white flex items-center justify-center text-[8px] text-blue-700 font-bold",children:"JD"}),e.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-100 border border-white flex items-center justify-center text-[8px] text-purple-700 font-bold",children:"ME"})]}),e.jsx(S,{href:`/clients/${a}/vendors/${s.vendorId}?tab=assessments`,children:e.jsx(_,{className:"w-3.5 h-3.5 hover:text-indigo-600 cursor-pointer"})})]})]})},s.id)},[P,c]=b.useState(!1),[t,u]=b.useState({vendorId:"",type:"",dueDate:""}),{data:f}=x.vendors.list.useQuery({clientId:a}),j=x.vendorAssessments.create.useMutation({onSuccess:()=>{o.success("Assessment scheduled"),c(!1),u({vendorId:"",type:"",dueDate:""}),C()},onError:s=>o.error("Failed to create: "+s.message)}),R=()=>{if(!t.vendorId)return o.error("Vendor is required");if(!t.type)return o.error("Assessment Type is required");j.mutate({clientId:a,vendorId:parseInt(t.vendorId),type:t.type,dueDate:t.dueDate,status:"Planned"})};return e.jsxs("div",{className:"p-6 h-[calc(100vh-64px)] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{children:e.jsx(U,{title:"Security Reviews",description:"Manage active security assessments and audit workflows.",rationale:"Systematic evaluation of vendor security controls reduces third-party risk.",howToUse:[{step:"Schedule",description:"Initiate new assessments (SIG, CAIQ)."},{step:"Track",description:"Monitor status of sent questionnaires."},{step:"Review",description:"Analyze vendor responses and approve."}]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",className:"border-purple-200 text-purple-700 hover:bg-purple-50",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"AI Review Assistant"]}),e.jsxs(i,{onClick:()=>c(!0),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," New Assessment"]})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search assessments...",className:"pl-8",value:m,onChange:s=>I(s.target.value)})]}),e.jsxs(i,{variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"})," Filter"]})]}),M?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(k,{className:"animate-spin h-8 w-8 text-indigo-600"})}):e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",children:e.jsx("div",{className:"flex gap-4 min-w-[1200px] h-full pb-4",children:W.map(s=>e.jsxs("div",{className:"flex-1 min-w-[280px] flex flex-col bg-slate-50/50 rounded-lg border border-slate-100",children:[e.jsxs("div",{className:"p-3 font-medium text-sm flex justify-between items-center border-b bg-white rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:N("w-2 h-2 rounded-full",X(s).split(" ")[1].replace("text-","bg-"))}),s]}),e.jsx(w,{variant:"secondary",className:"text-xs font-normal",children:v(s).length})]}),e.jsxs("div",{className:"p-3 overflow-y-auto flex-1 custom-scrollbar",children:[v(s).map(A),v(s).length===0&&e.jsx("div",{className:"text-center py-8 text-xs text-slate-400 border-2 border-dashed border-slate-100 rounded-lg",children:"No items"})]})]},s))})}),e.jsx(Q,{open:P,onOpenChange:c,title:"Schedule New Assessment",description:"Start a new security review or questionnaire for a vendor.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(i,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(i,{onClick:R,disabled:j.isPending,children:[j.isPending&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Schedule"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Vendor"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background md:text-sm",value:t.vendorId,onChange:s=>u({...t,vendorId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a vendor..."}),f==null?void 0:f.map(s=>e.jsx("option",{value:s.vendor.id,children:s.vendor.name},s.vendor.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Assessment Type"}),e.jsx(y,{placeholder:"e.g. SOC2 Review, SIG Lite, Security Questionnaire 2024",value:t.type,onChange:s=>u({...t,type:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Due Date"}),e.jsx(y,{type:"date",value:t.dueDate,onChange:s=>u({...t,dueDate:s.target.value})})]})]})})]})}export{je as default};
