import{ab as P,r as x,t as m,i as h,j as e,c as p,C as y,d as N,e as v,f as b,m as w,N as D,O as G,P as c,Q as n,V as I,W as a,x as u,k as j}from"./index-DOc7Nwb7.js";import{T as E,a as U,b as T,c as C}from"./tabs-CBDTXbEn.js";import{P as B}from"./PageGuide-CPKKXXS6.js";import{S as H}from"./share-2-d-nm3TwF.js";import{R as Q}from"./refresh-ccw-BMEkkcOe.js";import{G as F}from"./globe-BMGZmoaJ.js";import{S as O}from"./shield-check-ETs8j4-d.js";import{f as M}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function de(){const{id:A}=P(),l=parseInt(A||"0"),[f,S]=x.useState("governance"),[W,_]=x.useState(""),[d,o]=x.useState(null),{data:t,isLoading:z,refetch:g}=m.subprocessors.list.useQuery({clientId:l},{enabled:!!l}),{data:r,isLoading:k}=m.subprocessors.getMap.useQuery({clientId:l},{enabled:!!l&&f==="map"}),L=m.subprocessors.analyze.useMutation({onSuccess:s=>{h.success("Analysis complete! Trust score and clauses updated."),o(null),g()},onError:s=>{h.error("Analysis failed: "+s.message),o(null)}}),R=(s,i)=>{if(!i)return h.error("Vendor has no website to analyze.");o(s),L.mutate({vendorId:s,url:i})};return e.jsxs("div",{className:"space-y-6 page-transition",children:[e.jsxs("div",{className:"flex justify-between items-start animate-slide-down",children:[e.jsx(B,{title:"Subprocessor Governance",description:"Manage GDPR Article 28 compliance and chain of trust in your supply chain.",rationale:"Maintain visibility into 'fourth-party' data risks to ensure full regulatory compliance.",howToUse:[{step:"Inventory",description:"Maintain a list of all active sub-processors."},{step:"Analyze",description:"Verify transfer mechanisms and data locations."},{step:"Map",description:"Visualize the chain of trust and data flows."}]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",onClick:()=>window.open(`/api/public/subprocessors/${l}`,"_blank"),children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Public Export"]}),e.jsxs(p,{onClick:()=>g(),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Refresh Registry"]})]})]}),e.jsxs(E,{value:f,onValueChange:S,className:"w-full",children:[e.jsxs(U,{children:[e.jsx(T,{value:"governance",children:"Registry & Analysis"}),e.jsx(T,{value:"map",children:"Chain of Trust Map"})]}),e.jsx(C,{value:"governance",className:"space-y-4 pt-4",children:e.jsxs(y,{children:[e.jsxs(N,{className:"pb-3",children:[e.jsx(v,{children:"Approved Subprocessors"}),e.jsx(b,{children:"Vendors authorized to process personal data."})]}),e.jsx(w,{children:e.jsxs(D,{children:[e.jsx(G,{children:e.jsxs(c,{children:[e.jsx(n,{children:"Vendor"}),e.jsx(n,{children:"Data Location"}),e.jsx(n,{children:"Transfer Mechanism"}),e.jsx(n,{children:"DPA Status"}),e.jsx(n,{children:"Last Audit"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(I,{children:z?e.jsx(c,{children:e.jsx(a,{colSpan:6,className:"text-center py-8",children:e.jsx(u,{className:"h-6 w-6 animate-spin mx-auto text-indigo-500"})})}):(t==null?void 0:t.length)===0?e.jsx(c,{children:e.jsx(a,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No subprocessors found. Mark vendors as subprocessors in the Vendor Inventory."})}):t==null?void 0:t.map(s=>e.jsxs(c,{children:[e.jsxs(a,{children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[s.website?e.jsx(F,{className:"w-3 h-3"}):null,s.website||"No website"]})]}),e.jsx(a,{children:s.dataLocation?e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx("span",{className:"text-xs",children:s.dataLocation})}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})}),e.jsx(a,{children:e.jsx(j,{variant:"secondary",className:"font-normal text-xs",children:s.transferMechanism||"Unspecified"})}),e.jsx(a,{children:s.dpaAnalysis?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(j,{className:"bg-green-50 text-green-700 border-green-200 w-fit",children:"Verified"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.dpaAnalysis.verificationDate?M(new Date(s.dpaAnalysis.verificationDate),"MMM d, yyyy"):"Recently"})]}):e.jsx(j,{variant:"outline",className:"text-amber-600 bg-amber-50",children:"Missing DPA"})}),e.jsx(a,{children:s.lastTrustCenterChange?e.jsx("div",{className:"text-xs",children:M(new Date(s.lastTrustCenterChange),"MMM d, yyyy")}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Never"})}),e.jsx(a,{className:"text-right",children:e.jsxs(p,{size:"sm",variant:"ghost",className:"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50",onClick:()=>R(s.id,s.website),disabled:d===s.id,children:[d===s.id?e.jsx(u,{className:"w-3 h-3 animate-spin mr-1"}):e.jsx(O,{className:"w-3 h-3 mr-1"}),d===s.id?"Scanning...":"Analyze"]})})]},s.id))})]})})]})}),e.jsx(C,{value:"map",className:"space-y-4 pt-4",children:e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(v,{children:"Subprocessing Chain"}),e.jsx(b,{children:'Visualization of recursive sub-processors (The "Fourth Party" Risk).'})]}),e.jsx(w,{children:k?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(u,{className:"h-8 w-8 animate-spin text-slate-300"})}):e.jsxs("div",{className:"pl-2",children:[(r==null?void 0:r.length)===0&&e.jsx("div",{className:"text-muted-foreground p-4",children:"No data available for mapping."}),r==null?void 0:r.map(s=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-50 rounded border border-slate-100 table w-full",children:[e.jsx("div",{className:"h-8 w-8 bg-indigo-100 text-indigo-600 rounded flex items-center justify-center font-bold text-xs shrink-0",children:s.name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.dataLocation||"Unknown Location"})]})]}),s.children&&s.children.length>0?e.jsx("div",{className:"ml-4 border-l-2 border-indigo-100 pl-4 py-2 space-y-2",children:s.children.map((i,V)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 bg-white p-2 rounded border border-slate-100 shadow-sm",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-300"}),typeof i=="string"?i:i.name]},V))}):e.jsx("div",{className:"ml-8 text-xs text-muted-foreground italic py-1",children:"No disclosed sub-processors"})]},s.id))]})})]})})]})]})}export{de as default};
