import{ab as ee,b as se,r as x,t as r,i as l,j as e,c as a,C as D,m as R,L as o,E as $,G as O,H as U,J as q,K as z,A as te,N as ne,O as ie,P as F,Q as g,V as ae,W as u}from"./index-DOc7Nwb7.js";import{D as re}from"./DashboardLayout-aHnUqq57.js";import{E as H}from"./enhanced-dialog-CeRPsI16.js";import{T as y}from"./textarea-BtxBxzdY.js";import{B as oe}from"./Breadcrumb-CRi3LAxS.js";import{A as le}from"./arrow-left-CpuUojG-.js";import{P as G}from"./plus-BaQ35Jcx.js";import{S as ce}from"./sparkles-CoQ80pK2.js";import{P as de}from"./pen-BlTNmlLB.js";import{T as pe}from"./trash-2-CFEfisbM.js";import{L as me}from"./link-2-CtlmhYuV.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function ss(){var T,L,A,B;const{id:J}=ee(),n=parseInt(J||"0"),[,K]=se(),[N,d]=x.useState(!1),[j,E]=x.useState(""),[f,v]=x.useState(""),[i,p]=x.useState(null),{data:c}=r.clients.get.useQuery({id:n},{enabled:n>0}),{data:C,isLoading:W,refetch:w}=r.mappings.list.useQuery({clientId:n},{enabled:n>0}),{data:P}=r.clientControls.list.useQuery({clientId:n},{enabled:n>0}),{data:S,isLoading:he}=r.clientPolicies.list.useQuery({clientId:n},{enabled:n>0});x.useEffect(()=>{N||v("")},[N]);const{data:I}=r.controls.list.useQuery(),M=r.mappings.create.useMutation({onSuccess:()=>{l.success("Mapping created"),d(!1),w()},onError:s=>l.error(s.message)}),X=r.mappings.delete.useMutation({onSuccess:()=>{l.success("Mapping removed"),w()},onError:s=>l.error(s.message)}),k=r.mappings.update.useMutation({onSuccess:()=>{l.success("Mapping updated"),p(null),w()},onError:s=>l.error(s.message)}),Y=s=>{if(s.preventDefault(),!j||!f){l.error("Please select both a control and a policy");return}const t=new FormData(s.currentTarget);M.mutate({clientId:n,clientControlId:parseInt(j),clientPolicyId:parseInt(f),evidenceReference:t.get("evidenceReference"),notes:t.get("notes")})},Z=s=>{if(s.preventDefault(),!i)return;const t=new FormData(s.currentTarget);k.mutate({id:i.mapping.id,evidenceReference:t.get("evidenceReference"),notes:t.get("notes")})};return e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(oe,{items:[{label:"Clients",href:"/clients"},{label:(c==null?void 0:c.name)||"Client",href:`/clients/${n}`},{label:"Control-Policy Mappings"}]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>K(`/clients/${n}`),children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Control-Policy Mappings"}),e.jsx("p",{className:"text-muted-foreground",children:c==null?void 0:c.name})]})]}),e.jsxs(a,{onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Mapping"]})]}),e.jsx(D,{className:"bg-muted/30 border-dashed",children:e.jsx(R,{className:"pt-6",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Control-Policy Mappings"})," bridge the gap between your external compliance requirements and your internal documentation. Use this page to link your active ",e.jsx("strong",{children:"Controls"})," (what you need to do) to your internal ",e.jsx("strong",{children:"Policies"})," (how you do it), demonstrating clear compliance coverage to auditors."]})})}),e.jsx(H,{open:N,onOpenChange:d,title:"Create Mapping",description:"Link a control to a policy for this client.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{onClick:s=>{const t=document.getElementById("create-mapping-form");t&&t.requestSubmit()},disabled:M.isPending,children:M.isPending?"Creating...":"Create Mapping"})]}),children:e.jsx("form",{id:"create-mapping-form",onSubmit:Y,onReset:()=>{E(""),v("")},children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Control *"}),e.jsxs($,{value:j,onValueChange:E,children:[e.jsx(O,{className:j?"":"border-red-500",children:e.jsx(U,{placeholder:"Select control"})}),e.jsx(q,{children:P==null?void 0:P.map((s,t)=>{var h,Q,V;const m=((h=s.control)==null?void 0:h.name)||((Q=I==null?void 0:I.find(_=>_.id===s.clientControl.controlId))==null?void 0:Q.name)||`${s.clientControl.clientControlId} - Unknown`,b=(V=s.control)!=null&&V.name?`${s.clientControl.clientControlId} - ${m}`:m;return e.jsx(z,{value:s.clientControl.id.toString(),children:b},s.clientControl.id)})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Policy *"}),e.jsxs($,{value:f,onValueChange:v,children:[e.jsx(O,{className:f?"":"border-red-500",children:e.jsx(U,{placeholder:"Select policy"})}),e.jsx(q,{children:S&&S.length>0?S.map(s=>e.jsxs(z,{value:s.clientPolicy.id.toString(),children:[s.clientPolicy.clientPolicyId," - ",s.clientPolicy.name]},s.clientPolicy.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No policies available"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Evidence Reference"}),e.jsx(y,{name:"evidenceReference",placeholder:"Reference to evidence supporting this mapping..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(y,{name:"notes",placeholder:"Additional notes..."})]})]})})}),e.jsx(H,{open:!!i,onOpenChange:s=>!s&&p(null),title:"Edit Mapping",description:"Update evidence and notes for this control-policy mapping.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>p(null),children:"Cancel"}),e.jsx(a,{onClick:s=>{const t=document.getElementById("edit-mapping-form");t&&t.requestSubmit()},disabled:k.isPending,children:k.isPending?"Saving...":"Save Changes"})]}),children:i&&e.jsx("form",{id:"edit-mapping-form",onSubmit:Z,children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Control"}),e.jsx("div",{className:"p-2 border rounded bg-muted/50 text-sm",children:((T=i.control)==null?void 0:T.name)||((L=i.clientControl)==null?void 0:L.clientControlId)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Policy"}),e.jsx("div",{className:"p-2 border rounded bg-muted/50 text-sm",children:((A=i.clientPolicy)==null?void 0:A.name)||((B=i.clientPolicy)==null?void 0:B.clientPolicyId)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Evidence Reference"}),e.jsx(y,{name:"evidenceReference",defaultValue:i.mapping.evidenceReference||"",placeholder:"Reference to evidence supporting this mapping..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(y,{name:"notes",defaultValue:i.mapping.notes||"",placeholder:"Additional notes..."})]})]})})}),W?e.jsx(D,{children:e.jsx(R,{className:"p-6",children:e.jsx(te,{className:"h-64 w-full"})})}):C&&C.length>0?e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(ne,{children:[e.jsx(ie,{children:e.jsxs(F,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(g,{className:"text-white font-semibold py-4",children:"Control"}),e.jsx(g,{className:"text-white font-semibold py-4",children:"Policy"}),e.jsx(g,{className:"text-white font-semibold py-4",children:"Evidence Reference"}),e.jsx(g,{className:"text-white font-semibold py-4",children:"Notes"}),e.jsx(g,{className:"w-20 text-white font-semibold py-4",children:"Actions"})]})}),e.jsx(ae,{children:C.map(s=>{var t,m,b,h;return e.jsxs(F,{className:"bg-white border-b border-slate-200 cursor-pointer transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",onDoubleClick:()=>p(s),children:[e.jsx(u,{className:"py-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-mono text-sm text-black",children:(t=s.clientControl)==null?void 0:t.clientControlId}),s.mapping.isAiGenerated&&e.jsx("div",{className:"p-0.5 rounded bg-purple-100 text-purple-600",title:"AI Suggested Mapping",children:e.jsx(ce,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:(m=s.control)==null?void 0:m.name})]})}),e.jsx(u,{className:"py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm text-black",children:(b=s.clientPolicy)==null?void 0:b.clientPolicyId}),e.jsx("p",{className:"text-sm text-gray-500",children:(h=s.clientPolicy)==null?void 0:h.name})]})}),e.jsx(u,{className:"max-w-xs truncate text-gray-600 py-4",children:s.mapping.evidenceReference||"-"}),e.jsx(u,{className:"max-w-xs truncate text-gray-600 py-4",children:s.mapping.notes||"-"}),e.jsx(u,{className:"py-4",children:e.jsxs("div",{className:"flex gap-2 opacity-70 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(a,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",onClick:()=>p(s),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50 transition-colors duration-200",onClick:()=>{confirm("Remove this mapping?")&&X.mutate({id:s.mapping.id})},children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},`mapping-${s.mapping.id}`)})})]})}):e.jsx(D,{className:"py-12",children:e.jsxs(R,{className:"text-center",children:[e.jsx(me,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No mappings yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Link controls to policies to create an audit-ready mapping table."}),e.jsxs(a,{onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Create First Mapping"]})]})})]})})}export{ss as default};
