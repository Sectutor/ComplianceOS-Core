import{R as Ge,i as l,t as j,j as e,S as Re,c as n,C as I,d as Y,e as Z,m as M,f as Me,T as ms,k as w,r as g,D as Gs,o as Qs,p as Ws,q as Ks,s as Js,L as i,F as Te,a4 as Ys,Z as Zs,_ as Xs,$ as ea,a1 as js,I as b,bB as sa,x as _,n as aa,l as ta,z as ra,ab as ia,b as na,ao as vs,a3 as la,E as T,G as V,H as E,J as F,K as a}from"./index-DOc7Nwb7.js";import{B as da}from"./Breadcrumb-CRi3LAxS.js";import{T as ca,a as oa,b as ue,c as he}from"./tabs-CBDTXbEn.js";import{E as le}from"./enhanced-dialog-CeRPsI16.js";import{A as ma,a as xa,b as ua,c as ha,d as pa,e as ga,f as ja,g as va}from"./alert-dialog-V7xGXdVc.js";import{T as ye}from"./textarea-BtxBxzdY.js";/* empty css                   */import{P as fa}from"./progress-B-1k4ZZX.js";import{c as fs}from"./utils-BC5CVi_C.js";import{R as qe}from"./refresh-cw-Cjym1DSW.js";import{S as Na}from"./search-CwuIBBPE.js";import{F as ba}from"./file-check-De1wUTh7.js";import{L as wa}from"./lock-czWF3qbC.js";import{G as Ns}from"./globe-BMGZmoaJ.js";import{C as os}from"./circle-check-C5kiwRoG.js";import{E as ae}from"./external-link-C3PXjBR9.js";import{P as ve}from"./plus-BaQ35Jcx.js";import{M as Qe}from"./mail-xRDvl6QK.js";import{C as bs}from"./copy-CXVMffmd.js";import{I as Cs}from"./info-By5wLOUH.js";import{E as ya}from"./eye-CIq9q9s6.js";import{S as Ca}from"./sparkles-CoQ80pK2.js";import{S as Ce}from"./shield-alert-iAruRy4W.js";import{C as Ss}from"./clock-osbacZli.js";import{U as ks}from"./user-CqRnJLgW.js";import{U as Sa}from"./upload-BBmUECj8.js";import{P as _e}from"./pen-BlTNmlLB.js";import{T as ds}from"./trash-2-CFEfisbM.js";import{C as cs}from"./circle-check-big-BSqJVrgh.js";import{C as ws}from"./calendar-BlLJlGbj.js";import{Z as Be}from"./zap-B01fFOkT.js";import{O as ka}from"./octagon-alert-CfjMpeM5.js";import{P as Da}from"./phone-BFakwHvb.js";import{S as ys}from"./scroll-text-CmmtRUs3.js";import{f as pe}from"./format-H2tx8_vS.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";const Aa=({vendor:d,onRefresh:L})=>{var R,q;const[O,o]=Ge.useState(!1);Ge.useEffect(()=>{if(!O)return;L&&L();const u=setInterval(()=>{L&&L()},3e3),p=setTimeout(()=>{o(!1),l.info("Background analysis monitoring period ended. Please refresh manually if data is still not visible.")},45e3);return()=>{clearInterval(u),clearTimeout(p)}},[O,L]),Ge.useEffect(()=>{var u;O&&((u=d.trustCenterData)!=null&&u.riskSummary)},[d.trustCenterData,O]);const m=j.vendors.discoverTrustCenter.useMutation({onSuccess:u=>{l.success("Trust Center URL discovered! AI Analysis is now running in the background."),o(!0)},onError:u=>{l.error(`Discovery failed: ${u.message}`)}}),y=j.vendors.analyzeTrustCenter.useMutation({onSuccess:()=>{l.success("AI VRM Analysis complete!"),L&&L(),o(!0)},onError:u=>{l.error(`Analysis failed: ${u.message}`)}}),k=j.useContext(),x=d.trustCenterData,t=()=>{if(!(d!=null&&d.id))return l.error("Vendor ID is missing. Wait for page to load.");m.mutate({vendorId:Number(d.id)})},U=()=>{if(!(d!=null&&d.id))return l.error("Vendor ID is missing.");if(!d.trustCenterUrl)return l.error("No Trust Center URL found. Run discovery first.");y.mutate({vendorId:Number(d.id),url:d.trustCenterUrl})},h=u=>u>=80?"text-green-500":u>=50?"text-amber-500":"text-red-500";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(Re,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"AI Virtual Trust Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Automated Vendor Risk & Compliance Discovery"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{variant:d.trustCenterUrl?"outline":"default",onClick:t,disabled:m.isPending,className:fs("flex-1 md:flex-none font-bold transition-all transform hover:scale-105 active:scale-95",d.trustCenterUrl?"border-blue-200 text-blue-700 hover:bg-blue-50":"bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/50 animate-pulse-blue border-none"),children:[m.isPending?e.jsx(qe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Na,{className:"w-4 h-4 mr-2"}),"Refresh Discovery"]}),e.jsxs(n,{onClick:U,disabled:y.isPending||!d.trustCenterUrl,className:fs("flex-1 md:flex-none font-bold bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/50 transition-all transform hover:scale-105 active:scale-95 disabled:bg-slate-100 disabled:text-slate-400 disabled:shadow-none",y.isPending&&"animate-pulse"),children:[y.isPending?e.jsx(qe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ba,{className:"w-4 h-4 mr-2"}),"Re-run AI Analysis"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"md:col-span-1 overflow-hidden relative border-none bg-gradient-to-br from-slate-900 to-slate-800 text-white shadow-2xl",children:[e.jsx(Y,{className:"pb-2",children:e.jsx(Z,{className:"text-sm font-medium text-slate-400 uppercase tracking-wider",children:"Overall Trust Score"})}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsxs("div",{className:"text-6xl font-black mb-2 flex items-baseline",children:[e.jsx("span",{className:h(d.trustScore||0),children:d.trustScore||"—"}),e.jsx("span",{className:"text-2xl text-slate-500 ml-1",children:"/100"})]}),e.jsx("p",{className:"text-slate-400 text-sm text-center",children:"Based on public certifications, security documentation, and disclosure transparency."})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"Trust Level"}),e.jsx("span",{className:"font-semibold text-white",children:d.trustScore>=80?"Premium":d.trustScore>=50?"Standard":"Needs Review"})]}),e.jsx(fa,{value:d.trustScore||0,className:"h-2 bg-slate-700"})]})]})]}),e.jsxs(I,{className:"md:col-span-2",children:[e.jsxs(Y,{children:[e.jsxs(Z,{className:"text-lg flex items-center gap-2",children:[e.jsx(wa,{className:"w-5 h-5 text-primary"}),"AI Security Posture Analysis"]}),e.jsx(Me,{children:"Generated assessment of public-facing security controls"})]}),e.jsxs(M,{className:"space-y-4",children:[x!=null&&x.riskSummary?e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg border border-border italic text-sm text-muted-foreground leading-relaxed",children:[O&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-blue-600 text-xs font-semibold animate-pulse",children:[e.jsx(qe,{className:"h-3 w-3 animate-spin"})," Updating Analysis..."]}),'"',x.riskSummary,'"']}):O?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-blue-600 animate-pulse bg-blue-50/50 rounded-lg border border-blue-100",children:[e.jsx(qe,{className:"h-8 w-8 animate-spin mb-4"}),e.jsx("p",{className:"text-sm font-semibold",children:"AI Agent is analyzing vendor documentation..."}),e.jsx("p",{className:"text-xs text-blue-400 mt-1",children:"This usually takes 15-30 seconds"})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ns,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No analysis performed yet. Click re-run to start AI discovery."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Detected Artifacts"}),e.jsx("div",{className:"space-y-1.5",children:((R=x==null?void 0:x.docs)==null?void 0:R.map((u,p)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-background border border-border text-xs",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-3.5 h-3.5 text-green-500"}),u.name]}),e.jsx("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:e.jsx(ae,{className:"w-3.5 h-3.5"})})]},p)))||e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"None detected"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Likely Gaps"}),e.jsx("div",{className:"space-y-1.5",children:((q=x==null?void 0:x.gaps)==null?void 0:q.map((u,p)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded bg-red-500/5 border border-red-500/10 text-xs text-red-700 dark:text-red-300",children:[e.jsx(ms,{className:"w-3.5 h-3.5 text-red-500 shrink-0 mt-0.5"}),e.jsx("span",{children:u})]},p)))||e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No obvious gaps detected"})})]})]})]})]})]}),e.jsxs(I,{children:[e.jsxs(Y,{children:[e.jsx(Z,{className:"text-lg",children:"Public Discovery Details"}),e.jsx(Me,{children:"How our AI VRM Agent found this information"})]}),e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted border border-border",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground block mb-1 uppercase",children:"Source URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-blue-500 shrink-0"}),d.trustCenterUrl?e.jsxs("a",{href:d.trustCenterUrl,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-xs break-all text-primary hover:underline flex items-center gap-1",children:[d.trustCenterUrl,e.jsx(ae,{className:"w-3 h-3"})]}):e.jsx("span",{className:"font-mono text-xs text-muted-foreground italic",children:"No URL discovered"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted border border-border",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground block mb-1 uppercase",children:"Scan Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx(w,{className:"bg-green-500/10 text-green-600 border-green-500/20 hover:bg-green-500/20",children:"Verified"}):e.jsx(w,{variant:"outline",children:"Pending Scan"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Checked by ComplianceOS AI Agent"})]})]})]})})]}),e.jsxs(I,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx(Z,{children:"Manual Compliance Verification"}),e.jsx(Me,{children:"Manually verify compliance artifacts and status."})]})]})}),e.jsx(M,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{id:"soc2",label:"SOC 2 Type II",desc:"AICPA Service Organization Control"},{id:"iso27001",label:"ISO 27001",desc:"Information Security Management"},{id:"gdpr",label:"GDPR Compliant",desc:"General Data Protection Regulation"},{id:"ccpa",label:"CCPA/CPRA",desc:"California Consumer Privacy Act"},{id:"dpa",label:"DPA Signed",desc:"Data Processing Agreement executed"},{id:"fedramp",label:"FedRAMP",desc:"Federal Risk and Authorization Management"},{id:"hipaa",label:"HIPAA",desc:"Health Insurance Portability and Accountability"},{id:"pci",label:"PCI DSS",desc:"Payment Card Industry Data Security"},{id:"privacyshield",label:"Privacy Shield",desc:"Data Privacy Framework"}].map(u=>{var de;const p=!!((de=x==null?void 0:x.manual)!=null&&de[u.id]),J=r=>{if(!(d!=null&&d.id))return;const C=d.trustCenterData||{},D={...C.manual,[u.id]:r};k.vendors.get.setData({id:d.id},A=>A&&{...A,trustCenterData:{...C,manual:D}}),j.vendors.update.mutate({id:d.id,trustCenterData:{...C,manual:D}}).then(()=>{l.success(`Updated ${u.label}`,{duration:1500}),L&&L()}).catch(A=>{console.error("Failed to update vendor trust center:",A),l.error("Failed to save: "+(A.message||"Unknown error")),k.vendors.get.invalidate({id:d.id})})};return e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border hover:bg-slate-50 transition-colors cursor-pointer",onClick:r=>{r.target.tagName!=="INPUT"&&J(!p)},children:[e.jsx("input",{type:"checkbox",id:u.id,className:"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mt-0.5 cursor-pointer",checked:p,onChange:r=>J(r.target.checked)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:u.id,className:"font-medium text-sm cursor-pointer select-none pointer-events-none",children:u.label}),e.jsx("p",{className:"text-xs text-muted-foreground select-none pointer-events-none",children:u.desc})]})]},u.id)})})})]})]})};function Pa({isOpen:d,onClose:L,vendorName:O,onSend:o,templates:m=[]}){const[y,k]=g.useState([{type:"document",name:"SOC 2 Report"},{type:"document",name:"Penetration Test Report"}]),[x,t]=g.useState(""),U=[{type:"document",name:"ISO 27001 Certificate"},{type:"document",name:"Privacy Policy"},{type:"document",name:"Business Continuity Plan"},{type:"document",name:"Data Processing Agreement (DPA)"}],h=p=>{k(y.filter((J,de)=>de!==p))},R=p=>{y.find(J=>J.name===p.name)||k([...y,p])},q=()=>{if(!x)return l.error("Recipient email is required");if(y.length===0)return l.error("Please select at least one item to request");o({recipientEmail:x,items:y})},u=()=>{navigator.clipboard.writeText("https://app.grcompliance.com/portal/request/mock-token"),l.success("Link copied to clipboard")};return e.jsx(Gs,{open:d,onOpenChange:p=>!p&&L(),children:e.jsxs(Qs,{className:"sm:max-w-2xl w-[95vw] p-0 overflow-hidden rounded-2xl border-none shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-br from-slate-900 to-indigo-950 p-8 text-white text-left relative",children:e.jsxs(Ws,{className:"text-left pr-8",children:[e.jsxs(Ks,{className:"text-2xl font-bold flex items-center gap-3 text-white flex-wrap",children:[e.jsx(Re,{className:"w-7 h-7 text-indigo-400 shrink-0"}),e.jsxs("span",{children:["Request documents from ",O]})]}),e.jsx(Js,{className:"text-slate-300 text-sm mt-2 leading-relaxed max-w-lg",children:"Create a secure portal for your vendor to upload compliance evidence and fill questionnaires."})]})}),e.jsxs("div",{className:"p-8 space-y-8 bg-white text-left",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"text-sm font-semibold text-slate-700",children:"Specify the required documents"}),e.jsxs("div",{className:"min-h-[100px] p-2 border-2 border-slate-100 rounded-xl focus-within:border-indigo-500 transition-all bg-slate-50/50 flex flex-wrap gap-2 items-start content-start",children:[y.map((p,J)=>e.jsxs(w,{variant:"secondary",className:"px-3 py-1.5 rounded-lg bg-white border border-slate-200 shadow-sm text-slate-700 font-medium flex items-center gap-2",children:[p.type==="questionnaire"?e.jsx(Te,{className:"w-3 h-3 text-indigo-500"}):e.jsx(Re,{className:"w-3 h-3 text-emerald-500"}),p.name,e.jsx("button",{onClick:()=>h(J),className:"hover:text-red-500 transition-colors ml-1",children:e.jsx(Ys,{className:"w-3 h-3"})})]},J)),e.jsxs(Zs,{children:[e.jsx(Xs,{asChild:!0,children:e.jsxs(n,{variant:"ghost",size:"sm",className:"h-9 px-3 rounded-lg border border-dashed border-slate-300 text-slate-500 hover:border-slate-400",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Add item"]})}),e.jsxs(ea,{align:"start",className:"w-64 p-2 rounded-xl shadow-xl",children:[e.jsx("div",{className:"px-2 py-1 text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Questionnaires"}),m.map(p=>e.jsxs(js,{onClick:()=>R({type:"questionnaire",id:p.id,name:p.name}),className:"rounded-lg cursor-pointer",children:[e.jsx(Te,{className:"w-4 h-4 mr-3 text-indigo-500"}),p.name]},p.id)),e.jsx("div",{className:"px-2 py-1 mt-2 text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Common Documents"}),U.map(p=>e.jsxs(js,{onClick:()=>R(p),className:"rounded-lg cursor-pointer",children:[e.jsx(Re,{className:"w-4 h-4 mr-3 text-emerald-500"}),p.name]},p.name))]})]})]}),e.jsx("p",{className:"text-[11px] text-slate-400 italic",children:"Items are auto-populated based on your default vendor requirements."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-slate-400"}),"Send email invite"]}),e.jsx(b,{placeholder:"vendor-contact@example.com",value:x,onChange:p=>t(p.target.value),className:"rounded-xl border-slate-200 h-12 focus:ring-4 focus:ring-indigo-100"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-slate-400"}),"Or, copy the link below"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("div",{className:"flex-1 bg-slate-50 px-4 py-3 rounded-xl border border-slate-200 text-slate-500 text-xs truncate leading-6 font-mono min-w-0",children:"https://app.grcompliance.com/portal/request/secure_link_here"}),e.jsxs(n,{variant:"outline",size:"sm",onClick:u,className:"h-12 px-6 rounded-xl border-slate-200 hover:bg-slate-50 shrink-0",children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Copy Link"]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-[11px] text-amber-600 bg-amber-50 p-3 rounded-lg border border-amber-100",children:[e.jsx(Cs,{className:"w-3.5 h-3.5 shrink-0 mt-0.5"}),e.jsx("span",{children:"Anyone with the link can upload files and complete assessments."})]})]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-50 flex flex-col sm:flex-row items-center justify-between border-t border-slate-100 gap-4",children:[e.jsxs(n,{variant:"ghost",className:"text-slate-600 hover:bg-slate-200 rounded-xl w-full sm:w-auto justify-start sm:justify-center",children:[e.jsx(ya,{className:"w-4 h-4 mr-2"}),"Send me a preview"]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsx(n,{variant:"ghost",onClick:L,className:"rounded-xl px-6 flex-1 sm:flex-none",children:"Cancel"}),e.jsx(n,{onClick:q,className:"bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl px-8 py-5 h-auto font-semibold shadow-lg shadow-indigo-200 transition-all hover:translate-y-[-1px] flex-1 sm:flex-none",children:"Send email"})]})]})]})})}function Ia({clientId:d,vendorId:L,vendorName:O,hasScanData:o}){const[m,y]=g.useState(!1),{generate:k,data:x,isLoading:t,error:U}=sa(),h=()=>{m?y(!1):(y(!0),x||k({clientId:d,vendorId:L}))};return o?e.jsxs("div",{className:"mt-4",children:[e.jsxs(n,{onClick:h,variant:"outline",className:"w-full flex items-center justify-center gap-2 border-purple-200 hover:bg-purple-50 hover:text-purple-700 text-purple-600",children:[e.jsx(Ca,{className:"w-4 h-4"}),e.jsx("span",{children:x?"View Mitigation Plan":"Generate AI Mitigation Plan"})]}),m&&e.jsxs("div",{className:"mt-4 border border-gray-200 rounded-lg bg-white p-6 shadow-sm",children:[t&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(_,{className:"w-8 h-8 animate-spin text-purple-600 mb-2"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"Analyzing vulnerabilities and breach data..."}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"This may take up to 30 seconds"})]}),U&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(ms,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"Generation Failed"}),e.jsx("p",{className:"text-sm text-red-800",children:U.message||"Could not generate plan. Please try again."})]})]}),x&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-purple-600"}),"Risk Mitigation Plan: ",x.vendorName]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsxs("span",{children:["Timeline: ",x.estimatedTimeline]})]}),e.jsx("div",{children:e.jsxs("span",{children:[x.mitigationSteps.length," Actions"]})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.riskScore}),e.jsx("div",{className:"text-xs text-gray-500",children:"Current Risk Score"})]})]}),x.cveAnalysis&&e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-100 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-2 text-sm uppercase tracking-wide",children:"Risk Analysis"}),e.jsx("p",{className:"text-sm text-purple-800 leading-relaxed whitespace-pre-wrap",children:x.cveAnalysis})]}),e.jsx("div",{className:"space-y-4",children:x.mitigationSteps.map((R,q)=>e.jsx(La,{step:R,isLast:q===x.mitigationSteps.length-1,clientId:d},q))})]})]})]}):null}function La({step:d,isLast:L,clientId:O}){const[o,m]=g.useState(!1),y=j.remediationTasks.create.useMutation({onSuccess:()=>{l.success("Remediation task created"),m(!0)},onError:t=>l.error("Failed to create task: "+t.message)}),k=()=>{y.mutate({clientId:O,title:d.title,description:d.description,priority:d.priority.toLowerCase(),dueDate:new Date(Date.now()+7*24*60*60*1e3).toISOString()})},x={Critical:"bg-red-100 text-red-800 border-red-200",High:"bg-orange-100 text-orange-800 border-orange-200",Medium:"bg-yellow-100 text-yellow-800 border-yellow-200",Low:"bg-green-100 text-green-800 border-green-200"};return e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-0 top-0",children:e.jsx(aa,{className:`w-6 h-6 fill-white ${d.priority==="Critical"?"text-red-500":"text-purple-600"}`})}),!L&&e.jsx("div",{className:"absolute left-3 top-6 bottom-0 w-0.5 bg-gray-200"}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:d.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded border font-medium ${x[d.priority]||x.Medium}`,children:d.priority})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-3 leading-relaxed",children:d.description}),e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-50 pt-3 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[d.assignedTo&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ks,{className:"w-3 h-3"}),e.jsxs("span",{children:["Owner: ",d.assignedTo]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ss,{className:"w-3 h-3"}),e.jsxs("span",{children:["Effort: ",d.estimatedEffort]})]})]}),e.jsx(n,{size:"sm",variant:o?"ghost":"outline",className:`h-7 px-2 text-xs ${o?"text-green-600 hover:text-green-700 bg-green-50":""}`,onClick:k,disabled:o||y.isPending,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ta,{className:"w-3 h-3 mr-1"})," Task Created"]}):e.jsxs(e.Fragment,{children:[y.isPending?e.jsx(_,{className:"w-3 h-3 animate-spin mr-1"}):e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Create Task"]})})]})]})]})}const Ra=["image/png","image/jpeg","image/gif","image/webp","application/pdf","text/plain","text/csv","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/json","application/zip"];function Ma({onUploadComplete:d,folder:L="uploads",accept:O=Ra,maxSizeMB:o=10,multiple:m=!1}){const[y,k]=g.useState(!1),[x,t]=g.useState([]),U=g.useRef(null),h=r=>{const C=[],D=[];for(const A of r){if(!O.includes(A.type)){C.push(`${A.name}: File type not allowed`);continue}if(A.size>o*1024*1024){C.push(`${A.name}: File too large (max ${o}MB)`);continue}D.push(A)}return{valid:D,errors:C}},R=async r=>{!m&&r.length>1&&(l.error("Only one file allowed"),r=[r[0]]);const{valid:C,errors:D}=h(r);if(D.length>0&&(D.forEach($=>l.error($)),C.length===0))return;const A=C.map(($,X)=>({id:`${Date.now()}-${X}`,name:$.name,size:$.size,progress:0,status:"uploading"}));t($=>[...$,...A]);for(let $=0;$<C.length;$++){const X=C[$],te=A[$];try{const G=new FileReader;await new Promise((ke,Ve)=>{G.onload=async()=>{try{const Ee=G.result.split(",")[1];t(je=>je.map(re=>re.id===te.id?{...re,progress:30}:re));const De=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:X.name,data:Ee,contentType:X.type,folder:L})});if(!De.ok)throw new Error("Upload failed");const{url:ge,key:We}=await De.json();t(je=>je.map(re=>re.id===te.id?{...re,progress:100,status:"success"}:re)),d({name:X.name,url:ge,key:We}),ke()}catch(ce){const Ee=ce instanceof Error?ce.message:"Unknown error";t(De=>De.map(ge=>ge.id===te.id?{...ge,status:"error",error:Ee}:ge)),Ve(ce)}},G.onerror=()=>Ve(new Error("Failed to read file")),G.readAsDataURL(X)})}catch{}}setTimeout(()=>{t($=>$.filter(X=>X.status!=="success"))},3e3),U.current&&(U.current.value="")},q=async r=>{const C=Array.from(r.target.files||[]);C.length!==0&&await R(C)},u=r=>{r.preventDefault(),r.stopPropagation(),r.type==="dragenter"||r.type==="dragover"?k(!0):r.type==="dragleave"&&k(!1)},p=async r=>{r.preventDefault(),r.stopPropagation(),k(!1);const C=Array.from(r.dataTransfer.files||[]);C.length!==0&&await R(C)},J=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`,de=x.length>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between"}),e.jsxs("div",{onDragEnter:u,onDragLeave:u,onDragOver:u,onDrop:p,className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ${y?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onClick:()=>{var r;return(r=U.current)==null?void 0:r.click()},children:[e.jsx(Sa,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"Click or Drag files here to upload"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Max ",o,"MB"]}),e.jsx("input",{ref:U,type:"file",className:"hidden",onChange:q,accept:O.join(","),multiple:m})]}),de&&e.jsx(I,{className:"border-blue-200 bg-blue-50",children:e.jsx(M,{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:x.map(r=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r.status==="uploading"&&e.jsx(_,{className:"h-4 w-4 animate-spin text-blue-600 flex-shrink-0"}),r.status==="success"&&e.jsx(os,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),r.status==="error"&&e.jsx(ra,{className:"h-4 w-4 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r.name})]}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:J(r.size)})]}),r.status==="uploading"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all",style:{width:`${r.progress}%`}})}),r.status==="error"&&r.error&&e.jsx("p",{className:"text-xs text-red-600",children:r.error})]},r.id))})})})]})}function vt(){var gs;const{id:d,vendorId:L}=ia(),[,O]=na(),o=parseInt(d||"0"),m=parseInt(L||"0"),y=j.useContext(),{data:k,isLoading:x}=j.vendorAssessments.getVendorDetails.useQuery({vendorId:m,clientId:o},{enabled:!!m&&!!o}),t=k==null?void 0:k.vendor,U=(k==null?void 0:k.assessments)||[],h=k==null?void 0:k.scanResult,R=(h==null?void 0:h.vulnerabilities)||[],q=j.vendors.runRiskScan.useMutation({onSuccess:()=>{l.success("Risk scan completed"),y.vendorAssessments.getVendorDetails.invalidate({vendorId:m,clientId:o})},onError:s=>l.error("Scan failed: "+s.message)});Ge.useMemo(()=>{var K;if((K=h==null?void 0:h.scan)!=null&&K.riskScore)return h.scan.riskScore;if(!R||R.length===0)return 0;let s=0;const S=R.filter(N=>parseFloat(N.cvssScore||"0")>=9).length,H=R.filter(N=>parseFloat(N.cvssScore||"0")>=7&&parseFloat(N.cvssScore||"0")<9).length;return s=S*20+H*10,Math.min(s,100)},[R,h]),h!=null&&h.breaches;const[u,p]=g.useState(null),{data:J,isLoading:de}=j.vendors.getScanVulnerabilities.useQuery({scanId:u},{enabled:!!u}),[r,C]=g.useState(null),[D,A]=g.useState({priority:"high",assignee:"",dueDate:"",notes:""}),$=j.vendors.createRemediationTask.useMutation({onSuccess:()=>{l.success("Remediation task created",{description:`Task for ${r==null?void 0:r.cveId} added to the Task Management page.`}),C(null),A({priority:"high",assignee:"",dueDate:"",notes:""})},onError:s=>l.error("Failed to create task: "+s.message)}),[X,te]=g.useState(!1),[G,Se]=g.useState({type:"",dueDate:"",status:"Planned"}),ke=j.vendorAssessments.create.useMutation({onSuccess:()=>{l.success("Assessment scheduled"),te(!1),Se({type:"",dueDate:"",status:"Planned"}),refetchAssessments()},onError:s=>l.error("Failed to schedule: "+s.message)}),[Ve,ce]=g.useState(!1),[Ee,De]=g.useState({templateId:"",recipientEmail:"",dueDate:""}),{data:ge}=j.vendorAssessments.listTemplates.useQuery({clientId:o},{enabled:!!o}),We=j.vendorAssessments.sendConsolidatedRequest.useMutation({onSuccess:()=>{l.success("Requests sent to vendor"),ce(!1),refetchAssessments()},onError:s=>l.error("Failed to send: "+s.message)}),{data:je,refetch:re}=j.threatIntel.getVendorSuggestions.useQuery({vendorId:m},{enabled:!!m}),Ke=j.threatIntel.scanVendor.useMutation({onSuccess:()=>{l.success("Vendor threat scan completed"),re()},onError:s=>l.error("Vendor scan failed: "+s.message)}),Ds=s=>{We.mutate({clientId:o,vendorId:m,...s})},Je=j.vendorAssessments.update.useMutation({onSuccess:()=>{l.success("Assessment updated"),Fe(!1),ee({id:0,status:"",score:0,findings:"",documentUrl:"",inherentImpact:"",inherentLikelihood:"",inherentRiskLevel:"",residualImpact:"",residualLikelihood:"",residualRiskLevel:""}),refetchAssessments()},onError:s=>l.error("Failed to update assessment: "+s.message)}),[As,Fe]=g.useState(!1),[c,ee]=g.useState({id:0,status:"",score:0,findings:"",documentUrl:"",inherentImpact:"",inherentLikelihood:"",inherentRiskLevel:"",residualImpact:"",residualLikelihood:"",residualRiskLevel:""}),Ps=()=>{c.id&&Je.mutate({id:c.id,status:c.status,score:c.score,findings:c.findings,documentUrl:c.documentUrl,inherentImpact:c.inherentImpact,inherentLikelihood:c.inherentLikelihood,inherentRiskLevel:c.inherentRiskLevel,residualImpact:c.residualImpact,residualLikelihood:c.residualLikelihood,residualRiskLevel:c.residualRiskLevel})},Is=s=>{ee({id:s.id,status:s.status||"In Progress",score:s.score||0,findings:s.findings||"",documentUrl:s.documentUrl||"",inherentImpact:s.inherentImpact||"",inherentLikelihood:s.inherentLikelihood||"",inherentRiskLevel:s.inherentRiskLevel||"",residualImpact:s.residualImpact||"",residualLikelihood:s.residualLikelihood||"",residualRiskLevel:s.residualRiskLevel||""}),Fe(!0)},{data:ie,refetch:Ye}=j.vendorContacts.list.useQuery({vendorId:m},{enabled:!!m}),[Ls,Ae]=g.useState(!1),[Ze,Xe]=g.useState(null),[W,oe]=g.useState({name:"",email:"",phone:"",role:"",isPrimary:!1}),es=j.vendorContacts.create.useMutation({onSuccess:()=>{l.success("Contact added"),Ae(!1),oe({name:"",email:"",phone:"",role:"",isPrimary:!1}),Ye()},onError:s=>l.error("Failed to add contact: "+s.message)}),ss=j.vendorContacts.update.useMutation({onSuccess:()=>{l.success("Contact updated"),Ae(!1),Xe(null),Ye()},onError:s=>l.error("Failed to update contact: "+s.message)}),Rs=j.vendorContacts.delete.useMutation({onSuccess:()=>{l.success("Contact deleted"),Ye()}}),{data:fe,refetch:as}=j.vendorContracts.list.useQuery({vendorId:m},{enabled:!!m}),[Ms,me]=g.useState(!1),[Oe,xs]=g.useState(null),[f,B]=g.useState({title:"",description:"",startDate:"",endDate:"",autoRenew:!1,value:"",status:"Active",documentUrl:"",noticePeriod:"",paymentTerms:"",slaDetails:"",dpaStatus:"Not Signed",owner:""}),ts=j.vendorContracts.create.useMutation({onSuccess:()=>{l.success("Contract added"),me(!1),B({title:"",description:"",startDate:"",endDate:"",autoRenew:!1,value:"",status:"Active",documentUrl:"",noticePeriod:"",paymentTerms:"",slaDetails:"",dpaStatus:"Not Signed",owner:""}),as()},onError:s=>l.error("Failed to add contract: "+s.message)}),rs=j.vendorContracts.update.useMutation({onSuccess:()=>{l.success("Contract updated"),me(!1),xs(null),as()},onError:s=>l.error("Failed to update contract: "+s.message)}),Ts=j.vendorContracts.delete.useMutation({onSuccess:()=>{l.success("Contract deleted"),as(),me(!1)}}),{data:is,refetch:us}=j.vendorDpas.list.useQuery({vendorId:m,clientId:o},{enabled:!!m&&!!o}),{data:Ne,error:hs}=j.dpaTemplates.list.useQuery(void 0,{onSuccess:s=>console.log("Fetched DPA templates:",s),onError:s=>console.error("Error fetching DPA templates:",s)});hs&&console.error("Templates query error:",hs);const[Vs,Pe]=g.useState(!1),[ne,Ue]=g.useState({templateId:"",name:""}),ns=j.vendorDpas.createFromTemplate.useMutation({onSuccess:s=>{console.log("DPA created successfully:",s),l.success("DPA generated from template"),Pe(!1),Ue({templateId:"",name:""}),us()},onError:s=>{console.error("DPA creation error:",s),l.error("Failed to generate DPA: "+s.message)}}),Es=j.vendorDpas.delete.useMutation({onSuccess:()=>{l.success("DPA deleted"),us()},onError:s=>l.error("Failed to delete DPA: "+s.message)}),Fs=()=>{if(!W.name)return l.error("Name is required");Ze?ss.mutate({id:Ze.id,...W}):es.mutate({clientId:o,vendorId:m,...W})},ps=s=>{s?(Xe(s),oe({name:s.name,email:s.email||"",phone:s.phone||"",role:s.role||"",isPrimary:s.isPrimary||!1})):(Xe(null),oe({name:"",email:"",phone:"",role:"",isPrimary:!1})),Ae(!0)},Os=()=>{if(!G.type)return l.error("Type is required");ke.mutate({clientId:o,vendorId:m,...G})},[Us,ze]=g.useState(!1),[v,Q]=g.useState({name:"",description:"",website:"",criticality:"Low",dataAccess:"Internal",status:"Active",category:"SaaS",source:"Manual",reviewStatus:"needs_review",serviceDescription:"",additionalNotes:"",isSubprocessor:!1,trustCenterUrl:""}),be=j.vendors.update.useMutation({onSuccess:()=>{l.success("Vendor updated"),ze(!1),y.vendors.get.invalidate({id:m})},onError:s=>l.error("Failed to update: "+s.message)}),zs=()=>{if(!v.name)return l.error("Name is required");be.mutate({id:m,...v})},[Hs,Ie]=g.useState(!1),[se,we]=g.useState({to:"",subject:"Request for Compliance Documents",body:`Hello,

We are updating our vendor compliance records. Please provide the following documents:

- SOC 2 Report
- ISO 27001 Certificate
- Latest Penetration Test Summary

Thank you,
Security Team`}),ls=j.communication.sendVendorEmail.useMutation({onSuccess:()=>{l.success("Email sent successfully"),Ie(!1),we({to:"",subject:"Request for Compliance Documents",body:`Hello,

We are updating our vendor compliance records. Please provide the following documents:

- SOC 2 Report
- ISO 27001 Certificate
- Latest Penetration Test Summary

Thank you,
Security Team`})},onError:s=>l.error("Failed to send email: "+s.message)}),$s=()=>{if(!se.to)return l.error("Recipient email is required");ls.mutate({clientId:o,vendorId:m,to:se.to,subject:se.subject,body:se.body.replace(/\n/g,"<br/>")})},[qs,He]=g.useState(!1),[xe,$e]=g.useState({name:"",url:""}),[z,Le]=g.useState(null),_s=()=>{if(!xe.name||!xe.url)return l.error("Name and URL are required");const S=[...(t==null?void 0:t.additionalDocuments)||[],{name:xe.name,url:xe.url,date:new Date().toISOString()}];be.mutate({id:m,additionalDocuments:S}),He(!1),$e({name:"",url:""})},Bs=()=>{t&&(Q({name:t.name,description:t.description||"",website:t.website||"",criticality:t.criticality||"Low",dataAccess:t.dataAccess||"Internal",status:t.status||"Active",category:t.category||"SaaS",source:t.source||"Manual",reviewStatus:t.reviewStatus||"needs_review",serviceDescription:t.serviceDescription||"",additionalNotes:t.additionalNotes||"",isSubprocessor:t.isSubprocessor||!1,trustCenterUrl:t.trustCenterUrl||""}),ze(!0))};return x?e.jsx("div",{className:"flex h-[50vh] w-full items-center justify-center",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(da,{items:[{label:"Vendors",href:`/clients/${o}/vendors/overview`},{label:t.name}]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:`/clients/${o}/vendors/all`,children:"Back"})}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>Ie(!0),children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"})," Email Vendor"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:Bs,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Edit Vendor"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsx("div",{className:"h-24 w-24 rounded-lg bg-white border shadow-sm flex items-center justify-center text-3xl font-bold text-slate-500 uppercase shrink-0",children:t.name.substring(0,2)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t.name}),e.jsx(w,{className:t.status==="Active"?"bg-emerald-100 text-emerald-800":t.status==="Onboarding"?"bg-blue-100 text-blue-800":"bg-slate-100 text-slate-800",children:t.status}),t.isSubprocessor&&e.jsx(w,{className:"bg-purple-100 text-purple-800 border-purple-200",children:"Approved Subprocessor"}),t.category&&e.jsx(w,{variant:"outline",className:"text-slate-600",children:t.category}),t.reviewStatus==="needs_review"&&e.jsx(w,{variant:"destructive",className:"animate-pulse",children:"Review Needed"})]}),e.jsx("p",{className:"text-muted-foreground",children:t.description}),e.jsxs("div",{className:"flex gap-4 text-sm text-slate-500",children:[t.website&&e.jsxs("a",{href:t.website,target:"_blank",rel:"noreferrer",className:"flex items-center text-blue-600 hover:underline",children:[t.website," ",e.jsx(ae,{className:"ml-1 h-3 w-3"})]}),t.source&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:"w-3 h-3"})," Source: ",t.source]})]})]}),e.jsxs(I,{className:"min-w-[250px] bg-slate-50 border-slate-200",children:[e.jsx(Y,{className:"py-3",children:e.jsx(Z,{className:"text-sm font-medium uppercase tracking-wider text-muted-foreground",children:"Inherent Risk"})}),e.jsxs(M,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Criticality"}),e.jsx(w,{variant:"outline",className:t.criticality==="High"?"text-rose-600 border-rose-200 bg-rose-50":"text-emerald-600 border-emerald-200 bg-emerald-50",children:t.criticality})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Data Access"}),e.jsx(w,{variant:"outline",className:t.dataAccess==="Restricted"?"text-rose-600 border-rose-200 bg-rose-50":"text-slate-600 border-slate-200 bg-slate-50",children:t.dataAccess})]})]})]})]}),"// Force Reload: debug-marker-v1",e.jsx("div",{className:"bg-indigo-600 text-white p-2 rounded text-xs font-bold text-center mb-4",children:"DPA SYSTEM ACTIVE"}),e.jsxs(ca,{defaultValue:"overview",className:"w-full",children:[e.jsxs(oa,{className:"flex flex-wrap h-auto bg-slate-100 p-1 mb-2",children:[e.jsxs(ue,{value:"legal",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white",children:["Legal & DPAs",e.jsx(w,{variant:"secondary",className:"ml-2 bg-indigo-100 text-indigo-700 border-indigo-200 scale-75 origin-left font-bold",children:"NEW"})]}),e.jsx(ue,{value:"overview",children:"Overview"}),e.jsx(ue,{value:"documents",children:"Documents"}),e.jsx(ue,{value:"assessments",children:"Assessments"}),e.jsx(ue,{value:"trust-center",children:"Trust Center"}),e.jsx(ue,{value:"risk-scan",children:"Risk Scan"}),e.jsx(ue,{value:"contacts",children:"Contacts"}),e.jsx(ue,{value:"contracts",children:"Contracts"})]}),e.jsx(he,{value:"legal",className:"pt-4 space-y-4",children:e.jsxs(I,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"Data Processing Agreements (DPAs)"}),e.jsx(Me,{children:"Manage and generate DPAs for this vendor."})]}),e.jsxs(n,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>Pe(!0),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Generate DPA"]})]}),e.jsx(M,{children:!is||is.length===0?e.jsxs("div",{className:"text-center py-12 border border-dashed rounded-lg bg-slate-50",children:[e.jsx(Te,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-900",children:"No DPAs Found"}),e.jsx("p",{className:"text-slate-500 max-w-sm mx-auto mt-2",children:"No Data Processing Agreements have been generated or uploaded for this vendor."}),e.jsx(n,{variant:"outline",className:"mt-4",onClick:()=>Pe(!0),children:"Select Template"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:is.map(s=>e.jsx(I,{className:"overflow-hidden border-l-4 border-l-blue-500",children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(w,{variant:"secondary",className:s.status==="Signed"?"bg-green-100 text-green-700":s.status==="Review"?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-700",children:s.status}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>O(`/clients/${o}/vendors/dpa-editor/${s.id}`),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",className:"text-rose-500",onClick:()=>{Le({type:"dpa",id:s.id,name:s.name})},children:e.jsx(ds,{className:"h-4 w-4"})})]})]}),e.jsx("h4",{className:"font-bold text-slate-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Generated: ",pe(new Date(s.createdAt),"MMM d, yyyy")]}),s.signedAt&&e.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center",children:[e.jsx(cs,{className:"h-3 w-3 mr-1"})," Signed: ",pe(new Date(s.signedAt),"MMM d, yyyy")]}),e.jsx(n,{variant:"outline",className:"w-full mt-4 text-xs h-8",onClick:()=>O(`/clients/${o}/vendors/dpa-editor/${s.id}`),children:"View content"})]})},s.id))})})]})}),e.jsx(he,{value:"overview",className:"space-y-4 pt-4",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(Y,{children:e.jsx(Z,{children:"Service Description"})}),e.jsx(M,{children:t.serviceDescription?e.jsx("div",{className:"whitespace-pre-wrap text-sm text-slate-700",children:t.serviceDescription}):e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"No service description provided."})})]}),e.jsxs(I,{children:[e.jsx(Y,{children:e.jsx(Z,{children:"Additional Notes"})}),e.jsx(M,{children:t.additionalNotes?e.jsx("div",{className:"whitespace-pre-wrap text-sm text-slate-700",children:t.additionalNotes}):e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"No additional notes."})})]})]})}),e.jsxs(he,{value:"documents",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Additional Documents"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Compliance certificates, reports, and other files."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{we(s=>({...s,subject:`Request for Information - ${t==null?void 0:t.name}`})),Ie(!0)},children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"})," Request Information"]}),e.jsxs(n,{size:"sm",onClick:()=>He(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Add Documents"]})]})]}),e.jsx(I,{children:e.jsx(M,{className:"pt-6",children:((gs=t.additionalDocuments)==null?void 0:gs.length)>0?e.jsx("div",{className:"space-y-2",children:t.additionalDocuments.map((s,S)=>e.jsxs("div",{className:"flex justify-between items-center p-3 hover:bg-slate-50 rounded border border-transparent hover:border-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.date||"No date"})]})]}),e.jsx(n,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:e.jsx(ae,{className:"h-4 w-4"})})})]},S))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No additional documents."})})})]}),e.jsx(he,{value:"trust-center",className:"space-y-4 pt-4",children:e.jsx(Aa,{vendor:t,onRefresh:()=>y.vendors.get.invalidate({id:m})})}),e.jsxs(he,{value:"assessments",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Assessment History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track security questionnaires, SOC2 reviews, and other due diligence."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>ce(!0),children:[e.jsx(Re,{className:"mr-2 h-4 w-4 text-indigo-500"})," Request Evidence"]}),e.jsxs(n,{size:"sm",onClick:()=>te(!0),children:[e.jsx(ws,{className:"mr-2 h-4 w-4"})," Schedule Manual"]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[U==null?void 0:U.map(s=>e.jsx(I,{children:e.jsxs("div",{className:"flex items-center p-4 gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 shrink-0",children:e.jsx(Te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2 flex-wrap",children:[s.type,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",className:s.inherentRiskLevel==="Critical"?"text-rose-600 border-rose-200 bg-rose-50":s.inherentRiskLevel==="High"?"text-orange-600 border-orange-200 bg-orange-50":s.inherentRiskLevel==="Medium"?"text-amber-600 border-amber-200 bg-amber-50":s.inherentRiskLevel==="Low"?"text-emerald-600 border-emerald-200 bg-emerald-50":"text-slate-500 border-slate-200 bg-slate-50",children:["Inherent: ",s.inherentRiskLevel||"Not Rated"]}),e.jsxs(w,{variant:"outline",className:s.residualRiskLevel==="Critical"?"text-rose-600 border-rose-200 bg-rose-50":s.residualRiskLevel==="High"?"text-orange-600 border-orange-200 bg-orange-50":s.residualRiskLevel==="Medium"?"text-amber-600 border-amber-200 bg-amber-50":s.residualRiskLevel==="Low"?"text-emerald-600 border-emerald-200 bg-emerald-50":"text-slate-500 border-slate-200 bg-slate-50",children:["Residual: ",s.residualRiskLevel||"Not Rated"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Status: ",e.jsx("strong",{className:"text-slate-700",children:s.status})]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Due: ",s.dueDate?pe(new Date(s.dueDate),"MMM d, yyyy"):"No date"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.score&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.score,"%"]}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:"Score"})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Is(s),children:s.status==="Completed"?"View/Edit":"Start Review"})]})]})},s.id)),(U==null?void 0:U.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground bg-slate-50 rounded-lg border border-dashed gap-2",children:[e.jsx("p",{children:"No assessments recorded for this vendor."}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>te(!0),children:[e.jsx(ws,{className:"mr-2 h-4 w-4"})," Schedule First Assessment"]})]})]})]}),e.jsxs(he,{value:"risk-scan",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Automated Risk Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Continuous monitoring of vulnerabilities (CVEs) and data breaches."})]}),e.jsxs(n,{size:"sm",onClick:()=>q.mutate({vendorId:m,clientId:o}),disabled:q.isPending,children:[q.isPending?e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Run Risk Scan"]})]}),h!=null&&h.scan?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{className:"border-l-4 border-l-blue-500",children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-sm text-muted-foreground font-medium mb-1",children:"Automated Risk Score"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:`text-3xl font-bold ${h.scan.riskScore>80?"text-rose-600":h.scan.riskScore>50?"text-amber-600":"text-emerald-600"}`,children:[h.scan.riskScore,"/100"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R.length>0?`Based on ${R.length} detected vulnerabilities`:"No vulnerabilities detected"})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(vs,{className:"h-3 w-3"}),"Last scanned: ",h.scan.scanDate?pe(new Date(h.scan.scanDate),"PPp"):"Never"]})]})}),e.jsx(I,{children:e.jsxs(M,{className:"pt-6 flex flex-col items-center justify-center text-center p-6",children:[e.jsx(ka,{className:"h-8 w-8 text-rose-500 mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:h.scan.breachCount||0}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Data Breaches"})]})}),e.jsx(I,{children:e.jsxs(M,{className:"pt-6 flex flex-col items-center justify-center text-center p-6",children:[e.jsx(Ce,{className:"h-8 w-8 text-amber-500 mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:h.scan.vulnerabilityCount||0}),e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Vulnerabilities"})]})})]}),R.length>0?e.jsxs(I,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(Z,{className:"text-md flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-amber-500"})," Recent Vulnerabilities (CVEs)"]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-2",children:R.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50 rounded border border-transparent hover:border-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:"outline",children:s.cveId}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 line-clamp-1",children:s.description}),e.jsxs("div",{className:"text-xs text-slate-500 flex gap-2",children:[e.jsxs("span",{children:["CVSS: ",s.cvssScore]}),e.jsx("span",{className:"text-slate-400",children:"|"}),e.jsx("span",{className:"truncate max-w-[300px]",children:s.matchReason})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>C(s),children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Mitigate"]}),e.jsx("a",{href:`https://nvd.nist.gov/vuln/detail/${s.cveId}`,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline p-1",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},s.cveId))})})]}):e.jsx(I,{className:"bg-emerald-50/50 border-emerald-200",children:e.jsxs(M,{className:"pt-6 text-center",children:[e.jsx(cs,{className:"h-10 w-10 text-emerald-500 mx-auto mb-3"}),e.jsx("h4",{className:"font-semibold text-emerald-800",children:"No Known Vulnerabilities Found"}),e.jsx("p",{className:"text-sm text-emerald-600 mt-1",children:"The NVD database scan did not find any CVEs directly matching this vendor."})]})}),e.jsxs(I,{children:[e.jsxs(Y,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Z,{className:"text-md flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-amber-600"})," Vendor CVE Suggestions"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"text-xs h-7",onClick:()=>Ke.mutate({clientId:o,vendorId:m}),disabled:Ke.isPending,children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),Ke.isPending?"Scanning...":"Scan Vendor"]})]}),e.jsx(Me,{children:"Direct suggestions from NVD keyed to this vendor name."})]}),e.jsx(M,{children:je&&je.length>0?e.jsx("div",{className:"space-y-2",children:je.map((s,S)=>e.jsxs("div",{className:"flex items-start justify-between p-2 rounded border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:"outline",children:s.cveId}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium line-clamp-1",children:s.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["CVSS: ",s.cvssScore||"N/A"," • ",s.matchReason||"Keyword match"]})]})]}),e.jsx("a",{href:`https://nvd.nist.gov/vuln/detail/${s.cveId}`,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline p-1",children:e.jsx(ae,{className:"h-4 w-4"})})]},S))}):e.jsx("div",{className:"text-sm text-muted-foreground text-center py-2",children:"No vendor suggestions yet. Run Scan Vendor to fetch CVEs."})})]}),(h==null?void 0:h.scans)&&h.scans.length>0&&e.jsxs(I,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(Z,{className:"text-md flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-slate-500"})," Scan History"]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-3",children:h.scans.map((s,S)=>{const H=u===s.id,K=H?J||[]:[];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-colors ${S===0?"bg-indigo-50/50 border-indigo-200 hover:bg-indigo-100/50":"bg-slate-50 border-slate-200 hover:bg-slate-100"}`,onClick:()=>p(H?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center text-xs font-bold ${s.riskScore>80?"bg-rose-100 text-rose-600":s.riskScore>50?"bg-amber-100 text-amber-600":"bg-emerald-100 text-emerald-600"}`,children:s.riskScore}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.scanDate?pe(new Date(s.scanDate),"PPP"):"Unknown Date"}),S===0&&e.jsx(w,{className:"bg-indigo-500 text-white text-[10px]",children:"Latest"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.scanDate?pe(new Date(s.scanDate),"p"):""," •",s.vulnerabilityCount||0," CVEs •",s.breachCount||0," Breaches"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:s.status}),e.jsx(la,{className:`h-4 w-4 text-slate-400 transition-transform ${H?"rotate-180":""}`})]})]}),H&&e.jsx("div",{className:"ml-14 p-3 rounded-lg bg-white border border-slate-200 space-y-2",children:de?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(_,{className:"h-5 w-5 animate-spin text-slate-400"})}):K.length>0?K.map(N=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50 rounded border border-transparent hover:border-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:"outline",children:N.cveId}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 line-clamp-1",children:N.description}),e.jsx("div",{className:"text-xs text-slate-500 flex gap-2",children:e.jsxs("span",{children:["CVSS: ",N.cvssScore]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:P=>{P.stopPropagation(),C(N)},children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Mitigate"]}),e.jsx("a",{href:`https://nvd.nist.gov/vuln/detail/${N.cveId}`,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline p-1",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},N.id)):e.jsxs("div",{className:"text-sm text-muted-foreground text-center py-2",children:[e.jsx(cs,{className:"h-5 w-5 text-emerald-500 mx-auto mb-1"}),"No vulnerabilities found in this scan"]})})]},s.id)})})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(Ia,{clientId:o,vendorId:m,vendorName:t.name,hasScanData:!0})})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground bg-slate-50 rounded-lg border border-dashed gap-2",children:[e.jsx(Ce,{className:"h-12 w-12 text-slate-300 mb-2"}),e.jsx("h3",{className:"font-semibold text-lg text-slate-700",children:"No Scan Data Available"}),e.jsx("p",{className:"max-w-md text-center",children:"Run a risk scan to check for known vulnerabilities (CVEs) and data breaches associated with this vendor."}),e.jsxs(n,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>q.mutate({vendorId:m,clientId:o}),disabled:q.isPending,children:[q.isPending?e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Run First Scan"]})]})]}),e.jsxs(he,{value:"contacts",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Vendor Contacts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Key personnel for security, legal, and billing inquiries."})]}),e.jsxs(n,{size:"sm",onClick:()=>ps(),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Add Contact"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ie==null?void 0:ie.map(s=>e.jsx(I,{className:"relative group",children:e.jsxs(M,{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500",children:e.jsx(ks,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[s.name,s.isPrimary&&e.jsx(w,{variant:"secondary",className:"text-[10px] h-4",children:"Primary"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.role||"No Role"})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ps(s),children:e.jsx(_e,{className:"h-4 w-4 text-slate-500"})}),e.jsx(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",onClick:()=>{Le({type:"contact",id:s.id,name:s.name})},children:e.jsx(ds,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Qe,{className:"h-3.5 w-3.5"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:underline",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Da,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:s.phone})]})]})]})},s.id)),(ie==null?void 0:ie.length)===0&&e.jsx("div",{className:"col-span-full py-12 text-center text-muted-foreground bg-slate-50 border border-dashed rounded-lg",children:"No contacts added yet."})]})]}),e.jsxs(he,{value:"contracts",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Vendor Contracts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage legal agreements, SLAs, and renewal terms."})]}),e.jsxs(n,{size:"sm",onClick:()=>me(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Add Contract"]})]}),e.jsxs("div",{className:"grid gap-4",children:[fe==null?void 0:fe.map(s=>e.jsx(I,{className:"relative group hover:border-blue-200 transition-colors",children:e.jsx(M,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600 shrink-0",children:e.jsx(ys,{className:"h-5 w-5"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h4",{className:"font-semibold text-base flex items-center gap-2",children:[s.title,e.jsx(w,{variant:"outline",className:s.status==="Active"?"bg-emerald-50 text-emerald-700":"bg-slate-50 text-slate-500",children:s.status}),s.autoRenew&&e.jsx(w,{variant:"secondary",className:"text-[10px]",children:"Auto-Renews"})]}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 pt-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-[10px] uppercase text-muted-foreground font-medium",children:"Term"}),e.jsxs("div",{className:"text-sm font-medium",children:[s.startDate?pe(new Date(s.startDate),"MMM yyyy"):"N/A"," - ",s.endDate?pe(new Date(s.endDate),"MMM yyyy"):"Indefinite"]}),s.noticePeriod&&e.jsxs("div",{className:"text-xs text-rose-600",children:["Notice: ",s.noticePeriod]})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-[10px] uppercase text-muted-foreground font-medium",children:"Financials"}),e.jsx("div",{className:"text-sm font-medium",children:s.value||"N/A"}),s.paymentTerms&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.paymentTerms})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-[10px] uppercase text-muted-foreground font-medium",children:"Compliance"}),e.jsxs("div",{className:"text-sm font-medium",children:["DPA: ",s.dpaStatus]}),s.owner&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Owner: ",s.owner]})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-[10px] uppercase text-muted-foreground font-medium",children:"SLA Support"}),e.jsx("div",{className:"text-sm font-medium truncate max-w-[150px]",title:s.slaDetails,children:s.slaDetails||"Standard"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.documentUrl&&e.jsx(n,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noreferrer",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{xs(s),B({title:s.title,description:s.description||"",startDate:s.startDate?new Date(s.startDate).toISOString().split("T")[0]:"",endDate:s.endDate?new Date(s.endDate).toISOString().split("T")[0]:"",autoRenew:s.autoRenew||!1,value:s.value||"",status:s.status||"Active",documentUrl:s.documentUrl||"",noticePeriod:s.noticePeriod||"",paymentTerms:s.paymentTerms||"",slaDetails:s.slaDetails||"",dpaStatus:s.dpaStatus||"Not Signed",owner:s.owner||""}),me(!0)},children:e.jsx(_e,{className:"h-4 w-4 text-slate-500"})}),e.jsx(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",onClick:()=>{Le({type:"contract",id:s.id,name:s.title})},children:e.jsx(ds,{className:"h-4 w-4"})})]})]})})},s.id)),(fe==null?void 0:fe.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground bg-slate-50 rounded-lg border border-dashed gap-2",children:[e.jsx(ys,{className:"h-12 w-12 text-slate-300 mb-2"}),e.jsx("h3",{className:"font-semibold text-lg text-slate-700",children:"No Contracts on File"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>me(!0),children:"Add Contract Details"})]})]})]})]}),e.jsx(le,{open:X,onOpenChange:te,title:"Schedule Assessment",description:"Schedule a new security assessment.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsxs(n,{onClick:Os,disabled:ke.isPending,children:[ke.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Schedule"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Assessment Type"}),e.jsxs(T,{value:G.type,onValueChange:s=>Se({...G,type:s}),children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select type..."})}),e.jsxs(F,{children:[e.jsx(a,{value:"Security Questionnaire (SIG Lite)",children:"Security Questionnaire (SIG Lite)"}),e.jsx(a,{value:"SOC 2 Review",children:"SOC 2 Review"}),e.jsx(a,{value:"ISO 27001 Certificate Review",children:"ISO 27001 Certificate Review"}),e.jsx(a,{value:"Penetration Test Review",children:"Penetration Test Review"}),e.jsx(a,{value:"Privacy Impact Assessment",children:"Privacy Impact Assessment"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Due Date"}),e.jsx(b,{type:"date",value:G.dueDate,onChange:s=>Se({...G,dueDate:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Initial Status"}),e.jsxs(T,{value:G.status,onValueChange:s=>Se({...G,status:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Planned",children:"Planned"}),e.jsx(a,{value:"Sent",children:"Sent to Vendor"}),e.jsx(a,{value:"In Progress",children:"In Progress"})]})]})]})]})}),e.jsx(ma,{open:!!z,onOpenChange:s=>!s&&Le(null),children:e.jsxs(xa,{children:[e.jsxs(ua,{children:[e.jsx(ha,{children:"Are you sure?"}),e.jsxs(pa,{children:["This action cannot be undone. This will permanently delete the",(z==null?void 0:z.type)==="dpa"?" DPA":(z==null?void 0:z.type)==="contract"?" contract":" contact",(z==null?void 0:z.name)&&e.jsxs("span",{className:"font-semibold text-foreground",children:[' "',z.name,'"']}),"."]})]}),e.jsxs(ga,{children:[e.jsx(ja,{children:"Cancel"}),e.jsx(va,{className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",onClick:()=>{z&&(z.type==="dpa"?Es.mutate({id:z.id,clientId:o}):z.type==="contact"?Rs.mutate({id:z.id}):z.type==="contract"&&Ts.mutate({id:z.id}),Le(null))},children:"Delete"})]})]})}),e.jsx(Pa,{isOpen:Ve,onClose:()=>ce(!1),vendorName:(t==null?void 0:t.name)||"Vendor",templates:ge||[],onSend:Ds}),e.jsx(le,{open:Ls,onOpenChange:Ae,title:Ze?"Edit Contact":"Add Contact",description:"Add or edit vendor contact information.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>Ae(!1),children:"Cancel"}),e.jsxs(n,{onClick:Fs,disabled:es.isPending||ss.isPending,children:[(es.isPending||ss.isPending)&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Contact"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Full Name"}),e.jsx(b,{value:W.name,onChange:s=>oe({...W,name:s.target.value}),placeholder:"e.g. Jane Doe"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Email"}),e.jsx(b,{value:W.email,onChange:s=>oe({...W,email:s.target.value}),placeholder:"jane@vendor.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Phone"}),e.jsx(b,{value:W.phone,onChange:s=>oe({...W,phone:s.target.value}),placeholder:"+1 (555) 000-0000"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Role / Title"}),e.jsxs(T,{value:W.role,onValueChange:s=>oe({...W,role:s}),children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select role..."})}),e.jsxs(F,{children:[e.jsx(a,{value:"Account Manager",children:"Account Manager"}),e.jsx(a,{value:"Security Lead",children:"Security Lead (CISO)"}),e.jsx(a,{value:"Technical Support",children:"Technical Support"}),e.jsx(a,{value:"Legal / Compliance",children:"Legal / Compliance"}),e.jsx(a,{value:"Billing",children:"Billing"}),e.jsx(a,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:W.isPrimary,onChange:s=>oe({...W,isPrimary:s.target.checked})}),e.jsx(i,{htmlFor:"isPrimary",children:"Mark as Primary Contact"})]})]})}),e.jsx(le,{open:Us,onOpenChange:ze,title:"Edit Vendor Details",description:"Update vendor profile information.",size:"lg",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>ze(!1),children:"Cancel"}),e.jsxs(n,{onClick:zs,disabled:be.isPending,children:[be.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Vendor Name"}),e.jsx(b,{value:v.name,onChange:s=>Q({...v,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Website"}),e.jsx(b,{value:v.website,onChange:s=>Q({...v,website:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Trust Center URL"}),e.jsx(b,{value:v.trustCenterUrl,onChange:s=>Q({...v,trustCenterUrl:s.target.value}),placeholder:"https://trust.vendor.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Description"}),e.jsx(b,{value:v.description,onChange:s=>Q({...v,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Status"}),e.jsxs(T,{value:v.status,onValueChange:s=>Q({...v,status:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Onboarding",children:"Onboarding"}),e.jsx(a,{value:"Active",children:"Active"}),e.jsx(a,{value:"Offboarding",children:"Offboarding"}),e.jsx(a,{value:"Offboarded",children:"Offboarded"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Review Status"}),e.jsxs(T,{value:v.reviewStatus,onValueChange:s=>Q({...v,reviewStatus:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"needs_review",children:"Needs Review"}),e.jsx(a,{value:"in_progress",children:"In Progress"}),e.jsx(a,{value:"approved",children:"Approved"}),e.jsx(a,{value:"rejected",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Category"}),e.jsxs(T,{value:v.category,onValueChange:s=>Q({...v,category:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"SaaS",children:"SaaS"}),e.jsx(a,{value:"PaaS",children:"PaaS"}),e.jsx(a,{value:"IaaS",children:"IaaS"}),e.jsx(a,{value:"Service",children:"Service Provider"}),e.jsx(a,{value:"Hardware",children:"Hardware"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Source"}),e.jsxs(T,{value:v.source,onValueChange:s=>Q({...v,source:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Manual",children:"Manual Entry"}),e.jsx(a,{value:"SSO",children:"SSO Detection"}),e.jsx(a,{value:"Finance",children:"Finance API"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Criticality"}),e.jsxs(T,{value:v.criticality,onValueChange:s=>Q({...v,criticality:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Low",children:"Low"}),e.jsx(a,{value:"Medium",children:"Medium"}),e.jsx(a,{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Data Access"}),e.jsxs(T,{value:v.dataAccess,onValueChange:s=>Q({...v,dataAccess:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Internal",children:"Internal"}),e.jsx(a,{value:"Confidential",children:"Confidential"}),e.jsx(a,{value:"Restricted",children:"Restricted"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Service Description"}),e.jsx(ye,{value:v.serviceDescription,onChange:s=>Q({...v,serviceDescription:s.target.value}),placeholder:"Describe the service provided...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Additional Notes"}),e.jsx(ye,{value:v.additionalNotes,onChange:s=>Q({...v,additionalNotes:s.target.value}),placeholder:"Internal notes, context, etc.",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"flex items-center space-x-2 border p-3 rounded-md bg-slate-50 mt-4",children:[e.jsx("input",{type:"checkbox",id:"isSubprocessor",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer",checked:!!v.isSubprocessor,onChange:s=>Q({...v,isSubprocessor:s.target.checked})}),e.jsxs("div",{className:"grid gap-0.5",children:[e.jsx(i,{htmlFor:"isSubprocessor",className:"font-medium cursor-pointer",children:"Approved Subprocessor"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mark this vendor as a subprocessor processing personal data (Article 28)."})]})]})]})}),e.jsx(le,{open:As,onOpenChange:Fe,title:"Conduct Security Assessment",description:"Evaluate inherent and residual risks for this vendor.",size:"lg",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>Fe(!1),children:"Cancel"}),e.jsxs(n,{onClick:Ps,disabled:Je.isPending,children:[Je.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Assessment"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-6",children:[e.jsxs("div",{className:"space-y-4 border-r pr-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-500 border-b pb-2",children:"Inherent Risk (Before Controls)"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Impact"}),e.jsxs(T,{value:c.inherentImpact,onValueChange:s=>{const H={Low:1,Medium:2,High:3,Critical:4}[s]||0,K={Low:1,Medium:2,High:3,Critical:4}[c.inherentLikelihood]||0,N=H*K;let P="Low";N>=12?P="Critical":N>=8?P="High":N>=4&&(P="Medium"),ee({...c,inherentImpact:s,inherentRiskLevel:P})},children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select Impact"})}),e.jsxs(F,{children:[e.jsx(a,{value:"Low",children:"Low"}),e.jsx(a,{value:"Medium",children:"Medium"}),e.jsx(a,{value:"High",children:"High"}),e.jsx(a,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Likelihood"}),e.jsxs(T,{value:c.inherentLikelihood,onValueChange:s=>{const S=s,H={Low:1,Medium:2,High:3,Critical:4}[c.inherentImpact]||0,K={Low:1,Medium:2,High:3,Critical:4}[S]||0,N=H*K;let P="Low";N>=12?P="Critical":N>=8?P="High":N>=4&&(P="Medium"),ee({...c,inherentLikelihood:s,inherentRiskLevel:P})},children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select Likelihood"})}),e.jsxs(F,{children:[e.jsx(a,{value:"Low",children:"Low"}),e.jsx(a,{value:"Medium",children:"Medium"}),e.jsx(a,{value:"High",children:"High"}),e.jsx(a,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-md flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Inherent Risk:"}),e.jsx(w,{variant:"outline",className:c.inherentRiskLevel==="Critical"?"text-rose-600 bg-rose-50 border-rose-200":c.inherentRiskLevel==="High"?"text-orange-600 bg-orange-50 border-orange-200":c.inherentRiskLevel==="Medium"?"text-amber-600 bg-amber-50 border-amber-200":"text-emerald-600 bg-emerald-50 border-emerald-200",children:c.inherentRiskLevel||"Not Rated"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-500 border-b pb-2",children:"Residual Risk (After Controls)"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Impact"}),e.jsxs(T,{value:c.residualImpact,onValueChange:s=>{const H={Low:1,Medium:2,High:3,Critical:4}[s]||0,K={Low:1,Medium:2,High:3,Critical:4}[c.residualLikelihood]||0,N=H*K;let P="Low";N>=12?P="Critical":N>=8?P="High":N>=4&&(P="Medium"),ee({...c,residualImpact:s,residualRiskLevel:P})},children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select Impact"})}),e.jsxs(F,{children:[e.jsx(a,{value:"Low",children:"Low"}),e.jsx(a,{value:"Medium",children:"Medium"}),e.jsx(a,{value:"High",children:"High"}),e.jsx(a,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Likelihood"}),e.jsxs(T,{value:c.residualLikelihood,onValueChange:s=>{const S=s,H={Low:1,Medium:2,High:3,Critical:4}[c.residualImpact]||0,K={Low:1,Medium:2,High:3,Critical:4}[S]||0,N=H*K;let P="Low";N>=12?P="Critical":N>=8?P="High":N>=4&&(P="Medium"),ee({...c,residualLikelihood:s,residualRiskLevel:P})},children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select Likelihood"})}),e.jsxs(F,{children:[e.jsx(a,{value:"Low",children:"Low"}),e.jsx(a,{value:"Medium",children:"Medium"}),e.jsx(a,{value:"High",children:"High"}),e.jsx(a,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-md flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Residual Risk:"}),e.jsx(w,{className:c.residualRiskLevel==="Critical"?"bg-rose-600":c.residualRiskLevel==="High"?"bg-orange-500":c.residualRiskLevel==="Medium"?"bg-amber-500":"bg-emerald-500",children:c.residualRiskLevel||"Not Rated"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Current Status"}),e.jsxs(T,{value:c.status,onValueChange:s=>ee({...c,status:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Planned",children:"Planned"}),e.jsx(a,{value:"Sent",children:"Sent to Vendor"}),e.jsx(a,{value:"In Progress",children:"In Progress"}),e.jsx(a,{value:"Review",children:"In Review"}),e.jsx(a,{value:"Completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Score (0-100)"}),e.jsx(b,{type:"number",min:"0",max:"100",value:c.score,onChange:s=>ee({...c,score:parseInt(s.target.value)||0})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Detailed Findings"}),e.jsx(ye,{className:"min-h-[150px]",placeholder:"Enter detailed observations, missing controls, or risks identified...",value:c.findings,onChange:s=>ee({...c,findings:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Evidence Link (URL)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"https://...",value:c.documentUrl,onChange:s=>ee({...c,documentUrl:s.target.value})}),c.documentUrl&&e.jsx(n,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx("a",{href:c.documentUrl,target:"_blank",rel:"noreferrer",children:e.jsx(ae,{className:"h-4 w-4"})})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Link to SharePoint, Google Drive, or stored artifact."})]})]})}),e.jsx(le,{open:Hs,onOpenChange:Ie,title:"Send Email to Vendor",description:"Send a quick email to request documents or follow up.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>Ie(!1),children:"Cancel"}),e.jsxs(n,{onClick:$s,disabled:ls.isPending,children:[ls.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Email"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Recipient (To)"}),e.jsx(b,{value:se.to,onChange:s=>we({...se,to:s.target.value}),placeholder:"vendor@example.com"}),ie&&ie.length>0&&e.jsx("div",{className:"flex gap-2 flex-wrap",children:ie.map(s=>e.jsxs(w,{variant:"outline",className:"cursor-pointer hover:bg-slate-100",onClick:()=>s.email&&we(S=>({...S,to:s.email||""})),children:[s.name," (",s.email,")"]},s.id))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Subject"}),e.jsx(b,{value:se.subject,onChange:s=>we({...se,subject:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Message"}),e.jsx(ye,{value:se.body,onChange:s=>we({...se,body:s.target.value}),className:"min-h-[150px]"})]})]})}),e.jsx(le,{open:qs,onOpenChange:He,title:"Add Document",description:"Link an external document to this vendor.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>He(!1),children:"Cancel"}),e.jsxs(n,{onClick:_s,disabled:be.isPending,children:[be.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Document"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Upload File"}),e.jsx(Ma,{onUploadComplete:s=>{$e(S=>({...S,url:s.url,name:S.name||s.name})),l.success("File uploaded successfully")},folder:"vendor-docs"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or link external URL"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Document Name"}),e.jsx(b,{value:xe.name,onChange:s=>$e({...xe,name:s.target.value}),placeholder:"e.g. SOC 2 Report 2024"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Document URL"}),e.jsx(b,{value:xe.url,onChange:s=>$e({...xe,url:s.target.value}),placeholder:"https://..."})]})]})}),e.jsx(le,{open:Ms,onOpenChange:me,title:Oe?"Edit Contract":"Add Contract",description:"Manage contract terms, SLA, and DPA details.",size:"lg",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),e.jsxs(n,{onClick:()=>{const s={...f,clientId:o,vendorId:m};Oe?rs.mutate({id:Oe.id,...s}):ts.mutate(s)},disabled:ts.isPending||rs.isPending,children:[ts.isPending||rs.isPending?e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):null,Oe?"Update Contract":"Add Contract"]})]}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(i,{children:"Contract Title / Name"}),e.jsx(b,{value:f.title,onChange:s=>B({...f,title:s.target.value}),placeholder:"e.g. Master Services Agreement"})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(i,{children:"Description"}),e.jsx(ye,{value:f.description,onChange:s=>B({...f,description:s.target.value}),placeholder:"Scope of services..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Start Date"}),e.jsx(b,{type:"date",value:f.startDate,onChange:s=>B({...f,startDate:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"End Date"}),e.jsx(b,{type:"date",value:f.endDate,onChange:s=>B({...f,endDate:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Auto-Renewal"}),e.jsxs(T,{value:f.autoRenew?"yes":"no",onValueChange:s=>B({...f,autoRenew:s==="yes"}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"yes",children:"Yes, Auto-Renews"}),e.jsx(a,{value:"no",children:"No, Fixed Term"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Notice Period"}),e.jsx(b,{value:f.noticePeriod,onChange:s=>B({...f,noticePeriod:s.target.value}),placeholder:"e.g. 30 days"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Contract Value"}),e.jsx(b,{value:f.value,onChange:s=>B({...f,value:s.target.value}),placeholder:"e.g. $10,000/yr"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Payment Terms"}),e.jsx(b,{value:f.paymentTerms,onChange:s=>B({...f,paymentTerms:s.target.value}),placeholder:"e.g. Net 30"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Status"}),e.jsxs(T,{value:f.status,onValueChange:s=>B({...f,status:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Active",children:"Active"}),e.jsx(a,{value:"Expired",children:"Expired"}),e.jsx(a,{value:"Draft",children:"Draft"}),e.jsx(a,{value:"Terminated",children:"Terminated"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"DPA Status"}),e.jsxs(T,{value:f.dpaStatus,onValueChange:s=>B({...f,dpaStatus:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"Signed",children:"Signed"}),e.jsx(a,{value:"Not Signed",children:"Not Signed"}),e.jsx(a,{value:"Not Required",children:"Not Required"})]})]})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(i,{children:"SLA Details"}),e.jsx(b,{value:f.slaDetails,onChange:s=>B({...f,slaDetails:s.target.value}),placeholder:"e.g. 99.9% uptime, 4hr response time"})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(i,{children:"Document Link (URL)"}),e.jsx(b,{value:f.documentUrl,onChange:s=>B({...f,documentUrl:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(i,{children:"Internal Owner"}),e.jsx(b,{value:f.owner,onChange:s=>B({...f,owner:s.target.value}),placeholder:"e.g. Legal Team, CTO"})]})]})}),e.jsx(le,{open:Vs,onOpenChange:Pe,title:"Generate DPA from Template",description:"Select a standard template to generate a new DPA for this vendor.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(n,{variant:"outline",onClick:()=>Pe(!1),children:"Cancel"}),e.jsxs(n,{onClick:()=>{if(!ne.templateId||!ne.name)return l.error("Please select a template and provide a name");ns.mutate({clientId:o,vendorId:m,templateId:Number(ne.templateId),name:ne.name})},disabled:ns.isPending,children:[ns.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate DPA"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"DPA Document Name"}),e.jsx(b,{placeholder:"e.g. AWS DPA 2024",value:ne.name,onChange:s=>Ue({...ne,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Standard Template"}),e.jsxs(T,{value:ne.templateId,onValueChange:s=>{if(Ue({...ne,templateId:s}),!ne.name){const S=Ne==null?void 0:Ne.find(H=>String(H.id)===s);S&&t&&Ue(H=>({...H,name:`${t.name} - ${S.name}`}))}},children:[e.jsx(V,{children:e.jsx(E,{placeholder:"Select Template"})}),e.jsx(F,{children:Ne==null?void 0:Ne.map(s=>e.jsxs(a,{value:String(s.id),children:[s.name," (",s.jurisdiction,")"]},s.id))})]})]})]})}),e.jsx(le,{open:!!r,onOpenChange:s=>!s&&C(null),title:`Mitigation: ${r==null?void 0:r.cveId}`,icon:Ce,description:"Review vulnerability details and create a remediation task.",submitText:"Create Remediation Task",onSubmit:()=>{l.success("Remediation task created",{description:`Task for ${r==null?void 0:r.cveId} added to your roadmap.`}),C(null)},children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(w,{variant:"outline",className:"text-sm",children:r.cveId}),e.jsxs(w,{className:`${parseFloat(r.cvssScore||"0")>=9?"bg-rose-500":parseFloat(r.cvssScore||"0")>=7?"bg-amber-500":"bg-emerald-500"} text-white`,children:["CVSS: ",r.cvssScore]})]}),e.jsx("p",{className:"text-sm text-slate-700",children:r.description})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Remediation Priority"}),e.jsxs(T,{value:D.priority,onValueChange:s=>A({...D,priority:s}),children:[e.jsx(V,{children:e.jsx(E,{})}),e.jsxs(F,{children:[e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Assigned To"}),e.jsx(b,{value:D.assignee,onChange:s=>A({...D,assignee:s.target.value}),placeholder:"e.g. Security Team, DevOps"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Due Date"}),e.jsx(b,{type:"date",value:D.dueDate,onChange:s=>A({...D,dueDate:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(i,{children:"Notes"}),e.jsx(ye,{value:D.notes,onChange:s=>A({...D,notes:s.target.value}),placeholder:"Add any notes about the remediation plan...",rows:3})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>window.open(`https://nvd.nist.gov/vuln/detail/${r.cveId}`,"_blank"),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"View on NVD"]}),e.jsxs(n,{className:"flex-1",onClick:()=>$.mutate({clientId:o,vendorId:m,cveId:r.cveId,cveDescription:r.description,cvssScore:r.cvssScore,priority:D.priority,assignee:D.assignee,dueDate:D.dueDate,notes:D.notes}),disabled:$.isPending,children:[$.isPending?e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Create Remediation Task"]})]})]})})]}):e.jsxs("div",{className:"flex h-[50vh] w-full flex-col items-center justify-center gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Vendor not found"}),e.jsx(n,{onClick:()=>O(`/clients/${o}/vendors/all`),children:"Return to Vendor List"})]})}export{vt as default};
