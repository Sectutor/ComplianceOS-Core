import{M as oe,r as c,t as m,i,j as e,L as g,I as T,E as w,G as y,H as C,J as S,K as n,c as x,x as D,l as ce,S as me,N as Y,O as X,P as z,Q as o,V as Z,W as r,C as xe,d as he,e as ue,f as je,m as ge,k as V}from"./index-DOc7Nwb7.js";import{B as pe}from"./Breadcrumb-CRi3LAxS.js";import{E as ee}from"./enhanced-dialog-CeRPsI16.js";import{T as be,a as fe,b as F,c as G}from"./tabs-CBDTXbEn.js";import{M as ve}from"./mail-xRDvl6QK.js";import{P as se}from"./plus-BaQ35Jcx.js";import{T as ae}from"./trash-2-CFEfisbM.js";import{S as Ne}from"./square-pen-ClRv15cM.js";import{A as H,a as q,b as J,c as _,d as Q,e as $,f as K,g as W}from"./alert-dialog-V7xGXdVc.js";import{U as we}from"./user-CqRnJLgW.js";import{f as ye}from"./format-H2tx8_vS.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=oe("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);function Se({user:t}){const[A,R]=c.useState(!1),p=m.useUtils(),[u,M]=c.useState(t.name||""),[j,O]=c.useState(t.email||""),[l,k]=c.useState(t.role||"user"),[U,E]=c.useState(t.maxClients||2),{data:b}=m.clients.list.useQuery(),[d,I]=c.useState(""),[s,h]=c.useState("viewer"),v=m.users.update.useMutation({onSuccess:()=>{i.success("User profile updated"),p.users.list.invalidate()},onError:a=>i.error(a.message)}),f=m.users.updateRole.useMutation({onSuccess:()=>{i.success("Global role updated"),p.users.list.invalidate()},onError:a=>i.error(a.message)}),P=m.users.assignOrganization.useMutation({onSuccess:()=>{i.success("Organization access updated"),p.users.list.invalidate(),I("")},onError:a=>i.error(a.message)}),B=m.users.removeFromOrganization.useMutation({onSuccess:()=>{i.success("Removed from organization"),p.users.list.invalidate()},onError:a=>i.error(a.message)}),L=m.users.resetPassword.useMutation({onSuccess:a=>{i.success(a.message||"Password reset email sent")},onError:a=>i.error(a.message)}),te=()=>{L.mutate({userId:t.id})},ne=a=>{a.preventDefault(),v.mutate({id:t.id,name:u,email:j,maxClients:U})},ie=()=>{f.mutate({id:t.id,role:l})},re=()=>{d&&P.mutate({userId:t.id,clientId:parseInt(d),role:s})},le=(a,N)=>{P.mutate({userId:t.id,clientId:a,role:N})};return e.jsx(ee,{open:A,onOpenChange:R,trigger:e.jsx(x,{variant:"outline",size:"icon",className:"h-8 w-8 text-amber-600 bg-amber-50 border-amber-200 hover:text-amber-700 hover:bg-amber-100",title:"Edit User",children:e.jsx(Ne,{className:"h-4 w-4"})}),title:`Manage User: ${t.name}`,description:"Update profile, permissions, and organization access.",size:"lg",children:e.jsxs(be,{defaultValue:"account",className:"w-full",children:[e.jsx("div",{className:"px-6 border-b bg-slate-50/50",children:e.jsxs(fe,{className:"bg-transparent p-0 h-12 w-full justify-start gap-6",children:[e.jsx(F,{value:"account",className:"h-full rounded-none border-b-2 border-transparent data-[state=active]:bg-transparent data-[state=active]:border-[#1C4D8D] data-[state=active]:text-[#1C4D8D] data-[state=active]:shadow-none px-0 pb-0",children:"Account Details"}),e.jsx(F,{value:"permissions",className:"h-full rounded-none border-b-2 border-transparent data-[state=active]:bg-transparent data-[state=active]:border-[#1C4D8D] data-[state=active]:text-[#1C4D8D] data-[state=active]:shadow-none px-0 pb-0",children:"Global Permissions"}),e.jsx(F,{value:"organizations",className:"h-full rounded-none border-b-2 border-transparent data-[state=active]:bg-transparent data-[state=active]:border-[#1C4D8D] data-[state=active]:text-[#1C4D8D] data-[state=active]:shadow-none px-0 pb-0",children:"Organization Access"})]})}),e.jsxs("div",{className:"p-6 min-h-[400px]",children:[e.jsxs(G,{value:"account",className:"mt-0 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Personal Information"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Update the user's basic profile information."}),e.jsxs("form",{onSubmit:ne,className:"space-y-4 max-w-md",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Full Name"}),e.jsx(T,{value:u,onChange:a=>M(a.target.value),placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Email"}),e.jsx(T,{value:j,onChange:a=>O(a.target.value),placeholder:"john@example.com",type:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Organization Limit (Admin Tier)"}),e.jsxs(w,{value:U.toString(),onValueChange:a=>E(parseInt(a)),children:[e.jsx(y,{className:"w-full bg-white",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"2",children:"2 Organizations (Default)"}),e.jsx(n,{value:"10",children:"10 Organizations"}),e.jsx(n,{value:"999999",children:"Unlimited Organizations"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Limits how many organizations this user can create/manage as an owner."})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(x,{type:"submit",disabled:v.isPending,children:[v.isPending?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Save Profile"]})})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Password Reset"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Send a password reset email to this user."}),e.jsxs(x,{onClick:te,disabled:L.isPending,variant:"outline",children:[L.isPending?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Send Password Reset Email"]})]})]}),e.jsx(G,{value:"permissions",className:"mt-0 space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Global Role"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Controls the user's access level across the entire ComplianceOS platform."}),e.jsxs("div",{className:"border rounded-lg p-4 bg-slate-50 max-w-2xl space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Current Role"}),e.jsxs(w,{value:l,onValueChange:k,children:[e.jsx(y,{className:"w-[300px] bg-white",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"user",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-medium",children:"User"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Standard access, limited by org membership"})]})}),e.jsx(n,{value:"editor",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-medium",children:"Global Editor"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Can edit most global settings (Caution)"})]})}),e.jsx(n,{value:"admin",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-medium",children:"Global Admin"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Full system access (Danger)"})]})}),e.jsx(n,{value:"super_admin",children:e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-medium",children:"Super Admin"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Highest clearance, bypasses all limits"})]})})]})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(x,{onClick:ie,disabled:f.isPending||l===t.role,variant:l===t.role?"outline":"default",children:f.isPending?"Saving...":"Update Global Role"})})]})]})}),e.jsx(G,{value:"organizations",className:"mt-0 space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Organization Membership"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Manage which client organizations this user can access and their role within them."}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-3 mb-4 text-sm text-amber-800 flex gap-2 items-start",children:[e.jsx(me,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Note on Organization Roles:"}),' An "Admin" here has full control over ',e.jsx("strong",{children:"only this specific organization"}),". They cannot access other organizations or change global system settings."]})]}),e.jsxs("div",{className:"flex gap-2 items-end mb-6 p-4 bg-blue-50/50 border border-blue-100 rounded-lg",children:[e.jsxs("div",{className:"grid gap-2 flex-1",children:[e.jsx(g,{children:"Add to Organization"}),e.jsxs(w,{value:d,onValueChange:I,children:[e.jsx(y,{className:"bg-white",children:e.jsx(C,{placeholder:"Select Organization..."})}),e.jsx(S,{children:b==null?void 0:b.filter(a=>{var N;return!((N=t.memberships)!=null&&N.some(de=>de.clientId===a.id))}).map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"grid gap-2 w-[150px]",children:[e.jsx(g,{children:"Role"}),e.jsxs(w,{value:s,onValueChange:h,children:[e.jsx(y,{className:"bg-white",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"owner",children:"Owner"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"editor",children:"Editor"}),e.jsx(n,{value:"viewer",children:"Viewer"})]})]})]}),e.jsxs(x,{onClick:re,disabled:!d||P.isPending,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Add Access"]})]}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(Y,{children:[e.jsx(X,{children:e.jsxs(z,{className:"bg-slate-50",children:[e.jsx(o,{children:"Organization"}),e.jsx(o,{children:"Role"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(Z,{children:!t.memberships||t.memberships.length===0?e.jsx(z,{children:e.jsx(r,{colSpan:3,className:"text-center py-8 text-muted-foreground italic",children:"No organization memberships yet."})}):t.memberships.map(a=>e.jsxs(z,{children:[e.jsx(r,{className:"font-medium text-sm",children:a.clientName}),e.jsx(r,{children:e.jsxs(w,{value:a.role,onValueChange:N=>le(a.clientId,N),children:[e.jsx(y,{className:"h-8 w-[130px]",children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"owner",children:"Owner"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"editor",children:"Editor"}),e.jsx(n,{value:"viewer",children:"Viewer"})]})]})}),e.jsx(r,{className:"text-right",children:e.jsxs(x,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>B.mutate({userId:t.id,clientId:a.clientId}),disabled:B.isPending,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Remove"]})})]},a.clientId))})]})})]})})]})]})})}function Fe(){const[t,A]=c.useState(!1),[R,p]=c.useState("user"),[u,M]=c.useState(null),[j,O]=c.useState(null),{data:l,isLoading:k,refetch:U}=m.users.list.useQuery(),E=m.users.create.useMutation({onSuccess:()=>{i.success("User created successfully"),A(!1),p("user"),U()},onError:s=>{i.error(s.message||"Failed to create user")}}),b=m.users.delete.useMutation({onSuccess:()=>{console.log("[USER MANAGEMENT] Delete success"),i.success("User deleted"),O(null),U()},onError:s=>{console.error("[USER MANAGEMENT] Delete error:",s),i.error(s.message||"Failed to delete user")}}),d=m.users.impersonate.useMutation({onSuccess:s=>{i.success("Redirecting to user session..."),s.url&&(window.location.href=s.url)},onError:s=>{i.error("Impersonation failed: "+s.message),M(null)}}),I=s=>{s.preventDefault();const h=new FormData(s.currentTarget);E.mutate({name:h.get("name"),email:h.get("email"),role:R})};return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto animate-in fade-in duration-500",children:[e.jsx(pe,{items:[{label:"Admin"},{label:"User Management"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage user access and permissions across the platform."})]}),e.jsx(ee,{open:t,onOpenChange:A,trigger:e.jsxs(x,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Add User"]}),title:"Add New User",description:"Create a new user account. They will be able to log in with the provided email.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(x,{onClick:s=>{const h=document.getElementById("add-user-form");h&&h.requestSubmit()},disabled:E.isPending,children:E.isPending?"Creating...":"Create User"})]}),children:e.jsx("form",{id:"add-user-form",onSubmit:I,children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"name",children:"Full Name *"}),e.jsx(T,{id:"name",name:"name",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"email",children:"Email *"}),e.jsx(T,{id:"email",name:"email",type:"email",placeholder:"john@company.com",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Role"}),e.jsxs(w,{value:R,onValueChange:p,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"user",children:"User"}),e.jsx(n,{value:"editor",children:"Editor"}),e.jsx(n,{value:"admin",children:"Admin"})]})]})]})]})})})]}),e.jsxs(xe,{className:"shadow-sm border-muted/40",children:[e.jsxs(he,{children:[e.jsxs(ue,{className:"text-lg flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-primary"}),"Registered Users"]}),e.jsxs(je,{children:[(l==null?void 0:l.length)||0," users registered in the system."]})]}),e.jsx(ge,{children:k?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(Y,{children:[e.jsx(X,{children:e.jsxs(z,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(o,{className:"text-white font-semibold py-4",children:"User"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Email"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Role"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Organizations"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Limit"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Joined"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Actions"})]})}),e.jsx(Z,{children:l==null?void 0:l.map(s=>{var h,v;return e.jsxs(z,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(r,{className:"font-medium py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-black",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[#1C4D8D]/10 flex items-center justify-center text-[#1C4D8D] font-bold text-xs uppercase",children:s.name?s.name.substring(0,2):"U"}),s.name||"Unknown"]})}),e.jsx(r,{className:"text-gray-600 py-4",children:s.email}),e.jsx(r,{className:"py-4",children:e.jsx(V,{variant:s.role==="admin"||s.role==="owner"||s.role==="super_admin"?"default":"secondary",className:s.role==="admin"?"bg-purple-500 hover:bg-purple-600":s.role==="super_admin"?"bg-red-600 hover:bg-red-700 font-bold animate-pulse":"",children:s.role==="admin"?"Global Admin":s.role==="super_admin"?"Super Admin":s.role==="user"?"Org Admin":s.role})}),e.jsx(r,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(h=s.memberships)==null?void 0:h.map((f,P)=>e.jsxs(V,{variant:"outline",className:"text-xs",children:[f.clientName," (",f.role,")"]},`${f.clientId}-${P}`)),(!s.memberships||s.memberships.length===0)&&e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"No memberships"})]})}),e.jsx(r,{className:"py-4 font-mono text-sm",children:s.maxClients>=9999?"Unlimited":s.maxClients}),e.jsx(r,{className:"py-4",children:e.jsx(V,{variant:"outline",className:"text-green-600 border-green-200 bg-green-50",children:"Active"})}),e.jsx(r,{className:"text-gray-500 text-sm py-4",children:s.createdAt?ye(new Date(s.createdAt),"MMM d, yyyy"):"-"}),e.jsx(r,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{user:s}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors duration-200",title:"Login as User",disabled:s.role==="owner"||d.isPending,onClick:()=>M(s),children:d.isPending&&((v=d.variables)==null?void 0:v.userId)===s.id?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50 transition-colors duration-200",disabled:s.role==="owner",onClick:()=>O(s),children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]}),e.jsx(H,{open:!!j,onOpenChange:s=>!s&&O(null),children:e.jsxs(q,{children:[e.jsxs(J,{children:[e.jsx(_,{children:"Are you absolutely sure?"}),e.jsxs(Q,{children:["This action cannot be undone. This will permanently delete ",e.jsx("b",{children:j==null?void 0:j.name}),"'s account and remove their data from our servers."]})]}),e.jsxs($,{children:[e.jsx(K,{children:"Cancel"}),e.jsx(W,{className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",disabled:b.isPending,onClick:s=>{s.preventDefault(),j&&b.mutate({id:j.id})},children:b.isPending?e.jsx(D,{className:"h-4 w-4 animate-spin mr-2"}):"Delete Account"})]})]})}),e.jsx(H,{open:!!u,onOpenChange:s=>!s&&M(null),children:e.jsxs(q,{children:[e.jsxs(J,{children:[e.jsx(_,{children:"Confirm Impersonation"}),e.jsxs(Q,{children:["Are you sure you want to login as ",e.jsx("b",{children:u==null?void 0:u.name}),"?",e.jsx("br",{}),e.jsx("br",{}),"You will be signed out of your current account and redirected to a new session as this user."]})]}),e.jsxs($,{children:[e.jsx(K,{children:"Cancel"}),e.jsx(W,{onClick:s=>{s.preventDefault(),u&&d.mutate({userId:u.id})},disabled:d.isPending,children:d.isPending?e.jsx(D,{className:"h-4 w-4 animate-spin mr-2"}):"Login as User"})]})]})})]})}export{Fe as default};
