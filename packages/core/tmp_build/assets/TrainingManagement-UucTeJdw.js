import{r as C,t as x,i as p,j as e,L as d,c as r,l as G,ab as q,ac as W,C as Y,d as J,e as K,f as _,m as X,N as Z,O as ee,P as S,Q as b,V as se,W as u,x as te,F as ie,k as U,U as P,I as w,E as ae,G as ne,H as re,J as le,K as F}from"./index-DOc7Nwb7.js";import{a as oe,b as ce,c as de,d as me,e as pe,f as xe,D as ue}from"./DashboardLayout-aHnUqq57.js";import{E as R}from"./enhanced-dialog-CeRPsI16.js";import{c as z}from"./utils-BC5CVi_C.js";import{P as he}from"./PageGuide-CPKKXXS6.js";import{T as H}from"./textarea-BtxBxzdY.js";import{S as ge}from"./switch-B74-5eCi.js";import{A as je,a as fe,b as ye,c as ve,d as Ne,e as be,f as Ce,g as Te}from"./alert-dialog-V7xGXdVc.js";import{P as L}from"./plus-BaQ35Jcx.js";import{V as O}from"./video-D4zuDHk0.js";import{C as Se}from"./circle-check-C5kiwRoG.js";import{S as we}from"./square-pen-ClRv15cM.js";import{T as Ae}from"./trash-2-CFEfisbM.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function De({moduleId:m,clientId:h,open:T,onOpenChange:f}){const[a,g]=C.useState([]),l=x.useUtils(),{data:o}=x.employees.list.useQuery({clientId:h},{enabled:T&&h>0}),j=x.training.assign.useMutation({onSuccess:i=>{p.success(`Training assigned to ${i.count} employees`),f(!1),g([]),l.training.getAssignments.invalidate({moduleId:m}),l.training.getStats.invalidate({clientId:h})},onError:i=>p.error(i.message)}),s=()=>{a.length!==0&&j.mutate({clientId:h,moduleId:m,employeeIds:a})},y=i=>{g(c=>c.includes(i)?c.filter(A=>A!==i):[...c,i])},v=()=>{o&&(a.length===o.length?g([]):g(o.map(i=>i.id)))};return e.jsx(R,{open:T,onOpenChange:f,title:"Assign Training Module",description:"Select employees who must complete this training module.",trigger:null,footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(r,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(r,{onClick:s,disabled:a.length===0||j.isLoading,children:j.isLoading?"Assigning...":`Assign to ${a.length} Employees`})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{children:"Select Employees"}),e.jsx(r,{variant:"ghost",size:"sm",onClick:v,children:o&&a.length===o.length?"Deselect All":"Select All"})]}),e.jsxs(oe,{className:"border rounded-md max-h-[300px]",children:[e.jsx(ce,{placeholder:"Search employees..."}),e.jsxs(de,{children:[e.jsx(me,{children:"No employees found."}),e.jsx(pe,{children:o==null?void 0:o.map(i=>e.jsxs(xe,{value:`${i.firstName} ${i.lastName}`,onSelect:()=>y(i.id),className:"cursor-pointer",children:[e.jsx("div",{className:z("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",a.includes(i.id)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(G,{className:z("h-4 w-4")})}),e.jsxs("span",{children:[i.firstName," ",i.lastName]}),e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",i.jobTitle,")"]})]},i.id))})]})]})]})})}function vs({hideLayout:m=!1,clientId:h}){const{clientId:T}=q(),f=W(),a=h||parseInt(T||"0")||f.selectedClientId||0,[g,l]=C.useState(!1),[o,j]=C.useState(!1),[s,y]=C.useState(null),[v,i]=C.useState(null),{data:c,isLoading:A,refetch:D}=x.training.list.useQuery({clientId:a,includeInactive:!0},{enabled:a>0}),{data:M}=x.training.getStats.useQuery({clientId:a},{enabled:a>0}),E=x.training.create.useMutation({onSuccess:()=>{p.success("Training module created"),l(!1),D()},onError:t=>p.error(t.message)}),I=x.training.update.useMutation({onSuccess:()=>{p.success("Training module updated"),l(!1),D()},onError:t=>p.error(t.message)}),B=x.training.delete.useMutation({onSuccess:()=>{p.success("Training module deleted"),l(!1),D()},onError:t=>p.error(t.message)}),Q=t=>{t.preventDefault();const n=new FormData(t.currentTarget),N={clientId:a,title:n.get("title"),description:n.get("description"),type:n.get("type"),videoUrl:n.get("videoUrl"),thumbnailUrl:n.get("thumbnailUrl"),content:n.get("content"),durationMinutes:parseInt(n.get("durationMinutes")||"0"),active:n.get("active")==="on"};s?I.mutate({...N,id:s.id}):E.mutate(N)},k=()=>{y(null),l(!0)},$=t=>{y(t),l(!0)},V=e.jsxs("div",{className:m?"":"p-8 max-w-7xl mx-auto space-y-8",children:[!m&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Training Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create and manage training modules for your employees."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{title:"Training Management",description:"Create, assign, and track employee security training.",rationale:"Ensures staff awareness of security risks and compliance obligations.",howToUse:[{step:"Create Module",description:"Upload videos or write text-based training content."},{step:"Assign Training",description:"Target specific departments or roles."},{step:"Track Progress",description:"Monitor completion rates and audit evidence."}],integrations:[{name:"Personnel Hub",description:"Syncs with employee records."},{name:"Evidence Collection",description:"Auto-generates training logs."}]}),e.jsxs(r,{onClick:k,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Add Module"]})]})]}),e.jsxs(Y,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{children:[e.jsx(K,{children:"Training Modules"}),e.jsx(_,{children:m?"Manage company training content and assign modules.":"Support for video and rich text content."})]}),m&&e.jsxs(r,{onClick:k,size:"sm",className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Add Module"]})]}),e.jsx(X,{children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(S,{children:[e.jsx(b,{children:"Title"}),e.jsx(b,{children:"Type"}),e.jsx(b,{children:"Progress"}),e.jsx(b,{children:"Visibility"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:A?e.jsx(S,{children:e.jsx(u,{colSpan:6,className:"text-center py-8",children:e.jsx(te,{className:"h-6 w-6 animate-spin text-muted-foreground mx-auto"})})}):(c==null?void 0:c.length)===0?e.jsx(S,{children:e.jsx(u,{colSpan:6,className:"text-center py-8 text-muted-foreground border-dashed border-2 rounded-lg mt-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4",children:[e.jsx(O,{className:"h-8 w-8 text-gray-300"}),e.jsx("p",{children:"No training modules found."}),e.jsx(r,{variant:"outline",size:"sm",onClick:k,children:"Create your first module"})]})})}):c==null?void 0:c.map(t=>{var N;const n=((N=M==null?void 0:M.statsByModule)==null?void 0:N[t.id])||{assignments:0,completions:0};return e.jsxs(S,{children:[e.jsx(u,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.type==="video"?e.jsx(O,{className:"h-4 w-4 text-blue-500"}):e.jsx(ie,{className:"h-4 w-4 text-orange-500"}),t.title]})}),e.jsx(u,{children:e.jsx(U,{variant:"outline",className:"capitalize",children:t.type})}),e.jsx(u,{children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:[n.assignments," Assigned"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-3 w-3 text-green-500"}),e.jsxs("span",{children:[n.completions," Completed"]})]})]})}),e.jsx(u,{children:t.active?e.jsx(U,{className:"bg-green-100 text-green-700 hover:bg-green-100 border-none",children:"Active"}):e.jsx(U,{variant:"secondary",children:"Inactive"})}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>{y(t),j(!0)},title:"Assign to Users",children:e.jsx(P,{className:"h-4 w-4 text-primary"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>$(t),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>i(t.id),children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]},t.id)})})]})})]}),s&&e.jsx(De,{open:o,onOpenChange:j,clientId:a,moduleId:s.id}),e.jsx(R,{open:g,onOpenChange:l,title:s?"Edit Module":"Create Module",description:"Configure your training content.",children:e.jsxs("form",{onSubmit:Q,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"title",children:"Module Title"}),e.jsx(w,{id:"title",name:"title",defaultValue:s==null?void 0:s.title,required:!0,placeholder:"e.g. Data Privacy Basics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Short Description"}),e.jsx(H,{id:"description",name:"description",defaultValue:s==null?void 0:s.description,placeholder:"What will employees learn?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"type",children:"Content Type"}),e.jsxs(ae,{name:"type",defaultValue:(s==null?void 0:s.type)||"video",children:[e.jsx(ne,{children:e.jsx(re,{})}),e.jsxs(le,{children:[e.jsx(F,{value:"video",children:"Video"}),e.jsx(F,{value:"text",children:"Rich Text"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"durationMinutes",children:"Duration (minutes)"}),e.jsx(w,{id:"durationMinutes",name:"durationMinutes",type:"number",defaultValue:s==null?void 0:s.durationMinutes})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"videoUrl",children:"Video URL (YouTube/Vimeo link or direct file)"}),e.jsx(w,{id:"videoUrl",name:"videoUrl",defaultValue:s==null?void 0:s.videoUrl,placeholder:"https://youtube.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"thumbnailUrl",children:"Custom Thumbnail URL (Optional)"}),e.jsx(w,{id:"thumbnailUrl",name:"thumbnailUrl",defaultValue:s==null?void 0:s.thumbnailUrl,placeholder:"If empty, YouTube/Vimeo thumbnail will be used if possible"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"content",children:"Text Content (if Type is Rich Text)"}),e.jsx(H,{id:"content",name:"content",className:"min-h-[200px]",defaultValue:s==null?void 0:s.content,placeholder:"Markdown or HTML supported..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{id:"active",name:"active",defaultChecked:s?s.active:!0}),e.jsx(d,{htmlFor:"active",children:"Module is active and visible to employees"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:E.isPending||I.isPending,children:s?"Update Module":"Create Module"})]})]})}),e.jsx(je,{open:!!v,onOpenChange:t=>!t&&i(null),children:e.jsxs(fe,{children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Are you sure?"}),e.jsx(Ne,{children:"This will permanently delete the training module and all completion records."})]}),e.jsxs(be,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(Te,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>v&&B.mutate({clientId:a,id:v}),children:"Delete"})]})]})})]});return m?V:e.jsx(ue,{children:V})}export{vs as default};
