import{ac as A,ab as I,b as M,r as m,t as p,j as e,D as U,ap as R,c as n,o as B,p as O,q as G,s as H,L as l,I as c,w as E,C as F,d as $,e as q,f as z,m as J,k as w,ay as Q,aa as V}from"./index-DOc7Nwb7.js";import{A as K,a as W,b as X,c as Y,d as Z,e as _,f as ee,g as se}from"./alert-dialog-V7xGXdVc.js";import{D as te}from"./DashboardLayout-aHnUqq57.js";import{B as ae}from"./Breadcrumb-CRi3LAxS.js";import{P as re}from"./PageGuide-CPKKXXS6.js";import{T as ie}from"./textarea-BtxBxzdY.js";import{P as oe}from"./plus-BaQ35Jcx.js";import{S as ne}from"./search-CwuIBBPE.js";import{G as le}from"./github-DD1rPXyC.js";import{L as ce}from"./layers-ZuBPQb1T.js";import{C as de}from"./calendar-BlLJlGbj.js";import{T as me}from"./trash-2-CFEfisbM.js";import{f as pe}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";import"./differenceInCalendarDays-nctqlg7V.js";const is=()=>{const{selectedClientId:D}=A(),f=I(),[he,b]=M(),a=f.clientId?parseInt(f.clientId):D,[k,h]=m.useState(!1),[x,L]=m.useState(""),[u,g]=m.useState(null),[t,r]=m.useState({name:"",description:"",repositoryUrl:"",techStackInput:"",owner:""}),N=p.useContext(),{data:j,isLoading:S}=p.devProjects.list.useQuery({clientId:a},{enabled:!!a}),v=p.devProjects.create.useMutation({onSuccess:()=>{N.devProjects.list.invalidate(),h(!1),r({name:"",description:"",repositoryUrl:"",techStackInput:"",owner:""})}}),C=p.devProjects.delete.useMutation({onSuccess:()=>{N.devProjects.list.invalidate(),g(null)}}),T=async()=>{!u||!a||await C.mutateAsync({id:u,clientId:a})},P=async()=>{a&&await v.mutateAsync({clientId:a,name:t.name,description:t.description,repositoryUrl:t.repositoryUrl,techStack:t.techStackInput.split(",").map(s=>s.trim()).filter(Boolean),owner:t.owner})},i=j==null?void 0:j.filter(s=>{var o;return s.name.toLowerCase().includes(x.toLowerCase())||((o=s.description)==null?void 0:o.toLowerCase().includes(x.toLowerCase()))});return e.jsx(te,{children:e.jsxs("div",{className:"space-y-6 page-transition",children:[e.jsx(ae,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Threat Modeling"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Threat Modeling"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Manage security and risks for your software development projects."})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(re,{title:"Threat Modeling",description:"Identify and mitigate security risks in your software design.",rationale:"Shift security left by finding design flaws early in the SDLC.",howToUse:[{step:"Create Project",description:"Define the application scope."},{step:"Model Threats",description:"Use STRIDE or LINDDUN to find issues."},{step:"Treat Risks",description:"Assign mitigations to developers."}],integrations:[{name:"GitHub",description:"Link repos for automated scanning."},{name:"JIRA",description:"Push mitigations as tasks."}]}),e.jsxs(U,{open:k,onOpenChange:h,children:[e.jsx(R,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," New Project"]})}),e.jsxs(B,{children:[e.jsxs(O,{children:[e.jsx(G,{children:"Create New Project"}),e.jsx(H,{children:"Add a new software project to track security risks."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Project Name"}),e.jsx(c,{value:t.name,onChange:s=>r({...t,name:s.target.value}),placeholder:"e.g. Customer Portal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Description"}),e.jsx(ie,{value:t.description,onChange:s=>r({...t,description:s.target.value}),placeholder:"Brief description of the project..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Repository URL"}),e.jsx(c,{value:t.repositoryUrl,onChange:s=>r({...t,repositoryUrl:s.target.value}),placeholder:"https://github.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Tech Stack (comma separated)"}),e.jsx(c,{value:t.techStackInput,onChange:s=>r({...t,techStackInput:s.target.value}),placeholder:"React, Node, Postgres..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Owner / Lead"}),e.jsx(c,{value:t.owner,onChange:s=>r({...t,owner:s.target.value}),placeholder:"Tech Lead or Team Name"})]})]}),e.jsxs(E,{children:[e.jsx(n,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(n,{onClick:P,disabled:!t.name||v.isLoading,children:v.isLoading?"Creating...":"Create Project"})]})]})]})]})]}),e.jsx(K,{open:!!u,onOpenChange:s=>!s&&g(null),children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Are you absolutely sure?"}),e.jsx(Z,{children:"This action cannot be undone. This will permanently delete the project and all associated threat models and risks."})]}),e.jsxs(_,{children:[e.jsx(ee,{children:"Cancel"}),e.jsx(se,{onClick:T,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:C.isLoading?"Deleting...":"Delete Project"})]})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ne,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search projects...",className:"pl-8",value:x,onChange:s=>L(s.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S?e.jsx("div",{className:"col-span-3 text-center py-10",children:"Loading projects..."}):(i==null?void 0:i.length)===0?e.jsx("div",{className:"col-span-3 text-center py-10 text-slate-500 border border-dashed rounded-lg",children:"No projects found. Create your first one to get started."}):i==null?void 0:i.map(s=>{var o,y;return e.jsxs(F,{className:"hover:shadow-md transition-shadow cursor-pointer group",onClick:()=>b(`/clients/${a}/dev/projects/${s.id}`),children:[e.jsxs($,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(q,{className:"text-xl group-hover:text-blue-600 transition-colors",children:s.name}),s.repositoryUrl&&e.jsx(le,{className:"h-5 w-5 text-slate-400"})]}),e.jsx(z,{className:"line-clamp-2 min-h-[40px]",children:s.description||"No description provided."})]}),e.jsxs(J,{className:"pb-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[(o=s.techStack)==null?void 0:o.slice(0,3).map(d=>e.jsx(w,{variant:"secondary",className:"text-xs",children:d},d)),(((y=s.techStack)==null?void 0:y.length)||0)>3&&e.jsxs(w,{variant:"outline",className:"text-xs",children:["+",s.techStack.length-3]})]}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),s.threatModelCount||0," Threat Models"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Updated ",pe(new Date(s.updatedAt),"MMM d")]})]})]}),e.jsxs(Q,{className:"pt-0 flex justify-between items-center",children:[e.jsxs(n,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:d=>{d.stopPropagation(),g(s.id)},children:[e.jsx(me,{className:"h-4 w-4 mr-1"})," Delete"]}),e.jsxs(n,{variant:"ghost",className:"text-blue-600 p-0 h-auto hover:bg-transparent group-hover:underline",children:["View Details ",e.jsx(V,{className:"h-4 w-4 ml-1"})]})]})]},s.id)})})]})})};export{is as DevProjectsList};
