import{r as D,t as u,i as f,j as e,D as H,ap as X,c as N,o as W,p as O,q,s as z,L as h,I as C,E as L,G as I,H as R,J as V,K as x,w as Q,x as Z,b as ee,A as se,N as te,O as ae,P as M,Q as w,V as ie,W as j,X as re,Y as ne,Z as le,_ as oe,$ as de,a1 as k,bC as ce,bD as me,aa as xe,bE as he,bF as ue,k as v,ab as pe,z as ge}from"./index-DOc7Nwb7.js";import{D as je,L as fe,k as we}from"./DashboardLayout-aHnUqq57.js";import{P as ve}from"./PageGuide-CPKKXXS6.js";import{u as Ne}from"./index.esm-BxsGsA2t.js";import{T as _}from"./textarea-BtxBxzdY.js";import{t as be,o as ye,s as F,e as ke}from"./zod-NsgrLny8.js";import{P as De}from"./plus-BaQ35Jcx.js";import{T as Ce,a as Te,b as U}from"./tabs-CBDTXbEn.js";import{F as Se}from"./filter-Ceo--4mb.js";import{C as Ae}from"./calendar-BlLJlGbj.js";import{U as B}from"./user-CqRnJLgW.js";import{E as Pe}from"./ellipsis-BXWwt8ER.js";import{C as G}from"./circle-check-C5kiwRoG.js";import{f as Me}from"./format-H2tx8_vS.js";import{A as Fe}from"./activity-B1F2IRm3.js";import{C as Ue}from"./clock-osbacZli.js";import{A as Le}from"./arrow-right-M96iV-v9.js";import{B as Ie}from"./book-open-BffBrdze.js";import{S as Re}from"./sparkles-CoQ80pK2.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";import"./differenceInCalendarDays-nctqlg7V.js";const Ve=ye({title:F().min(1,"Title is required"),description:F().optional(),priority:ke(["low","medium","high","critical"]),dueDate:F().min(1,"Due date is required")});function Ee({clientId:n,onOpenChange:i}){const[p,g]=D.useState(!1),a=u.useUtils(),{register:t,handleSubmit:c,reset:o,setValue:T,watch:S,formState:{errors:r}}=Ne({resolver:be(Ve),defaultValues:{priority:"medium"}}),m=u.governance.create.useMutation({onSuccess:()=>{f.success("Task created successfully"),a.governance.list.invalidate(),a.governance.getStats.invalidate(),g(!1),o(),i&&i(!1)},onError:l=>{f.error(`Failed to create task: ${l.message}`)}}),A=l=>{m.mutate({clientId:n,title:l.title,description:l.description||"",priority:l.priority,dueDate:new Date(l.dueDate).toISOString()})},P=S("priority");return e.jsxs(H,{open:p,onOpenChange:l=>{g(l),i&&i(l)},children:[e.jsx(X,{asChild:!0,children:e.jsxs(N,{children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"New Task"]})}),e.jsxs(W,{className:"sm:max-w-[500px]",children:[e.jsxs(O,{children:[e.jsx(q,{children:"Create New Task"}),e.jsx(z,{children:"Add a new task to your governance workbench."})]}),e.jsxs("form",{onSubmit:c(A),className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:"Title"}),e.jsx(C,{id:"title",placeholder:"Review Q1 Access Logs",...t("title")}),r.title&&e.jsx("p",{className:"text-sm text-red-500",children:r.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",placeholder:"Detailed description of the task...",className:"resize-none",...t("description")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"priority",children:"Priority"}),e.jsxs(L,{onValueChange:l=>T("priority",l),defaultValue:P,children:[e.jsx(I,{children:e.jsx(R,{placeholder:"Select priority"})}),e.jsxs(V,{children:[e.jsx(x,{value:"low",children:"Low"}),e.jsx(x,{value:"medium",children:"Medium"}),e.jsx(x,{value:"high",children:"High"}),e.jsx(x,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"dueDate",children:"Due Date *"}),e.jsx(C,{id:"dueDate",type:"date",...t("dueDate"),required:!0}),r.dueDate&&e.jsx("p",{className:"text-sm text-red-500",children:r.dueDate.message})]})]}),e.jsx(Q,{children:e.jsxs(N,{type:"submit",disabled:m.isPending,children:[m.isPending&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Task"]})})]})]})]})}function $e({clientId:n}){var $;const[i,p]=D.useState("all"),[g,a]=D.useState(void 0);ee();const[t,c]=D.useState(null),{data:o,isLoading:T,refetch:S}=u.governance.list.useQuery({clientId:n,status:g}),{data:r}=u.universalTasks.listAssignees.useQuery({clientId:n}),m=u.governance.update.useMutation({onSuccess:()=>{f.success("Task updated"),S()},onError:s=>{f.error("Failed to update task")}}),A=s=>{c(s)},P=s=>{p(s),s==="all"&&a(void 0),s==="pending"&&a("pending"),s==="completed"&&a("completed")},l=s=>{switch(s){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-blue-600 bg-blue-50 border-blue-200";case"low":return"text-gray-600 bg-gray-50 border-gray-200";default:return""}},Y=s=>{switch(s){case"completed":return e.jsx(v,{variant:"default",className:"bg-green-600",children:"Completed"});case"in_progress":return e.jsx(v,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"In Progress"});case"pending":return e.jsx(v,{variant:"outline",className:"text-gray-500",children:"Pending"});case"cancelled":return e.jsx(v,{variant:"destructive",children:"Cancelled"});default:return e.jsx(v,{variant:"outline",children:s})}},J=s=>{if(!s)return"Unassigned";const d=r==null?void 0:r.find(b=>b.id===s);return d?`${d.firstName} ${d.lastName}`:`User ${s}`},K=s=>{m.mutate({clientId:n,id:s,status:"completed"})},E=(s,d)=>{m.mutate({clientId:n,id:s,assignedToUserId:d}),f.success(d?"User assigned":"Task unassigned")};return T?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsx(se,{className:"h-12 w-full"},s))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ce,{value:i,onValueChange:P,className:"w-[400px]",children:e.jsxs(Te,{className:"bg-slate-100",children:[e.jsx(U,{value:"all",className:"data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:"All Tasks"}),e.jsx(U,{value:"pending",className:"data-[state=active]:bg-amber-500 data-[state=active]:text-white",children:"Pending"}),e.jsx(U,{value:"completed",className:"data-[state=active]:bg-emerald-600 data-[state=active]:text-white",children:"Completed"})]})}),e.jsxs(N,{variant:"outline",size:"sm",className:"h-8 gap-1",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Filter"})]})]}),e.jsx("div",{className:"rounded-md border bg-white overflow-hidden",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(M,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(w,{className:"w-[40%] text-white font-semibold py-4",children:"Task Details"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Priority"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Due Date"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Assignee"}),e.jsx(w,{className:"w-[50px] text-white font-semibold py-4"})]})}),e.jsx(ie,{children:o&&o.length>0?o.map(s=>{var d,b;return e.jsxs(M,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group cursor-pointer",onDoubleClick:()=>A(s),children:[e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.title}),s.description&&e.jsx("span",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description})]})}),e.jsx(j,{children:Y(s.status||"pending")}),e.jsx(j,{children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium border ${l(s.priority||"medium")}`,children:((d=s.priority)==null?void 0:d.charAt(0).toUpperCase())+((b=s.priority)==null?void 0:b.slice(1))})}),e.jsx(j,{children:s.dueDate?e.jsxs("div",{className:`flex items-center gap-1.5 text-sm ${new Date(s.dueDate)<new Date&&s.status!=="completed"?"text-red-600 font-medium":"text-muted-foreground"}`,children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:Me(new Date(s.dueDate),"MMM d")})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-6 w-6",children:e.jsx(ne,{className:"text-[10px]",children:e.jsx(B,{className:"h-3 w-3"})})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:J(s.assignedToUserId)})]})}),e.jsx(j,{children:e.jsxs(le,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(N,{variant:"ghost",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsxs(de,{align:"end",children:[e.jsxs(k,{onClick:()=>K(s.id),children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-green-600"}),"Mark as Complete"]}),e.jsxs(ce,{children:[e.jsxs(me,{children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Assign User",e.jsx(xe,{className:"ml-auto h-4 w-4"})]}),e.jsx(he,{children:e.jsxs(ue,{className:"max-h-[200px] overflow-y-auto",children:[e.jsx(k,{onClick:()=>E(s.id,null),children:"Unassign"}),r==null?void 0:r.map(y=>e.jsxs(k,{onClick:()=>E(s.id,y.id),children:[y.firstName," ",y.lastName]},y.id))]})})]}),e.jsx(k,{className:"text-red-600",children:"Delete"})]})]})})]},s.id)}):e.jsx(M,{children:e.jsx(j,{colSpan:6,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-muted-foreground",children:[e.jsx(G,{className:"h-8 w-8 mb-2 opacity-20"}),e.jsx("p",{children:"No tasks found for this view."})]})})})})]})}),t&&e.jsx(H,{open:!!t,onOpenChange:()=>c(null),children:e.jsxs(W,{className:"sm:max-w-[500px]",children:[e.jsxs(O,{children:[e.jsx(q,{children:"Edit Task"}),e.jsx(z,{children:"Update task details and assignment"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Title"}),e.jsx(C,{defaultValue:t.title,onBlur:s=>s.target.value!==t.title&&m.mutate({clientId:n,id:t.id,title:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Description"}),e.jsx(_,{defaultValue:t.description||"",onBlur:s=>s.target.value!==t.description&&m.mutate({clientId:n,id:t.id,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Due Date"}),e.jsx(C,{type:"date",defaultValue:t.dueDate?new Date(t.dueDate).toISOString().split("T")[0]:"",onBlur:s=>s.target.value&&m.mutate({clientId:n,id:t.id,dueDate:new Date(s.target.value).toISOString()})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Status"}),e.jsxs(L,{defaultValue:t.status,onValueChange:s=>{m.mutate({clientId:n,id:t.id,status:s}),c({...t,status:s})},children:[e.jsx(I,{children:e.jsx(R,{})}),e.jsxs(V,{children:[e.jsx(x,{value:"pending",children:"Pending"}),e.jsx(x,{value:"in_progress",children:"In Progress"}),e.jsx(x,{value:"completed",children:"Completed"}),e.jsx(x,{value:"cancelled",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Assignee"}),e.jsxs(L,{defaultValue:(($=t.assignedToUserId)==null?void 0:$.toString())||"unassigned",onValueChange:s=>{const d=s==="unassigned"?null:parseInt(s);m.mutate({clientId:n,id:t.id,assignedToUserId:d}),c({...t,assignedToUserId:d})},children:[e.jsx(I,{children:e.jsx(R,{placeholder:"Select Assignee"})}),e.jsxs(V,{children:[e.jsx(x,{value:"unassigned",children:"Unassigned"}),r==null?void 0:r.map(s=>e.jsxs(x,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))]})]})]})]}),e.jsx(Q,{children:e.jsx(N,{onClick:()=>c(null),children:"Close"})})]})})]})}function Fs(){const{id:n}=pe(),i=parseInt(n,10),p=u.useUtils(),{data:g}=u.autopilot.getLastRun.useQuery({clientId:i}),{data:a,isLoading:t}=u.governance.getStats.useQuery({clientId:i}),c=u.autopilot.trigger.useMutation({onSuccess:o=>{f.success("Autopilot Analysis Complete",{description:`Created ${o.totalCreated} new tasks: ${o.policies} policies, ${o.risks} risks, ${o.controls} controls.`}),p.governance.list.invalidate(),p.governance.getStats.invalidate(),p.autopilot.getLastRun.invalidate()},onError:o=>{f.error("Autopilot Failed",{description:o.message})}});return!i||isNaN(i)?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("p",{className:"text-muted-foreground",children:"Please select a client to view the workbench."})}):e.jsx(je,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Governance Workbench"}),e.jsx("p",{className:"text-muted-foreground",children:"Your centralized mission control for compliance operations, tasks, and oversight."})]}),e.jsx(ve,{title:"Governance Workbench",description:"Central mission control for compliance operations, tasks, and oversight.",rationale:"Effective governance requires continuous monitoring. This workbench aggregates tasks from across your compliance program—policy reviews, risk assessments, and control validations—into a single actionable feed.",howToUse:[{step:"Monitor Health",description:"Review the top cards for an instant snapshot of your compliance posture."},{step:"Manage Tasks",description:"Use the 'Governance Tasks' feed to track and resolve pending items."},{step:"Run Autopilot",description:"Click 'Run Autopilot' to have the AI analyze your program and generate recommendations."},{step:"Create Items",description:"Manually add tasks for your team using the 'Create Work Item' dialog."}],integrations:[{name:"Policy Management",description:"Policy review tasks appear here automatically when due."},{name:"Risk Register",description:"Risk mitigation actions are tracked as governance tasks."},{name:"Autopilot",description:"AI-driven insights inject new tasks based on regulatory changes or gaps."}]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-3 lg:grid-cols-5",children:[e.jsxs("div",{className:"p-4 rounded-xl border-none shadow-lg shadow-emerald-200 dark:shadow-none bg-emerald-600 text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:"Health Score"}),t?e.jsx("div",{className:"h-8 w-16 bg-white/20 animate-pulse rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("p",{className:"text-2xl font-bold mt-1 text-white",children:(a==null?void 0:a.healthScore)??100}),e.jsx("span",{className:"text-sm text-white/80",children:"/ 100"})]}),e.jsx("p",{className:"text-xs text-white/60 mt-1",children:"Overall Status"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-white/20 backdrop-blur-md",children:e.jsx(Fe,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"p-4 rounded-xl border-none shadow-lg shadow-blue-200 dark:shadow-none bg-blue-600 text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:"Pending Tasks"}),t?e.jsx("div",{className:"h-8 w-16 bg-white/20 animate-pulse rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-bold mt-1 text-white",children:(a==null?void 0:a.pending)||0}),e.jsx("p",{className:"text-xs text-white/60 mt-1",children:"Tasks requiring attention"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-white/20 backdrop-blur-md",children:e.jsx(fe,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"p-4 rounded-xl border-none shadow-lg shadow-red-200 dark:shadow-none bg-red-600 text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:"Critical Items"}),t?e.jsx("div",{className:"h-8 w-16 bg-white/20 animate-pulse rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-bold mt-1 text-white",children:(a==null?void 0:a.critical)||0}),e.jsx("p",{className:"text-xs text-white/60 mt-1",children:"High priority or critical"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-white/20 backdrop-blur-md",children:e.jsx(ge,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"p-4 rounded-xl border-none shadow-lg shadow-orange-200 dark:shadow-none bg-orange-500 text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:"Overdue"}),t?e.jsx("div",{className:"h-8 w-16 bg-white/20 animate-pulse rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-bold mt-1 text-white",children:(a==null?void 0:a.overdue)||0}),e.jsx("p",{className:"text-xs text-white/60 mt-1",children:"Past due date"})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-white/20 backdrop-blur-md",children:e.jsx(Ue,{className:"w-5 h-5 text-white"})})]}),e.jsx("div",{className:"p-4 rounded-xl border border-indigo-200 bg-white shadow-sm flex flex-col justify-between cursor-pointer hover:border-indigo-400 hover:shadow-md transition-all group",onClick:()=>window.location.href=`/clients/${i}/governance`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:"Program Guide"}),e.jsx(v,{variant:"secondary",className:"text-[10px] px-1.5 h-5 bg-indigo-100 text-indigo-700 pointer-events-none",children:"NEW"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 mt-2 font-medium group-hover:text-indigo-600 transition-colors",children:[e.jsx("span",{children:"View Framework"}),e.jsx(Le,{className:"w-3 h-3 group-hover:translate-x-1 transition-transform"})]})]}),e.jsx("div",{className:"p-2 rounded-lg bg-indigo-50 text-indigo-600 group-hover:bg-indigo-100 transition-colors",children:e.jsx(Ie,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Last check: ",we(new Date(g.createdAt),{addSuffix:!0})]}),e.jsxs(N,{variant:"outline",onClick:()=>c.mutate({clientId:i}),disabled:c.isPending,className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-indigo-500"}),c.isPending?"Analyzing...":"Run Autopilot"]})]}),e.jsx(Ee,{clientId:i})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-tight",children:"Governance Tasks"}),e.jsx($e,{clientId:i})]})]})})}export{Fs as default};
