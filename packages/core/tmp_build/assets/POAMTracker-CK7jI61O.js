import{ab as We,t as x,r as b,i as j,j as e,c as p,Z as ue,_ as xe,a3 as pe,$ as je,a0 as ve,a2 as ae,a1 as w,D as ge,ap as Ue,o as Ne,p as fe,q as be,s as ke,L as l,I as c,E as V,G as L,H as F,J as E,K as d,w as Ce,z as He,C as Pe,d as Qe,e as ze,l as Q,m as Ae,N as Be,O as _e,P as te,Q as O,V as Ze,W as y,k as le}from"./index-DOc7Nwb7.js";import{D as ie}from"./DashboardLayout-aHnUqq57.js";import{B as De}from"./Breadcrumb-CRi3LAxS.js";import{T as v}from"./textarea-BtxBxzdY.js";import{T as we,a as ye,b as k,c as C}from"./tabs-CBDTXbEn.js";import{S as z}from"./switch-B74-5eCi.js";import{S as Re}from"./scroll-area-DPaNxEJD.js";import{S as g}from"./searchable-select-CvBIVEjS.js";import{Z as ne}from"./zap-B01fFOkT.js";import{C as Se}from"./circle-check-C5kiwRoG.js";import{P as Ie}from"./plus-BaQ35Jcx.js";import{D as Ge}from"./download-ByfWg1Mi.js";import{C as Ke}from"./clock-osbacZli.js";import{U as Je}from"./user-CqRnJLgW.js";import{S as Ye}from"./search-CwuIBBPE.js";import{F as Xe}from"./filter-Ceo--4mb.js";import{C as es}from"./calendar-BlLJlGbj.js";import{E as ss}from"./ellipsis-vertical-DBvk9Y0C.js";import"./index--2vFva6Y.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./chevrons-up-down-COXP-OtJ.js";function zs(){var de,me;const _=We(),r=Number(_.id),{data:m,refetch:$,isLoading:Z}=x.federal.listPoams.useQuery({clientId:r}),[Oe,q]=b.useState(null);b.useEffect(()=>{q(null)},[r]);const N=Oe||((de=m==null?void 0:m[0])==null?void 0:de.id),{data:G,refetch:re}=x.federal.getPoamWithItems.useQuery({id:N,clientId:r},{enabled:!!N}),{data:R}=x.clientControls.list.useQuery({clientId:r}),{data:S}=x.assets.list.useQuery({clientId:r}),{data:I}=x.risks.getVulnerabilities.useQuery({clientId:r}),{data:P}=x.users.listWorkspaceMembers.useQuery({clientId:r}),{data:A}=x.risks.getAll.useQuery({clientId:r}),W=x.federal.createPoam.useMutation({onSuccess:s=>{j.success("POA&M Created"),$(),q(s.id)}}),Me=()=>{const s=window.prompt("Enter a title for the new POA&M Plan:",`POA&M ${new Date().getFullYear()}`);s&&W.mutate({clientId:r,title:s})},K=x.federal.importSamplePoam.useMutation({onSuccess:s=>{j.success("Sample POA&M Imported"),$(),q(s.id)},onError:()=>{j.error("Failed to import sample data")}}),[Te,U]=b.useState(!1),[a,i]=b.useState(null),J=x.federal.updatePoamItem.useMutation({onSuccess:()=>{j.success("POA&M item updated"),re(),U(!1),i(null)},onError:s=>{j.error(`Failed to update POA&M item: ${s.message}`)}}),Ve=s=>{i(s),U(!0)},oe=()=>{K.mutate({clientId:r})},Le=x.federal.addPoamItem.useMutation(),[Fe,Y]=b.useState(!1),[t,n]=b.useState({weaknessName:"",weaknessDescription:"",controlId:"",pointOfContact:"",scheduledCompletionDate:"",weaknessDetectorSource:"",sourceIdentifier:"",assetIdentifier:"",resourcesRequired:"",overallRemediationPlan:"",originalDetectionDate:"",status:"open",statusDate:"",vendorDependency:"",lastVendorCheckinDate:"",productName:"",originalRiskRating:"low",adjustedRiskRating:"low",riskAdjustment:"",falsePositive:!1,operationalRequirement:"",deviationRationale:"",comments:"",autoApprove:!1,relatedRiskId:void 0}),Ee=async()=>{if(N)try{await Le.mutateAsync({clientId:r,poamId:N,...t,originalDetectionDate:t.originalDetectionDate||void 0,scheduledCompletionDate:t.scheduledCompletionDate||void 0,statusDate:t.statusDate||void 0,lastVendorCheckinDate:t.lastVendorCheckinDate||void 0}),j.success("POA&M item added"),Y(!1),n({weaknessName:"",weaknessDescription:"",controlId:"",pointOfContact:"",scheduledCompletionDate:"",weaknessDetectorSource:"",sourceIdentifier:"",assetIdentifier:"",resourcesRequired:"",overallRemediationPlan:"",originalDetectionDate:"",status:"open",statusDate:"",vendorDependency:"",lastVendorCheckinDate:"",productName:"",originalRiskRating:"low",adjustedRiskRating:"low",riskAdjustment:"",falsePositive:!1,operationalRequirement:"",deviationRationale:"",comments:"",autoApprove:!1,relatedRiskId:void 0}),re()}catch{j.error("Failed to add item")}},X=x.federal.exportPoam.useMutation({onSuccess:s=>{const o=window.atob(s.base64),h=new Uint8Array(o.length);for(let D=0;D<o.length;D++)h[D]=o.charCodeAt(D);const se=new Blob([h],{type:"text/csv"}),T=URL.createObjectURL(se),f=document.createElement("a");f.href=T,f.download=s.filename,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(T),j.success("POA&M Exported Successfully")},onError:()=>{j.error("Failed to export POA&M")}}),$e=()=>{N&&X.mutate({poamId:N,clientId:r})};if(Z)return e.jsx(ie,{children:e.jsx("div",{className:"flex h-[50vh] items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading POA&Ms..."})})});if(m&&m.length===0)return e.jsx(ie,{children:e.jsxs("div",{className:"p-8 space-y-6 w-full",children:[e.jsx(De,{items:[{label:"Dashboard",href:`/clients/${r}/dashboard`},{label:"Federal Hub",href:`/clients/${r}/federal`},{label:"POA&M Tracker"}]}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50",children:[e.jsx("div",{className:"p-4 bg-white rounded-full shadow-sm mb-4",children:e.jsx(ne,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Initialize POA&M"}),e.jsx("p",{className:"text-slate-500 max-w-md text-center mb-6",children:"No Plan of Action & Milestones document found. Initialize one to start tracking weaknesses and remediation efforts for NIST 800-171/CMMC."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{onClick:()=>W.mutate({clientId:r,title:"Primary POA&M"}),disabled:W.isPending,className:"bg-blue-600 hover:bg-blue-700",children:W.isPending?"Initializing...":"Create POA&M Document"}),e.jsxs(p,{onClick:oe,disabled:K.isPending,variant:"outline",className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),K.isPending?"Importing...":"Load Sample Data"]})]})]})]})});const[ee,qe]=b.useState(""),[u,M]=b.useState(null),H=(G==null?void 0:G.items)||[],ce=H.filter(s=>{var T,f,D,he;const o=ee.toLowerCase(),h=!ee||((T=s.weaknessName)==null?void 0:T.toLowerCase().includes(o))||((f=s.weaknessDescription)==null?void 0:f.toLowerCase().includes(o))||((D=s.controlId)==null?void 0:D.toLowerCase().includes(o))||((he=s.sourceIdentifier)==null?void 0:he.toLowerCase().includes(o)),se=!u||s.status===u;return h&&se});return e.jsx(ie,{children:e.jsxs("div",{className:"p-8 space-y-6 w-full",children:[e.jsx(De,{items:[{label:"Dashboard",href:`/clients/${r}/dashboard`},{label:"Federal Hub",href:`/clients/${r}/federal`},{label:"POA&M Tracker"}]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-black text-slate-900 tracking-tight",children:((me=m==null?void 0:m.find(s=>s.id===N))==null?void 0:me.title)||"Plan of Action & Milestones"}),e.jsx("p",{className:"text-slate-500",children:"Track and remediate security weaknesses for NIST 800-171 compliance."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"gap-2 border-slate-200 font-bold h-11",children:["Plans",e.jsx(pe,{className:"h-4 w-4 opacity-50"})]})}),e.jsxs(je,{align:"end",className:"w-56",children:[e.jsx(ve,{children:"Available Plans"}),e.jsx(ae,{}),m==null?void 0:m.map(s=>e.jsxs(w,{onClick:()=>q(s.id),className:"justify-between cursor-pointer",children:[s.title,s.id===N&&e.jsx(Se,{className:"h-3 w-3 text-blue-600"})]},s.id)),e.jsx(ae,{}),e.jsxs(w,{onClick:oe,className:"text-slate-600 cursor-pointer",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-amber-500"})," Import Sample POA&M"]}),e.jsxs(w,{onClick:Me,className:"text-blue-600 font-bold cursor-pointer",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"})," New POA&M Plan"]})]})]}),e.jsxs(p,{variant:"outline",className:"gap-2 border-slate-200 font-bold h-11",onClick:()=>$e(),disabled:X.isPending,children:[e.jsx(Ge,{className:"h-4 w-4"}),X.isPending?"Generating...":"Export DoD"]}),e.jsxs(ge,{open:Fe,onOpenChange:Y,children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(p,{className:"bg-blue-600 hover:bg-blue-700 font-bold gap-2 h-11 shadow-lg shadow-blue-100",children:[e.jsx(Ie,{className:"h-4 w-4"})," New Weakness"]})}),e.jsxs(Ne,{className:"sm:max-w-[500px]",children:[e.jsxs(fe,{children:[e.jsx(be,{children:"Add POA&M Weakness"}),e.jsx(ke,{children:"Record a new security weakness and its remediation plan."})]}),e.jsxs(we,{defaultValue:"identification",className:"py-4",children:[e.jsxs(ye,{className:"grid w-full grid-cols-4",children:[e.jsx(k,{value:"identification",children:"ID"}),e.jsx(k,{value:"responsibility",children:"Resp"}),e.jsx(k,{value:"remediation",children:"Remed"}),e.jsx(k,{value:"risk",children:"Risk"})]}),e.jsxs(Re,{className:"h-[400px] pr-4 mt-4",children:[e.jsxs(C,{value:"identification",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Weakness Name *"}),e.jsx(c,{value:t.weaknessName,onChange:s=>n({...t,weaknessName:s.target.value}),placeholder:"e.g. MFA not enabled on VPN"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Control ID"}),e.jsx(g,{placeholder:"Select Control",value:t.controlId||"",onSelect:s=>n({...t,controlId:s}),options:(R==null?void 0:R.map(s=>{var o,h;return{label:`${((o=s.control)==null?void 0:o.controlId)||s.clientControl.clientControlId||"Custom"}: ${((h=s.control)==null?void 0:h.name)||""}`,value:s.clientControl.id.toString()}}))||[]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Asset Identifier"}),e.jsx(g,{placeholder:"Select Asset",value:t.assetIdentifier||"",onSelect:s=>n({...t,assetIdentifier:s}),options:(S==null?void 0:S.map(s=>({label:s.name,value:s.id.toString()})))||[]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Weakness Description"}),e.jsx(v,{value:t.weaknessDescription,onChange:s=>n({...t,weaknessDescription:s.target.value}),placeholder:"Describe the deficiency..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Detector Source"}),e.jsx(c,{value:t.weaknessDetectorSource,onChange:s=>n({...t,weaknessDetectorSource:s.target.value}),placeholder:"e.g. Vulnerability Scan"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Source Identifier"}),e.jsx(g,{placeholder:"Select Source (CVE/ID)",value:t.sourceIdentifier||"",onSelect:s=>n({...t,sourceIdentifier:s}),options:(I==null?void 0:I.map(s=>({label:s.name,value:s.name})))||[]})]})]})]}),e.jsxs(C,{value:"responsibility",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Point of Contact"}),e.jsx(g,{placeholder:"Select Point of Contact",value:t.pointOfContact||"",onSelect:s=>n({...t,pointOfContact:s}),options:(P==null?void 0:P.map(s=>({label:s.name,value:s.name})))||[]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Resources Required"}),e.jsx(v,{value:t.resourcesRequired,onChange:s=>n({...t,resourcesRequired:s.target.value}),placeholder:"Budget, staff, tools..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Product Name"}),e.jsx(c,{value:t.productName,onChange:s=>n({...t,productName:s.target.value}),placeholder:"e.g. Cisco AnyConnect"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Vendor Dependency"}),e.jsx(c,{value:t.vendorDependency,onChange:s=>n({...t,vendorDependency:s.target.value}),placeholder:"e.g. Firmware Update"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Last Check-in"}),e.jsx(c,{type:"date",value:t.lastVendorCheckinDate,onChange:s=>n({...t,lastVendorCheckinDate:s.target.value})})]})]})]}),e.jsxs(C,{value:"remediation",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Overall Remediation Plan"}),e.jsx(v,{value:t.overallRemediationPlan,onChange:s=>n({...t,overallRemediationPlan:s.target.value}),placeholder:"Steps to fix..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Detection Date"}),e.jsx(c,{type:"date",value:t.originalDetectionDate,onChange:s=>n({...t,originalDetectionDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Completion Date"}),e.jsx(c,{type:"date",value:t.scheduledCompletionDate,onChange:s=>n({...t,scheduledCompletionDate:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Comments"}),e.jsx(v,{value:t.comments,onChange:s=>n({...t,comments:s.target.value}),placeholder:"Additional notes..."})]})]}),e.jsxs(C,{value:"risk",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Related Risk Assessment"}),e.jsx(g,{placeholder:"Select Related Risk",value:t.relatedRiskId?t.relatedRiskId.toString():"",onSelect:s=>n({...t,relatedRiskId:s?Number(s):void 0}),options:(A==null?void 0:A.map(s=>({label:`${s.assessmentId}: ${s.title}`,value:s.id.toString(),description:`Inherent Risk: ${s.inherentRisk}`})))||[]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Original Risk"}),e.jsxs(V,{value:t.originalRiskRating,onValueChange:s=>n({...t,originalRiskRating:s}),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"moderate",children:"Moderate"}),e.jsx(d,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Adjusted Risk"}),e.jsxs(V,{value:t.adjustedRiskRating,onValueChange:s=>n({...t,adjustedRiskRating:s}),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"moderate",children:"Moderate"}),e.jsx(d,{value:"high",children:"High"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"font-bold",children:"Risk Adjustment Rationale"}),e.jsx(v,{value:t.riskAdjustment,onChange:s=>n({...t,riskAdjustment:s.target.value}),placeholder:"Why was the risk adjusted?"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"font-bold text-sm",children:"False Positive"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Is this a known false positive?"})]}),e.jsx(z,{checked:t.falsePositive,onCheckedChange:s=>n({...t,falsePositive:s})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"font-bold text-sm",children:"Auto Approve"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automate closure upon verification?"})]}),e.jsx(z,{checked:t.autoApprove,onCheckedChange:s=>n({...t,autoApprove:s})})]})]})]})]}),e.jsxs(Ce,{children:[e.jsx(p,{variant:"outline",onClick:()=>Y(!1),children:"Cancel"}),e.jsx(p,{onClick:Ee,className:"bg-blue-600 hover:bg-blue-700",children:"Add Item"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(B,{label:"Open Weaknesses",value:H.filter(s=>s.status==="open").length,icon:He,color:"text-amber-600",bg:"bg-amber-50"}),e.jsx(B,{label:"Completed",value:H.filter(s=>s.status==="closed").length,icon:Se,color:"text-emerald-600",bg:"bg-emerald-50"}),e.jsx(B,{label:"Past Due",value:0,icon:Ke,color:"text-rose-600",bg:"bg-rose-50"}),e.jsx(B,{label:"Risk Accepted",value:0,icon:Je,color:"text-blue-600",bg:"bg-blue-50"})]}),e.jsxs(Pe,{className:"border-slate-200",children:[e.jsx(Qe,{className:"border-b bg-slate-50/50 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Remediation Roadmap"}),e.jsx("span",{className:"text-xs text-slate-400 font-normal",children:"(Double-click items to edit)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(c,{placeholder:"Search weaknesses, controls, or IDs...",className:"pl-9 h-9 w-72 bg-white",value:ee,onChange:s=>qe(s.target.value)})]}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",className:`h-9 gap-2 font-bold ${u?"bg-blue-50 text-blue-700 border-blue-200":""}`,children:[e.jsx(Xe,{className:"h-4 w-4"}),u?u.charAt(0).toUpperCase()+u.slice(1):"Filter Status",u&&e.jsx(pe,{className:"h-3 w-3 opacity-50"})]})}),e.jsxs(je,{align:"end",children:[e.jsx(ve,{children:"Filter by Status"}),e.jsx(ae,{}),e.jsxs(w,{onClick:()=>M(null),children:[u===null&&e.jsx(Q,{className:"h-3 w-3 mr-2"}),"All Statuses"]}),e.jsxs(w,{onClick:()=>M("open"),children:[u==="open"&&e.jsx(Q,{className:"h-3 w-3 mr-2"}),"Open"]}),e.jsxs(w,{onClick:()=>M("closed"),children:[u==="closed"&&e.jsx(Q,{className:"h-3 w-3 mr-2"}),"Closed"]}),e.jsxs(w,{onClick:()=>M("risk_accepted"),children:[u==="risk_accepted"&&e.jsx(Q,{className:"h-3 w-3 mr-2"}),"Risk Accepted"]})]})]}),u&&e.jsx(p,{variant:"ghost",size:"sm",className:"h-9 px-2 text-slate-400 hover:text-slate-600",onClick:()=>M(null),children:"Clear"})]})]})}),e.jsx(Ae,{className:"p-0",children:e.jsxs(Be,{children:[e.jsx(_e,{children:e.jsxs(te,{className:"hover:bg-transparent border-slate-200",children:[e.jsx(O,{className:"w-[120px] font-bold text-slate-700",children:"Control ID"}),e.jsx(O,{className:"font-bold text-slate-700",children:"Weakness / Deficiency"}),e.jsx(O,{className:"font-bold text-slate-700",children:"Point of Contact"}),e.jsx(O,{className:"font-bold text-slate-700",children:"Scheduled Date"}),e.jsx(O,{className:"font-bold text-slate-700 text-center",children:"Status"}),e.jsx(O,{className:"w-[50px]"})]})}),e.jsx(Ze,{children:ce.length===0?e.jsx(te,{children:e.jsx(y,{colSpan:6,className:"h-32 text-center text-slate-400",children:H.length===0?"No POA&M items found. Start by recording a weakness.":"No items match your search criteria."})}):ce.map(s=>{var o,h;return e.jsxs(te,{className:"group border-slate-100 cursor-pointer hover:bg-slate-50 transition-colors",onDoubleClick:()=>Ve(s),title:"Double-click to edit",children:[e.jsx(y,{className:"font-mono text-xs font-bold text-blue-600",children:s.controlId||"N/A"}),e.jsx(y,{children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("p",{className:"font-bold text-slate-900 mb-0.5",children:s.weaknessName}),e.jsx("p",{className:"text-xs text-slate-500 line-clamp-1 mb-1.5",children:s.weaknessDescription||"No description provided."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(le,{variant:"outline",className:`text-[10px] h-4 px-1 ${s.adjustedRiskRating==="high"?"border-rose-200 text-rose-700 bg-rose-50":s.adjustedRiskRating==="moderate"?"border-amber-200 text-amber-700 bg-amber-50":"border-emerald-200 text-emerald-700 bg-emerald-50"}`,children:[((o=s.adjustedRiskRating)==null?void 0:o.toUpperCase())||"LOW"," RISK"]}),s.falsePositive&&e.jsx(le,{variant:"outline",className:"text-[10px] h-4 px-1 border-blue-200 text-blue-700 bg-blue-50",children:"FALSE POSITIVE"})]})]})}),e.jsx(y,{className:"text-sm text-slate-600",children:s.pointOfContact||"--"}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(es,{className:"h-3.5 w-3.5 opacity-50"}),s.scheduledCompletionDate?new Date(s.scheduledCompletionDate).toLocaleDateString():"--"]})}),e.jsx(y,{className:"text-center",children:e.jsx(le,{className:s.status==="open"?"bg-amber-100 text-amber-700":s.status==="closed"?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-700",children:(h=s.status)==null?void 0:h.toUpperCase()})}),e.jsx(y,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ss,{className:"h-4 w-4 text-slate-400"})})})]},s.id)})})]})})]}),e.jsx(ge,{open:Te,onOpenChange:U,children:e.jsxs(Ne,{className:"sm:max-w-[600px]",children:[e.jsxs(fe,{children:[e.jsx(be,{children:"Edit POA&M Item"}),e.jsx(ke,{children:"Update the weakness details and remediation information."})]}),a&&e.jsxs(we,{defaultValue:"identification",className:"py-4",children:[e.jsxs(ye,{className:"grid w-full grid-cols-4",children:[e.jsx(k,{value:"identification",children:"ID"}),e.jsx(k,{value:"responsibility",children:"Resp"}),e.jsx(k,{value:"remediation",children:"Remed"}),e.jsx(k,{value:"risk",children:"Risk"})]}),e.jsxs(Re,{className:"h-[450px] pr-4 mt-4",children:[e.jsxs(C,{value:"identification",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"controlId",children:"Control ID"}),e.jsx(g,{placeholder:"Select Control",value:a.controlId||"",onSelect:s=>i({...a,controlId:s}),options:(R==null?void 0:R.map(s=>{var o,h;return{label:`${((o=s.control)==null?void 0:o.controlId)||s.clientControl.clientControlId||"Custom"}: ${((h=s.control)==null?void 0:h.name)||""}`,value:s.clientControl.id.toString()}}))||[]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"status",children:"Status"}),e.jsxs(V,{value:a.status||"open",onValueChange:s=>i({...a,status:s}),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(d,{value:"open",children:"Open"}),e.jsx(d,{value:"closed",children:"Closed"}),e.jsx(d,{value:"risk_accepted",children:"Risk Accepted"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"weaknessName",children:"Weakness Name *"}),e.jsx(c,{id:"weaknessName",value:a.weaknessName||"",onChange:s=>i({...a,weaknessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"weaknessDescription",children:"Weakness Description"}),e.jsx(v,{id:"weaknessDescription",value:a.weaknessDescription||"",rows:3,onChange:s=>i({...a,weaknessDescription:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Detector Source"}),e.jsx(c,{value:a.weaknessDetectorSource||"",onChange:s=>i({...a,weaknessDetectorSource:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Asset Identifier"}),e.jsx(g,{placeholder:"Select Asset",value:a.assetIdentifier||"",onSelect:s=>i({...a,assetIdentifier:s}),options:(S==null?void 0:S.map(s=>({label:s.name,value:s.id.toString()})))||[]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Source Identifier"}),e.jsx(g,{placeholder:"Select Source (CVE/ID)",value:a.sourceIdentifier||"",onSelect:s=>i({...a,sourceIdentifier:s}),options:(I==null?void 0:I.map(s=>({label:s.name,value:s.name})))||[]})]})]}),e.jsxs(C,{value:"responsibility",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Point of Contact"}),e.jsx(g,{placeholder:"Select Point of Contact",value:a.pointOfContact||"",onSelect:s=>i({...a,pointOfContact:s}),options:(P==null?void 0:P.map(s=>({label:s.name,value:s.name})))||[]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Resources Required"}),e.jsx(v,{value:a.resourcesRequired||"",onChange:s=>i({...a,resourcesRequired:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Product Name"}),e.jsx(c,{value:a.productName||"",onChange:s=>i({...a,productName:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Vendor Dependency"}),e.jsx(c,{value:a.vendorDependency||"",onChange:s=>i({...a,vendorDependency:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Last Check-in"}),e.jsx(c,{type:"date",value:a.lastVendorCheckinDate?new Date(a.lastVendorCheckinDate).toISOString().split("T")[0]:"",onChange:s=>i({...a,lastVendorCheckinDate:s.target.value})})]})]})]}),e.jsxs(C,{value:"remediation",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Overall Remediation Plan"}),e.jsx(v,{value:a.overallRemediationPlan||"",rows:4,onChange:s=>i({...a,overallRemediationPlan:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Detection Date"}),e.jsx(c,{type:"date",value:a.originalDetectionDate?new Date(a.originalDetectionDate).toISOString().split("T")[0]:"",onChange:s=>i({...a,originalDetectionDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Scheduled Completion"}),e.jsx(c,{type:"date",value:a.scheduledCompletionDate?new Date(a.scheduledCompletionDate).toISOString().split("T")[0]:"",onChange:s=>i({...a,scheduledCompletionDate:s.target.value||void 0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Status Date"}),e.jsx(c,{type:"date",value:a.statusDate?new Date(a.statusDate).toISOString().split("T")[0]:"",onChange:s=>i({...a,statusDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Comments"}),e.jsx(v,{value:a.comments||"",onChange:s=>i({...a,comments:s.target.value})})]})]}),e.jsxs(C,{value:"risk",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Related Risk Assessment"}),e.jsx(g,{placeholder:"Select Related Risk",value:a.relatedRiskId?a.relatedRiskId.toString():"",onSelect:s=>i({...a,relatedRiskId:s?Number(s):void 0}),options:(A==null?void 0:A.map(s=>({label:`${s.assessmentId}: ${s.title}`,value:s.id.toString(),description:`Inherent Risk: ${s.inherentRisk}`})))||[]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Original Risk"}),e.jsxs(V,{value:a.originalRiskRating||"low",onValueChange:s=>i({...a,originalRiskRating:s}),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"moderate",children:"Moderate"}),e.jsx(d,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Adjusted Risk"}),e.jsxs(V,{value:a.adjustedRiskRating||"low",onValueChange:s=>i({...a,adjustedRiskRating:s}),children:[e.jsx(L,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"moderate",children:"Moderate"}),e.jsx(d,{value:"high",children:"High"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Risk Adjustment Rationale"}),e.jsx(v,{value:a.riskAdjustment||"",onChange:s=>i({...a,riskAdjustment:s.target.value})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"font-bold text-sm",children:"False Positive"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Is this a known false positive?"})]}),e.jsx(z,{checked:a.falsePositive,onCheckedChange:s=>i({...a,falsePositive:s})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"font-bold text-sm",children:"Auto Approve"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automate closure upon verification?"})]}),e.jsx(z,{checked:a.autoApprove,onCheckedChange:s=>i({...a,autoApprove:s})})]})]})]})]}),e.jsxs(Ce,{children:[e.jsx(p,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(p,{onClick:()=>{if(!(a!=null&&a.weaknessName)){j.error("Weakness name is required");return}J.mutate({clientId:r,id:a.id,controlId:a.controlId||void 0,weaknessName:a.weaknessName,weaknessDescription:a.weaknessDescription||void 0,weaknessDetectorSource:a.weaknessDetectorSource||void 0,sourceIdentifier:a.sourceIdentifier||void 0,assetIdentifier:a.assetIdentifier||void 0,pointOfContact:a.pointOfContact||void 0,resourcesRequired:a.resourcesRequired||void 0,overallRemediationPlan:a.overallRemediationPlan||void 0,originalDetectionDate:a.originalDetectionDate||void 0,scheduledCompletionDate:a.scheduledCompletionDate||void 0,status:a.status||void 0,statusDate:a.statusDate||void 0,vendorDependency:a.vendorDependency||void 0,lastVendorCheckinDate:a.lastVendorCheckinDate||void 0,productName:a.productName||void 0,originalRiskRating:a.originalRiskRating||void 0,adjustedRiskRating:a.adjustedRiskRating||void 0,riskAdjustment:a.riskAdjustment||void 0,falsePositive:a.falsePositive||void 0,operationalRequirement:a.operationalRequirement||void 0,deviationRationale:a.deviationRationale||void 0,comments:a.comments||void 0,autoApprove:a.autoApprove||void 0,relatedRiskId:a.relatedRiskId||void 0})},disabled:J.isPending,children:J.isPending?"Saving...":"Save Changes"})]})]})})]})})}function B({label:_,value:r,icon:m,color:$,bg:Z}){return e.jsx(Pe,{className:"border-slate-200",children:e.jsx(Ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${Z}`,children:e.jsx(m,{className:`h-6 w-6 ${$}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:_}),e.jsx("p",{className:"text-3xl font-black text-slate-900 tracking-tighter",children:r})]})]})})})}export{zs as default};
