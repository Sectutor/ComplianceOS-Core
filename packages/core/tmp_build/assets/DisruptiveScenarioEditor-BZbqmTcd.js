import{b as F,au as Q,r as g,t as o,i as x,j as e,x as M,c as b,S as T,T as A,C as y,d as C,e as S,f as w,m as k,L as j,I as E,E as q,G as H,H as G,J as V,K as R,a4 as Z}from"./index-DOc7Nwb7.js";import{T as $}from"./textarea-BtxBxzdY.js";import{D as J}from"./DashboardLayout-aHnUqq57.js";import{B as K}from"./Breadcrumb-CRi3LAxS.js";import{A as O}from"./arrow-left-CpuUojG-.js";import{Z as U}from"./zap-B01fFOkT.js";import{S as X}from"./save-CvVmWchr.js";import{I as _}from"./info-By5wLOUH.js";import{S as W}from"./search-CwuIBBPE.js";import{P as Y}from"./plus-BaQ35Jcx.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function ee({scenarioId:d,clientId:m}){const I=o.useContext(),[r,n]=g.useState(""),[p,c]=g.useState([]),{data:t}=o.businessContinuity.scenarios.listRisks.useQuery({scenarioId:d},{enabled:!!d}),{data:f}=o.risks.getAll.useQuery({clientId:m},{enabled:!!m}),N=o.businessContinuity.scenarios.addRisk.useMutation({onSuccess:()=>{I.businessContinuity.scenarios.listRisks.invalidate({scenarioId:d}),x.success("Risk linked to scenario")}}),l=o.businessContinuity.scenarios.removeRisk.useMutation({onSuccess:()=>{I.businessContinuity.scenarios.listRisks.invalidate({scenarioId:d}),x.success("Risk unlinked")}}),D=i=>{d&&N.mutate({scenarioId:d,riskId:i})},a=i=>{if(n(i),!i){c([]);return}if(f){const v=f.filter(u=>((u.title||"").toLowerCase().includes(i.toLowerCase())||(u.description||"").toLowerCase().includes(i.toLowerCase()))&&!(t!=null&&t.some(L=>L.id===u.id)));c(v)}};return d?e.jsxs(y,{className:"w-full max-w-none",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Risk Register Integration"}),e.jsx(w,{children:"Link identified risks that contribute to or are realized by this disruptive scenario."})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Link Existing Risk"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search Risk Register...",className:"pl-8",value:r,onChange:i=>a(i.target.value)})]}),p.length>0&&e.jsx("div",{className:"border rounded-md mt-2 max-h-40 overflow-y-auto bg-white shadow-sm",children:p.map(i=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50 border-b last:border-0 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:i.title}),e.jsx("span",{className:"text-xs text-slate-500 truncate max-w-[300px]",children:i.description})]}),e.jsxs(b,{size:"sm",variant:"ghost",className:"text-blue-600",onClick:()=>D(i.id),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," Link"]})]},i.id))})]}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-900",children:["Linked Risks (",(t==null?void 0:t.length)||0,")"]}),(t==null?void 0:t.length)===0?e.jsx("p",{className:"text-sm text-slate-500 italic",children:"No risks linked yet."}):e.jsx("div",{className:"grid gap-3",children:t==null?void 0:t.map(i=>e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg border bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-4 w-4 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-slate-900",children:i.title}),e.jsx("p",{className:"text-xs text-slate-500",children:i.inherentRiskScore?`Risk Score: ${i.inherentRiskScore}`:"Unscored"})]})]}),e.jsx(b,{size:"icon",variant:"ghost",className:"h-8 w-8 text-slate-400 hover:text-red-600",onClick:()=>l.mutate({linkId:i.linkId}),children:e.jsx(Z,{className:"w-4 h-4"})})]},i.linkId))})]})]})]}):e.jsx("div",{className:"text-center p-8 text-slate-500",children:"Please save the scenario first to link risks."})}function Qe(){const[d,m]=F(),[I,r]=Q("/clients/:clientId/business-continuity/scenarios/:scenarioId"),n=r!=null&&r.clientId?parseInt(r.clientId):0,p=r==null?void 0:r.scenarioId,c=p==="new",t=!c&&p?parseInt(p):null,[f,N]=g.useState(!1),[l,D]=g.useState("general"),[a,i]=g.useState({title:"",description:"",likelihood:"medium",potentialImpact:"",mitigationStrategies:""}),{data:v}=o.clients.get.useQuery({id:n},{enabled:!!n}),{data:u,isLoading:L}=o.businessContinuity.scenarios.list.useQuery({clientId:n},{enabled:!!t&&!!n}),h=u==null?void 0:u.find(s=>s.id===t);g.useEffect(()=>{h&&i({title:h.title,description:h.description,likelihood:h.likelihood||"medium",potentialImpact:h.potentialImpact||"",mitigationStrategies:h.mitigationStrategies||""})},[h]);const P=o.businessContinuity.scenarios.create.useMutation({onSuccess:()=>{x.success("Scenario created successfully"),m(`/clients/${n}/business-continuity/scenarios`)},onError:s=>x.error(`Failed to create: ${s.message}`)}),B=o.businessContinuity.scenarios.update.useMutation({onSuccess:()=>{x.success("Scenario updated successfully"),m(`/clients/${n}/business-continuity/scenarios`)},onError:s=>x.error(`Failed to update: ${s.message}`)}),z=async()=>{if(!a.title||!a.description){x.error("Title and Description are required");return}N(!0);try{t?await B.mutateAsync({id:t,...a}):await P.mutateAsync({clientId:n,...a})}catch(s){console.error(s)}finally{N(!1)}};return L&&!c?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(M,{className:"animate-spin"})}):e.jsx(J,{children:e.jsxs("div",{className:"w-full max-w-none py-8 px-6 pb-20",children:[e.jsx("div",{className:"mb-6",children:e.jsx(K,{items:[{label:"Clients",href:"/clients"},{label:(v==null?void 0:v.name)||"Client",href:`/clients/${n}`},{label:"Business Continuity",href:`/clients/${n}/business-continuity`},{label:"Scenarios",href:`/clients/${n}/business-continuity/scenarios`},{label:c?"New Scenario":a.title||"Edit Scenario"}]})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>m(`/clients/${n}/business-continuity/scenarios`),children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-[#1C4D8D]"}),c?"Define New Scenario":"Edit Scenario"]}),e.jsx("p",{className:"text-muted-foreground",children:c?"Describe a potential disruptive event":`Managing scenario: ${a.title}`})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>m(`/clients/${n}/business-continuity/scenarios`),children:"Cancel"}),e.jsxs(b,{onClick:z,disabled:f,className:"bg-[#1C4D8D] hover:bg-[#1C4D8D]/90",children:[f&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(X,{className:"w-4 h-4 mr-2"}),c?"Create Scenario":"Save Changes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 space-y-1",children:e.jsx("nav",{className:"flex flex-col space-y-1 sticky top-8",children:[{id:"general",label:"General Info",icon:_,desc:"Basic Info"},{id:"impact",label:"Impact Analysis",icon:T,desc:"Consequences"},{id:"mitigation",label:"Mitigation Strategies",icon:T,desc:"Controls & Plans"},{id:"risks",label:"Risk Integration",icon:A,desc:"Linked Risk Register"}].map(s=>e.jsxs("button",{onClick:()=>D(s.id),className:`group flex items-center gap-3 w-full text-left px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 ${l===s.id?"bg-[#1C4D8D] text-white shadow-md ring-1 ring-[#1C4D8D]":"text-slate-600 hover:bg-slate-100 hover:text-slate-900 bg-transparent"}`,children:[e.jsx("div",{className:`p-2 rounded-md transition-colors ${l===s.id?"bg-white/20":"bg-slate-100 group-hover:bg-white border border-slate-200 group-hover:border-slate-300"}`,children:e.jsx(s.icon,{className:`w-4 h-4 ${l===s.id?"text-white":"text-slate-500 group-hover:text-slate-700"}`})}),e.jsxs("div",{children:[e.jsx("span",{className:"block",children:s.label}),e.jsx("span",{className:`text-[10px] font-normal ${l===s.id?"text-blue-100":"text-slate-400 group-hover:text-slate-500"}`,children:s.desc})]}),l===s.id&&e.jsx("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]},s.id))})}),e.jsxs("div",{className:"lg:col-span-3 space-y-8",children:[e.jsx("div",{className:l==="general"?"block":"hidden",children:e.jsxs(y,{className:"w-full max-w-none",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Scenario Details"}),e.jsx(w,{children:"Core information about the disruptive event."})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{children:["Scenario Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(E,{value:a.title,onChange:s=>i({...a,title:s.target.value}),placeholder:"e.g. Data Center Power Failure"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Likelihood"}),e.jsxs(q,{value:a.likelihood,onValueChange:s=>i({...a,likelihood:s}),children:[e.jsx(H,{children:e.jsx(G,{})}),e.jsxs(V,{children:[e.jsx(R,{value:"low",children:"Low"}),e.jsx(R,{value:"medium",children:"Medium"}),e.jsx(R,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{value:a.description,onChange:s=>i({...a,description:s.target.value}),placeholder:"Detailed description of the event trigger, scope, and immediate effects...",className:"min-h-[150px]"})]})]})]})}),e.jsx("div",{className:l==="impact"?"block":"hidden",children:e.jsxs(y,{className:"w-full max-w-none",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Impact Analysis"}),e.jsx(w,{children:"Analyze the potential consequences of this scenario."})]}),e.jsx(k,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Potential Business Impact"}),e.jsx($,{value:a.potentialImpact,onChange:s=>i({...a,potentialImpact:s.target.value}),placeholder:"Operational, Financial, Reputational, and Legal impacts...",className:"min-h-[200px]"})]})})]})}),e.jsx("div",{className:l==="mitigation"?"block":"hidden",children:e.jsxs(y,{className:"w-full max-w-none",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Mitigation Strategies"}),e.jsx(w,{children:"Controls and plans to reduce likelihood or impact."})]}),e.jsx(k,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Mitigation Strategies"}),e.jsx($,{value:a.mitigationStrategies,onChange:s=>i({...a,mitigationStrategies:s.target.value}),placeholder:"Preventative controls, recovery strategies, and response plans...",className:"min-h-[200px]"})]})})]})}),e.jsx("div",{className:l==="risks"?"block":"hidden",children:e.jsx(ee,{scenarioId:t,clientId:n})})]})]})]})})}export{Qe as default};
