import{r as m,t as N,i as w,j as e,x as De,c as d,ab as Ie,b as Ae,L as g,I as Z,E as D,G as I,H as A,J as E,K as o,a4 as Ee,A as me,k as ee,N as Fe,V as ze,P as Te,W as $,S as xe,z as Oe,C as Me,m as Pe}from"./index-DOc7Nwb7.js";import{D as Ue}from"./DashboardLayout-aHnUqq57.js";import{E as K}from"./enhanced-dialog-CeRPsI16.js";import{T as Le}from"./textarea-BtxBxzdY.js";import Re from"./EvidenceFileUpload-BXLp96ZN.js";import{C as Ve}from"./circle-check-big-BSqJVrgh.js";import{C as Be}from"./circle-x-DxtMpzS7.js";import{S as he}from"./sparkles-CoQ80pK2.js";import{A as $e,a as Ge,b as qe,c as Qe}from"./accordion-BvRtf4FI.js";import{A as Ke,a as _e,b as Je,c as Xe,d as He,e as We,f as Ye,g as Ze}from"./alert-dialog-V7xGXdVc.js";import{A as es}from"./arrow-left-CpuUojG-.js";import{D as ss}from"./download-ByfWg1Mi.js";import{B as ts}from"./book-open-BffBrdze.js";import{U as as}from"./upload-BBmUECj8.js";import{P as ue}from"./paperclip-CVvoCde1.js";import{P as pe}from"./plus-BaQ35Jcx.js";import{S as ls}from"./search-CwuIBBPE.js";import{T as ns}from"./trash-2-CFEfisbM.js";import{U as rs}from"./user-CqRnJLgW.js";import{I as is}from"./info-By5wLOUH.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";function cs({evidenceId:_,controlName:u,controlDescription:O}){const[J,y]=m.useState(!1),[b,M]=m.useState(null),[C,F]=m.useState(""),k=N.evidence.analyze.useMutation({onSuccess:j=>{M(j.analysis),F(`${j.provider}/${j.model}`)},onError:j=>{w.error(j.message||"Analysis failed")}}),z=()=>{M(null),k.mutate({evidenceId:_,controlName:u,controlDescription:O})};return e.jsx(K,{open:J,onOpenChange:y,trigger:e.jsxs(d,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"AI Analyze"]}),title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-primary"}),"AI Evidence Analysis"]}),description:"Use AI to assess if this evidence meets the control requirements.",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Checking against Control:"}),e.jsx("p",{className:"text-muted-foreground",children:O})]}),b?e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${b.isCompliant?"bg-green-50 border-green-200 dark:bg-green-900/20":"bg-red-50 border-red-200 dark:bg-red-900/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b.isCompliant?e.jsx(Ve,{className:"h-5 w-5 text-green-600"}):e.jsx(Be,{className:"h-5 w-5 text-red-600"}),e.jsx("h4",{className:`font-semibold ${b.isCompliant?"text-green-800 dark:text-green-300":"text-red-800 dark:text-red-300"}`,children:b.isCompliant?"Complaint Evidence":"Non-Compliant Evidence"})]}),e.jsx("p",{className:"text-sm opacity-90",children:b.reasoning})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Detailed Findings"}),e.jsx("ul",{className:"space-y-2",children:b.keyFindings.map((j,G)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-primary mt-1.5 shrink-0"}),j]},G))})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>M(null),children:"Reset Analysis"})})]}):e.jsx("div",{className:"py-8 text-center space-y-4",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analyzing document content..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will extract text from the file and compare it against the control description to determine compliance."}),e.jsx(d,{onClick:z,className:"w-full",children:"Start Analysis"})]})})]})})}function at(){var ce,oe;const{id:_}=Ie(),u=parseInt(_||"0"),[,O]=Ae(),[J,y]=m.useState(!1),[b,M]=m.useState(null),[C,F]=m.useState(null),[k,z]=m.useState(""),[j,G]=m.useState(""),[ge,se]=m.useState("R"),[q,Q]=m.useState([]),[te,ae]=m.useState(!1),[P,X]=m.useState(null),[U,le]=m.useState(""),[T,ne]=m.useState("all"),[os,ds]=m.useState("all"),[L,re]=m.useState("all"),{data:H}=N.clients.get.useQuery({id:u},{enabled:u>0}),{data:f,isLoading:je,refetch:W}=N.evidence.list.useQuery({clientId:u},{enabled:u>0}),{data:v}=N.clientControls.list.useQuery({clientId:u},{enabled:u>0}),{data:R}=N.employees.list.useQuery({clientId:u},{enabled:u>0}),{data:V}=N.compliance.frameworkMappings.list.useQuery({},{enabled:u>0}),Y=N.evidence.create.useMutation(),fe=N.evidenceFiles.create.useMutation();N.evidence.update.useMutation({onSuccess:()=>{w.success("Evidence updated"),M(null),W()},onError:s=>w.error(s.message)});const ve=N.evidence.delete.useMutation({onSuccess:()=>{w.success("Evidence removed"),X(null),W()},onError:s=>w.error(s.message)}),ie=m.useMemo(()=>{if(console.log("[DEBUG] groupedData memo recalculating. Dependencies:",{clientControls:!!v,evidenceList:!!f,frameworkMappings:!!V,searchQuery:U,statusFilter:T,frameworkFilter:L}),!v||!f)return console.log("[DEBUG] evidenceList or clientControls missing, skipping memo logic"),[];try{const s=new Map;V&&(console.log("[DEBUG] Building mapping graph from",V.length,"mappings"),V.forEach(a=>{const t=a.sourceControlId,c=a.targetControlId;s.has(t)||s.set(t,new Set),s.has(c)||s.set(c,new Set),s.get(t).add(c),s.get(c).add(t)}));const n=a=>{const t=new Set([a]),c=[a],h=new Set([a]);for(;c.length>0;){const x=c.shift(),i=s.get(x);if(i)for(const p of i)h.has(p)||(h.add(p),t.add(p),c.push(p))}return t};let l=v.map(a=>{var x;const t=(x=a.control)==null?void 0:x.id;if(!t)return{...a,evidence:[]};const c=n(t),h=f.filter(i=>{var S;const p=(S=i.control)==null?void 0:S.id;return p&&c.has(p)}).map(i=>{var p,S,B;return{evidence:i,isInherited:((p=i.control)==null?void 0:p.id)!==t,sourceFramework:(S=i.control)==null?void 0:S.framework,sourceControlId:(B=i.control)==null?void 0:B.controlId}});return{...a,evidence:h}});if(console.log("[DEBUG] Filtered controls count:",l.length),U){const a=U.toLowerCase();l=l.filter(t=>{var c,h,x,i,p;return((h=(c=t.control)==null?void 0:c.name)==null?void 0:h.toLowerCase().includes(a))||((x=t.clientControl.clientControlId)==null?void 0:x.toLowerCase().includes(a))||((p=(i=t.control)==null?void 0:i.description)==null?void 0:p.toLowerCase().includes(a))})}T!=="all"&&(l=l.filter(a=>T==="need_documents"?a.evidence.length===0:T==="ok"?a.evidence.some(t=>t.evidence.status==="verified"):!0)),L!=="all"&&(l=l.filter(a=>{var t;return((t=a.control)==null?void 0:t.framework)===L}));const r={};return l.forEach(a=>{var h,x;const t=((h=a.control)==null?void 0:h.category)||"Other",c=((x=a.control)==null?void 0:x.grouping)||"General";r[t]||(r[t]={name:t,subgroups:{},totalItems:0,okItems:0}),r[t].subgroups[c]||(r[t].subgroups[c]={name:c,items:[]}),r[t].subgroups[c].items.push(a),r[t].totalItems++,a.evidence.some(i=>i.evidence.status==="verified")&&r[t].okItems++}),Object.values(r).sort((a,t)=>a.name.localeCompare(t.name))}catch(s){return console.error("[DEBUG] Error in groupedData memo:",s),[]}},[v,f,V,U,T,L]),Ne=m.useMemo(()=>v?Array.from(new Set(v.map(s=>{var n;return(n=s.control)==null?void 0:n.framework}).filter(Boolean))):[],[v]),be=()=>{if(!f||f.length===0)return"EVD-001";const s=Math.max(...f.map(n=>{var r;const l=(r=n.evidenceId)==null?void 0:r.match(/EVD-(\d+)/);return l?parseInt(l[1]):0}));return`EVD-${String(s+1).padStart(3,"0")}`},we=async s=>{if(s.preventDefault(),!k){w.error("Please select a control");return}ae(!0);const n=new FormData(s.currentTarget);let l=j;if(j&&R){const r=R.find(a=>a.id.toString()===j);r&&(l=`${r.firstName} ${r.lastName}`)}try{const r=await Y.mutateAsync({clientId:u,clientControlId:parseInt(k),evidenceId:n.get("evidenceId"),description:n.get("description"),type:n.get("type"),location:n.get("location"),owner:l||n.get("owner"),status:n.get("status")});if(q.length>0&&(r!=null&&r.id))for(const a of q){const t=new FileReader;await new Promise((c,h)=>{t.onload=async()=>{try{const x=t.result.split(",")[1],i=Date.now(),p=Math.random().toString(36).substring(2,8),S=a.name.split(".").pop()||"",B=`evidence-${r.id}-${i}-${p}.${S}`,de=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:B,data:x,contentType:a.type,folder:"evidence"})});if(!de.ok)throw new Error("Upload failed");const{key:ke,url:Se}=await de.json();await fe.mutateAsync({evidenceId:r.id,filename:B,originalFilename:a.name,mimeType:a.type,size:a.size,fileKey:ke,url:Se}),c()}catch(x){h(x)}},t.onerror=()=>h(new Error("File read failed")),t.readAsDataURL(a)})}w.success("Evidence added successfully"),y(!1),Q([]),W()}catch(r){w.error(r.message||"Failed to create evidence")}finally{ae(!1)}},ye=s=>{X(s)},Ce=()=>{P&&ve.mutate({id:P.id})};return e.jsxs(Ue,{children:[e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6 pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>O(`/clients/${u}`),className:"h-8 w-8 p-0",children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"Documents"})]}),e.jsxs("p",{className:"text-slate-500 ml-10",children:[H==null?void 0:H.name," â€¢ Evidence Tracking"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{variant:"outline",size:"sm",className:"hidden sm:flex",children:[e.jsx(ss,{className:"mr-2 h-4 w-4"})," Export all"]}),e.jsxs(d,{variant:"outline",size:"sm",className:"hidden sm:flex",onClick:()=>O(`/clients/${u}/evidence/overview`),children:[e.jsx(ts,{className:"mr-2 h-4 w-4"})," Usage Guide"]}),e.jsx(K,{open:J,onOpenChange:y,trigger:e.jsxs(d,{className:"bg-[#5844ED] hover:bg-[#4736C9] font-semibold",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," Add document"]}),title:"Add Evidence",description:"Track evidence for a control.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{className:"bg-[#5844ED] hover:bg-[#4736C9]",onClick:s=>{const n=document.getElementById("add-evidence-form");n&&n.requestSubmit()},disabled:Y.isPending||te,children:Y.isPending||te?"Adding & Uploading...":"Add Evidence"})]}),size:"lg",children:e.jsx("form",{id:"add-evidence-form",onSubmit:we,onReset:()=>{z(""),G(""),se("R")},children:e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Evidence ID"}),e.jsx(Z,{name:"evidenceId",defaultValue:be()})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Control *"}),e.jsxs(D,{value:k,onValueChange:z,children:[e.jsx(I,{className:k?"":"border-red-500",children:e.jsx(A,{placeholder:"Select control"})}),e.jsx(E,{className:"max-h-[300px]",children:v==null?void 0:v.map(s=>{var n;return e.jsxs(o,{value:s.clientControl.id.toString(),children:[s.clientControl.clientControlId," - ",(n=s.control)==null?void 0:n.name]},s.clientControl.id)})})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Description"}),e.jsx(Le,{name:"description",placeholder:"Describe the evidence...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Type"}),e.jsxs(D,{name:"type",defaultValue:"Document",children:[e.jsx(I,{children:e.jsx(A,{placeholder:"Select type"})}),e.jsxs(E,{children:[e.jsx(o,{value:"Document",children:"Document"}),e.jsx(o,{value:"Screenshot",children:"Screenshot"}),e.jsx(o,{value:"Log",children:"Log"}),e.jsx(o,{value:"Report",children:"Report"}),e.jsx(o,{value:"Configuration",children:"Configuration"}),e.jsx(o,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Status"}),e.jsxs(D,{name:"status",defaultValue:"pending",children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"pending",children:"Pending"}),e.jsx(o,{value:"verified",children:"Verified"}),e.jsx(o,{value:"expired",children:"Expired"}),e.jsx(o,{value:"not_applicable",children:"Not Applicable"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Location"}),e.jsx(Z,{name:"location",placeholder:"URL, file path, or system name..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"Owner"}),e.jsxs(D,{value:j,onValueChange:G,children:[e.jsx(I,{children:e.jsx(A,{placeholder:"Select employee"})}),e.jsx(E,{children:R==null?void 0:R.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{children:"RACI Role"}),e.jsxs(D,{value:ge,onValueChange:se,children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"R",children:"Responsible"}),e.jsx(o,{value:"A",children:"Accountable"}),e.jsx(o,{value:"C",children:"Consulted"}),e.jsx(o,{value:"I",children:"Informed"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(g,{children:"Attachments"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center hover:bg-slate-50 transition-colors cursor-pointer relative border-slate-200",onClick:()=>{var s;return(s=document.getElementById("evidence-file-upload"))==null?void 0:s.click()},onDragOver:s=>s.preventDefault(),onDrop:s=>{s.preventDefault(),s.dataTransfer.files&&Q(n=>[...n,...Array.from(s.dataTransfer.files)])},children:[e.jsx("input",{id:"evidence-file-upload",type:"file",className:"hidden",multiple:!0,onChange:s=>{s.target.files&&Q(n=>[...n,...Array.from(s.target.files)])}}),e.jsx(as,{className:"h-8 w-8 mx-auto text-slate-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Drag & drop files here, or click to select"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Supports PDF, PNG, JPG, DOCX"})]}),q.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:q.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 p-2 rounded-md border border-slate-200 text-sm",children:[e.jsxs("span",{className:"truncate max-w-[200px] flex items-center gap-2",children:[e.jsx(ue,{className:"h-3.5 w-3.5 text-slate-400"}),s.name]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:l=>{l.stopPropagation(),Q(r=>r.filter((a,t)=>t!==n))},children:e.jsx(Ee,{className:"h-3 w-3"})})]},n))})]})]})})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 bg-white p-2 rounded-lg border border-slate-200 shadow-sm overflow-x-auto",children:[e.jsxs("div",{className:"relative w-full max-w-xs min-w-[200px]",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(Z,{placeholder:"Search all documents",className:"pl-9 h-9 border-slate-200 focus:ring-[#5844ED]",value:U,onChange:s=>le(s.target.value)})]}),e.jsx("div",{className:"h-6 w-[1px] bg-slate-200 mx-1 hidden sm:block"}),e.jsx("span",{className:"text-sm font-medium text-slate-500 whitespace-nowrap",children:"Filter by"}),e.jsxs(D,{value:T,onValueChange:ne,children:[e.jsxs(I,{className:"h-9 w-fit gap-2 border-slate-200 font-medium",children:[e.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Status:"}),e.jsx(A,{placeholder:"All"})]}),e.jsxs(E,{children:[e.jsx(o,{value:"all",children:"All"}),e.jsx(o,{value:"need_documents",children:"Need documents"}),e.jsx(o,{value:"ok",children:"OK"})]})]}),e.jsxs(D,{value:L,onValueChange:re,children:[e.jsxs(I,{className:"h-9 w-fit gap-2 border-slate-200 font-medium",children:[e.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Framework:"}),e.jsx(A,{placeholder:"All"})]}),e.jsxs(E,{children:[e.jsx(o,{value:"all",children:"All Frameworks"}),Ne.map(s=>e.jsx(o,{value:s,children:s},s))]})]}),e.jsx(d,{variant:"outline",size:"sm",className:"h-9 text-slate-600 border-slate-200",children:"Category"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-9 text-slate-600 border-slate-200",children:"Frequency"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-9 text-slate-600 border-slate-200",children:"Priority"}),e.jsx(d,{variant:"outline",size:"sm",className:"h-9 text-slate-600 border-slate-200",children:"Owner"})]}),je?e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{className:"h-40 w-full rounded-xl"}),e.jsx(me,{className:"h-40 w-full rounded-xl"})]}):ie.length>0?e.jsx("div",{className:"space-y-8",children:ie.map(s=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-slate-500 bg-white px-3 py-1 rounded-full border border-slate-200",children:[e.jsx("div",{className:`h-2.5 w-2.5 rounded-full border ${s.okItems===s.totalItems?"bg-green-500 border-green-200":"bg-amber-400 border-amber-200"}`}),s.okItems," / ",s.totalItems," OK"]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:e.jsx($e,{type:"multiple",defaultValue:Object.keys(s.subgroups),className:"divide-y divide-slate-100",children:Object.values(s.subgroups).map(n=>e.jsxs(Ge,{value:n.name,className:"border-none",children:[e.jsx(qe,{className:"px-6 py-4 hover:no-underline hover:bg-slate-50 transition-colors group",children:e.jsxs("div",{className:"flex items-center justify-between w-full pr-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-slate-300 group-data-[state=open]:bg-[#5844ED]"}),e.jsx("span",{className:"font-semibold text-slate-700",children:n.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.items.some(l=>l.evidence.length===0)&&e.jsxs(ee,{variant:"secondary",className:"bg-slate-100 text-slate-600 font-medium px-2 py-0 h-6 border-slate-200 border",children:[n.items.filter(l=>l.evidence.length===0).length," Need documents"]}),n.items.filter(l=>l.evidence.some(r=>r.evidence.status==="verified")).length>0&&e.jsxs(ee,{className:"bg-green-50 text-green-700 font-medium px-2 py-0 h-6 border-green-200 border shadow-none",children:[n.items.filter(l=>l.evidence.some(r=>r.evidence.status==="verified")).length," OK"]})]})]})}),e.jsx(Qe,{children:e.jsx("div",{className:"border-t border-slate-100 bg-slate-50/30",children:e.jsx(Fe,{children:e.jsx(ze,{children:n.items.map(l=>{var r,a,t,c,h,x;return e.jsxs(Te,{className:"hover:bg-white border-b border-slate-100 last:border-0",children:[e.jsx($,{className:"w-12 text-center text-slate-400 font-mono text-xs",children:l.clientControl.clientControlId}),e.jsxs($,{className:"max-w-[300px]",children:[e.jsx("div",{className:"font-semibold text-slate-800",children:(r=l.control)==null?void 0:r.name}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:(a=l.control)==null?void 0:a.description})]}),e.jsx($,{children:l.evidence.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.evidence.map(i=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded-md border border-slate-200 text-xs shadow-sm group/ev",children:[e.jsx("span",{className:"font-medium text-slate-700",children:i.evidence.evidenceId}),e.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${i.evidence.status==="verified"?"bg-green-500":i.evidence.status==="pending"?"bg-blue-400":i.evidence.status==="expired"?"bg-red-500":"bg-slate-300"}`}),i.isInherited&&e.jsx(ee,{variant:"outline",className:"h-4 px-1 text-[10px] bg-slate-50 text-slate-500 border-slate-200 font-normal",children:"Inherited"}),e.jsxs("div",{className:"flex items-center gap-1 ml-1 opacity-0 group-hover/ev:opacity-100 transition-opacity",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>F(i.evidence.id),children:e.jsx(ue,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-5 w-5 text-red-500",onClick:()=>ye(i.evidence),children:e.jsx(ns,{className:"h-3 w-3"})})]})]}),i.isInherited&&e.jsxs("div",{className:"text-[10px] text-slate-400 ml-1 flex items-center gap-1",children:[e.jsx(xe,{className:"h-2.5 w-2.5"}),"via ",i.sourceFramework," ",i.sourceControlId]})]},i.evidence.id)),e.jsx(d,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full border border-dashed border-slate-300",onClick:()=>{z(l.clientControl.id.toString()),y(!0)},children:e.jsx(pe,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 italic text-sm",children:[e.jsx(Oe,{className:"h-3.5 w-3.5"}),"No evidence provided",e.jsx(d,{variant:"link",size:"sm",className:"h-fit p-0 ml-1 text-[#5844ED] font-semibold",onClick:()=>{z(l.clientControl.id.toString()),y(!0)},children:"Add document"})]})}),e.jsx($,{className:"w-40",children:e.jsxs("div",{className:"flex items-center gap-2 text-slate-600 text-xs",children:[e.jsx(rs,{className:"h-3 w-3 text-slate-400"}),l.clientControl.owner||"Unassigned"]})}),e.jsx($,{className:"w-10",children:e.jsx(K,{open:C===((t=l.evidence[0])==null?void 0:t.evidence.id),onOpenChange:i=>!i&&F(null),trigger:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400",children:e.jsx(is,{className:"h-4 w-4"})}),title:"Control Details",size:"lg",children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Framework"}),e.jsx("div",{className:"font-medium",children:(c=l.control)==null?void 0:c.framework})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Frequency"}),e.jsx("div",{className:"font-medium",children:((h=l.control)==null?void 0:h.frequency)||"Continuous"})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Implementation Guidance"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:((x=l.control)==null?void 0:x.implementationGuidance)||"No guidance available"})]})]})})})]},l.clientControl.id)})})})})})]},n.name))})})]},s.name))}):e.jsx(Me,{className:"py-20 border-dashed border-2",children:e.jsxs(Pe,{className:"text-center",children:[e.jsx("div",{className:"h-20 w-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(xe,{className:"h-10 w-10 text-slate-300"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-slate-500 max-w-sm mx-auto mb-8",children:"Try adjusting your search or filters to find what you're looking for."}),e.jsx(d,{variant:"outline",onClick:()=>{le(""),ne("all"),re("all")},children:"Clear all filters"})]})})]}),C!==null&&e.jsx(K,{open:C!==null,onOpenChange:s=>!s&&F(null),title:"Evidence Files",description:"Manage attachments and view analysis results",size:"lg",footer:e.jsx(d,{onClick:()=>F(null),children:"Close"}),children:e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsx(Re,{evidenceId:C,clientId:u}),e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx(g,{className:"text-sm font-semibold mb-3 block",children:"AI Compliance Analysis"}),e.jsx(cs,{evidenceId:C,controlName:(oe=(ce=f==null?void 0:f.find(s=>s.id===C))==null?void 0:ce.control)==null?void 0:oe.name})]})]})}),e.jsx(Ke,{open:!!P,onOpenChange:s=>!s&&X(null),children:e.jsxs(_e,{children:[e.jsxs(Je,{children:[e.jsx(Xe,{children:"Delete Evidence?"}),e.jsxs(He,{children:["Are you sure you want to delete this evidence? This action cannot be undone.",P&&P.status==="verified"&&e.jsxs("div",{className:"mt-2 p-2 bg-amber-50 rounded text-amber-800 text-sm border border-amber-200",children:["Warning: This evidence is marked as ",e.jsx("b",{children:"Verified"}),". Deleting it may impact compliance status."]})]})]}),e.jsxs(We,{children:[e.jsx(Ye,{children:"Cancel"}),e.jsx(Ze,{className:"bg-red-600 hover:bg-red-700",onClick:s=>{s.preventDefault(),Ce()},children:"Delete Evidence"})]})]})})]})}export{at as default};
