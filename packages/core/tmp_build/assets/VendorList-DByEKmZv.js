import{ab as ue,r as n,t as x,i as a,j as e,c as t,aq as C,I as f,x as R,N as xe,O as he,P as V,Q as m,V as me,W as h,F as pe,C as ge,m as je,h as W,k as ve,l as fe,L as c,E as H,G as U,H as _,J as Q,K as p}from"./index-DOc7Nwb7.js";import{T as be,a as we,b as G,c as J}from"./tabs-CBDTXbEn.js";import{E as I}from"./enhanced-dialog-CeRPsI16.js";import{T as K}from"./textarea-BtxBxzdY.js";import{c as L}from"./utils-BC5CVi_C.js";import{S as Ne}from"./StatusBadge-BTrMKCQr.js";import{A as Se,a as ye,b as Ce,c as Re,d as Ae,e as Te,f as ke,g as Pe}from"./alert-dialog-V7xGXdVc.js";import{P as De}from"./PageGuide-CPKKXXS6.js";import{P as X}from"./plus-BaQ35Jcx.js";import{S as Me}from"./search-CwuIBBPE.js";import{F as Oe}from"./filter-Ceo--4mb.js";import{S as Ve}from"./shield-alert-iAruRy4W.js";import{P as Ie}from"./play-CNfCaKB0.js";import{T as Le}from"./trash-2-CFEfisbM.js";import{A as Fe}from"./arrow-right-M96iV-v9.js";import{U as Ee}from"./user-CqRnJLgW.js";import{f as ze}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function us({mode:d="all"}){const{id:Z}=ue(),r=parseInt(Z||"0"),[A,ee]=n.useState(""),[F,E]=n.useState("active"),se=d==="discovery"?"needs_review":d==="reviews"?"in_progress":void 0,[te,b]=n.useState(!1),[o,w]=n.useState({name:"",description:"",website:"",criticality:"Low",dataAccess:"Internal",category:"SaaS",source:"Manual",status:"Active",reviewStatus:"needs_review"}),[ae,N]=n.useState(!1),[i,g]=n.useState({name:"",website:"",category:"SaaS",description:"",businessOwner:""}),[re,S]=n.useState(!1),[z,$]=n.useState(null),[q,B]=n.useState(""),[j,T]=n.useState(null),{data:k,isLoading:ie,refetch:y}=x.vendors.list.useQuery({clientId:r,reviewStatus:se},{enabled:!!r}),{data:l,refetch:P}=x.vendorRequests.list.useQuery({clientId:r},{enabled:!!r}),D=x.vendors.create.useMutation({onSuccess:()=>{a.success("Vendor added successfully"),b(!1),w({name:"",description:"",website:"",criticality:"Low",dataAccess:"Internal",category:"SaaS",source:"Manual",status:"Active",reviewStatus:"needs_review"}),y()},onError:s=>a.error("Failed to add vendor: "+s.message)}),M=x.vendorRequests.submit.useMutation({onSuccess:()=>{a.success("Request submitted for approval"),N(!1),g({name:"",website:"",category:"SaaS",description:"",businessOwner:""}),P(),E("requests")},onError:s=>a.error("Failed to submit request: "+s.message)}),ne=x.vendorRequests.approve.useMutation({onSuccess:()=>{a.success("Request approved & vendor created"),P(),y()},onError:s=>a.error("Approval failed: "+s.message)}),O=x.vendorRequests.reject.useMutation({onSuccess:()=>{a.success("Request rejected"),S(!1),$(null),B(""),P()},onError:s=>a.error("Rejection failed: "+s.message)});x.vendors.scan.useMutation({onSuccess:s=>{a.success(`Scan complete! Found ${s.count} new vendors.`),y()},onError:s=>a.error("Scan failed: "+s.message)});const le=x.vendors.delete.useMutation({onSuccess:()=>{a.success("Vendor deleted successfully"),T(null),y()},onError:s=>a.error("Failed to delete vendor: "+s.message)}),ce=()=>{if(!o.name)return a.error("Name is required");D.mutate({clientId:r,...o})},de=(s,u)=>{s.preventDefault(),s.stopPropagation(),T(u)},oe=()=>{j&&le.mutate({id:j.id})},v=k==null?void 0:k.filter(s=>{var u;return s.vendor.name.toLowerCase().includes(A.toLowerCase())||((u=s.vendor.description)==null?void 0:u.toLowerCase().includes(A.toLowerCase()))});return e.jsxs("div",{className:"space-y-6 page-transition",children:[e.jsxs("div",{className:"flex justify-between items-start animate-slide-down",children:[e.jsx(De,{...n.useMemo(()=>{switch(d){case"discovery":return{title:"Discovery Hub",description:"Review and classify newly discovered vendors.",rationale:"Identify shadow IT and bring unmanaged vendors under governance.",howToUse:[{step:"Review",description:"Examine detected apps and services."},{step:"Classify",description:"Assign ownership and criticality."},{step:"Onboard",description:"Convert to active vendor inventory."}]};case"reviews":return{title:"Security Reviews",description:"Manage active security assessments.",rationale:"Ensure vendors meet your security standards before onboarding.",howToUse:[{step:"Track",description:"Monitor progress of sent questionnaires."},{step:"Analyze",description:"Review responses and identified gaps."},{step:"Approve",description:"Sign off on vendor security posture."}]};default:return{title:"All Vendors",description:"Complete inventory of third-party vendors.",rationale:"Centralized view of all external relationships.",howToUse:[{step:"Search",description:"Find vendors by name or category."},{step:"Filter",description:"Sort by risk level or status."},{step:"Manage",description:"View details and update attributes."}]}}},[d])}),d==="all"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:"outline",onClick:()=>N(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Request Vendor"]}),e.jsx(C,{href:`/clients/${r}/vendors/onboard`,children:e.jsxs(t,{variant:"default",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Subprocessor Onboarding"]})}),e.jsxs(t,{onClick:()=>b(!0),children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Add Directly"]})]})]}),e.jsxs(be,{value:F,onValueChange:E,className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(we,{children:[e.jsx(G,{value:"active",children:"Active Vendors"}),e.jsxs(G,{value:"requests",className:"relative",children:["Pending Requests",(l==null?void 0:l.filter(s=>s.status==="pending").length)>0&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})]})]}),F==="active"&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(Me,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-slate-500"}),e.jsx(f,{placeholder:"Search vendors...",className:"pl-9 bg-white",value:A,onChange:s=>ee(s.target.value)})]}),e.jsx(t,{variant:"outline",size:"icon",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]}),e.jsx(J,{value:"active",className:"space-y-4",children:ie?e.jsx("div",{className:"flex justify-center p-12",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-indigo-600"})}):e.jsx("div",{className:"rounded-md border bg-white",children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(V,{children:[e.jsx(m,{children:"Name"}),e.jsx(m,{children:"Category"}),e.jsx(m,{children:"Trust Score"}),e.jsx(m,{children:"Risk Level"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Source"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(me,{children:[(v==null?void 0:v.length)===0&&e.jsx(V,{children:e.jsx(h,{colSpan:7,className:"h-24 text-center",children:"No vendors found matching criteria."})}),v==null?void 0:v.map(({vendor:s})=>e.jsxs(V,{className:"hover-lift transition-all cursor-pointer",onClick:()=>window.location.href=`/clients/${r}/vendors/${s.id}`,children:[e.jsx(h,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded bg-indigo-50 flex items-center justify-center text-indigo-600 font-bold text-xs uppercase",children:s.name.substring(0,2)}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(C,{href:`/clients/${r}/vendors/${s.id}`,children:e.jsx("span",{className:"cursor-pointer hover:underline text-indigo-600 font-semibold",children:s.name})}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:s.description||"No description"})]})]})}),e.jsx(h,{children:s.category||"-"}),e.jsx(h,{children:s.trustScore?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:L("w-8 h-8 rounded-full flex items-center justify-center text-[10px] font-bold border shrink-0",s.trustScore>=80?"bg-green-500/10 text-green-600 border-green-500/20":s.trustScore>=50?"bg-amber-500/10 text-amber-600 border-amber-500/20":"bg-red-500/10 text-red-600 border-red-500/20"),children:s.trustScore}),e.jsx("span",{className:"text-xs text-muted-foreground hidden lg:inline",children:"Trust Score"})]}):e.jsx("span",{className:"text-xs text-muted-foreground italic",children:"Pending"})}),e.jsx(h,{children:e.jsx(Ne,{status:s.criticality==="High"?"error":s.criticality==="Medium"?"warning":"success",label:`${s.criticality} Risk`})}),e.jsx(h,{children:e.jsx("div",{className:L("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",s.reviewStatus==="needs_review"?"bg-amber-100 text-amber-800":"bg-slate-100 text-slate-800"),children:s.reviewStatus==="needs_review"?"Review Needed":s.status})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.source==="SSO"?e.jsx(Ve,{className:"w-3.5 h-3.5 text-blue-500"}):e.jsx(pe,{className:"w-3.5 h-3.5"}),s.source||"Manual"]})}),e.jsx(h,{className:"text-right",onClick:u=>u.stopPropagation(),children:e.jsx("div",{className:"flex justify-end gap-2",children:d==="discovery"?e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"ghost",size:"sm",asChild:!0,className:"h-8 text-indigo-600",children:e.jsxs(C,{href:`/clients/${r}/vendors/${s.id}`,children:["Start Review ",e.jsx(Ie,{className:"w-3 h-3 ml-1"})]})}),e.jsx(t,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-red-600 hover:bg-red-50",onClick:u=>de(u,s),children:e.jsx(Le,{className:"h-4 w-4"})})]}):e.jsx(t,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(C,{href:`/clients/${r}/vendors/${s.id}`,children:["Details ",e.jsx(Fe,{className:"w-3 h-3 ml-1"})]})})})})]},s.id))]})]})})}),e.jsx(J,{value:"requests",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[(l==null?void 0:l.length)===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground bg-white rounded-lg border border-dashed",children:[e.jsx(Y,{className:"h-12 w-12 text-slate-300 mb-2"}),e.jsx("h3",{className:"font-semibold text-lg text-slate-700",children:"No Pending Requests"}),e.jsx("p",{className:"text-sm",children:"Employees can request new vendors here."})]}),l==null?void 0:l.map(s=>e.jsx(ge,{className:"bg-white hover:border-indigo-200 transition-colors",children:e.jsxs(je,{className:"p-6 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:L("h-12 w-12 rounded-lg flex items-center justify-center shrink-0",s.status==="pending"?"bg-amber-50 text-amber-600":s.status==="approved"?"bg-green-50 text-green-600":"bg-red-50 text-red-600"),children:e.jsx(W,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx(ve,{variant:"outline",className:s.status==="pending"?"bg-amber-50 text-amber-700 border-amber-200":s.status==="approved"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200",children:s.status})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(Ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"Business Owner:"}),s.businessOwner||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600",children:[e.jsx(W,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider text-slate-400",children:"Category:"}),s.category||"N/A"]}),e.jsx("div",{className:"flex items-center gap-1.5 text-slate-400",children:e.jsxs("span",{className:"text-xs",children:["Requested ",s.createdAt?ze(new Date(s.createdAt),"MMM d, yyyy"):""]})})]}),s.status==="rejected"&&s.rejectionReason&&e.jsxs("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Reason: ",s.rejectionReason]})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50 hover:text-red-700 border-red-200",onClick:()=>{$(s.id),S(!0)},children:"Reject"}),e.jsxs(t,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white",onClick:()=>{confirm(`Approve request for ${s.name}? This will create a new Vendor record.`)&&ne.mutate({id:s.id,clientId:r})},children:[e.jsx(fe,{className:"h-4 w-4 mr-2"})," Approve & Create Vendor"]})]})]})},s.id))]})})]}),e.jsx(I,{open:te,onOpenChange:b,title:"Add New Vendor",description:"Directly add a vendor to the inventory.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(t,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(t,{onClick:ce,disabled:D.isPending,children:[D.isPending&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Vendor"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Vendor Name"}),e.jsx(f,{value:o.name,onChange:s=>w({...o,name:s.target.value}),placeholder:"e.g. Amazon Web Services"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Website"}),e.jsx(f,{value:o.website,onChange:s=>w({...o,website:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Category"}),e.jsxs(H,{value:o.category,onValueChange:s=>w({...o,category:s}),children:[e.jsx(U,{children:e.jsx(_,{})}),e.jsxs(Q,{children:[e.jsx(p,{value:"SaaS",children:"SaaS"}),e.jsx(p,{value:"PaaS",children:"PaaS"}),e.jsx(p,{value:"IaaS",children:"IaaS"}),e.jsx(p,{value:"Service",children:"Service Provider"})]})]})]})]})}),e.jsx(I,{open:ae,onOpenChange:N,title:"Request New Vendor",description:"Submit a vendor for security and legal review.",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(t,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(t,{onClick:()=>{if(!i.name)return a.error("Name is required");M.mutate({clientId:r,...i})},disabled:M.isPending,children:[M.isPending&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Request"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Vendor Name"}),e.jsx(f,{value:i.name,onChange:s=>g({...i,name:s.target.value}),placeholder:"e.g. Slack"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Website / URL"}),e.jsx(f,{value:i.website,onChange:s=>g({...i,website:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Category"}),e.jsxs(H,{value:i.category,onValueChange:s=>g({...i,category:s}),children:[e.jsx(U,{children:e.jsx(_,{})}),e.jsxs(Q,{children:[e.jsx(p,{value:"SaaS",children:"SaaS"}),e.jsx(p,{value:"PaaS",children:"PaaS"}),e.jsx(p,{value:"Review",children:"Service Provider"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Business Owner"}),e.jsx(f,{value:i.businessOwner,onChange:s=>g({...i,businessOwner:s.target.value}),placeholder:"Who owns this relationship?"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Business Justification"}),e.jsx(K,{value:i.description,onChange:s=>g({...i,description:s.target.value}),placeholder:"Why do we need this vendor?"})]})]})}),e.jsx(I,{open:re,onOpenChange:S,title:"Reject Vendor Request",size:"sm",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(t,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsxs(t,{variant:"destructive",onClick:()=>{z&&O.mutate({id:z,reason:q})},disabled:O.isPending,children:[O.isPending&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm Rejection"]})]}),children:e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsx(c,{children:"Reason for Rejection"}),e.jsx(K,{value:q,onChange:s=>B(s.target.value),placeholder:"e.g. Duplicate tool, Security concerns..."})]})}),e.jsx(Se,{open:!!j,onOpenChange:s=>!s&&T(null),children:e.jsxs(ye,{children:[e.jsxs(Ce,{children:[e.jsx(Re,{children:"Delete Vendor?"}),e.jsxs(Ae,{children:["Are you sure you want to delete ",e.jsx("b",{children:j==null?void 0:j.name}),"? This action cannot be undone."]})]}),e.jsxs(Te,{children:[e.jsx(ke,{children:"Cancel"}),e.jsx(Pe,{className:"bg-red-600 hover:bg-red-700",onClick:s=>{s.preventDefault(),oe()},children:"Delete Vendor"})]})]})})]})}function Y({className:d}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:d,children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]})}export{us as default};
