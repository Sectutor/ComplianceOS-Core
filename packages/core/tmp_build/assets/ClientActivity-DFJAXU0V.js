import{au as L,r as m,t as b,j as e,c as d,C as R,d as z,e as P,f as V,E as N,G as g,H as w,J as C,K as i,m as F,x as O,N as U,O as B,P as y,Q as o,V as H,W as n,k as J,aa as Q}from"./index-DOc7Nwb7.js";import{E as _}from"./enhanced-dialog-CeRPsI16.js";import{D as $}from"./DashboardLayout-aHnUqq57.js";import{B as G}from"./Breadcrumb-CRi3LAxS.js";import{R as K}from"./refresh-cw-Cjym1DSW.js";import{D as M}from"./download-ByfWg1Mi.js";import{E as W}from"./eye-CIq9q9s6.js";import{C as q}from"./chevron-left-DZH-lUm7.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function Ve(){const[,x]=L("/clients/:id/activity"),r=parseInt((x==null?void 0:x.id)||"0"),[h,v]=m.useState(1),[f]=m.useState(50),[p,D]=m.useState("all"),[j,E]=m.useState("all"),{data:t,isLoading:u,isError:S,error:A,refetch:k}=b.auditLogs.list.useQuery({page:h,limit:f,clientId:r,action:p==="all"?void 0:p,entityType:j==="all"?void 0:j},{enabled:!!r}),{data:l}=b.clients.get.useQuery({id:r},{enabled:!!r}),T=()=>{if(!t)return;const s="data:text/csv;charset=utf-8,"+["ID,Time,User,Action,Entity Type,Entity ID,Details,Severity,IP"].join(",")+`
`+t.map(a=>[a.id,new Date(a.createdAt||"").toISOString(),a.userEmail||a.userId,a.action,a.entityType,a.entityId,JSON.stringify(a.details).replace(/,/g,";"),a.severity,a.ipAddress||""].join(",")).join(`
`),I=encodeURI(s),c=document.createElement("a");c.setAttribute("href",I),c.setAttribute("download",`client_${r}_activity_${new Date().toISOString()}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)};return e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{items:[{label:"Clients",href:"/clients"},{label:(l==null?void 0:l.name)||"Client",href:`/clients/${r}`},{label:"Activity Log"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Activity Log"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Audit trail for ",l==null?void 0:l.name,"."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>k(),children:[e.jsx(K,{className:"h-4 w-4 mr-2"})," Refresh"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:T,disabled:!t||t.length===0,children:[e.jsx(M,{className:"h-4 w-4 mr-2"})," Export CSV"]})]})]}),e.jsxs(R,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Change History"}),e.jsx(V,{children:"View changes made within this workspace."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-[180px]",children:e.jsxs(N,{value:p,onValueChange:D,children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Filter by Action"})}),e.jsxs(C,{children:[e.jsx(i,{value:"all",children:"All Actions"}),e.jsx(i,{value:"create",children:"Create"}),e.jsx(i,{value:"update",children:"Update"}),e.jsx(i,{value:"delete",children:"Delete"}),e.jsx(i,{value:"publish",children:"Publish"}),e.jsx(i,{value:"restore",children:"Restore"}),e.jsx(i,{value:"login",children:"Login"})]})]})}),e.jsx("div",{className:"w-[180px]",children:e.jsxs(N,{value:j,onValueChange:E,children:[e.jsx(g,{children:e.jsx(w,{placeholder:"Filter by Entity"})}),e.jsxs(C,{children:[e.jsx(i,{value:"all",children:"All Entities"}),e.jsx(i,{value:"policy",children:"Policy"}),e.jsx(i,{value:"control",children:"Control"}),e.jsx(i,{value:"user",children:"People"})]})]})})]})]})}),e.jsxs(F,{children:[u?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):S?e.jsxs("div",{className:"text-center p-8 text-red-500",children:["Error loading logs: ",A.message]}):e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(U,{children:[e.jsx(B,{children:e.jsxs(y,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(o,{className:"text-white font-semibold py-4",children:"Timestamp"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"User"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Action"}),e.jsx(o,{className:"text-white font-semibold py-4",children:"Entity"}),e.jsx(o,{className:"text-right text-white font-semibold py-4",children:"Details"})]})}),e.jsx(H,{children:(t==null?void 0:t.length)===0?e.jsx(y,{children:e.jsx(n,{colSpan:5,className:"text-center h-24 text-gray-500 bg-white",children:"No activity found."})}):t==null?void 0:t.map(s=>e.jsxs(y,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(n,{className:"whitespace-nowrap font-mono text-xs text-gray-500 py-4",children:new Date(s.createdAt||"").toLocaleString()}),e.jsx(n,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm text-black",children:s.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:s.userEmail})]})}),e.jsx(n,{className:"py-4",children:e.jsx(J,{variant:"outline",className:"capitalize bg-white border-gray-300 text-gray-700",children:s.action})}),e.jsx(n,{className:"py-4",children:e.jsxs("span",{className:"capitalize text-sm text-black",children:[s.entityType," ",s.entityId&&e.jsxs("span",{className:"text-gray-500",children:["#",s.entityId]})]})}),e.jsx(n,{className:"text-right py-4",children:e.jsx(_,{title:"Details",trigger:e.jsxs(d,{variant:"ghost",size:"sm",className:"hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"View"]}),size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Action"}),s.action]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Entity"}),s.entityType," #",s.entityId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"User"}),s.userName," (",s.userEmail,")"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Time"}),new Date(s.createdAt||"").toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block mb-2 text-muted-foreground",children:"Raw Data"}),e.jsx("pre",{className:"bg-slate-950 text-slate-50 p-4 rounded-lg overflow-x-auto text-xs font-mono",children:JSON.stringify(JSON.parse(s.details||"{}"),null,2)})]})]})})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>v(s=>Math.max(1,s-1)),disabled:h===1||u,children:[e.jsx(q,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",h]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>v(s=>s+1),disabled:!t||t.length<f||u,children:["Next",e.jsx(Q,{className:"h-4 w-4"})]})]})]})]})]})})}export{Ve as default};
