import{ac as O,b as Q,ab as _,r as i,t as E,i as R,j as e,x as P,c as j,k as g,C as M,d as U,e as V,f as q,m as B,L as a,I as W,E as n,G as l,H as c,J as o,K as t,ay as X,F as Z}from"./index-DOc7Nwb7.js";import{C as F}from"./CyberLayout-B8x_G-rt.js";import{T as H}from"./textarea-BtxBxzdY.js";import{A as ee,a as se,b as te}from"./alert-BudCfM-X.js";import{P as re}from"./PageGuide-CPKKXXS6.js";import{A as ie}from"./arrow-left-CpuUojG-.js";import{S as ae}from"./send-FW7-3cjH.js";import{S as ne}from"./save-CvVmWchr.js";import{C as le}from"./circle-check-C5kiwRoG.js";import{f as z}from"./format-H2tx8_vS.js";import"./DashboardLayout-aHnUqq57.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./utils-BC5CVi_C.js";import"./bar-chart-3-BCngNY6H.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";import"./differenceInCalendarDays-nctqlg7V.js";function es(){const{selectedClientId:d}=O(),[ce,v]=Q(),G=_(),p=parseInt(G.incidentId||"0"),[f,y]=i.useState(""),[h,C]=i.useState(""),[N,b]=i.useState(""),[w,S]=i.useState(""),[A,I]=i.useState("no"),[m,T]=i.useState("open"),[L,D]=i.useState(""),[x,k]=i.useState(!1),{data:s,isLoading:Y,refetch:$}=E.cyber.getIncident.useQuery({clientId:d,incidentId:p},{enabled:!!d&&!!p}),u=E.cyber.updateIncident.useMutation({onSuccess:()=>{R.success("Incident Updated",{description:"The incident report has been saved."}),$()},onError:r=>{R.error("Error",{description:r.message||"Failed to update incident"})}});i.useEffect(()=>{s&&(y(s.title||""),C(s.severity||"low"),b(s.cause||""),S(s.description||""),I(s.crossBorderImpact?"yes":"no"),T(s.status||"open"),D(s.affectedAssets||""),k(s.reportedToAuthorities||!1))},[s]);const J=()=>{d&&u.mutate({clientId:d,incidentId:p,title:f,severity:h,cause:N,description:w,crossBorderImpact:A==="yes",affectedAssets:L,status:m,reportedToAuthorities:x})},K=r=>{switch(r){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-green-100 text-green-800 border-green-200"}};return Y?e.jsx(F,{children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(F,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between animate-slide-down",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>v("/cyber/incidents"),className:"mt-1",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(re,{title:`Incident #${p}`,description:"Manage the lifecycle of this security incident.",rationale:"Detailed record-keeping is essential for post-incident analysis and reporting.",howToUse:[{step:"Update",description:"Log new findings and status changes."},{step:"Mitigate",description:"Record mitigation actions taken."},{step:"Close",description:"Ensure all reporting obligations are met before closing."}]})]}),e.jsx(g,{className:`text-sm px-3 py-1 ${K(h)}`,children:h.toUpperCase()})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),e.jsx(g,{variant:m==="resolved"?"default":"secondary",className:"capitalize",children:m.replace("_"," ")}),x&&e.jsxs(g,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"})," Reported to CSIRT"]})]}),e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Incident Details"}),e.jsx(q,{children:"Edit and update the incident report. Changes are preserved as evidence."})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Title"}),e.jsx(W,{value:f,onChange:r=>y(r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Severity Level"}),e.jsxs(n,{value:h,onValueChange:C,children:[e.jsx(l,{children:e.jsx(c,{})}),e.jsxs(o,{children:[e.jsx(t,{value:"low",children:"Low - No Service Disruption"}),e.jsx(t,{value:"medium",children:"Medium - Limited Disruption"}),e.jsx(t,{value:"high",children:"High - Significant Disruption"}),e.jsx(t,{value:"critical",children:"Critical - Public Safety Risk"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Current Status"}),e.jsxs(n,{value:m,onValueChange:T,children:[e.jsx(l,{children:e.jsx(c,{})}),e.jsxs(o,{children:[e.jsx(t,{value:"open",children:"Open"}),e.jsx(t,{value:"investigating",children:"Investigating"}),e.jsx(t,{value:"mitigated",children:"Mitigated"}),e.jsx(t,{value:"resolved",children:"Resolved"}),e.jsx(t,{value:"reported",children:"Reported to Authority"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Suspected Cause"}),e.jsxs(n,{value:N,onValueChange:b,children:[e.jsx(l,{children:e.jsx(c,{})}),e.jsxs(o,{children:[e.jsx(t,{value:"malware",children:"Malware / Ransomware"}),e.jsx(t,{value:"phishing",children:"Phishing / Social Engineering"}),e.jsx(t,{value:"dos",children:"DDoS"}),e.jsx(t,{value:"vulnerability",children:"Exploited Vulnerability"}),e.jsx(t,{value:"insider",children:"Insider Threat"}),e.jsx(t,{value:"unknown",children:"Unknown"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Description"}),e.jsx(H,{value:w,onChange:r=>S(r.target.value),placeholder:"Detailed description of the incident...",className:"h-32"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Affected Assets"}),e.jsx(H,{value:L,onChange:r=>D(r.target.value),placeholder:"List of affected systems, servers, or data...",className:"h-20"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Cross-border Impact?"}),e.jsxs(n,{value:A,onValueChange:I,children:[e.jsx(l,{children:e.jsx(c,{})}),e.jsxs(o,{children:[e.jsx(t,{value:"no",children:"No"}),e.jsx(t,{value:"yes",children:"Yes"}),e.jsx(t,{value:"unknown",children:"Unknown"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{children:"Reported to Authorities?"}),e.jsxs(n,{value:x?"yes":"no",onValueChange:r=>k(r==="yes"),children:[e.jsx(l,{children:e.jsx(c,{})}),e.jsxs(o,{children:[e.jsx(t,{value:"no",children:"No"}),e.jsx(t,{value:"yes",children:"Yes"})]})]})]})]})]}),e.jsxs(X,{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",onClick:()=>v("/cyber/incidents"),children:"Cancel"}),e.jsxs(j,{onClick:J,disabled:u.isLoading,children:[u.isLoading?e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]}),e.jsxs(M,{children:[e.jsx(U,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Evidence & Audit Trail"]})}),e.jsxs(B,{children:[e.jsxs(ee,{children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(se,{children:"Evidentiary Record"}),e.jsx(te,{children:"All changes to this incident are automatically logged with timestamps. This record can be exported for management reporting or regulatory submissions."})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",(s==null?void 0:s.createdAt)&&z(new Date(s.createdAt),"PPpp")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Modified:"})," ",(s==null?void 0:s.updatedAt)&&z(new Date(s.updatedAt),"PPpp")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reporter:"})," ",(s==null?void 0:s.reporterName)||"Unknown"]})]})]})]})]})})}export{es as default};
