import{ab as Q,b as U,u as G,r as w,t as u,j as e,c as y,T as J,I as q,S as K,z as V,i as N}from"./index-DOc7Nwb7.js";import{D as k}from"./DashboardLayout-aHnUqq57.js";import{R as W}from"./RiskHeatmap-OsHQJKEg.js";import{B as _}from"./Breadcrumb-CRi3LAxS.js";import{P as X}from"./PageGuide-CPKKXXS6.js";import{A as Y}from"./arrow-left-CpuUojG-.js";import{D as Z}from"./download-ByfWg1Mi.js";import{P as ee}from"./plus-BaQ35Jcx.js";import{C as te}from"./clock-osbacZli.js";import{T as se}from"./trending-down-qhVy-7Im.js";import{C as $}from"./circle-check-C5kiwRoG.js";import{S as re}from"./search-CwuIBBPE.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./utils-BC5CVi_C.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function Xe(){const v=Q(),[ie,b]=U(),E=v.id?Number(v.id):null,{user:ae,client:m}=G(),[p,T]=w.useState(""),[l,R]=w.useState(null),C=E||(m==null?void 0:m.id),{data:P,isLoading:H}=u.clients.get.useQuery({id:C||0},{enabled:!!C&&!m}),n=m||P,a=(n==null?void 0:n.id)||0,{data:f,isLoading:M,refetch:le}=u.risks.getRiskAssessments.useQuery({clientId:a},{enabled:!!a}),O=u.risks.exportReport.useMutation(),{data:A}=u.businessContinuity.processes.list.useQuery({clientId:a},{enabled:!!a}),{data:r,isLoading:g}=u.risks.getKRIStats.useQuery({clientId:a},{enabled:!!a}),D=t=>!t||!A?"-":(Array.isArray(t)?t:typeof t=="string"?JSON.parse(t):[]).map(i=>{var d;return(d=A.find(c=>c.id===i))==null?void 0:d.name}).filter(Boolean).join(", ")||"-",j=t=>{if(!t)return 0;const s=t.toString().toLowerCase().trim(),i=parseInt(s.charAt(0));return!isNaN(i)&&i>=1&&i<=5?i:s==="1"||s.includes("very low")||s.includes("rare")||s.includes("insignificant")||s.includes("negligible")?1:s==="2"||s.includes("low")||s.includes("unlikely")||s.includes("minor")?2:s==="3"||s.includes("medium")||s.includes("possible")||s.includes("moderate")?3:s==="5"||s.includes("very high")||s.includes("almost certain")||s.includes("critical")||s.includes("extreme")||s.includes("catastrophic")?5:s==="4"||s.includes("high")||s.includes("likely")||s.includes("major")?4:0},S=t=>{if(!t||t==="-")return"-";const s=j(t);return s===0||/^\d/.test(t)?t:`${s} - ${t}`},o=f==null?void 0:f.filter(t=>{var i,d,c;if(!(t.assessmentId.toLowerCase().includes(p.toLowerCase())||((i=t.title)==null?void 0:i.toLowerCase().includes(p.toLowerCase()))||((d=t.threatDescription)==null?void 0:d.toLowerCase().includes(p.toLowerCase()))||((c=t.assessmentDate)==null?void 0:c.toString().includes(p))))return!1;if(l){const h=j(t.likelihood),x=j(t.impact);if(h.toString()!==l.likelihood||x.toString()!==l.impact)return!1}return!0}),z=()=>{b(`/clients/${a}/risks/assessments/new`)},L=t=>{b(`/clients/${a}/risks/assessments/${t.id}`)},[B,I]=w.useState(!1),F=async()=>{try{I(!0),N.info("Generating report...",{description:"This may take a few seconds."});const t=await O.mutateAsync({clientId:a});if(!t.base64)throw new Error("Received empty report from server.");const s=atob(t.base64),i=new Array(s.length);for(let x=0;x<s.length;x++)i[x]=s.charCodeAt(x);const d=new Uint8Array(i),c=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),h=document.createElement("a");h.href=window.URL.createObjectURL(c),h.download=t.filename,h.click(),N.success("Export successful",{description:`Report downloaded: ${t.filename}`})}catch(t){console.error("Export failed:",t),N.error("Export failed",{description:t.message||"An unexpected error occurred."})}finally{I(!1)}};return H?e.jsx(k,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading client data..."})}):n?e.jsx(k,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(_,{items:[{label:"Clients",href:"/clients"},{label:(n==null?void 0:n.name)||"Client",href:`/clients/${a}`},{label:"Risk Management",href:`/clients/${a}/risks`},{label:"Risk Assessments",href:`/clients/${a}/risks/assessments`}]}),e.jsxs(y,{variant:"ghost",size:"sm",className:"mt-2 -ml-3 text-muted-foreground hover:text-foreground",onClick:()=>b(`/clients/${a}/risks`),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Back to Risk Dashboard"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Risk Assessments"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Detailed risk assessments and evaluations."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"outline",onClick:F,disabled:B||!a,className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Export Risk Report"]}),e.jsxs(y,{onClick:z,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"New Assessment"]}),e.jsx(X,{title:"Risk Assessments",description:"Evaluate, score, and treat organizational risks.",rationale:"Systematic risk assessments provide the data needed to make informed security investment decisions.",howToUse:[{step:"Identify Risks",description:"Create new assessments for specific threat scenarios."},{step:"Analyze Heatmap",description:"Use the Risk Heatmap to focus on High Impact/High Likelihood risks."},{step:"Monitor Treatments",description:"Ensure all critical risks have documented treatment plans."}],integrations:[{name:"Controls Library",description:"Apply controls to reduce Inherent Risk to an acceptable Residual Risk level."},{name:"Gap Analysis",description:"Identify missing controls directly from the assessment workflow."}]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[380px]",children:e.jsx(W,{assessments:f||[],activeFilter:l,onFilterChange:R})}),e.jsxs("div",{className:"h-[380px] grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500",children:"Overdue Reviews"}),e.jsx("div",{className:"p-2 bg-red-50 rounded-lg",children:e.jsx(te,{className:"w-5 h-5 text-red-600"})})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mt-2",children:g?"-":(r==null?void 0:r.overdueReviews)||0})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 text-xs font-medium text-red-600 bg-red-50 w-fit px-2 py-1 rounded-full",children:e.jsx("span",{children:"Action Required"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500",children:"Unmitigated Critical"}),e.jsx("div",{className:"p-2 bg-amber-50 rounded-lg",children:e.jsx(J,{className:"w-5 h-5 text-amber-600"})})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mt-2",children:g?"-":(r==null?void 0:r.unmitigatedCriticalRisks)||0})]}),e.jsx("div",{className:`flex items-center gap-2 mt-4 text-xs font-medium w-fit px-2 py-1 rounded-full ${Number((r==null?void 0:r.unmitigatedCriticalRisks)||0)>0?"text-amber-700 bg-amber-50":"text-green-700 bg-green-50"}`,children:e.jsx("span",{children:Number((r==null?void 0:r.unmitigatedCriticalRisks)||0)>0?"Needs Treatment":"All Mitigated"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500",children:"Mitigation Efficiency"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-blue-600"})})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mt-2",children:g?"-":`${(r==null?void 0:r.mitigationEfficiency)||0}%`})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2 line-clamp-2",children:"Risks effectively reduced by controls"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between hover:shadow-md transition-shadow",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-500",children:"Implementation Rate"}),e.jsx("div",{className:"p-2 bg-emerald-50 rounded-lg",children:e.jsx($,{className:"w-5 h-5 text-emerald-600"})})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mt-2",children:g?"-":`${(r==null?void 0:r.controlImplementationRate)||0}%`})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-1.5 mt-4",children:e.jsx("div",{className:"bg-emerald-500 h-1.5 rounded-full transition-all duration-500",style:{width:`${(r==null?void 0:r.controlImplementationRate)||0}%`}})})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-card p-4 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(q,{placeholder:"Search assessments...",value:p,onChange:t=>T(t.target.value),className:"pl-9"})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm",children:[e.jsxs("span",{children:["Filter: Likelihood ",l.likelihood,", Impact ",l.impact]}),e.jsx("button",{onClick:()=>R(null),className:"hover:text-blue-900 font-bold ml-1",children:"Ã—"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg overflow-hidden min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#1C4D8D]",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Threat Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Likelihood"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Impact"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Inherent Risk"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Residual Risk"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Affected Assets"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Processes"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Treatments"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Risk Owner"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Next Review"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:14,className:"p-8 text-center text-gray-500 bg-white",children:"Loading assessments..."})}):(o==null?void 0:o.length)===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:14,className:"p-12 text-center bg-white",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Assessments Found"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Start by creating a new risk assessment."})]})}):o==null?void 0:o.map(t=>{var s,i;return e.jsxs("tr",{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm cursor-pointer group",onDoubleClick:()=>L(t),onClick:()=>L(t),children:[e.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-500",children:t.assessmentId}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-black",children:t.title||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.assessmentDate?new Date(t.assessmentDate).toLocaleDateString():"-"}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm max-w-[250px] truncate text-gray-600",title:t.threatDescription||"",children:t.threatDescription}),e.jsx("div",{className:"text-xs text-gray-400 max-w-[250px] truncate",title:t.vulnerabilityDescription||"",children:t.vulnerabilityDescription})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:S(t.likelihood)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:S(t.impact)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${t.inherentRisk==="High"?"bg-red-50 text-red-700 border-red-200":t.inherentRisk==="Medium"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-green-50 text-green-700 border-green-200"}`,children:t.inherentRisk||"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${t.residualRisk==="High"?"bg-red-50 text-red-700 border-red-200":t.residualRisk==="Medium"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-green-50 text-green-700 border-green-200"}`,children:t.residualRisk||"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 max-w-[200px] truncate",title:typeof t.affectedAssets=="string"?JSON.parse(t.affectedAssets).join(", "):(s=t.affectedAssets)==null?void 0:s.join(", "),children:typeof t.affectedAssets=="string"?JSON.parse(t.affectedAssets).join(", "):((i=t.affectedAssets)==null?void 0:i.join(", "))||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 max-w-[200px] truncate",title:D(t.affectedProcessIds),children:D(t.affectedProcessIds)}),e.jsx("td",{className:"px-6 py-4",children:t.treatmentCount>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200",children:[t.treatmentCount," ",t.treatmentCount===1?"treatment":"treatments"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[(t.priority==="Critical"||t.priority==="High")&&e.jsx(V,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500 border border-gray-200",children:"No treatments"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize border ${t.status==="approved"?"bg-green-50 text-green-700 border-green-200":t.status==="reviewed"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 text-center",children:t.riskOwner||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.nextReviewDate?new Date(t.nextReviewDate).toLocaleDateString():"-"})]},t.id)})})]})})})]})}):e.jsx(k,{children:e.jsx("div",{className:"p-8 text-center text-destructive",children:"Client not found."})})}export{Xe as default};
