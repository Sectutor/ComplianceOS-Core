import{r as l,t as S,i as N,R as re,j as e,S as ne,I as De,E as le,G as oe,H as ce,J as de,K as y,an as Ie,a3 as Le,k as $,c as v,Z as Me,_ as Te,$ as Oe,a1 as G,l as Ee,T as me,x as He,ab as Pe,b as ze,aq as X,aa as xe,F as Ue}from"./index-DOc7Nwb7.js";import{D as he}from"./DashboardLayout-aHnUqq57.js";import{E as Ne}from"./enhanced-dialog-CeRPsI16.js";import{R as $e}from"./RiskDetailsDialog-AfBJ1Kgz.js";import{S as pe,a as ue}from"./slotNames-XB2IFQPg.js";import{A as Ve,a as Be,b as _e,c as Fe,d as Ge,e as We,f as Qe,g as Ke}from"./alert-dialog-V7xGXdVc.js";import{S as Je}from"./search-CwuIBBPE.js";import{E as qe}from"./eye-CIq9q9s6.js";import{E as Ze}from"./ellipsis-BXWwt8ER.js";import{P as Xe}from"./pencil-Bud7U1sU.js";import{H as Ye}from"./hammer-BQtgYNwo.js";import{T as es}from"./trash-2-CFEfisbM.js";import{W as ee}from"./wand-sparkles-BtekNLFr.js";import{C as ss}from"./circle-check-C5kiwRoG.js";import{A as ge}from"./arrow-up-down-BDk2lJRe.js";import{S as ts}from"./sparkles-CoQ80pK2.js";import{S as as}from"./save-CvVmWchr.js";import{A as is,a as rs}from"./arrow-up-B1n-fuue.js";import{R as je}from"./RiskHeatmap-OsHQJKEg.js";import{H as ns,R as ls}from"./RiskAssessmentWizard-CMmEYHgh.js";import{B as os,a as cs,b as Y,c as fe,d as we,e as ds}from"./breadcrumb-BTf0geTn.js";import{u as ms}from"./usePageHelp-TOp0nY4e.js";import{P as xs}from"./PageGuide-CPKKXXS6.js";import{C as hs}from"./chevron-left-DZH-lUm7.js";import{R as ps}from"./refresh-ccw-BMEkkcOe.js";import{P as us}from"./plus-BaQ35Jcx.js";import{M as gs}from"./index-utl_XIpZ.js";import{D as js}from"./download-ByfWg1Mi.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./utils-BC5CVi_C.js";import"./radio-group-BhirXgcC.js";import"./textarea-BtxBxzdY.js";import"./riskCalculations-D9ghekGI.js";import"./circle-check-big-BSqJVrgh.js";import"./layers-ZuBPQb1T.js";import"./building-C0cheRWa.js";import"./info-By5wLOUH.js";import"./arrow-right-M96iV-v9.js";import"./separator-BWuYil37.js";const O=u=>{if(!u)return 0;const n=u.toString().toLowerCase().trim();let r=parseInt(n.charAt(0));return isNaN(r)&&(n.includes("critical")||n.includes("extreme")||n.includes("catastrophic")?r=5:n.includes("very high")||n.includes("almost certain")?r=4:n.includes("high")||n.includes("likely")||n.includes("major")?r=3:n.includes("medium")||n.includes("moderate")||n.includes("possible")?r=2:(n.includes("low")||n.includes("unlikely")||n.includes("minor")||n.includes("rare")||n.includes("insignificant"))&&(r=1)),r>=1&&r<=5?r:0};function fs({clientId:u,onEditRisk:n,heatmapFilter:r}){const[c,W]=l.useState(""),[b,Q]=l.useState("all"),[C,K]=l.useState("all"),[D,E]=l.useState("all"),[M,H]=l.useState(null),[g,I]=l.useState(null),[T,V]=l.useState(new Set),[t,P]=l.useState(null),[R,z]=l.useState(null),[f,J]=l.useState(null),[d,L]=l.useState("asc"),{data:j,isLoading:B}=S.risks.getRiskAssessments.useQuery({clientId:u},{enabled:!!u}),_=S.useUtils(),be=S.actions.create.useMutation(),[q,ye]=l.useState(new Set),ve=S.risks.delete.useMutation({onSuccess:()=>{_.risks.getRiskAssessments.invalidate(),N.success("Risk assessment deleted successfully")},onError:s=>{N.error(`Failed to delete risk: ${s.message}`)}}),Z=S.risks.upsert.useMutation({onSuccess:()=>{_.risks.getRiskAssessments.invalidate(),N.success("Risk updated successfully with AI insights"),P(null),z(null)}});re.useEffect(()=>{const a=new URLSearchParams(window.location.search).get("openRiskId");if(a&&j){const w=j.find(o=>o.id===parseInt(a));w&&H(w)}},[j]);const Re=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return[s]}return s||[]},ke=s=>{f===s?L(d==="asc"?"desc":"asc"):(J(s),L("asc"))},se={"Very High":5,High:4,Medium:3,Low:2,"Very Low":1},te={Critical:4,High:3,Medium:2,Low:1},ae={draft:1,reviewed:2,approved:3,closed:4},U=l.useMemo(()=>{let s=(j==null?void 0:j.filter(a=>{var h,x,p;const w=((h=a.assessmentId)==null?void 0:h.toLowerCase().includes(c.toLowerCase()))||((x=a.threatDescription)==null?void 0:x.toLowerCase().includes(c.toLowerCase()))||((p=a.riskOwner)==null?void 0:p.toLowerCase().includes(c.toLowerCase())),o=b==="all"||a.status===b,m=C==="all"||a.priority===C,F=D==="all"||a.inherentRisk===D||a.residualRisk===D;let i=!0;if(r!=null&&r.likelihood&&(r!=null&&r.impact)){const A=parseInt(r.likelihood),Ce=parseInt(r.impact);if(r.type==="residual")i=O(a.residualRisk)===A;else{const ie=O(a.likelihood),Ae=O(a.impact);i=ie===A&&Ae===Ce}}return w&&o&&m&&F&&i}))||[];return f&&(s=[...s].sort((a,w)=>{let o=a[f],m=w[f];return f==="inherentRisk"||f==="residualRisk"?(o=se[o||""]||0,m=se[m||""]||0):f==="priority"?(o=te[o||""]||0,m=te[m||""]||0):f==="status"?(o=ae[o||""]||0,m=ae[m||""]||0):(o=(o==null?void 0:o.toString().toLowerCase())||"",m=(m==null?void 0:m.toString().toLowerCase())||""),o<m?d==="asc"?-1:1:o>m?d==="asc"?1:-1:0})),s},[j,c,b,C,D,f,d,r]),k=({field:s,children:a,className:w=""})=>e.jsx("th",{className:`px-4 py-3 text-xs font-medium text-muted-foreground uppercase tracking-wider cursor-pointer hover:bg-muted/50 select-none transition-colors ${w}`,onClick:()=>ke(s),children:e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[a,f===s?d==="asc"?e.jsx(is,{className:"w-3 h-3"}):e.jsx(rs,{className:"w-3 h-3"}):e.jsx(ge,{className:"w-3 h-3 opacity-40"})]})}),Se=s=>{const a=new Set(T);a.has(s)?a.delete(s):a.add(s),V(a)};return B?e.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-8 text-center",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading Risk Register..."})}):e.jsxs("div",{className:"bg-card rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-slate-950",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-700"}),"Risk Register"]}),e.jsx("p",{className:"text-slate-900 text-sm mt-1 font-medium",children:"Consolidated view of all identified risks and their treatment status"})]}),e.jsx("div",{className:"flex items-center gap-2"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(De,{placeholder:"Search risks...",className:"pl-10",value:c,onChange:s=>W(s.target.value)})]}),e.jsxs(le,{value:b,onValueChange:Q,children:[e.jsx(oe,{className:"w-[140px]",children:e.jsx(ce,{placeholder:"Status"})}),e.jsxs(de,{children:[e.jsx(y,{value:"all",children:"All Status"}),e.jsx(y,{value:"draft",children:"Draft"}),e.jsx(y,{value:"reviewed",children:"Reviewed"}),e.jsx(y,{value:"approved",children:"Approved"}),e.jsx(y,{value:"closed",children:"Closed"})]})]}),e.jsxs(le,{value:D,onValueChange:E,children:[e.jsx(oe,{className:"w-[140px]",children:e.jsx(ce,{placeholder:"Risk Level"})}),e.jsxs(de,{children:[e.jsx(y,{value:"all",children:"All Levels"}),e.jsx(y,{value:"Very High",children:"Very High"}),e.jsx(y,{value:"High",children:"High"}),e.jsx(y,{value:"Medium",children:"Medium"}),e.jsx(y,{value:"Low",children:"Low"})]})]})]})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-2xl overflow-hidden bg-white m-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[1200px] table-fancy",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-none",children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-8"}),e.jsx(k,{field:"assessmentId",className:"text-left text-white",children:"Risk ID"}),e.jsx(k,{field:"threatDescription",className:"text-left max-w-[250px] text-white",children:"Description"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider",children:"Source"}),e.jsx(k,{field:"likelihood",className:"text-center text-white",children:"Likelihood"}),e.jsx(k,{field:"impact",className:"text-center text-white",children:"Impact"}),e.jsx(k,{field:"inherentRisk",className:"text-center text-white",children:"Inherent"}),e.jsx(k,{field:"residualRisk",className:"text-center text-white",children:"Residual"}),e.jsx(k,{field:"treatmentOption",className:"text-left text-white",children:"Treatment"}),e.jsx(k,{field:"riskOwner",className:"text-left text-white",children:"Owner"}),e.jsx(k,{field:"status",className:"text-center text-white",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-center text-xs font-semibold text-white uppercase tracking-wider min-w-[120px]",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:U.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:13,className:"px-4 py-12 text-center bg-white",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-gray-400 opacity-30 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No risks found matching your criteria."})]})}):U.map(s=>{var a,w,o,m,F;return e.jsxs(re.Fragment,{children:[e.jsxs("tr",{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 cursor-pointer group",onDoubleClick:()=>n(s),title:"Double-click to edit",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:()=>Se(s.id),className:"p-1 hover:bg-gray-100 rounded text-gray-500",children:T.has(s.id)?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"font-mono text-sm font-medium text-black",children:s.assessmentId})}),e.jsx("td",{className:"px-4 py-4 max-w-[250px]",children:e.jsx("div",{className:"truncate text-sm text-gray-600",title:((a=s.contextSnapshot)==null?void 0:a.description)||s.description||s.threatDescription||"",children:((w=s.contextSnapshot)==null?void 0:w.description)||s.description||s.threatDescription||"-"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx($,{variant:"secondary",className:"text-xs font-medium bg-blue-50 text-blue-700 border-blue-200",children:((o=s.contextSnapshot)==null?void 0:o.source)||"Manual"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.likelihood||"-"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.impact||"-"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:(()=>{const i=O(s.likelihood),h=O(s.impact),x=i*h;let p="Low",A="bg-gray-100 text-gray-800";return x>=15?(p="Very High",A="bg-red-600 text-white shadow-sm"):x>=8?(p="High",A="bg-orange-500 text-white shadow-sm"):x>=4?(p="Medium",A="bg-yellow-400 text-black shadow-sm"):(p="Low",A="bg-green-400 text-black shadow-sm"),e.jsx($,{className:`${A} border-0 font-semibold px-2.5 py-0.5`,children:p})})()}),e.jsx("td",{className:"px-4 py-4 text-center",children:(()=>{var p;const i=O(s.residualRisk);let h="Low",x="bg-gray-100 text-gray-800";return i>=5?(h="Very High",x="bg-red-600 text-white shadow-sm"):i===4&&(h="High",x="bg-orange-500 text-white shadow-sm"),i>=4?(h="Very High",x="bg-red-600 text-white shadow-sm"):i===3?(h="High",x="bg-orange-500 text-white shadow-sm"):i===2?(h="Medium",x="bg-yellow-400 text-black shadow-sm"):(h="Low",x="bg-green-400 text-black shadow-sm"),e.jsx($,{className:`${x} border-0 font-semibold px-2.5 py-0.5`,children:((p=s.contextSnapshot)==null?void 0:p.residualRisk)||s.residualRisk||h})})()}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm capitalize text-gray-700",children:((m=s.contextSnapshot)==null?void 0:m.treatmentStrategy)||s.treatmentOption||"-"}),s.treatmentCount>0&&e.jsx($,{variant:"secondary",className:"text-xs bg-green-50 text-green-700 border-green-200",children:s.treatmentCount})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:((F=s.contextSnapshot)==null?void 0:F.riskOwner)||s.riskOwner||"-"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx($,{variant:s.status==="approved"?"success":s.status==="reviewed"?"info":s.status==="closed"?"secondary":"default",className:"capitalize text-[10px] font-bold px-2.5",children:s.status||"-"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),H(s)},className:"h-8 w-8 p-0 hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D]",title:"View details",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsxs(Me,{children:[e.jsx(Te,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",onClick:i=>i.stopPropagation(),className:"h-8 w-8 p-0 hover:bg-slate-100",children:e.jsx(Ze,{className:"w-4 h-4"})})}),e.jsxs(Oe,{align:"end",className:"w-48",children:[e.jsxs(G,{onClick:i=>{i.stopPropagation(),n(s)},className:"gap-2 cursor-pointer",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Edit Risk"]}),e.jsxs(G,{disabled:q.has(s.id),onClick:async i=>{var h,x;i.stopPropagation();try{await be.mutateAsync({clientId:u,title:`Remediate Risk: ${s.assessmentId}`,description:`Threat: ${s.threatDescription||"N/A"}. Recommended Actions: ${s.recommendedActions||"N/A"}.`,priority:((h=s.priority)==null?void 0:h.toLowerCase())==="critical"?"high":((x=s.priority)==null?void 0:x.toLowerCase())||"medium",dueDate:s.nextReviewDate||void 0}),N.success("Task created in Action Center"),ye(p=>new Set([...p,s.id]))}catch(p){N.error(`Failed: ${p.message}`)}},className:"gap-2 cursor-pointer",children:[q.has(s.id)?e.jsx(Ee,{className:"w-4 h-4 text-green-600"}):e.jsx(Ye,{className:"w-4 h-4"}),q.has(s.id)?"Task Created":"Create Task"]}),e.jsxs(G,{onClick:i=>{i.stopPropagation(),I(s)},className:"gap-2 text-red-600 focus:text-red-700 focus:bg-red-50 cursor-pointer",children:[e.jsx(es,{className:"w-4 h-4"}),"Delete Risk"]}),e.jsx("div",{className:"border-t my-1"}),e.jsxs(G,{onClick:i=>{i.stopPropagation(),P(s),z(null)},className:"gap-2 text-purple-700 focus:text-purple-800 focus:bg-purple-50 cursor-pointer",children:[e.jsx(ee,{className:"w-4 h-4"}),"AI Smart Insights"]})]})]})]})})]}),T.has(s.id)&&e.jsx("tr",{className:"bg-slate-50 border-b border-slate-200",children:e.jsx("td",{colSpan:12,className:"px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Vulnerability"}),e.jsx("p",{className:"text-gray-600",children:s.vulnerabilityDescription||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Existing Controls"}),e.jsx("p",{className:"text-gray-600",children:s.existingControls||"None documented"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Recommended Actions"}),e.jsx("p",{className:"text-gray-600",children:s.recommendedActions||"None specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Control Effectiveness"}),e.jsx("p",{className:"text-gray-600 capitalize",children:s.controlEffectiveness||"Not evaluated"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Assessment Date"}),e.jsx("p",{className:"text-gray-600",children:s.assessmentDate?new Date(s.assessmentDate).toLocaleDateString():"Not set"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Next Review"}),e.jsx("p",{className:"text-gray-600",children:s.nextReviewDate?new Date(s.nextReviewDate).toLocaleDateString():"Not scheduled"})]}),s.notes&&e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-600",children:s.notes})]})]})})})]},s.id)})})]})})}),e.jsx("div",{className:"px-6 py-4 border-t bg-muted/30",children:e.jsxs("div",{className:"flex flex-wrap gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Risks:"}),e.jsx("span",{className:"font-semibold",children:U.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"High/Critical:"}),e.jsx("span",{className:"font-semibold text-red-600",children:U.filter(s=>s.inherentRisk==="High"||s.inherentRisk==="Very High").length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"With Treatments:"}),e.jsx("span",{className:"font-semibold text-green-600",children:U.filter(s=>s.treatmentCount>0).length})]})]})}),e.jsx($e,{open:!!M,onOpenChange:s=>!s&&H(null),risk:M,clientId:u}),e.jsx(Ve,{open:!!g,onOpenChange:s=>!s&&I(null),children:e.jsxs(Be,{children:[e.jsxs(_e,{children:[e.jsxs(Fe,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(me,{className:"h-5 w-5"}),"Delete Risk Assessment"]}),e.jsxs(Ge,{children:["Are you sure you want to delete the risk assessment for",e.jsxs("span",{className:"font-semibold text-foreground",children:[" ",(g==null?void 0:g.threatDescription)||(g==null?void 0:g.assessmentId)," "]}),"? This action cannot be undone and will permanently remove all associated data."]})]}),e.jsxs(We,{children:[e.jsx(Qe,{children:"Cancel"}),e.jsx(Ke,{onClick:()=>{g&&(ve.mutate({id:g.id,clientId:u}),I(null))},className:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-600",children:"Delete Risk"})]})]})}),e.jsx(Ne,{open:!!t,onOpenChange:s=>!s&&P(null),title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-purple-600"}),"AI Smart Insights: ",t==null?void 0:t.assessmentId]}),description:"Leverage AI to triage this risk and get control recommendations.",size:"xl",footer:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx(v,{variant:"ghost",onClick:()=>P(null),children:"Close"}),R&&e.jsxs(v,{onClick:()=>{Z.mutate({id:t.id,clientId:u,likelihood:parseInt(R.likelihood),impact:parseInt(R.impact),notes:(t.notes||"")+`

[AI Triage]: ${R.reasoning}`})},disabled:Z.isLoading,className:"bg-purple-600 hover:bg-purple-700 text-white gap-2",children:[Z.isLoading?e.jsx(He,{className:"w-4 h-4 animate-spin"}):e.jsx(as,{className:"w-4 h-4"}),"Commit AI Triage to Risk"]})]}),children:e.jsxs("div",{className:"space-y-8 py-4",children:[e.jsxs("div",{className:"bg-purple-50/50 p-6 rounded-xl border border-purple-100",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Step 1: AI Auto-Triage"]}),e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("p",{className:"text-sm text-purple-800 italic",children:['"Analysis based on: ',e.jsx("strong",{children:(t==null?void 0:t.threatDescription)||"No description"}),'"']}),e.jsx(pe,{name:ue.RISK_AUTO_TRIAGE,props:{clientId:u,threatDescription:(t==null?void 0:t.threatDescription)||"",vulnerabilityDescription:(t==null?void 0:t.vulnerabilityDescription)||"",affectedAssets:Re(t==null?void 0:t.affectedAssets),onAnalysisComplete:s=>{z(s),N.success("AI Triage complete! Review and commit the results below.")}}})]}),R&&e.jsxs("div",{className:"w-64 bg-white p-4 rounded-lg border border-purple-200 shadow-sm animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("h5",{className:"text-xs font-bold text-purple-700 uppercase mb-3",children:"AI Recommendation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase",children:"Likelihood"}),e.jsx("p",{className:"text-lg font-bold",children:R.likelihood})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase",children:"Impact"}),e.jsx("p",{className:"text-lg font-bold",children:R.impact})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase",children:"Reasoning"}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:R.reasoning})]})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2 px-4",children:[e.jsx(ts,{className:"w-4 h-4 text-purple-600"}),"Step 2: Intelligent Control Suggestions"]}),e.jsx(pe,{name:ue.RISK_CONTROL_SUGGESTION,props:{clientId:u,threat:(t==null?void 0:t.threatDescription)||"",vulnerability:(t==null?void 0:t.vulnerabilityDescription)||"",selectedControlIds:[],onAddControl:s=>{N.info(`Control ${s} recommendation accepted. In a full implementation, this would link the control.`)}}})]})]})})]})}function Lt(){ms({pageTitle:"Risk Register",description:"This is the central repository for all identified risks. Use this page to add new risks, assess their inherent and residual levels, and assign owners.",keyTopics:["Risk Assessment","Inherent Risk","Residual Risk","Risk Treatment","Risk Owners"],dataSummary:{context:"User is viewing the Risk Register table and heatmaps."}});const u=Pe(),[n,r]=ze(),c=u.id?parseInt(u.id):0,[W,b]=l.useState(!1),[Q,C]=l.useState(null),[K,D]=l.useState(null),[E,M]=l.useState(!1),[H,g]=l.useState(!1),[I,T]=l.useState(null),V=S.useUtils(),{data:t}=S.risks.getRiskAssessments.useQuery({clientId:c},{enabled:!!c});S.risks.exportReport.useMutation();const[P,R]=l.useState(!1),z=S.risks.generateAIAnalysis.useMutation({onSuccess:d=>{D(d),M(!1),g(!0),V.risks.getReport.invalidate({clientId:c}),N.success("AI Analysis generated and saved to Report Area")},onError:d=>{M(!1),N.error(`Analysis failed: ${d.message}`)}}),f=async()=>{M(!0),z.mutate({clientId:c})};if(l.useEffect(()=>{const d=new URLSearchParams(window.location.search),L=d.get("title"),j=d.get("description"),B=d.get("assetId");if(L||j){C({riskName:L||"",description:j||"",assetId:B?parseInt(B):void 0,status:"Open",likelihood:1,impact:1}),b(!0);const _=window.location.pathname;window.history.replaceState({},"",_)}},[]),!c)return e.jsx(he,{children:e.jsx("div",{className:"p-8 text-center text-destructive",children:"Invalid Client ID"})});const J=d=>{C(d),b(!0)};return e.jsx(he,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(os,{children:e.jsxs(cs,{children:[e.jsx(Y,{children:e.jsx(fe,{asChild:!0,children:e.jsx(X,{href:`/clients/${c}`,children:e.jsx(ns,{className:"w-4 h-4"})})})}),e.jsx(we,{children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(Y,{children:e.jsx(fe,{asChild:!0,children:e.jsx(X,{href:`/clients/${c}/risks`,children:"Risk Management"})})}),e.jsx(we,{children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(Y,{children:e.jsx(ds,{children:"Risk Register"})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx(X,{href:`/clients/${c}/risks`,children:e.jsxs(v,{variant:"ghost",size:"sm",className:"pl-0 gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(hs,{className:"w-4 h-4"}),"Back to Dashboard"]})})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-950",children:"Risk Register"}),e.jsx("p",{className:"text-slate-900 mt-1 font-medium",children:"Manage and track all identified risks for this client."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"primary",onClick:f,disabled:E||!t||t.length===0,className:"gap-2 shadow-lg shadow-blue-500/20 bg-gradient-to-r from-blue-700 to-indigo-700 hover:from-blue-800 hover:to-indigo-800 transition-all active:scale-[0.98] text-white",children:[E?e.jsx(ps,{className:"w-4 h-4 animate-spin text-white"}):e.jsx(ee,{className:"w-4 h-4 text-white"}),E?"AI Analyzing Risks...":"AI Management Report"]}),e.jsxs(v,{onClick:()=>{C(null),b(!0)},children:[e.jsx(us,{className:"w-4 h-4 mr-2"})," Add Risk"]}),e.jsx(xs,{title:"Risk Register",description:"Identify, assess, and treat risks to your organization.",rationale:"A comprehensive risk register is the foundation of information security. It documents potential threats, their likelihood and impact, and the controls you've put in place to mitigate them.",howToUse:[{step:"Add Risks",description:"Click 'Add Risk' to use the wizard for documenting new threats."},{step:"Assess Risk",description:"Score inherent risk (before controls) and residual risk (after controls)."},{step:"Assign Owners",description:"Designate a risk owner responsible for monitoring and mitigation."},{step:"Analyze Heatmaps",description:"Use the heatmaps to visualize your highest-priority risks."}],integrations:[{name:"Controls",description:"Mitigating controls are linked directly from the Control Library."},{name:"AI Analysis",description:"Use the 'AI Management Report' to generate executive summaries."},{name:"Audits",description:"This register serves as primary evidence for risk management standards (e.g., ISO 27001 Clause 6)."}]})]})]}),t&&t.length>0&&e.jsxs("div",{className:"h-64 grid grid-cols-2 gap-4 mb-8",children:[e.jsx(je,{assessments:t||[],type:"inherent",activeFilter:I,onFilterChange:T,title:"Inherent Risk"}),e.jsx(je,{assessments:t||[],type:"residual",activeFilter:I,onFilterChange:T,title:"Residual Risk"})]}),e.jsx(fs,{clientId:c,onEditRisk:J,heatmapFilter:I}),e.jsx(ls,{open:W,onOpenChange:b,clientId:c,initialData:Q,onSuccess:()=>{b(!1),C(null),V.risks.getRiskAssessments.invalidate(),N.success("Risk saved successfully")}}),e.jsxs(Ne,{open:H,onOpenChange:g,title:"AI Risk Management Analysis",description:"Strategic report generated based on current Risk Register data.",size:"3xl",children:[e.jsx("div",{className:"max-h-[70vh] overflow-y-auto p-4 bg-slate-50/50 rounded-xl border border-slate-200/60 shadow-inner",children:e.jsx("div",{className:`prose prose-slate max-w-none prose-sm dark:prose-invert \r
                            prose-headings:text-slate-900 prose-headings:font-bold prose-headings:mb-3 prose-headings:mt-6\r
                            prose-p:text-slate-800 prose-p:leading-relaxed prose-p:mb-4\r
                            prose-li:text-slate-800 prose-li:mb-1\r
                            prose-strong:text-slate-950 prose-strong:font-bold\r
                            prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg`,children:e.jsx(gs,{children:K||""})})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(v,{variant:"outline",onClick:()=>g(!1),children:"Close"}),e.jsxs(v,{variant:"secondary",className:"gap-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200",onClick:()=>{g(!1),r(`/clients/${c}/risks/report`)},children:[e.jsx(Ue,{className:"w-4 h-4"}),"Edit in Report Editor"]}),e.jsxs(v,{className:"gap-2 bg-slate-900 hover:bg-slate-800",onClick:()=>{const d=new Blob([K||""],{type:"text/markdown"}),L=URL.createObjectURL(d),j=document.createElement("a");j.href=L,j.download=`Risk_Management_Report_${new Date().toISOString().split("T")[0]}.md`,j.click(),N.success("Report downloaded as Markdown")},children:[e.jsx(js,{className:"w-4 h-4"}),"Download Markdown"]})]})]})]})})}export{Lt as default};
