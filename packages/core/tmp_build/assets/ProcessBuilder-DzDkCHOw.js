import{M as W,t as j,r as f,j as e,C as $,d as X,e as Y,m as H,L as u,E as k,G as P,H as D,J as I,K as d,I as v,c as x,x as R,k as Z,i as m,U as ee,b as se,au as ae,R as re,l as te}from"./index-DOc7Nwb7.js";import{T as ie}from"./textarea-BtxBxzdY.js";import{D as ne}from"./DashboardLayout-aHnUqq57.js";import{c as y}from"./utils-BC5CVi_C.js";import{P as ce}from"./plus-BaQ35Jcx.js";import{T as U}from"./trash-2-CFEfisbM.js";import{S as L}from"./server-Dvm2PAz3.js";import{B as G}from"./building-C0cheRWa.js";import{T as de}from"./truck-Bi4vSDO4.js";import{A as oe}from"./arrow-up-right-BLuFLpps.js";import{A as E}from"./arrow-left-CpuUojG-.js";import{C as _}from"./clock-osbacZli.js";import{G as le}from"./git-graph-BZPB1uXv.js";import{A as B}from"./index-B9D6dsvY.js";import{m as V}from"./proxy-DIbepYjM.js";import{A as z}from"./activity-B1F2IRm3.js";import{S as me}from"./shield-alert-iAruRy4W.js";import{S as F}from"./save-CvVmWchr.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./shield-check-ETs8j4-d.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=W("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);function ue({processId:A,dependencies:h,onUpdate:N}){const o=j.businessContinuity.processes.addDependency.useMutation(),c=j.businessContinuity.processes.removeDependency.useMutation(),[t,l]=f.useState({type:"it_system",name:"",criticality:"medium",notes:""}),[g,i]=f.useState(!1),M=async()=>{if(t.name){i(!0);try{await o.mutateAsync({processId:A,dependencyType:t.type,dependencyName:t.name,criticality:t.criticality,notes:t.notes}),m.success("Dependency added"),l({...t,name:"",notes:""}),N()}catch{m.error("Failed to add dependency")}finally{i(!1)}}},w=async r=>{try{await c.mutateAsync({id:r}),m.success("Dependency removed"),N()}catch{m.error("Failed to remove dependency")}},n=r=>{switch(r){case"upstream_process":return e.jsx(oe,{className:"w-4 h-4"});case"downstream_process":return e.jsx(pe,{className:"w-4 h-4"});case"it_system":return e.jsx(L,{className:"w-4 h-4"});case"vendor":return e.jsx(de,{className:"w-4 h-4"});case"people":return e.jsx(ee,{className:"w-4 h-4"});case"facility":return e.jsx(G,{className:"w-4 h-4"});default:return e.jsx(L,{className:"w-4 h-4"})}},b=r=>{switch(r){case"upstream_process":return"Upstream Process (Input)";case"downstream_process":return"Downstream Process (Output)";case"it_system":return"IT System / Application";case"vendor":return"Third Party / Vendor";case"people":return"Key Personnel / Teams";case"facility":return"Facility / Location";default:return r}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{className:"border-dashed border-2",children:[e.jsx(X,{className:"pb-4",children:e.jsx(Y,{className:"text-lg font-medium",children:"Add New Dependency"})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(u,{children:"Resource Type"}),e.jsxs(k,{value:t.type,onValueChange:r=>l({...t,type:r}),children:[e.jsx(P,{children:e.jsx(D,{})}),e.jsxs(I,{children:[e.jsx(d,{value:"it_system",children:"IT System"}),e.jsx(d,{value:"vendor",children:"Vendor"}),e.jsx(d,{value:"people",children:"People/Team"}),e.jsx(d,{value:"facility",children:"Facility"}),e.jsx(d,{value:"upstream_process",children:"Upstream Process"}),e.jsx(d,{value:"downstream_process",children:"Downstream Process"})]})]})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(u,{children:"Name / Reference"}),e.jsx(v,{placeholder:"e.g. ERP System, AWS, HR Team...",value:t.name,onChange:r=>l({...t,name:r.target.value})})]}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(u,{children:"Criticality"}),e.jsxs(k,{value:t.criticality,onValueChange:r=>l({...t,criticality:r}),children:[e.jsx(P,{children:e.jsx(D,{})}),e.jsxs(I,{children:[e.jsx(d,{value:"critical",children:"Critical"}),e.jsx(d,{value:"high",children:"High"}),e.jsx(d,{value:"medium",children:"Medium"}),e.jsx(d,{value:"low",children:"Low"})]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(x,{className:"w-full",onClick:M,disabled:g||!t.name,children:[g?e.jsx(R,{className:"w-4 h-4 animate-spin"}):e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Add"]})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Mapped Dependencies"}),h.length===0&&e.jsx("div",{className:"text-center py-10 text-muted-foreground border rounded-lg bg-slate-50",children:"No dependencies mapped yet. Add resources above."}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:h.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-slate-100 text-slate-600",children:n(r.dependencyType)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.dependencyName}),e.jsxs("div",{className:"text-xs text-muted-foreground flex gap-2 items-center",children:[e.jsx("span",{children:b(r.dependencyType)}),e.jsx("span",{className:"text-slate-300",children:"â€¢"}),e.jsx("span",{children:r.notes||"No notes"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Z,{variant:r.criticality==="critical"||r.criticality==="high"?"destructive":"secondary",children:r.criticality||"medium"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>w(r.id),className:"text-muted-foreground hover:text-destructive",children:e.jsx(U,{className:"w-4 h-4"})})]})]},r.id))})]})]})}function cs(){const[A,h]=se(),[N,o]=ae("/clients/:clientId/business-continuity/processes/:action"),c=o!=null&&o.clientId?parseInt(o.clientId):0,t=o!=null&&o.action&&o.action!=="new"?parseInt(o.action):void 0,l=!t,{data:g}=j.businessContinuity.processes.list.useQuery({clientId:c},{enabled:!!c}),{data:i,isLoading:M,refetch:w}=j.businessContinuity.processes.get.useQuery({id:t,clientId:c},{enabled:!!t&&!!c}),[n,b]=f.useState(1),[r,T]=f.useState(!1),[a,p]=f.useState({name:"",department:"",ownerId:void 0,parentId:void 0,description:"",criticalityTier:"Tier 2",rto:"24h",rpo:"4h",mtpd:"72h",upstreamDependencies:[],downstreamDependencies:[]});re.useEffect(()=>{i&&!l&&p({name:i.name,department:i.department||"",ownerId:i.ownerId||void 0,parentId:i.parentId||void 0,description:i.description||"",criticalityTier:i.criticalityTier||"Tier 2",rto:i.rto||"24h",rpo:i.rpo||"4h",mtpd:i.mtpd||"72h",upstreamDependencies:[],downstreamDependencies:[]})},[i,l]);const q=j.businessContinuity.processes.create.useMutation({onSuccess:()=>{m.success("Process definition saved successfully"),h(`/clients/${c}/business-continuity/processes`)},onError:s=>m.error(`Error: ${s.message}`)}),K=j.businessContinuity.processes.update.useMutation({onSuccess:()=>{m.success("Process updated successfully"),h(`/clients/${c}/business-continuity/processes`)},onError:s=>m.error(`Error: ${s.message}`)}),Q=j.businessContinuity.processes.delete.useMutation({onSuccess:()=>{m.success("Process deleted successfully"),h(`/clients/${c}/business-continuity/processes`)},onError:s=>m.error(`Delete Error: ${s.message}`)}),J=async()=>{if(confirm("Are you sure you want to delete this process? This action cannot be undone."))try{await Q.mutateAsync({id:t,clientId:c})}catch(s){console.error(s)}},S=async()=>{T(!0);try{l?await q.mutateAsync({clientId:c,name:a.name,department:a.department,description:a.description,criticalityTier:a.criticalityTier,rto:a.rto,rpo:a.rpo,mtpd:a.mtpd,parentId:a.parentId}):await K.mutateAsync({id:t,clientId:c,name:a.name,department:a.department,description:a.description,criticalityTier:a.criticalityTier,rto:a.rto,rpo:a.rpo,mtpd:a.mtpd,parentId:a.parentId})}catch(s){console.error(s)}finally{T(!1)}},C=[{id:1,title:"Core Definition",description:"Identity & Ownership",icon:G},{id:2,title:"Recovery Metrics",description:"RTO, RPO & MTPD",icon:_},{id:3,title:"Dependencies",description:"Upstream & Downstream",icon:le}];return e.jsx(ne,{children:e.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-background p-6 lg:p-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-8 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(x,{variant:"ghost",size:"sm",className:"pl-0 hover:pl-2 transition-all text-muted-foreground mb-2",onClick:()=>h(`/clients/${c}/business-continuity/processes`),children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Back to Registry"]}),e.jsxs("div",{className:"flex items-center justify-between min-w-[300px]",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:l?"Design Business Process":"Edit Process"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-lg",children:"Define the operational parameters and resilience requirements."})]}),!l&&e.jsxs(x,{variant:"destructive",size:"sm",onClick:J,className:"ml-4 gap-2",children:[e.jsx(U,{className:"h-4 w-4"})," Delete"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-10",children:[e.jsxs("div",{className:"lg:col-span-4 space-y-8",children:[e.jsx("div",{className:"bg-card rounded-2xl shadow-sm border p-6",children:e.jsx("nav",{"aria-label":"Progress",children:e.jsx("ol",{role:"list",className:"overflow-hidden",children:C.map((s,O)=>e.jsxs("li",{className:y(O!==C.length-1?"pb-10":"","relative"),children:[O!==C.length-1?e.jsx("div",{className:y("absolute left-4 top-4 -ml-px mt-0.5 h-full w-0.5",n>s.id?"bg-primary":"bg-muted"),"aria-hidden":"true"}):null,e.jsxs("div",{className:"group relative flex items-start cursor-pointer",onClick:()=>n>s.id&&b(s.id),children:[e.jsx("span",{className:"flex h-9 items-center",children:e.jsx("span",{className:y("relative z-10 flex h-8 w-8 items-center justify-center rounded-full border-2 transition-colors duration-200",n>s.id?"bg-primary border-primary":n===s.id?"border-primary bg-card":"border-muted bg-card"),children:n>s.id?e.jsx(te,{className:"h-4 w-4 text-primary-foreground","aria-hidden":"true"}):e.jsx(s.icon,{className:y("h-4 w-4",n===s.id?"text-primary":"text-muted-foreground")})})}),e.jsxs("span",{className:"ml-4 flex min-w-0 flex-col",children:[e.jsx("span",{className:y("text-sm font-semibold tracking-wide",n===s.id?"text-primary":"text-muted-foreground"),children:s.title}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.description})]})]})]},s.id))})})}),e.jsx(B,{mode:"wait",children:n===2&&e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-accent/10 rounded-2xl p-6 border border-accent/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"h-5 w-5 text-accent"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Advisor Tips"})]}),e.jsxs("div",{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-foreground",children:"RTO (Recovery Time Objective)"}),e.jsx("p",{children:"Maximum allowed downtime. e.g. An e-commerce site might have RTO = 1 hour."})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"block mb-1 text-foreground",children:"RPO (Recovery Point Objective)"}),e.jsx("p",{children:"Maximum data loss allowed. e.g. Losing 24h of emails might be acceptable, but 0 banking transactions."})]})]})]})})]}),e.jsx("div",{className:"lg:col-span-8",children:e.jsx($,{className:"border shadow-sm bg-card overflow-hidden h-full",children:e.jsxs(H,{className:"p-8",children:[e.jsx(B,{mode:"wait",children:e.jsxs(V.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{duration:.3},className:"min-h-[400px]",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-base",children:"Process Name"}),e.jsx(v,{className:"h-12 bg-background",placeholder:"e.g. Employee Payroll",value:a.name,onChange:s=>p({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-base",children:"Department"}),e.jsx(v,{className:"h-12 bg-background",placeholder:"e.g. HR / Finance",value:a.department,onChange:s=>p({...a,department:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-base",children:"Criticality Tier"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["Tier 1 (Mission Critical)","Tier 2 (Business Critical)","Tier 3 (Operational)","Tier 4 (Non-Critical)"].map(s=>e.jsxs("div",{className:y("cursor-pointer rounded-lg border p-4 transition-all hover:border-primary",a.criticalityTier===s.split(" ")[0]+" "+s.split(" ")[1]?"border-primary bg-primary/5 ring-1 ring-primary":"bg-background"),onClick:()=>p({...a,criticalityTier:s.split(" ")[0]+" "+s.split(" ")[1]}),children:[e.jsx("div",{className:"font-medium text-foreground",children:s}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.includes("Tier 1")?"Must recover < 4hrs. Customer facing.":s.includes("Tier 2")?"Recover < 24hrs. Internal dependencies.":s.includes("Tier 3")?"Recover < 72hrs. Manual workarounds exist.":"Deferrable."})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-base",children:"Parent Process (Optional)"}),e.jsxs(k,{value:a.parentId?a.parentId.toString():"none",onValueChange:s=>p({...a,parentId:s==="none"?void 0:parseInt(s)}),children:[e.jsx(P,{className:"h-12 bg-background",children:e.jsx(D,{placeholder:"Select parent process..."})}),e.jsxs(I,{children:[e.jsx(d,{value:"none",children:"No Parent (Top Level)"}),g==null?void 0:g.filter(s=>s.id!==void 0).map(s=>e.jsx(d,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select if this is a sub-process of a larger function."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-base",children:"Description"}),e.jsx(ie,{className:"min-h-[120px] bg-background resize-none",placeholder:"Describe the objective, inputs, and outputs of this process...",value:a.description,onChange:s=>p({...a,description:s.target.value})})]})]}),n===2&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"p-4 rounded-xl border bg-background space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold",children:[e.jsx(_,{className:"w-5 h-5"})," RTO"]}),e.jsx(v,{className:"h-10",value:a.rto,onChange:s=>p({...a,rto:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recovery Time Objective"})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-background space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold",children:[e.jsx(z,{className:"w-5 h-5"})," RPO"]}),e.jsx(v,{className:"h-10",value:a.rpo,onChange:s=>p({...a,rpo:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recovery Point Objective"})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-background space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive font-semibold",children:[e.jsx(me,{className:"w-5 h-5"})," MTPD"]}),e.jsx(v,{className:"h-10",value:a.mtpd,onChange:s=>p({...a,mtpd:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max Tolerable Period"})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t relative",children:[e.jsx(u,{className:"mb-4 block",children:"Recovery Timeline Visualization"}),e.jsxs("div",{className:"h-2 bg-muted rounded-full w-full relative",children:[e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-4 h-4 bg-destructive rounded-full border-4 border-background shadow-sm",title:"Disaster"}),e.jsx("div",{className:"absolute left-[20%] top-1/2 -translate-y-1/2 w-4 h-4 bg-primary/70 rounded-full border-4 border-background shadow-sm",title:"RPO"}),e.jsx("div",{className:"absolute left-[40%] top-1/2 -translate-y-1/2 w-4 h-4 bg-primary rounded-full border-4 border-background shadow-sm",title:"RTO"}),e.jsx("div",{className:"absolute left-[80%] top-1/2 -translate-y-1/2 w-4 h-4 bg-destructive rounded-full border-4 border-background shadow-sm",title:"MTPD"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"Incident"}),e.jsxs("span",{className:"pl-12",children:["RPO (",a.rpo,")"]}),e.jsxs("span",{className:"pl-8",children:["RTO (",a.rto,")"]}),e.jsxs("span",{children:["MTPD (",a.mtpd,")"]})]})]})]}),n===3&&e.jsx("div",{className:"py-6",children:l?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-xl bg-slate-50",children:[e.jsx(F,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Save Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please save the initial process definition before mapping dependencies."}),e.jsxs(x,{onClick:S,disabled:r,children:[r&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Save & Continue"]})]}):e.jsx(ue,{processId:t,dependencies:(i==null?void 0:i.dependencies)||[],onUpdate:w})})]},n)}),e.jsxs("div",{className:"flex justify-between items-center mt-12 pt-6 border-t",children:[e.jsxs(x,{variant:"ghost",onClick:()=>b(s=>Math.max(1,s-1)),disabled:n===1,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Back"]}),n<3?e.jsx(x,{onClick:()=>b(s=>s+1),className:"px-8 shadow-md",children:"Next Step"}):e.jsxs(x,{onClick:S,disabled:r,className:"px-8 shadow-md bg-green-600 hover:bg-green-700 text-white",children:[r&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(F,{className:"mr-2 h-4 w-4"})," Complete Setup"]})]})]})})})]})]})})})}export{cs as default};
