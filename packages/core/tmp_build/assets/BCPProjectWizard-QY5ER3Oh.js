import{t as P,r as t,j as e,D as ae,ap as re,c as d,o as ie,p as le,q as ne,L as u,I as W,x as J,X as G,Y as M,E as K,G as X,H as _,J as Z,K as p,N as ce,O as oe,P as I,Q as F,V as de,W as w,i as v,ac as me,b as xe,C as L,d as O,e as z,f as $,m as R,ay as H,l as ee}from"./index-DOc7Nwb7.js";import{D as he,P as Q,g as U,h as E}from"./DashboardLayout-aHnUqq57.js";import{T as je}from"./textarea-BtxBxzdY.js";import{C as V}from"./calendar-CRg26W4I.js";import{c as k}from"./utils-BC5CVi_C.js";import{P as ue}from"./plus-BaQ35Jcx.js";import{S as pe}from"./search-CwuIBBPE.js";import{A as ge}from"./arrow-left-CpuUojG-.js";import{C as Y}from"./calendar-BlLJlGbj.js";import{f as q}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./endOfWeek-tX_WdcBG.js";import"./startOfMonth-BTb_IeTV.js";import"./isSameDay-CGHMiO64.js";import"./chevron-left-DZH-lUm7.js";function fe({projectId:l,processId:x}){const{data:a,refetch:r}=P.businessContinuity.stakeholders.list.useQuery({projectId:l,processId:x}),n=P.businessContinuity.stakeholders.add.useMutation(),[g,b]=t.useState(!1),[h,D]=t.useState(""),[c,y]=t.useState(null),[f,A]=t.useState("contributor"),{data:i,isLoading:T}=P.businessContinuity.stakeholders.searchCandidates.useQuery({query:h},{enabled:g}),o=async()=>{if(c)try{await n.mutateAsync({userId:c.id,role:f,projectId:l,processId:x}),v.success("Stakeholder added"),b(!1),y(null),r()}catch{v.error("Failed to add stakeholder")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Stakeholders"}),e.jsxs(ae,{open:g,onOpenChange:b,children:[e.jsx(re,{asChild:!0,children:e.jsxs(d,{size:"sm",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Add Stakeholder"]})}),e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(ne,{children:"Add Stakeholder"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Search User"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(W,{className:"pl-8",placeholder:"Name or email...",value:h,onChange:s=>D(s.target.value)})]}),T?e.jsx("div",{className:"flex justify-center p-2",children:e.jsx(J,{className:"w-4 h-4 animate-spin"})}):e.jsx("div",{className:"border rounded-md max-h-40 overflow-auto",children:i==null?void 0:i.map(s=>{var m;return e.jsxs("div",{className:`p-2 hover:bg-muted cursor-pointer flex items-center gap-2 ${(c==null?void 0:c.id)===s.id?"bg-muted":""}`,onClick:()=>y(s),children:[e.jsx(G,{className:"h-6 w-6",children:e.jsx(M,{children:((m=s.name)==null?void 0:m[0])||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]})]},s.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Role"}),e.jsxs(K,{value:f,onValueChange:A,children:[e.jsx(X,{children:e.jsx(_,{})}),e.jsxs(Z,{children:[e.jsx(p,{value:"owner",children:"Process Owner"}),e.jsx(p,{value:"contributor",children:"Contributor"}),e.jsx(p,{value:"reviewer",children:"Reviewer"}),e.jsx(p,{value:"approver",children:"Approver"})]})]})]}),e.jsx(d,{onClick:o,disabled:!c||n.isPending,className:"w-full",children:n.isPending?"Adding...":"Add Stakeholder"})]})]})]})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(I,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(F,{className:"text-white font-semibold py-4",children:"User"}),e.jsx(F,{className:"text-white font-semibold py-4",children:"Role"}),e.jsx(F,{className:"text-white font-semibold py-4",children:"Assigned"})]})}),e.jsxs(de,{children:[a==null?void 0:a.map(s=>{var m,N,S,C;return e.jsxs(I,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsxs(w,{className:"flex items-center gap-2 py-4",children:[e.jsx(G,{className:"h-8 w-8",children:e.jsx(M,{children:((N=(m=s.user)==null?void 0:m.name)==null?void 0:N[0])||"U"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-black",children:(S=s.user)==null?void 0:S.name}),e.jsx("div",{className:"text-xs text-gray-500",children:(C=s.user)==null?void 0:C.email})]})]}),e.jsx(w,{className:"capitalize text-gray-600 py-4",children:s.stakeholder.role}),e.jsx(w,{className:"text-xs text-gray-500 py-4",children:new Date(s.stakeholder.assignedDate).toLocaleDateString()})]},s.stakeholder.id)}),(a==null?void 0:a.length)===0&&e.jsx(I,{children:e.jsx(w,{colSpan:3,className:"text-center py-6 text-gray-500 bg-white",children:"No stakeholders assigned."})})]})]})})]})}function os(){const{selectedClientId:l}=me(),[x,a]=xe(),[r,n]=t.useState(1),[g,b]=t.useState(null),[h,D]=t.useState(""),[c,y]=t.useState(""),[f,A]=t.useState("Global"),[i,T]=t.useState(),[o,s]=t.useState(),[m,N]=t.useState(!1),S=P.businessContinuity.projects.create.useMutation(),C=async()=>{if(!h||!l){v.error("Please fill in project title");return}N(!0);try{const j=`[${f}] ${c}`,te=await S.mutateAsync({clientId:l,title:h,scope:j,startDate:i==null?void 0:i.toISOString(),targetDate:o==null?void 0:o.toISOString()});v.success("Project initialized"),b(te.id),n(2)}catch(j){console.error(j),v.error("Failed to create project")}finally{N(!1)}},se=()=>{a(`/clients/${l}/business-continuity`)};return e.jsx(he,{children:e.jsxs("div",{className:"p-8 max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{variant:"ghost",className:"pl-0 hover:bg-transparent",onClick:()=>a(`/clients/${l}/business-continuity`),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"})," Cancel"]}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"New BCP Cycle"})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{current:r,number:1,title:"Scope & Timeline"}),e.jsx("div",{className:"w-12 h-0.5 bg-muted"}),e.jsx(B,{current:r,number:2,title:"Stakeholders"}),e.jsx("div",{className:"w-12 h-0.5 bg-muted"}),e.jsx(B,{current:r,number:3,title:"Review"})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[r===1&&e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(z,{children:"Project Initiation"}),e.jsx($,{children:"Define the boundaries and timeline for this BCP cycle."})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"title",children:["Project Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(W,{id:"title",placeholder:"e.g. FY2026 Enterprise BCP Update",value:h,onChange:j=>D(j.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Start Date"}),e.jsxs(Q,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:k("w-full justify-start text-left font-normal",!i&&"text-muted-foreground"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),i?q(i,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(E,{className:"w-auto p-0",children:e.jsx(V,{mode:"single",selected:i,onSelect:T,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Target Date"}),e.jsxs(Q,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:k("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),o?q(o,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(E,{className:"w-auto p-0",children:e.jsx(V,{mode:"single",selected:o,onSelect:s,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Geographic Scope"}),e.jsxs(K,{value:f,onValueChange:A,children:[e.jsx(X,{children:e.jsx(_,{})}),e.jsxs(Z,{children:[e.jsx(p,{value:"Global",children:"Global / All Locations"}),e.jsx(p,{value:"Regional",children:"Regional (Multi-site)"}),e.jsx(p,{value:"Single Site",children:"Single Site"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"scope",children:"Scope Description"}),e.jsx(je,{id:"scope",placeholder:"Detailed scope notes...",className:"min-h-[100px]",value:c,onChange:j=>y(j.target.value)})]})]}),e.jsx(H,{className:"flex justify-end",children:e.jsxs(d,{onClick:C,disabled:m,children:[m&&e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Initialize Project"]})})]}),r===2&&g&&e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(z,{children:"Stakeholder Management"}),e.jsx($,{children:"Assign owners and contributors to this project."})]}),e.jsx(R,{className:"space-y-6",children:e.jsx(fe,{projectId:g})}),e.jsxs(H,{className:"flex justify-between",children:[e.jsx(d,{variant:"ghost",children:"Back (Saved)"}),e.jsx(d,{onClick:()=>n(3),children:"Next Step"})]})]}),r===3&&e.jsx(L,{className:"text-center py-12",children:e.jsxs(R,{className:"space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto text-green-600",children:e.jsx(ee,{className:"w-10 h-10"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Project Setup Complete!"}),e.jsxs("p",{className:"text-muted-foreground",children:['Your BCP cycle "',h,'" has been initialized.',e.jsx("br",{}),"Stakeholders have been notified (simulation)."]}),e.jsx("div",{className:"flex justify-center gap-4 mt-6",children:e.jsx(d,{onClick:se,className:"px-8",children:"Go to Project Dashboard"})})]})})]})]})})}function B({current:l,number:x,title:a}){const r=l===x,n=l>x;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:k("w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",r?"bg-primary text-primary-foreground":n?"bg-green-500 text-white":"bg-muted text-muted-foreground"),children:n?e.jsx(ee,{className:"w-4 h-4"}):x}),e.jsx("span",{className:k("text-sm font-medium",r?"text-foreground":"text-muted-foreground"),children:a})]})}export{os as default};
