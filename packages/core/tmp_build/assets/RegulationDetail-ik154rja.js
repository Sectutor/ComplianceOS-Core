import{r as v,t as T,i as B,j as e,D as ae,o as ne,p as re,q as oe,s as le,L as Z,E as ce,G as de,H as me,J as pe,K as H,c as o,F as U,S as P,l as ue,w as he,x as xe,b as ge,ab as fe,b0 as _,k as r,C as h,d as x,e as g,m as b,f as $,T as Q}from"./index-DOc7Nwb7.js";import{P as je,g as ye,h as be,a as ve,b as Ne,c as we,d as Ce,e as ke,f as Ae,D as Se}from"./DashboardLayout-aHnUqq57.js";import{B as Ie}from"./Breadcrumb-CRi3LAxS.js";import{g as Te}from"./index-CuHtgnXp.js";import{S as W}from"./scroll-area-DPaNxEJD.js";import{T as Pe,a as ze,b as J,c as K}from"./tabs-CBDTXbEn.js";import{E as ee}from"./enhanced-dialog-CeRPsI16.js";import{c as te}from"./utils-BC5CVi_C.js";import{P as q}from"./paperclip-CVvoCde1.js";import{C as De}from"./chevrons-up-down-COXP-OtJ.js";import{L as Le}from"./link-FmUqdGRG.js";import{P as X}from"./plus-BaQ35Jcx.js";import{E as Y}from"./external-link-C3PXjBR9.js";import{I as Re}from"./info-By5wLOUH.js";import{A as se}from"./activity-B1F2IRm3.js";import{B as Ee}from"./bar-chart-3-BCngNY6H.js";import{T as Oe}from"./target-cfAj3L6j.js";import{W as Me}from"./wand-sparkles-BtekNLFr.js";import{S as ie}from"./sparkles-CoQ80pK2.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./database-Bjtecw5f.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function $e({isOpen:z,onClose:N,clientId:p,regulationId:u,articleId:l,onSuccess:i}){var E;const[t,O]=v.useState("policy"),[a,D]=v.useState(null),[L,c]=v.useState(!1),f=T.useUtils(),{data:w,isLoading:F}=T.clientPolicies.list.useQuery({clientId:p},{enabled:z&&t==="policy"}),{data:j,isLoading:d}=T.evidence.list.useQuery({clientId:p},{enabled:z&&t==="evidence"}),{data:y,isLoading:G}=T.clientControls.list.useQuery({clientId:p},{enabled:z&&t==="control"}),C=T.regulations.mapToArticle.useMutation({onSuccess:()=>{B.success(`Successfully linked ${t} to article`),f.regulations.getArticleLinks.invalidate({clientId:p,regulationId:u,articleId:l}),i(),k()},onError:s=>{B.error(`Failed to link: ${s.message}`)}}),k=()=>{D(null),O("policy"),N()},A=()=>{a&&C.mutate({clientId:p,regulationId:u,articleId:l,mappedType:t,mappedId:a})},R=t==="policy"?(w==null?void 0:w.map(s=>({id:s.id,label:s.name,icon:U})))||[]:t==="evidence"?(j==null?void 0:j.map(s=>({id:s.id,label:s.title||s.description||s.evidenceId,icon:q})))||[]:t==="control"?(y==null?void 0:y.map(s=>({id:s.id,label:`${s.controlId}: ${s.title||"Untitled Control"}`,icon:P})))||[]:[],S=F||d||G,I=(E=R.find(s=>s.id===a))==null?void 0:E.label;return e.jsx(ae,{open:z,onOpenChange:s=>!s&&k(),children:e.jsxs(ne,{className:"sm:max-w-md",children:[e.jsxs(re,{children:[e.jsx(oe,{children:"Link Compliance Item"}),e.jsxs(le,{children:["Associate a policy, evidence, or control with Regulation ",u," Article ",l,"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Item Type"}),e.jsxs(ce,{value:t,onValueChange:s=>{O(s),D(null)},children:[e.jsx(de,{children:e.jsx(me,{})}),e.jsxs(pe,{children:[e.jsx(H,{value:"policy",children:"Policy"}),e.jsx(H,{value:"evidence",children:"Evidence"}),e.jsx(H,{value:"control",children:"Control"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Select Item"}),e.jsxs(je,{open:L,onOpenChange:c,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(o,{variant:"outline",role:"combobox","aria-expanded":L,className:"w-full justify-between",disabled:S,children:[a?e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[t==="policy"&&e.jsx(U,{className:"h-4 w-4 shrink-0 opacity-50"}),t==="evidence"&&e.jsx(q,{className:"h-4 w-4 shrink-0 opacity-50"}),t==="control"&&e.jsx(P,{className:"h-4 w-4 shrink-0 opacity-50"}),e.jsx("span",{className:"truncate",children:I})]}):e.jsx("span",{className:"text-muted-foreground",children:S?"Loading...":"Select item..."}),e.jsx(De,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(be,{className:"w-[400px] p-0",children:e.jsxs(ve,{children:[e.jsx(Ne,{placeholder:`Search ${t}...`}),e.jsxs(we,{children:[e.jsxs(Ce,{children:["No ",t," found."]}),e.jsx(ke,{children:R.map(s=>e.jsxs(Ae,{value:s.id.toString()+" "+s.label,onSelect:()=>{D(s.id),c(!1)},children:[e.jsx(ue,{className:te("mr-2 h-4 w-4",a===s.id?"opacity-100":"opacity-0")}),e.jsx(s.icon,{className:"mr-2 h-4 w-4 opacity-50"}),e.jsx("span",{className:"truncate",children:s.label})]},s.id))})]})]})})]})]})]}),e.jsxs(he,{children:[e.jsx(o,{variant:"outline",onClick:k,children:"Cancel"}),e.jsxs(o,{onClick:A,disabled:!a||C.isLoading,children:[C.isLoading&&e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}),"Link Item"]})]})]})})}function Ps(){var E;const[z,N]=ge(),p=fe(),u=p.regId,l=p.id?parseInt(p.id):1;if(!u)return e.jsx(_,{to:`/clients/${l}/compliance-obligations`});const i=Te(u);if(!i)return e.jsx(_,{to:"/404"});const[t,O]=v.useState((E=i.articles[0])==null?void 0:E.id),a=i.articles.find(s=>s.id===t),[D,L]=v.useState(!1),{data:c}=T.regulations.getArticleLinks.useQuery({clientId:l,regulationId:u,articleId:t||""},{enabled:!!u&&!!t}),[f,w]=v.useState({loading:!1,articleId:null,matches:null}),F=s=>{w({loading:!0,articleId:s.id,matches:null}),B.info("AI suggestions are currently being upgraded. Check back soon!"),w(n=>({...n,loading:!1}))},j={"AC-1":{title:"Access Control Policy and Procedures",description:"The organization develops, documents, and disseminates to defined personnel or roles an access control policy.",guidance:"Ensure your Access Control Policy is reviewed annually and approved by management."},"AC-2":{title:"Account Management",description:"The organization identifies and selects the following types of information system accounts to support organizational missions/business functions.",guidance:"Implement automated mechanisms to audit account creation, modification, enabling, disabling, and removal actions."},"AC-3":{title:"Access Enforcement",description:"The information system enforces approved authorizations for logical access to information and system resources.",guidance:"Use Role-Based Access Control (RBAC) to restrict access based on job responsibilities."},"AC-6":{title:"Least Privilege",description:"The organization employs the principle of least privilege, allowing only authorized accesses for users.",guidance:"Regularly audit user permissions to ensure they are not broader than necessary."},"AC-20":{title:"Use of External Information Systems",description:"The organization establishes terms and conditions, consistent with any trust relationships established with other organizations owning external systems.",guidance:"Restrict the use of external systems (like personal devices or third-party apps) unless approved and secured."},"AT-1":{title:"Security Awareness and Training Policy",description:"The organization develops, documents, and disseminates a security awareness and training policy.",guidance:"Define who needs training, how often, and the consequences of non-compliance."},"AT-2":{title:"Security Awareness Training",description:"The organization provides basic security awareness training to information system users.",guidance:"Conduct phishing simulations and mandatory annual training modules."},"AU-3":{title:"Content of Audit Records",description:"The information system generates audit records containing information that establishes what type of event occurred, when, where, source, and outcome.",guidance:"Ensure logs capture timestamp, user ID, action type, and resource affected."},"CA-1":{title:"Security Assessment and Authorization Policy",description:"The organization develops, documents, and disseminates a security assessment and authorization policy.",guidance:"Establish a formal process for testing and authorizing new systems before deployment."},"CA-2":{title:"Security Assessments",description:"The organization assesses the security controls in the information system to determine if they are effective.",guidance:"Perform annual penetration tests and vulnerability assessments."},"CM-8":{title:"Information System Component Inventory",description:"The organization develops and documents an inventory of information system components.",guidance:"Maintain an automated asset inventory that tracks hardware, software, and data assets."},"CP-2":{title:"Contingency Plan",description:"The organization develops a contingency plan for the information system that identifies essential missions and business functions.",guidance:"Create a Business Continuity Plan (BCP) and Disaster Recovery Plan (DRP) and test them annually."},"IA-8":{title:"Identification and Authentication (Non-Organizational Users)",description:"The information system uniquely identifies and authenticates non-organizational users.",guidance:"Implement strict identity verification for customers, partners, or minors (e.g. for child consent)."},"IR-6":{title:"Incident Reporting",description:"The organization requires personnel to report suspected security incidents to the organizational incident response capability.",guidance:"Set up a clear reporting channel (e.g., email alias, ticket system) for security incidents."},"MP-4":{title:"Media Storage",description:"The organization physically controls and securely stores information system media within defined controlled areas.",guidance:"Encrypt sensitive data at rest and restrict physical access to storage media."},"MP-6":{title:"Media Sanitization",description:"The organization sanitizes information system media prior to disposal or reuse.",guidance:"Use NIST-approved sanitization methods (clear, purge, destroy) before discarding hard drives."},"PM-1":{title:"Information Security Program Plan",description:"The organization develops and disseminates an organization-wide information security program plan.",guidance:"Appoint a CISO or DPO to oversee the security program."},"PM-2":{title:"Senior Information Security Officer",description:"The organization appoints a senior information security officer with the mission and resources to coordinate the security program.",guidance:"Ensure the DPO/CISO has direct access to executive leadership."},"PS-1":{title:"Personnel Security Policy",description:"The organization develops, documents, and disseminates a personnel security policy.",guidance:"Include security requirements in job descriptions and employee contracts."},"PT-5":{title:"Privacy Notice",description:"The organization provides effective notice to the public and to individuals regarding its privacy activities.",guidance:"Publish a clear, accessible Privacy Policy on your website."},"RA-1":{title:"Risk Assessment Policy",description:"The organization develops, documents, and disseminates a risk assessment policy.",guidance:"Define your risk appetite and the methodology for scoring risks."},"RA-3":{title:"Risk Assessment",description:"The organization conducts an assessment of risk, including the likelihood and magnitude of harm.",guidance:"Conduct a DPIA (Data Protection Impact Assessment) for high-risk processing activities."},"SA-8":{title:"Security Engineering Principles",description:"The organization applies information system security engineering principles in the specification, design, development, implementation, and modification of the information system.",guidance:"Adopt 'Privacy by Design' and 'Security by Default' principles in your SDLC."},"SA-9":{title:"External Information System Services",description:"The organization requires that providers of external information system services employ adequate security controls.",guidance:"Vet vendors and processors (Third-Party Risk Management) before sharing data."},"SC-1":{title:"System and Communications Protection Policy",description:"The organization develops, documents, and disseminates a system and communications protection policy.",guidance:"Define standards for encryption, key management, and network segregation."},"SC-7":{title:"Boundary Protection",description:"The information system monitors and controls communications at the external boundary of the system.",guidance:"Use firewalls, IDS/IPS, and web proxies to inspect traffic entering and leaving your network."},"SI-4":{title:"Information System Monitoring",description:"The organization monitors the information system to detect attacks and indicators of potential attacks.",guidance:"Implement continuous monitoring to detect anomalies and unauthorized erasure attempts."},"A.6.1.1":{title:"Information Security Roles and Responsibilities",description:"Responsibilities for information security shall be defined and allocated.",guidance:"Assign ownership of security risks and tasks."},"A.7.2.2":{title:"Information Security Awareness, Education and Training",description:"All employees shall receive appropriate awareness education and training.",guidance:"Regular training is key to compliance."},"A.8.2.1":{title:"Classification of Information",description:"Information shall be classified in terms of legal requirements, value, criticality and sensitivity to unauthorised disclosure or modification.",guidance:"Label documents as Public, Internal, Confidential."},"A.9.1.1":{title:"Access Control Policy",description:"An access control policy shall be established, documented and reviewed.",guidance:"Define who can access what."},"A.9.2.1":{title:"User Registration and De-registration",description:"A formal user registration and de-registration process shall be implemented to enable assignment of access rights.",guidance:"Automate onboarding and offboarding."},"A.12.6.1":{title:"Management of Technical Vulnerabilities",description:"Information about technical vulnerabilities of information systems being used shall be obtained in a timely fashion.",guidance:"Patch management is crucial."},"A.16.1.1":{title:"Reporting Information Security Events",description:"Information security events shall be reported through appropriate management channels as quickly as possible.",guidance:"Encourage 'See something, say something'."},"A.18.1.4":{title:"Privacy and Protection of Personally Identifiable Information",description:"Privacy and protection of PII shall be ensured as required in relevant legislation and regulation.",guidance:"GDPR compliance is built on this control."}},[d,y]=v.useState(null),[G,C]=v.useState(!1),k=s=>s?Array.isArray(s)?{"NIST 800-53":s}:s:{},A=i.articles.length,M=i.articles.filter(s=>s.mappedControls).length,R=Math.round(M/A*100),S=A-M,I={};return i.articles.forEach(s=>{const n=k(s.mappedControls);Object.keys(n).forEach(m=>{I[m]=(I[m]||0)+1})}),e.jsx(Se,{children:e.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col space-y-4",children:[e.jsx(Ie,{items:[{label:"Compliance Obligations",href:`/clients/${l}/compliance-obligations`},{label:i.name}]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[i.name,e.jsx(r,{variant:"outline",children:i.type})]}),e.jsx("p",{className:"text-muted-foreground",children:i.description})]})}),e.jsxs(Pe,{defaultValue:"guide",className:"h-full flex flex-col overflow-hidden",children:[e.jsxs(ze,{className:"w-full justify-start h-auto p-1 bg-muted rounded-md mb-4 gap-1",children:[e.jsx(J,{value:"guide",className:"px-4 py-2",children:"Regulation Guide"}),e.jsx(J,{value:"crosswalk",className:"px-4 py-2",children:"Control Cross-Walk"}),e.jsx(J,{value:"coverage",className:"px-4 py-2",children:"Coverage Analysis"})]}),e.jsx(K,{value:"guide",className:"flex-1 h-full overflow-hidden mt-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full overflow-hidden",children:[e.jsxs(h,{className:"w-full lg:w-96 flex flex-col h-full border-r-0 lg:border-r rounded-none lg:rounded-lg shadow-none lg:shadow-sm",children:[e.jsx(x,{className:"pb-3 border-b",children:e.jsx(g,{className:"text-lg",children:"Articles"})}),e.jsx(W,{className:"flex-1",children:e.jsx("div",{className:"p-3 space-y-1",children:i.articles.map(s=>e.jsx(o,{variant:t===s.id?"secondary":"ghost",className:te("w-full justify-start text-left h-auto py-3 whitespace-normal",t===s.id?"bg-secondary font-medium":""),onClick:()=>O(s.id),children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(r,{variant:"outline",className:"mt-0.5 shrink-0 w-10 h-6 flex items-center justify-center p-0 text-xs",children:s.numericId}),e.jsx("span",{className:"text-sm leading-snug",children:s.title})]})},s.id))})})]}),e.jsx("div",{className:"flex-1 h-full overflow-hidden flex flex-col",children:a?e.jsxs(h,{className:"h-full flex flex-col border-none shadow-md",children:[e.jsxs(x,{className:"border-b bg-muted/20 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs(r,{children:[i.name," Article ",a.numericId]}),i.type&&e.jsx(r,{variant:"outline",children:i.type})]}),e.jsx(g,{className:"text-2xl",children:a.title})]}),e.jsx(W,{className:"flex-1",children:e.jsx(b,{className:"p-8 max-w-4xl mx-auto",children:e.jsxs("div",{className:"prose prose-slate dark:prose-invert max-w-none",children:[e.jsx("p",{className:"text-lg leading-relaxed",children:a.description}),a.subArticles&&a.subArticles.length>0&&e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Sub-Articles"}),e.jsx("div",{className:"grid gap-4",children:a.subArticles.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border bg-card/50",children:[e.jsx("h4",{className:"font-medium mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]},s.id))})]}),a.mappedControls&&e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("h3",{className:"text-sm font-semibold uppercase text-muted-foreground mb-4 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"})," Mapped Controls"]}),Object.entries(k(a.mappedControls)).map(([s,n])=>e.jsxs("div",{className:"mb-4 last:mb-0",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground mb-2",children:s}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(m=>e.jsx(r,{variant:s.includes("NIST")?"secondary":"outline",className:"font-mono cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>y({id:m,framework:s}),children:m},m))})]},s))]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold uppercase text-muted-foreground flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"})," Evidence & Policies"]}),e.jsxs(o,{variant:"outline",size:"sm",className:"h-8 gap-2",onClick:()=>L(!0),children:[e.jsx(X,{className:"h-3 w-3"})," Link Item"]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[c.policies.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Linked Policies"}),e.jsx("div",{className:"space-y-2",children:c.policies.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 border rounded bg-slate-50 hover:bg-slate-100 cursor-pointer group",onClick:()=>N(`/clients/${l}/privacy/documents/${s.id}`),children:[e.jsx(U,{className:"h-3 w-3 text-blue-500"}),e.jsx("span",{className:"truncate flex-1 group-hover:text-blue-600 transition-colors font-medium",children:s.name}),e.jsx(r,{variant:"outline",className:"text-[10px] bg-white",children:s.status}),e.jsx(Y,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.id))})]}),c.evidence.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Linked Evidence"}),e.jsx("div",{className:"space-y-2",children:c.evidence.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 border rounded bg-slate-50 hover:bg-slate-100 cursor-pointer group",onClick:()=>N(`/clients/${l}/intake`),children:[e.jsx(q,{className:"h-3 w-3 text-orange-500"}),e.jsx("span",{className:"truncate flex-1 group-hover:text-orange-600 transition-colors font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s.fileType,")"]}),e.jsx(Y,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.id))})]}),c.controls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Linked Client Controls"}),e.jsx("div",{className:"space-y-2",children:c.controls.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 border rounded bg-slate-50 hover:bg-slate-100 cursor-pointer group",onClick:()=>N(`/clients/${l}/controls`),children:[e.jsx(P,{className:"h-3 w-3 text-emerald-500"}),e.jsxs("span",{className:"truncate flex-1 group-hover:text-emerald-600 transition-colors font-medium",children:[s.clientControlId," - ",s.status]}),e.jsx(Y,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.id))})]}),c.policies.length===0&&c.evidence.length===0&&c.controls.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No direct items linked to this article."})]})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Select an article to view details"})})]})}),e.jsx(K,{value:"crosswalk",className:"mt-4 flex-1 h-full overflow-y-auto pb-20",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(g,{children:"Control Cross-Walk (Multi-Framework)"}),e.jsx($,{children:"View compliance mapping across multiple standards (NIST 800-53, ISO 27001)."})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4 mb-6 flex items-start gap-3 text-blue-800",children:[e.jsx(Re,{className:"h-5 w-5 shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["Displaying ",i.articles.filter(s=>s.mappedControls).length," of ",i.articles.length," Articles"]}),e.jsx("p",{className:"text-sm opacity-90",children:"This view filters to only show articles that have specific control mappings defined (NIST 800-53, ISO 27001, etc). Articles without direct control mappings (such as definitions or purely administrative clauses) are hidden from this view."})]})]}),i.articles.filter(s=>s.mappedControls).length>0?i.articles.filter(s=>s.mappedControls).map(s=>e.jsxs("div",{className:"flex flex-col border-b pb-4 last:border-0 last:pb-0 gap-3",children:[e.jsx("div",{children:e.jsxs("h4",{className:"font-semibold text-sm",children:["Article ",s.numericId,": ",s.title]})}),e.jsx("div",{className:"flex flex-col gap-2",children:Object.entries(k(s.mappedControls)).map(([n,m])=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("span",{className:"w-24 shrink-0 text-muted-foreground text-xs font-semibold",children:n}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:m.map(V=>e.jsx(r,{variant:"outline",className:"font-mono bg-muted/50 cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>y({id:V,framework:n}),children:V},V))})]},n))})]},s.id)):e.jsx("p",{className:"text-muted-foreground italic",children:"No mappings defined for this regulation yet."})]})})]})}),t&&e.jsx($e,{isOpen:D,onClose:()=>L(!1),clientId:l,regulationId:u,articleId:t,onSuccess:()=>{}}),e.jsxs(K,{value:"coverage",className:"mt-4 flex-1 h-full overflow-y-auto pb-20",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs(h,{className:"bg-primary/5 border-primary/20",children:[e.jsx(x,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"})," Overall Readiness"]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[R,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[M," of ",A," articles covered"]}),e.jsx("div",{className:"w-full bg-secondary h-2 rounded-full mt-3 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-full rounded-full transition-all duration-500",style:{width:`${R}%`}})})]})]}),e.jsxs(h,{className:"cursor-pointer hover:bg-muted/50 transition-colors border-orange-200",onClick:()=>C(!0),children:[e.jsx(x,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-orange-600"})," Compliance Gaps"]})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:S}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Articles needing attention"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-2 underline",children:"Click to view details"})]})]}),e.jsxs(h,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"})," Active Frameworks"]})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(I).length}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Object.keys(I).map(s=>e.jsx(r,{variant:"outline",className:"text-[10px]",children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"h-full",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"})," Framework Contribution"]}),e.jsx($,{children:"Number of articles covered by each framework."})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(I).map(([s,n])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsxs("span",{className:"text-muted-foreground",children:[n," / ",A]})]}),e.jsx("div",{className:"w-full bg-muted h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full",style:{width:`${n/A*100}%`}})})]},s))})})]}),e.jsxs(h,{className:"h-full",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"})," Unmapped Areas"]}),e.jsx($,{children:"Top unaddressed articles."})]}),e.jsx(W,{className:"h-[300px]",children:e.jsx(b,{children:e.jsxs("div",{className:"space-y-2",children:[i.articles.filter(s=>!s.mappedControls).slice(0,10).map(s=>e.jsxs("div",{className:"p-3 border rounded-md bg-muted/20 flex gap-3",children:[e.jsx(r,{variant:"outline",className:"h-6 w-8 shrink-0 flex items-center justify-center p-0",children:s.numericId}),e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description})]}),e.jsxs(o,{size:"sm",variant:"ghost",className:"h-8 gap-1 text-[10px]",onClick:()=>N(`/clients/${l}/implementation`),children:[e.jsx(X,{className:"h-3 w-3"})," Remediate"]})]},s.id)),S>10&&e.jsxs("p",{className:"text-center text-xs text-muted-foreground italic mt-4",children:["+ ",S-10," more unmapped articles"]})]})})})]})]}),e.jsxs(h,{className:"mt-6",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-red-500"})," Risk Alignment"]}),e.jsx($,{children:"Risks mitigated by controls mapped to this regulation."})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>N(`/clients/${l}/risks`),children:"View Risk Register"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-xl bg-red-50/50 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{variant:"destructive",children:"High Exposure"}),e.jsx(Q,{className:"h-4 w-4 text-red-600"})]}),e.jsx("h4",{className:"font-bold text-sm",children:"Regulatory Non-Compliance Risk"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fines up to 4% of global turnover for Article 32 violations."}),e.jsxs("div",{className:"mt-auto pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-red-700",children:"Priority: Critical"}),e.jsx(o,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-red-700",children:"Link to Mitigation"})]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-blue-50/50 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Operational Risk"}),e.jsx(P,{className:"h-4 w-4 text-blue-600"})]}),e.jsx("h4",{className:"font-bold text-sm",children:"Data Breach Impact"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reputational damage and customer churn post-breach."}),e.jsxs("div",{className:"mt-auto pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-blue-700",children:"Status: Managed"}),e.jsx(o,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-blue-700",children:"View Control"})]})]}),e.jsxs("div",{className:"p-4 border rounded-xl border-dashed flex flex-col items-center justify-center text-center p-6 bg-slate-50/50 cursor-pointer hover:bg-slate-100/50 transition-colors",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center mb-2",children:e.jsx(X,{className:"h-4 w-4 text-slate-500"})}),e.jsx("p",{className:"text-xs font-medium",children:"Link New Risk Scenario"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Connect obligation to existing risk"})]})]})})]})]})]}),e.jsx(ee,{open:!!d,onOpenChange:s=>!s&&y(null),title:e.jsxs("div",{className:"flex items-center justify-between w-full pr-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),d==null?void 0:d.id]}),d&&e.jsx(r,{variant:"outline",children:d.framework})]}),description:"Common framework control definition.",footer:e.jsx(o,{variant:"outline",onClick:()=>y(null),children:"Close"}),children:d&&j[d.id]?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:j[d.id].title}),e.jsx("p",{className:"text-muted-foreground mt-1",children:j[d.id].description})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-md",children:[e.jsxs("h5",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"})," Implementation Guidance"]}),e.jsx("p",{className:"text-sm",children:j[d.id].guidance})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No detailed definition available for this control ID."})})}),e.jsx(ee,{open:G,onOpenChange:C,title:e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(Q,{className:"h-5 w-5"})," Unmapped Articles (",S,")"]}),description:"The following articles currently have no controls mapped to them.",size:"xl",footer:e.jsx(o,{onClick:()=>C(!1),children:"Close"}),children:e.jsx("div",{className:"space-y-3 py-4",children:i.articles.filter(s=>!s.mappedControls).map(s=>e.jsxs("div",{className:"p-4 border rounded-lg bg-orange-50/50 border-orange-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{variant:"outline",className:"border-orange-200 text-orange-700 bg-orange-50",children:["Article ",s.numericId]}),e.jsx("h4",{className:"font-semibold text-sm",children:s.title})]}),e.jsxs(o,{size:"sm",variant:"ghost",className:"h-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50 gap-2",onClick:()=>F(s),disabled:f.loading,children:[f.loading&&f.articleId===s.id?e.jsx(Me,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"}),"Suggest Mapping"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),f.articleId===s.id&&f.matches&&e.jsxs("div",{className:"mt-3 p-3 bg-white border rounded-md shadow-sm animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("h5",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 text-purple-500"})," AI Suggested Controls"]}),e.jsx("div",{className:"space-y-2",children:f.matches.map((n,m)=>e.jsxs("div",{className:"flex gap-2 text-sm items-start p-2 bg-slate-50 rounded",children:[e.jsx(r,{className:"shrink-0",children:n.controlId}),e.jsx("span",{className:"text-slate-600 text-xs mt-0.5",children:n.reason})]},m))}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>w({loading:!1,articleId:null,matches:null}),children:"Dimiss"}),e.jsx(o,{size:"sm",onClick:()=>B.success("This would save the mapping in a real implementation!"),children:"Accept Suggestion"})]})]})]},s.id))})})]})})}export{Ps as default};
