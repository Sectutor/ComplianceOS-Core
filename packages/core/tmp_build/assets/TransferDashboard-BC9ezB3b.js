import{ab as ee,b as se,r as i,t as u,i as o,j as e,c as h,C as g,d as T,e as S,m as f,I as G,N as ae,O as te,P as A,Q as j,V as ne,W as l,S as re,D as le,o as ie,p as oe,q as de,s as ce,L as p,E as v,G as C,H as N,J as y,K as n,w as me,k as b,T as xe}from"./index-DOc7Nwb7.js";import{A as ue,a as he,b as je,c as pe,d as ge,e as fe,f as ve,g as Ce}from"./alert-dialog-V7xGXdVc.js";import{B as Ne}from"./Breadcrumb-CRi3LAxS.js";import{P as ye}from"./PageGuide-CPKKXXS6.js";import{P as be}from"./plus-BaQ35Jcx.js";import{S as Te}from"./search-CwuIBBPE.js";import{G as Se}from"./globe-BMGZmoaJ.js";import{E as Ae}from"./external-link-C3PXjBR9.js";import{S as Ie}from"./square-pen-ClRv15cM.js";import{T as we}from"./trash-2-CFEfisbM.js";import{C as De}from"./clock-osbacZli.js";import{C as Me}from"./circle-check-big-BSqJVrgh.js";import{f as Ee}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";const Pe=[{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"JP",name:"Japan"},{code:"CH",name:"Switzerland"},{code:"IN",name:"India"},{code:"SG",name:"Singapore"},{code:"IL",name:"Israel"},{code:"KR",name:"South Korea"},{code:"NZ",name:"New Zealand"},{code:"BR",name:"Brazil"},{code:"MX",name:"Mexico"},{code:"TR",name:"Turkey"},{code:"CN",name:"China"},{code:"AE",name:"United Arab Emirates"},{code:"HK",name:"Hong Kong"},{code:"AR",name:"Argentina"},{code:"RU",name:"Russia"},{code:"ZA",name:"South Africa"},{code:"TH",name:"Thailand"},{code:"MY",name:"Malaysia"},{code:"ID",name:"Indonesia"},{code:"VN",name:"Vietnam"},{code:"PH",name:"Philippines"},{code:"SA",name:"Saudi Arabia"},{code:"EG",name:"Egypt"},{code:"NG",name:"Nigeria"},{code:"KE",name:"Kenya"},{code:"CO",name:"Colombia"},{code:"CL",name:"Chile"},{code:"PE",name:"Peru"},{code:"UA",name:"Ukraine"},{code:"RS",name:"Serbia"},{code:"MA",name:"Morocco"}].sort((I,L)=>I.name.localeCompare(L.name));function es(){const{id:I}=ee(),[L,K]=se(),d=parseInt(I||"0"),[w,_]=i.useState(""),[q,c]=i.useState(!1),[a,r]=i.useState({title:"",destinationCountry:"",transferTool:"scc_2021",sccModule:void 0,activityId:void 0,vendorId:void 0}),{data:t,isLoading:Q,refetch:D}=u.transfers.list.useQuery({clientId:d}),{data:M}=u.processingActivities.list.useQuery({clientId:d}),{data:m}=u.vendors.list.useQuery({clientId:d}),[E,R]=i.useState(!1),[U,B]=i.useState(null),[V,H]=i.useState(null),[$,P]=i.useState(!1),O=u.transfers.create.useMutation({onSuccess:()=>{o.success("Transfer record created successfully"),c(!1),k(),D()},onError:s=>o.error(`Error: ${s.message}`)}),F=u.transfers.update.useMutation({onSuccess:()=>{o.success("Transfer record updated"),c(!1),k(),D()},onError:s=>o.error(`Error: ${s.message}`)}),J=u.transfers.delete.useMutation({onSuccess:()=>{o.success("Transfer deleted"),P(!1),H(null),D()},onError:s=>o.error(`Error: ${s.message}`)}),k=()=>{r({title:"",destinationCountry:"",transferTool:"scc_2021",sccModule:void 0,activityId:void 0,vendorId:void 0}),R(!1),B(null)},Z=()=>{if(!a.title||!a.destinationCountry||!a.transferTool){o.error("Please fill in all required fields");return}E&&U?F.mutate({id:U,title:a.title}):O.mutate({clientId:d,title:a.title,destinationCountry:a.destinationCountry.toUpperCase(),transferTool:a.transferTool,sccModule:a.sccModule||void 0,activityId:a.activityId,vendorId:a.vendorId})},W=()=>{V&&J.mutate({id:V})},X=s=>{switch(s){case"active":return e.jsxs(b,{className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"})," Active"]});case"pending":return e.jsxs(b,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[e.jsx(De,{className:"w-3 h-3 mr-1"})," Pending TIA"]});case"risk_flagged":return e.jsxs(b,{className:"bg-red-100 text-red-800 border-red-200",children:[e.jsx(xe,{className:"w-3 h-3 mr-1"})," Risk Flagged"]});case"expired":return e.jsx(b,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Expired"});default:return e.jsx(b,{variant:"outline",children:s})}},x=t==null?void 0:t.filter(s=>s.title.toLowerCase().includes(w.toLowerCase())||s.destinationCountry.toLowerCase().includes(w.toLowerCase()));return e.jsxs("div",{className:"space-y-6 flex flex-col h-full",children:[e.jsx(Ne,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Privacy",href:`/clients/${d}/privacy`},{label:"International Transfers"}]}),e.jsxs("div",{className:"flex justify-between items-center -mb-2 animate-slide-down",children:[e.jsx(ye,{title:"International Data Transfers",description:"Map and legitimize cross-border data flows.",rationale:"Ensure Chapter V compliance for transfers to non-adequate countries.",howToUse:[{step:"Map",description:"Identify transfers and destination countries."},{step:"Legitimize",description:"Select transfer tool (Adequacy, SCCs, BCRs)."},{step:"Assess",description:"Conduct Transfer Impact Assessment (TIA) for high-risk flows."}]}),e.jsxs(h,{onClick:()=>{k(),c(!0)},children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," New Transfer"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(g,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Total Transfers"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.length)||0})})]}),e.jsxs(g,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Active Flows"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(t==null?void 0:t.filter(s=>s.status==="active").length)||0})})]}),e.jsxs(g,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"Pending TIA"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(t==null?void 0:t.filter(s=>s.status==="pending").length)||0})})]}),e.jsxs(g,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(S,{className:"text-sm font-medium text-muted-foreground",children:"High Risk"})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(t==null?void 0:t.filter(s=>s.status==="risk_flagged").length)||0})})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search transfers or countries...",value:w,onChange:s=>_(s.target.value),className:"pl-10"})]})}),e.jsx(g,{children:e.jsx(f,{className:"p-0",children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(A,{children:[e.jsx(j,{children:"Transfer Name"}),e.jsx(j,{children:"Destination"}),e.jsx(j,{children:"Transfer Tool"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Last Updated"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(ne,{children:Q?e.jsx(A,{children:e.jsx(l,{colSpan:6,className:"text-center py-10",children:"Loading..."})}):(x==null?void 0:x.length)===0?e.jsx(A,{children:e.jsx(l,{colSpan:6,className:"text-center py-10",children:"No transfers found"})}):x==null?void 0:x.map(s=>{var z;return e.jsxs(A,{children:[e.jsx(l,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.title}),s.vendorId&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center mt-1",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),((z=m==null?void 0:m.find(Y=>Y.id===s.vendorId))==null?void 0:z.name)||"Unknown Vendor"]})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 mr-2 text-slate-400"}),e.jsx("span",{className:"font-mono bg-slate-100 px-1.5 py-0.5 rounded text-xs uppercase",children:s.destinationCountry})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"capitalize text-sm font-medium",children:s.transferTool.replace("_"," ")}),s.sccModule&&e.jsxs("span",{className:"text-[10px] text-blue-600 font-bold uppercase",children:["Module ",s.sccModule.replace("c","C").replace("p","P")]})]})}),e.jsx(l,{children:X(s.status||"pending")}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.updatedAt?Ee(new Date(s.updatedAt),"MMM d, yyyy"):"-"}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>K(`/clients/${d}/privacy/transfers/${s.id}`),children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"})," Open TIA"]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>{r({title:s.title,destinationCountry:s.destinationCountry,transferTool:s.transferTool,sccModule:s.sccModule||void 0,activityId:s.activityId||void 0,vendorId:s.vendorId||void 0}),R(!0),B(s.id),c(!0)},children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>{H(s.id),P(!0)},children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id)})})]})})}),e.jsx(le,{open:q,onOpenChange:c,children:e.jsxs(ie,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(de,{children:E?"Edit Transfer":"New International Transfer"}),e.jsx(ce,{children:"Define a new data flow to a country outside the EEA."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"title",children:"Transfer Title"}),e.jsx(G,{id:"title",value:a.title,onChange:s=>r({...a,title:s.target.value}),placeholder:"e.g. AWS US Hosting Flow"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"country",children:"Destination Country"}),e.jsxs(v,{value:a.destinationCountry,onValueChange:s=>r({...a,destinationCountry:s}),children:[e.jsx(C,{id:"country",children:e.jsx(N,{placeholder:"Select Country"})}),e.jsx(y,{children:Pe.map(s=>e.jsxs(n,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"vendor",children:"Vendor (Optional)"}),e.jsxs(v,{value:a.vendorId?a.vendorId.toString():"none",onValueChange:s=>r({...a,vendorId:s==="none"?void 0:parseInt(s)}),children:[e.jsx(C,{id:"vendor",children:e.jsx(N,{placeholder:"Select Vendor"})}),e.jsxs(y,{children:[e.jsx(n,{value:"none",children:"No Vendor Linked"}),m==null?void 0:m.map(({vendor:s})=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Transfer Tool (Legal Basis)"}),e.jsxs(v,{value:a.transferTool,onValueChange:s=>r({...a,transferTool:s}),children:[e.jsx(C,{children:e.jsx(N,{})}),e.jsxs(y,{children:[e.jsx(n,{value:"adequacy",children:"Adequacy Decision (Art. 45)"}),e.jsx(n,{value:"scc_2021",children:"SCCs 2021 (Art. 46)"}),e.jsx(n,{value:"bcr",children:"Binding Corporate Rules (BCR)"}),e.jsx(n,{value:"derogation",children:"Derogation (Art. 49)"}),e.jsx(n,{value:"ad_hoc",children:"Ad-hoc Contractual Clauses"})]})]})]}),a.transferTool==="scc_2021"&&e.jsxs("div",{className:"space-y-2 border-l-2 border-blue-500 pl-4 py-1 bg-blue-50/50",children:[e.jsx(p,{className:"text-blue-700",children:"SCC Module Selection"}),e.jsxs(v,{value:a.sccModule||"",onValueChange:s=>{r({...a,sccModule:s})},children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Select Module"})}),e.jsxs(y,{children:[e.jsx(n,{value:"c2c",children:"Module 1: Controller to Controller"}),e.jsx(n,{value:"c2p",children:"Module 2: Controller to Processor"}),e.jsx(n,{value:"p2p",children:"Module 3: Processor to Processor"}),e.jsx(n,{value:"p2c",children:"Module 4: Processor to Controller"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"activity",children:"Link to Processing Activity (ROPA)"}),e.jsxs(v,{value:a.activityId?a.activityId.toString():"none",onValueChange:s=>r({...a,activityId:s==="none"?void 0:parseInt(s)}),children:[e.jsx(C,{id:"activity",children:e.jsx(N,{placeholder:"Select Activity"})}),e.jsxs(y,{children:[e.jsx(n,{value:"none",children:"No Activity Linked"}),M==null?void 0:M.map(s=>e.jsx(n,{value:s.id.toString(),children:s.activityName},s.id))]})]})]})]}),e.jsxs(me,{children:[e.jsx(h,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(h,{onClick:Z,disabled:O.isPending||F.isPending,children:E?"Update Transfer":"Create Transfer"})]})]})}),e.jsx(ue,{open:$,onOpenChange:P,children:e.jsxs(he,{children:[e.jsxs(je,{children:[e.jsx(pe,{children:"Are you sure?"}),e.jsx(ge,{children:"This will remove this international transfer record. Any associated Transfer Impact Assessments (TIA) will remain in the database but will be unlinked."})]}),e.jsxs(fe,{children:[e.jsx(ve,{children:"Cancel"}),e.jsx(Ce,{onClick:W,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})}export{es as default};
