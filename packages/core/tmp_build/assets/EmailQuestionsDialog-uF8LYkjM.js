import{r as t,t as k,j as e,L as r,I as x,c as i,k as R,x as M,i as l}from"./index-DOc7Nwb7.js";import{E as P}from"./enhanced-dialog-CeRPsI16.js";import{T}from"./textarea-BtxBxzdY.js";import{C}from"./circle-check-C5kiwRoG.js";import{C as D}from"./copy-CXVMffmd.js";import{E as A}from"./external-link-C3PXjBR9.js";import{S as F}from"./send-FW7-3cjH.js";function H({open:w,onOpenChange:c,assessmentId:E,selectedControlIds:o,controls:S}){const[n,g]=t.useState(""),[j,f]=t.useState(""),[d,v]=t.useState(""),[a,N]=t.useState(null),[b,m]=t.useState(!1),h=k.gapQuestionnaire.create.useMutation(),p=k.gapQuestionnaire.sendEmail.useMutation(),u=S.filter(s=>o.includes(s.id)),L=async()=>{if(!n){l.error("Please enter a recipient email");return}if(o.length===0){l.error("Please select at least one control");return}try{const s=await h.mutateAsync({assessmentId:E,recipientEmail:n,recipientName:j||void 0,controlIds:o,message:d||void 0});await p.mutateAsync({email:n,link:s.link,message:d||void 0}),N(s.link),l.success(`Questionnaire created! Share the link with ${n}`)}catch(s){l.error(s.message)}},Q=()=>{a&&(navigator.clipboard.writeText(window.location.origin+a),m(!0),l.success("Link copied to clipboard!"),setTimeout(()=>m(!1),2e3))},y=()=>{g(""),f(""),v(""),N(null),m(!1)};return e.jsx(P,{open:w,onOpenChange:s=>{s||y(),c(s)},title:a?"Questionnaire Ready!":"Email Questions",description:a?"Share this link with the recipient":`Send ${o.length} question(s) to a stakeholder for input`,size:"lg",children:a?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-green-700 font-medium",children:"Questionnaire created successfully!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Response Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{value:window.location.origin+a,readOnly:!0,className:"font-mono text-sm"}),e.jsx(i,{variant:"outline",onClick:Q,children:b?e.jsx(C,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",asChild:!0,children:e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:e.jsx(A,{className:"h-4 w-4"})})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Send this link to ",n,". The link expires in 7 days."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(i,{variant:"outline",onClick:y,children:"Send Another"}),e.jsx(i,{onClick:()=>c(!1),children:"Done"})]})]}):e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{children:["Controls to Include (",u.length,")"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 space-y-1",children:u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No controls selected"}):u.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(R,{variant:"outline",className:"font-mono text-xs",children:s.controlId}),e.jsx("span",{className:"truncate",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Recipient Email *"}),e.jsx(x,{id:"email",type:"email",placeholder:"stakeholder@company.com",value:n,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Recipient Name"}),e.jsx(x,{id:"name",placeholder:"John Doe",value:j,onChange:s=>f(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"message",children:"Custom Message (Optional)"}),e.jsx(T,{id:"message",placeholder:"Hi, please provide your input on these controls for our compliance assessment...",value:d,onChange:s=>v(s.target.value),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(i,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(i,{onClick:L,disabled:h.isPending||p.isPending,className:"gap-2",children:[h.isPending||p.isPending?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(F,{className:"h-4 w-4"}),"Create & Get Link"]})]})]})})}export{H as E};
