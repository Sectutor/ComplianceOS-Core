import{r as b,t as c,i as h,j as s,L as N,c as d,l as E}from"./index-DOc7Nwb7.js";import{E as C}from"./enhanced-dialog-CeRPsI16.js";import{a as D,b as v,c as S,d as w,e as P,f as k}from"./DashboardLayout-aHnUqq57.js";import{c as x}from"./utils-BC5CVi_C.js";function R({policyId:m,clientId:a,open:u,onOpenChange:n}){const[i,l]=b.useState([]),g=c.useUtils(),{data:t}=c.employees.list.useQuery({clientId:a},{enabled:u&&a>0}),r=c.policyManagement.assignPolicy.useMutation({onSuccess:e=>{h.success(`Policy distributed to ${e.count} employees`),n(!1),l([]),g.policyManagement.getAssignments.invalidate({policyId:m})},onError:e=>h.error(e.message)}),p=()=>{i.length!==0&&r.mutate({clientId:a,policyId:m,employeeIds:i})},f=e=>{l(o=>o.includes(e)?o.filter(j=>j!==e):[...o,e])},y=()=>{t&&(i.length===t.length?l([]):l(t.map(e=>e.id)))};return s.jsx(C,{open:u,onOpenChange:n,title:"Distribute Policy",description:"Select employees who must read and attest to this policy.",trigger:null,footer:s.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[s.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),s.jsx(d,{onClick:p,disabled:i.length===0||r.isPending,children:r.isPending?"Distributing...":`Distribute to ${i.length} Employees`})]}),children:s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(N,{children:"Select Recipients"}),s.jsx(d,{variant:"ghost",size:"sm",onClick:y,children:t&&i.length===t.length?"Deselect All":"Select All"})]}),s.jsxs(D,{className:"border rounded-md max-h-[300px]",children:[s.jsx(v,{placeholder:"Search employees..."}),s.jsxs(S,{children:[s.jsx(w,{children:"No employees found."}),s.jsx(P,{children:t==null?void 0:t.map(e=>s.jsxs(k,{value:`${e.firstName} ${e.lastName}`,onSelect:()=>f(e.id),className:"cursor-pointer",children:[s.jsx("div",{className:x("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",i.includes(e.id)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:s.jsx(E,{className:x("h-4 w-4")})}),s.jsxs("span",{children:[e.firstName," ",e.lastName]}),s.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",e.jobTitle,")"]})]},e.id))})]})]})]})})}export{R as D};
