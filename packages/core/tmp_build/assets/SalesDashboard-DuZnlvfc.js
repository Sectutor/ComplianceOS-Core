import{t as j,r as S,j as e,k as C,C as u,m as g,i as T,D as H,ap as Q,c as N,o as U,p as $,q as R,s as W,L as D,I as L,E as q,G as z,H as K,J as G,K as J,w as X,x as Y,U as Z,d as w,e as y,N as _,O as ee,P as V,Q as f,V as se,W as b}from"./index-DOc7Nwb7.js";import{S as te}from"./scroll-area-DPaNxEJD.js";import{c as ae}from"./utils-BC5CVi_C.js";import{D as E}from"./dollar-sign-M9UCfTjq.js";import{f as F}from"./format-H2tx8_vS.js";import{u as re}from"./index.esm-BxsGsA2t.js";import{t as le,o as ie,s as I,c as ne}from"./zod-NsgrLny8.js";import{P as oe}from"./plus-BaQ35Jcx.js";import{D as de}from"./DashboardLayout-aHnUqq57.js";import{T as ce,a as me,b as k,c as A}from"./tabs-CBDTXbEn.js";import{L as xe}from"./layout-grid-CGqkIAJU.js";import{L as he}from"./list-BZOuFwEg.js";import{B as pe}from"./briefcase-BxorFA78.js";import{T as ue}from"./trending-up-eUiO956o.js";import{A as ge}from"./activity-B1F2IRm3.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";const je=[{id:1,title:"New Lead",color:"bg-slate-50 border-t-4 border-slate-500"},{id:2,title:"Qualified",color:"bg-blue-50 border-t-4 border-blue-500"},{id:3,title:"Proposal",color:"bg-orange-50 border-t-4 border-orange-500"},{id:4,title:"Negotiation",color:"bg-purple-50 border-t-4 border-purple-500"},{id:5,title:"Won",color:"bg-emerald-50 border-t-4 border-emerald-500"},{id:6,title:"Lost",color:"bg-red-50 border-t-4 border-red-500"}];function fe({clientId:l}){const{data:t,isLoading:o,refetch:x}=j.sales.getDeals.useQuery({}),h=j.sales.updateDealStage.useMutation(),[p,c]=S.useState(null),[a,d]=S.useState(null),r=(s,i)=>{s.dataTransfer.setData("dealId",i.toString()),c(i)},P=(s,i)=>{s.preventDefault(),a!==i&&d(i)},B=async(s,i)=>{s.preventDefault(),d(null);const m=parseInt(s.dataTransfer.getData("dealId"));if(m)try{await h.mutateAsync({dealId:m,stageId:i}),T.success("Deal moved!"),x()}catch{T.error("Failed to move deal")}c(null)},v=S.useMemo(()=>{const s={};return t==null||t.forEach(i=>{const m=i.stageId;s[m]||(s[m]=[]),s[m].push(i)}),s},[t]);return o?e.jsx("div",{children:"Loading pipeline..."}):e.jsx("div",{className:"h-full flex flex-col gap-4",children:e.jsx("div",{className:"flex-1 overflow-x-auto min-h-[500px]",children:e.jsx("div",{className:"flex gap-4 h-full min-w-[1000px]",children:je.map(s=>{var i,m;return e.jsxs("div",{className:ae("flex-1 flex flex-col rounded-lg border shadow-sm p-3 min-w-[280px] transition-all duration-200 h-full",s.color,a===s.id&&"ring-2 ring-primary/20 scale-[1.01]"),onDragOver:n=>P(n,s.id),onDrop:n=>B(n,s.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 uppercase tracking-wider",children:s.title}),e.jsx(C,{variant:"secondary",className:"bg-white/50 text-slate-700 hover:bg-white/80",children:((i=v[s.id])==null?void 0:i.length)||0})]}),e.jsx(te,{className:"flex-1",children:e.jsxs("div",{className:"space-y-3 pr-2 pb-2",children:[(m=v[s.id])==null?void 0:m.map(n=>{var M;return e.jsx(u,{draggable:!0,onDragStart:O=>r(O,n.id),className:"cursor-grab active:cursor-grabbing hover:shadow-lg transition-all duration-200 border-none shadow-sm ring-1 ring-slate-200",children:e.jsxs(g,{className:"p-4 space-y-3",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-900 leading-tight",children:n.title}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs(C,{variant:"outline",className:"font-mono text-[10px] bg-slate-50",children:[e.jsx(E,{className:"w-3 h-3 mr-0.5"}),((M=n.value)==null?void 0:M.toLocaleString())||0]}),n.expectedCloseDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-300"}),F(new Date(n.expectedCloseDate),"MMM d")]})]})]})},n.id)}),(!v[s.id]||v[s.id].length===0)&&e.jsx("div",{className:"h-24 border-2 border-dashed border-slate-200 rounded-lg flex items-center justify-center text-slate-400 text-xs",children:"Drop deals here"})]})})]},s.id)})})})})}const be=ie({title:I().min(1,"Title is required"),value:ne.number().min(0,"Value must be positive"),stageId:I().min(1,"Stage is required"),expectedCloseDate:I().optional()});function Ne({trigger:l,onSuccess:t}){const[o,x]=S.useState(!1),h=j.useContext(),{data:p}=j.sales.getStages.useQuery(),c=j.sales.createDeal.useMutation({onSuccess:()=>{T.success("Deal created successfully"),x(!1),a.reset(),h.sales.getDeals.invalidate(),t==null||t()},onError:r=>{T.error(`Failed to create deal: ${r.message}`)}}),a=re({resolver:le(be),defaultValues:{title:"",value:0,stageId:""}}),d=r=>{c.mutate({title:r.title,value:r.value,stageId:parseInt(r.stageId),expectedCloseDate:r.expectedCloseDate||void 0})};return e.jsxs(H,{open:o,onOpenChange:x,children:[e.jsx(Q,{asChild:!0,children:l||e.jsxs(N,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"New Deal"]})}),e.jsxs(U,{className:"sm:max-w-[425px]",children:[e.jsxs($,{children:[e.jsx(R,{children:"Create New Deal"}),e.jsx(W,{children:"Add a new opportunity to your sales pipeline."})]}),e.jsxs("form",{onSubmit:a.handleSubmit(d),className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"title",children:"Deal Title"}),e.jsx(L,{id:"title",placeholder:"e.g. Enterprise License - Acme Corp",...a.register("title")}),a.formState.errors.title&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"value",children:"Value (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"$"}),e.jsx(L,{id:"value",type:"number",className:"pl-7",...a.register("value")})]}),a.formState.errors.value&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.value.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"stage",children:"Stage"}),e.jsxs(q,{onValueChange:r=>a.setValue("stageId",r),defaultValue:a.getValues("stageId"),children:[e.jsx(z,{children:e.jsx(K,{placeholder:"Select a stage"})}),e.jsx(G,{children:p==null?void 0:p.map(r=>e.jsx(J,{value:r.id.toString(),children:r.name},r.id))})]}),a.formState.errors.stageId&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.stageId.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"date",children:"Expected Close Date"}),e.jsx(L,{id:"date",type:"date",...a.register("expectedCloseDate")})]}),e.jsxs(X,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(N,{type:"submit",disabled:c.isLoading,children:[c.isLoading&&e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),"Create Deal"]})]})]})]})]})}function ve({deals:l}){const t=l.reduce((d,r)=>d+(r.value||0),0),o=l.length,x=o>0?t/o:0,h=l.filter(d=>d.stageId===5).length,p=l.filter(d=>d.stageId===6).length,c=h+p,a=c>0?Math.round(h/c*100):0;return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[e.jsxs(u,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Total Pipeline"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",t.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),e.jsxs(u,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Active Deals"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+180.1% from last month"})]})]}),e.jsxs(u,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Avg. Deal Size"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(x).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+19% from last month"})]})]}),e.jsxs(u,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:"Win Rate"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+201 since last hour"})]})]})]})}function De({deals:l}){return l!=null&&l.length?e.jsx("div",{className:"rounded-md border",children:e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Deal Title"}),e.jsx(f,{children:"Value"}),e.jsx(f,{children:"Stage"}),e.jsx(f,{children:"Expected Close"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:l.map(t=>{var o;return e.jsxs(V,{children:[e.jsx(b,{className:"font-medium",children:t.title}),e.jsxs(b,{children:["$",(o=t.value)==null?void 0:o.toLocaleString()]}),e.jsx(b,{children:e.jsx(C,{variant:"outline",children:t.stageId})}),e.jsx(b,{children:t.expectedCloseDate?F(new Date(t.expectedCloseDate),"MMM d, yyyy"):"-"}),e.jsx(b,{className:"text-right",children:e.jsx(N,{variant:"ghost",size:"sm",children:"Edit"})})]},t.id)})})]})}):e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No deals found."})}function xs(){const{data:l,isLoading:t}=j.sales.getDeals.useQuery({});return e.jsx(de,{children:e.jsxs("div",{className:"h-full flex flex-col space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-3",children:["Sales Pipeline",e.jsx(C,{className:"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-none px-3 py-1 text-[10px] font-bold tracking-widest shadow-lg shadow-indigo-200 uppercase",children:"Premium"})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage opportunities and track revenue growth."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:()=>window.location.href="/sales/waitlist",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Waitlist"]}),e.jsx(Ne,{})]})]}),e.jsx(ve,{deals:l||[]}),e.jsxs(ce,{defaultValue:"kanban",className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(me,{children:[e.jsxs(k,{value:"kanban",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Kanban"]}),e.jsxs(k,{value:"list",className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"List View"]})]}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground"})]}),e.jsx(A,{value:"kanban",className:"flex-1 h-full min-h-[500px]",children:e.jsx(fe,{})}),e.jsx(A,{value:"list",children:e.jsx(u,{children:e.jsx(g,{className:"pt-6",children:e.jsx(De,{deals:l||[]})})})})]})]})})}export{xs as default};
