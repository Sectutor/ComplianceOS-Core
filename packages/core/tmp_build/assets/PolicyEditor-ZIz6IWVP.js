import{r as d,j as e,C as ie,d as re,e as le,f as Te,k as I,m as oe,N as vs,O as Ns,P as Q,Q as _,V as ks,W as T,T as ce,c as m,ab as Ws,b as qs,t as j,i as p,x as z,F as se,L,I as ye,U as es,ao as ss,S as B,D as ve,ap as Ne,o as ke,p as we,q as Ce,s as Se,l as ts,w as Re,E as Qs,G as Ys,H as Js,J as Ks,K as te}from"./index-DOc7Nwb7.js";import{D as Pe,a as ns,b as is,c as rs,d as ls,e as os,f as as}from"./DashboardLayout-aHnUqq57.js";import{T as Xs}from"./textarea-BtxBxzdY.js";import{B as Zs}from"./Breadcrumb-CRi3LAxS.js";import{T as cs,a as et,b as G,c as W}from"./tabs-CBDTXbEn.js";import{R as st}from"./RichTextEditor-NQxhVz6n.js";import{d as De}from"./marked.esm-DajSjiQI.js";import{T as tt}from"./turndown.browser.es-DScDaalG.js";import{a as nt,F as it}from"./FileSaver.min-dLwv_bIh.js";import{c as q}from"./utils-BC5CVi_C.js";import{C as ds,a as rt}from"./ControlDetailsDialog-C3wFd0o2.js";import{R as lt}from"./RiskDetailsDialog-AfBJ1Kgz.js";import{S as ms,a as xs}from"./slotNames-XB2IFQPg.js";import{D as ot}from"./DistributionDialog-CHNqqf_x.js";import{P as at}from"./PageGuide-CPKKXXS6.js";import{C as ae}from"./circle-check-C5kiwRoG.js";import{P as ct}from"./plus-BaQ35Jcx.js";import{W as dt}from"./wand-sparkles-BtekNLFr.js";import{A as hs}from"./arrow-left-CpuUojG-.js";import{S as us}from"./sparkles-CoQ80pK2.js";import{E as mt}from"./eye-CIq9q9s6.js";import{S as xt}from"./send-FW7-3cjH.js";import{S as ht}from"./save-CvVmWchr.js";import{R as ut}from"./rotate-ccw-C6dHuDj9.js";import{S as ne}from"./shield-alert-iAruRy4W.js";import{T as Le}from"./trending-down-qhVy-7Im.js";import{T as ps}from"./target-cfAj3L6j.js";import{B as pt}from"./bar-chart-3-BCngNY6H.js";import{L as gs}from"./link-FmUqdGRG.js";import{E as js}from"./external-link-C3PXjBR9.js";import{U as fs}from"./unlink-BReNnSJu.js";import{C as bs}from"./clock-osbacZli.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./brain-C-Zi22rJ.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./enhanced-dialog-CeRPsI16.js";import"./separator-BWuYil37.js";import"./alert-dialog-V7xGXdVc.js";import"./trash-2-CFEfisbM.js";import"./download-ByfWg1Mi.js";import"./info-By5wLOUH.js";const ys=[{id:"purpose",title:"Purpose",markdown:`## Purpose

This policy establishes the objectives and intent of the organization regarding the subject matter, ensuring consistent and compliant operations.`,keywords:["purpose","objective","intent"]},{id:"scope",title:"Scope",markdown:`## Scope

This policy applies to all relevant employees, contractors, systems, and processes within the organization as defined herein.`,keywords:["scope","applies","applicability"]},{id:"roles",title:"Roles and Responsibilities",markdown:`## Roles and Responsibilities

- Executive Sponsor: Provides oversight and approves changes
- Policy Owner: Maintains and reviews the policy
- Employees: Comply with policy requirements`,keywords:["roles","responsibilities","owner","sponsor"]},{id:"policy",title:"Policy Statements",markdown:`## Policy Statements

The organization mandates the following requirements:

1. 
2. 
3. `,keywords:["policy","requirements","mandate"]},{id:"procedures",title:"Procedures",markdown:`## Procedures

Describe the procedures and steps required to implement this policy, including who performs them and when.`,keywords:["procedures","process","steps"]},{id:"exceptions",title:"Exceptions",markdown:`## Exceptions

Exceptions to this policy must be documented, risk-assessed, and approved by the Policy Owner and Executive Sponsor.`,keywords:["exceptions","deviation","waiver"]},{id:"enforcement",title:"Enforcement",markdown:`## Enforcement

Non-compliance with this policy may result in disciplinary action and corrective measures in accordance with HR policies and applicable laws.`,keywords:["enforcement","discipline","non-compliance"]},{id:"definitions",title:"Definitions",markdown:`## Definitions

Provide definitions for key terms used in this policy to ensure clarity and consistency.`,keywords:["definitions","glossary","terms"]},{id:"references",title:"References",markdown:`## References

List related policies, standards, procedures, and external regulations that inform this policy.`,keywords:["references","related policies","standards","regulations"]},{id:"revision",title:"Revision History",markdown:`## Revision History

| Version | Date | Author | Changes |
|--------|------|--------|---------|
| 1.0    |      |        | Initial publication |
`,keywords:["revision","history","version","changes"]}];function gt(N){return N.replace(/<[^>]+>/g," ").replace(/\s+/g," ").toLowerCase()}function jt(N,o){const i=N.includes(o.title.toLowerCase()),H=o.keywords.some(A=>N.includes(A.toLowerCase()));return i||H}function ft(N){return[/\bTBD\b/i,/\[?Company Name\]?/i,/\{\{company(_name)?\}\}/i,/\bLOREM IPSUM\b/i,/\[insert.*?\]/i].filter(i=>i.test(N)).length}function bt({content:N,onInsertSection:o}){const i=d.useMemo(()=>gt(N||""),[N]),H=d.useMemo(()=>ys.map(g=>{const P=jt(i,g);return{id:g.id,type:P?"ok":"missing",title:g.title,description:P?void 0:"Section is recommended and commonly required by auditors.",fixable:!P}}),[i]),A=d.useMemo(()=>ft(i)>0?[{id:"placeholders",type:"warning",title:"Unresolved placeholders",description:"Detected unresolved tokens like TBD or Company Name.",fixable:!1}]:[],[i]),k=[...H.filter(g=>g.type!=="ok"),...A],de=g=>{const P=ys.find(me=>me.id===g);if(!P)return;const Y=De.parse(P.markdown,{async:!1});o(`<div>${Y}</div>`)};return e.jsxs(ie,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Policy Linter"}),e.jsx(Te,{children:"Checks for required sections and common issues"})]}),e.jsx(I,{variant:"outline",className:q(k.length===0?"text-green-700 border-green-200 bg-green-50":"text-amber-700 border-amber-200 bg-amber-50"),children:k.length===0?"No issues":`${k.length} issue(s)`})]})}),e.jsx(oe,{children:k.length===0?e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(ae,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"All required sections detected."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:e.jsxs(Q,{children:[e.jsx(_,{children:"Item"}),e.jsx(_,{children:"Status"}),e.jsx(_,{children:"Action"})]})}),e.jsxs(ks,{children:[H.filter(g=>g.type==="missing").map(g=>e.jsxs(Q,{children:[e.jsx(T,{className:"font-medium",children:g.title}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Missing"})]})}),e.jsx(T,{children:e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>de(g.id),children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Insert Template"]})})]},g.id)),A.map(g=>e.jsxs(Q,{children:[e.jsx(T,{className:"font-medium",children:g.title}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Warning"})]})}),e.jsx(T,{children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),"Review"]})})]},g.id))]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Templates are generic and should be tailored to your organization."})]})})]})}function In(){const N=Ws(),o=Number(N.id),i=Number(N.policyId),[H,A]=qs(),{data:k,isLoading:de,refetch:g}=j.clientPolicies.get.useQuery({id:i,clientId:o},{enabled:!!o&&!!i}),P=j.clientPolicies.update.useMutation(),Y=j.clientPolicies.delete.useMutation(),me=j.clientPolicies.publish.useMutation(),ws=j.clientPolicies.restore.useMutation(),{data:xe,refetch:Cs}=j.clientPolicies.history.useQuery({policyId:i},{enabled:!!i}),{data:f,refetch:Ie}=j.clientPolicies.getLinkedRisks.useQuery({policyId:i},{enabled:!!i}),{data:w,refetch:he}=j.clientPolicies.getLinkedControls.useQuery({policyId:i},{enabled:!!i}),{data:$}=j.risks.getAll.useQuery({clientId:o},{enabled:!!o}),{data:O}=j.clientControls.list.useQuery({clientId:o},{enabled:!!o}),{data:ue,isLoading:Ss}=j.policyManagement.getAssignments.useQuery({policyId:i},{enabled:!!i}),Rs=j.clientPolicies.linkRisk.useMutation(),Ps=j.clientPolicies.unlinkRisk.useMutation(),Ls=j.clientPolicies.linkControl.useMutation(),Ts=j.clientPolicies.unlinkControl.useMutation(),pe=j.intake.createFromPolicy.useMutation({onSuccess:()=>{p.success("Policy sent to evidence intake!")},onError:s=>{console.error("[PolicyEditor] intake.createFromPolicy mutation failed:",s),p.error(s.message||"Failed to send to intake")}}),[D,Ae]=d.useState(""),[y,F]=d.useState(""),[Ee,$e]=d.useState("draft"),[_e,Fe]=d.useState(""),[ge,Me]=d.useState(!1),[V,Ue]=d.useState("edit"),[He,je]=d.useState(!1),[Oe,Ve]=d.useState(!1),[ze,Be]=d.useState(""),[Ge,We]=d.useState(""),[Ds,fe]=d.useState(!1),[yt,vt]=d.useState(!1),[Is,J]=d.useState(!1),[As,K]=d.useState(!1),[C,M]=d.useState([]),[S,U]=d.useState([]),[qe,X]=d.useState([]),[Qe,Z]=d.useState([]),[Ye,Je]=d.useState(null),[ee,Ke]=d.useState(null),[Es,be]=d.useState(!1);d.useMemo(()=>new tt({headingStyle:"atx"}),[]);const n=d.useMemo(()=>{const s=(f||[]).filter(l=>l==null?void 0:l.risk);if(s.length===0)return null;const t=s.reduce((l,h)=>{var R;return l+(((R=h.risk)==null?void 0:R.inherentScore)||0)},0),r=s.reduce((l,h)=>{var R,Ze;return l+(((R=h.risk)==null?void 0:R.residualScore)||((Ze=h.risk)==null?void 0:Ze.inherentScore)||0)},0),c=s.filter(l=>{var h;return(((h=l.risk)==null?void 0:h.inherentScore)||0)>=15}).length,u=s.filter(l=>{var h;return(((h=l.risk)==null?void 0:h.inherentScore)||0)>=20}).length,b=Math.round(t/s.length),v=t>0?Math.round((t-r)/t*100):0,x={critical:s.filter(l=>{var h;return(((h=l.risk)==null?void 0:h.inherentScore)||0)>=20}).length,high:s.filter(l=>{var h,R;return(((h=l.risk)==null?void 0:h.inherentScore)||0)>=15&&(((R=l.risk)==null?void 0:R.inherentScore)||0)<20}).length,medium:s.filter(l=>{var h,R;return(((h=l.risk)==null?void 0:h.inherentScore)||0)>=9&&(((R=l.risk)==null?void 0:R.inherentScore)||0)<15}).length,low:s.filter(l=>{var h;return(((h=l.risk)==null?void 0:h.inherentScore)||0)<9}).length};return{totalRisks:s.length,totalInherentScore:t,totalResidualScore:r,highRiskCount:c,criticalRiskCount:u,averageInherentScore:b,riskReduction:v,riskLevelCounts:x,hasHighRisks:c>0,hasCriticalRisks:u>0}},[f]),a=d.useMemo(()=>{const s=(w||[]).filter(x=>x==null?void 0:x.clientControl);if(s.length===0)return null;const t=s.filter(x=>{var l;return((l=x.clientControl)==null?void 0:l.status)==="implemented"}).length,r=s.filter(x=>{var l;return((l=x.clientControl)==null?void 0:l.status)==="in_progress"}).length,c=s.filter(x=>{var l,h;return((l=x.clientControl)==null?void 0:l.status)==="not_implemented"||!((h=x.clientControl)!=null&&h.status)}).length,u=s.filter(x=>{var l;return((l=x.clientControl)==null?void 0:l.status)==="not_applicable"}).length,b=Math.round(t/s.length*100);new Set((f||[]).filter(x=>x==null?void 0:x.risk).map(x=>x.risk.id));const v=(n==null?void 0:n.highRiskCount)&&t<n.highRiskCount;return{totalControls:s.length,implementedCount:t,inProgressCount:r,notImplementedCount:c,notApplicableCount:u,implementationRate:b,hasUnmitigatedHighRisks:v,allImplemented:t===s.length}},[w,f,n]),Xe=d.useMemo(()=>{const s=[];return(!f||f.length===0)&&s.push({type:"info",message:"No risks linked to this policy",action:"Consider linking relevant risks to assess policy coverage",actionType:"link_risk"}),(!w||w.length===0)&&s.push({type:"info",message:"No controls linked to this policy",action:"Link controls to demonstrate how this policy is enforced",actionType:"link_control"}),n!=null&&n.highRiskCount&&(!a||a.totalControls===0)&&s.push({type:"critical",message:`${n.highRiskCount} high/critical risk(s) with no linked controls`,action:"Urgent: Link mitigating controls to address high-risk exposures",actionType:"link_control"}),a&&a.notImplementedCount>0&&s.push({type:"warning",message:`${a.notImplementedCount} of ${a.totalControls} controls not yet implemented`,action:"Review control implementation status",actionType:"review_controls"}),n!=null&&n.criticalRiskCount&&n.criticalRiskCount>0&&s.push({type:"critical",message:`${n.criticalRiskCount} critical risk(s) affecting this policy`,action:"Immediate attention required for critical risks",actionType:"link_control"}),s},[f,w,n,a]);d.useEffect(()=>{if(k){const s=k.clientPolicy||k;if(Ae(s.name||""),$e(s.status||"draft"),Fe(s.owner||""),s.content)try{je(!1);let t=s.content;if(t.trim().startsWith("```markdown")?t=t.replace(/^```markdown\s*/,"").replace(/\s*```$/,""):t.trim().startsWith("```")&&(t=t.replace(/^```\s*/,"").replace(/\s*```$/,"")),/<[a-z][\s\S]*>/i.test(t))console.log("Detected HTML storage, loading directly"),F(t);else{console.log("Detected Markdown storage, parsing to HTML");const c=De.parse(t,{async:!1});F(c)}}catch(t){console.error("Error parsing markdown:",t),F(s.content)}finally{setTimeout(()=>je(!0),100)}else F(""),je(!0)}},[k]);const $s=async()=>{if(!o||!i){p.error("Missing client or policy ID");return}Me(!0);try{const s=y;await P.mutateAsync({id:i,clientId:o,name:D,content:s,status:Ee,owner:_e}),p.success("Policy updated successfully"),g()}catch(s){console.error("Error saving policy:",s),p.error(s.message||"Failed to save policy")}finally{Me(!1)}},_s=async()=>{if(confirm("Are you sure you want to delete this policy? This action cannot be undone."))try{await Y.mutateAsync({id:i,clientId:o}),p.success("Policy deleted successfully"),A(`/clients/${o}/policies`)}catch(s){console.error("Error deleting policy:",s),p.error(s.message||"Failed to delete policy")}},Fs=async()=>{if(i){Ve(!0);try{await me.mutateAsync({id:i,version:Ge||void 0,notes:ze}),p.success("Version published successfully"),Be(""),We(""),fe(!1),g(),Cs()}catch(s){console.error("Error publishing version:",s),p.error(s.message||"Failed to publish version")}finally{Ve(!1)}}},Ms=async s=>{if(i&&confirm("Are you sure you want to restore this version? This will overwrite the current draft."))try{await ws.mutateAsync({policyId:i,versionId:s}),p.success("Version restored to draft"),g()}catch(t){console.error("Error restoring version:",t),p.error(t.message||"Failed to restore version")}},Us=async()=>{if(!(C.length===0||!i))try{await Promise.all(C.map(s=>Rs.mutateAsync({policyId:i,riskId:s}))),p.success(`${C.length} risk(s) linked successfully`),J(!1),M([]),X([]),Ie()}catch{p.error("Failed to link risks")}},Hs=async s=>{if(i)try{await Ps.mutateAsync({policyId:i,riskId:s}),p.success("Risk unlinked successfully"),Ie()}catch{p.error("Failed to unlink risk")}},Os=async()=>{if(!(S.length===0||!i))try{await Promise.all(S.map(s=>Ls.mutateAsync({policyId:i,controlId:s}))),p.success(`${S.length} control(s) linked successfully`),K(!1),U([]),Z([]),he()}catch{p.error("Failed to link controls")}},Vs=async s=>{if(i)try{await Ts.mutateAsync({policyId:i,controlId:s}),p.success("Control unlinked successfully"),he()}catch{p.error("Failed to unlink control")}},zs=async()=>{if(!i||!o){console.error("[PolicyEditor] Missing required parameters for intake creation:",{policyId:!!i,clientId:!!o}),p.error("Cannot send to intake: missing policy or client ID");return}try{const s={clientId:o,policyId:i};console.log("[PolicyEditor] Calling intake.createFromPolicy with:",s),await pe.mutateAsync(s)}catch{}},Bs=async()=>{try{const s=`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${D}</title>
                    <style>
                        body { font-family: 'Calibri', 'Arial', sans-serif; }
                        h1 { color: #2E74B5; border-bottom: 1px solid #2E74B5; padding-bottom: 10px; }
                        h2 { color: #2E74B5; margin-top: 20px; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th { background-color: #F2F2F2; border: 1px solid #DDD; padding: 8px; text-align: left; }
                        td { border: 1px solid #DDD; padding: 8px; }
                    </style>
                </head>
                <body>
                    <h1 style="text-align: center;">${D}</h1>
                    <p style="text-align: center; color: #666; margin-bottom: 30px;">Generated by ComplianceOS</p>
                    ${y}
                    <br/><br/>
                    <hr/>
                    <p style="font-size: 10pt; color: #999; text-align: center;">Confidential - ${new Date().toLocaleDateString()}</p>
                </body>
                </html>
            `,t=await nt(s);it.saveAs(t,`${D.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.docx`),p.success("Word export downloaded")}catch(s){console.error("Export failed:",s),p.error("Failed to export Word document")}},Gs=()=>{try{return y&&y.trim()!==""?y.includes("<")&&y.includes(">")?{__html:y}:{__html:De.parse(y,{async:!1})}:{__html:""}}catch(s){return console.error("Error rendering preview:",s),{__html:y||""}}};if(de)return e.jsx(Pe,{children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(z,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Loading policy..."})]})});if(!k)return e.jsx(Pe,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsx("h2",{className:"mt-4 text-xl font-semibold",children:"Policy not found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The policy you're looking for doesn't exist or you don't have access."}),e.jsxs(m,{variant:"outline",className:"mt-4",onClick:()=>A(`/clients/${o}/policies`),children:[e.jsx(hs,{className:"mr-2 h-4 w-4"}),"Back to Policies"]})]})});const E=k.clientPolicy||k;return e.jsxs(Pe,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(Zs,{items:[{label:"Clients",href:"/clients"},{label:`Client ${o}`,href:`/clients/${o}`},{label:"Policies",href:`/clients/${o}/policies`},{label:E.name||"Policy Editor",href:"#"}]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Policy Editor"}),E.isAiGenerated&&e.jsxs(I,{variant:"secondary",className:"bg-purple-100 text-purple-700 border-purple-200",children:[e.jsx(us,{className:"mr-1 h-3 w-3"}),"AI Generated Draft"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Edit and manage your compliance policy"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>A(`/clients/${o}/policies`),children:[e.jsx(hs,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsxs(m,{variant:"outline",onClick:()=>Ue(V==="edit"?"preview":"edit"),children:[e.jsx(mt,{className:"mr-2 h-4 w-4"}),V==="edit"?"Preview":"Edit"]}),e.jsx(m,{variant:"destructive",onClick:_s,disabled:ge||Y.isPending,children:"Delete"}),E.status==="approved"&&e.jsxs(m,{variant:"outline",className:"text-indigo-600 border-indigo-200 bg-indigo-50 hover:bg-indigo-100",onClick:zs,disabled:pe.isPending,children:[e.jsx(xt,{className:"mr-2 h-4 w-4"}),pe.isPending?"Sending...":"Send to Auditor"]}),e.jsxs(m,{onClick:$s,disabled:ge||P.isPending||!He,children:[ge||P.isPending?e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ht,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(at,{title:"Policy Management Guide",description:"Build, manage, and distribute your organizational policies.",rationale:"Policies are the foundation of compliance. This editor ensures they are not just text files, but integrated living documents connected to your risks and controls.",howToUse:[{step:"Structure Policy",description:"Use the Rich Text Editor to build well-formatted, readable policies."},{step:"Link Integrations",description:"Connect your policy to the Risks it mitigates and Controls it enforces."},{step:"Publish Version",description:"Create a locked, timestamped record of the policy for auditors."},{step:"Track Attestation",description:"Monitor employee acknowledgment in the Employees tab."}],integrations:[{name:"Risk Register",description:"Link to source risks."},{name:"Audit Hub",description:"Export results as evidence."}]}),e.jsxs(ie,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Policy Content"}),e.jsx(Te,{children:V==="edit"?"Edit your policy content using the rich text editor below":"Preview how your policy will appear"})]}),e.jsx(cs,{value:V,onValueChange:s=>Ue(s),children:e.jsxs(et,{children:[e.jsx(G,{value:"edit",children:"Edit"}),e.jsx(G,{value:"preview",children:"Preview"}),e.jsx(G,{value:"integrations",children:"Integrations"}),e.jsx(G,{value:"employees",children:"Employees"}),e.jsx(G,{value:"history",children:"History"})]})})]})}),e.jsx(oe,{children:e.jsxs(cs,{value:V,children:[e.jsxs(W,{value:"edit",className:"m-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"policy-name",children:"Policy Name"}),e.jsx(ye,{id:"policy-name",value:D,onChange:s=>Ae(s.target.value),placeholder:"Enter policy name"})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Policy Content"}),He?e.jsx(st,{value:y,onChange:F,className:"min-h-[400px]"}):e.jsx("div",{className:"min-h-[400px] flex items-center justify-center bg-slate-50 rounded-lg border",children:e.jsx(z,{className:"h-6 w-6 animate-spin text-muted-foreground"})})]}),e.jsx(bt,{content:y,onInsertSection:s=>{F(t=>`${t||""}
${s}`)}})]}),e.jsx(W,{value:"preview",className:"m-0",children:e.jsxs("div",{className:"prose prose-sm max-w-none",children:[e.jsx("h1",{children:D}),e.jsx("div",{dangerouslySetInnerHTML:Gs()}),e.jsxs("div",{className:"mt-8 border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Auditor Comments & Feedback"}),e.jsx(ds,{clientId:o,entityType:"policy",entityId:i})]})]})}),e.jsx(W,{value:"employees",className:"m-0",children:e.jsx("div",{className:"space-y-4",children:Ss?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ue&&ue.length>0?e.jsx("div",{className:"border rounded-md",children:e.jsxs(vs,{children:[e.jsx(Ns,{children:e.jsxs(Q,{children:[e.jsx(_,{children:"Employee"}),e.jsx(_,{children:"Job Title"}),e.jsx(_,{children:"Status"}),e.jsx(_,{children:"Attested Date"})]})}),e.jsx(ks,{children:ue.map(s=>e.jsxs(Q,{children:[e.jsxs(T,{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx(T,{children:s.jobTitle||"-"}),e.jsx(T,{children:e.jsx(I,{variant:s.status==="attested"?"default":s.status==="viewed"?"secondary":"outline",className:s.status==="attested"?"bg-green-100 text-green-700 hover:bg-green-100 border-green-200":s.status==="viewed"?"bg-blue-50 text-blue-700 hover:bg-blue-50 border-blue-200":"",children:s.status==="attested"?"Attested":s.status==="viewed"?"Viewed":"Pending"})}),e.jsx(T,{children:s.attestedAt?e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(ae,{className:"mr-2 h-4 w-4 text-green-600"}),new Date(s.attestedAt).toLocaleDateString()]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground bg-muted/20 rounded-lg border border-dashed",children:[e.jsx(es,{className:"h-8 w-8 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No employees assigned to this policy yet."}),e.jsx(m,{variant:"link",onClick:()=>be(!0),children:"Assign Employees"})]})})}),e.jsx(W,{value:"history",className:"m-0",children:e.jsx("div",{className:"space-y-4",children:xe&&xe.length>0?xe.map(s=>{var t;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:s.version.version}),e.jsx(I,{variant:"outline",children:s.version.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.version.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.version.description||"No description provided."}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Published by: ",((t=s.publisher)==null?void 0:t.name)||"Unknown"]})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Ms(s.version.id),children:[e.jsx(ut,{className:"mr-2 h-4 w-4"}),"Restore"]})]},s.version.id)}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ss,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No version history available for this policy."})]})})}),e.jsxs(W,{value:"integrations",className:"m-0 space-y-6",children:[Xe.length>0&&e.jsx("div",{className:"space-y-2",children:Xe.map((s,t)=>{let r={bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-900",subtext:"text-blue-700",iconColor:"text-blue-600"},c=B;return s.type==="critical"?(r={bg:"bg-red-50",border:"border-red-200",text:"text-red-900",subtext:"text-red-700",iconColor:"text-red-600"},c=ce):s.type==="warning"&&(r={bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-900",subtext:"text-amber-700",iconColor:"text-amber-600"},c=bs),e.jsxs("div",{className:`flex items-start gap-3 p-3 border rounded-lg ${r.bg} ${r.border}`,children:[e.jsx(c,{className:`h-5 w-5 shrink-0 mt-0.5 ${r.iconColor}`}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${r.text}`,children:s.message}),s.action&&e.jsx("p",{className:`text-sm mt-0.5 ${r.subtext}`,children:s.action})]}),s.actionType&&e.jsx(m,{size:"sm",variant:s.type==="critical"?"destructive":"outline",className:`shrink-0 ${s.type!=="critical"?"bg-white/50 hover:bg-white":""}`,onClick:()=>{if(s.actionType==="link_risk"&&J(!0),s.actionType==="link_control"&&K(!0),s.actionType==="review_controls"){const u=document.getElementById("linked-controls-section");u&&u.scrollIntoView({behavior:"smooth"})}},children:s.actionType==="link_risk"?"Link Risks":s.actionType==="review_controls"?"Review Controls":"Link Controls"})]})})]},`alert-${t}`)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100/50 border border-orange-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Risk Exposure"}),e.jsx(ne,{className:"h-4 w-4 text-orange-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:(n==null?void 0:n.totalInherentScore)||0}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:n?`${n.totalRisks} linked risk(s)`:"No risks linked"}),(n==null?void 0:n.hasCriticalRisks)&&e.jsxs(I,{variant:"destructive",className:"mt-2 text-xs",children:[n.criticalRiskCount," Critical"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-100/50 border border-emerald-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-800",children:"Risk Reduction"}),e.jsx(Le,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-900",children:[(n==null?void 0:n.riskReduction)||0,"%"]}),e.jsx("p",{className:"text-xs text-emerald-700 mt-1",children:n?`Residual: ${n.totalResidualScore}`:"No reduction data"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Control Coverage"}),e.jsx(B,{className:"h-4 w-4 text-blue-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:(a==null?void 0:a.totalControls)||0}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:a?`${a.implementedCount} implemented`:"No controls linked"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-100/50 border border-purple-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Implementation"}),e.jsx(ps,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[(a==null?void 0:a.implementationRate)||0,"%"]}),e.jsx("div",{className:"mt-2 h-2 bg-purple-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-600 transition-all duration-500",style:{width:`${(a==null?void 0:a.implementationRate)||0}%`}})})]})]}),n&&e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 border",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),"Risk Distribution"]}),e.jsxs("div",{className:"flex items-center gap-2 h-8",children:[n.riskLevelCounts.critical>0&&e.jsx("div",{className:"h-full bg-red-500 rounded flex items-center justify-center text-white text-xs font-bold",style:{flex:n.riskLevelCounts.critical},title:`${n.riskLevelCounts.critical} Critical`,children:n.riskLevelCounts.critical}),n.riskLevelCounts.high>0&&e.jsx("div",{className:"h-full bg-orange-500 rounded flex items-center justify-center text-white text-xs font-bold",style:{flex:n.riskLevelCounts.high},title:`${n.riskLevelCounts.high} High`,children:n.riskLevelCounts.high}),n.riskLevelCounts.medium>0&&e.jsx("div",{className:"h-full bg-yellow-500 rounded flex items-center justify-center text-white text-xs font-bold",style:{flex:n.riskLevelCounts.medium},title:`${n.riskLevelCounts.medium} Medium`,children:n.riskLevelCounts.medium}),n.riskLevelCounts.low>0&&e.jsx("div",{className:"h-full bg-green-500 rounded flex items-center justify-center text-white text-xs font-bold",style:{flex:n.riskLevelCounts.low},title:`${n.riskLevelCounts.low} Low`,children:n.riskLevelCounts.low})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-500"})," Critical"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-orange-500"})," High"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-yellow-500"})," Medium"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," Low"]})]})]}),(n||a)&&e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 via-white to-slate-50 rounded-xl p-6 border",children:[e.jsx("h4",{className:"text-sm font-medium mb-4 text-center",children:"Policy Relationship Map"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"bg-orange-100 border-2 border-orange-300 rounded-lg p-3 flex flex-col items-center min-w-[120px]",children:[e.jsx(ne,{className:"h-6 w-6 text-orange-600 mb-1"}),e.jsx("span",{className:"text-sm font-medium text-orange-900",children:"Risks"}),e.jsx("span",{className:"text-2xl font-bold text-orange-700",children:(n==null?void 0:n.totalRisks)||0})]}),(n==null?void 0:n.hasHighRisks)&&e.jsxs(I,{variant:"destructive",className:"text-xs",children:[n.highRiskCount," High/Critical"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-0.5 bg-orange-300"}),e.jsx("div",{className:"w-0 h-0 border-t-4 border-b-4 border-l-8 border-transparent border-l-orange-400"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-100 to-indigo-100 border-2 border-blue-400 rounded-xl p-4 flex flex-col items-center min-w-[140px] shadow-md",children:[e.jsx(se,{className:"h-8 w-8 text-blue-600 mb-2"}),e.jsx("span",{className:"text-sm font-bold text-blue-900",children:"This Policy"}),e.jsx("span",{className:"text-xs text-blue-700 mt-1 text-center truncate max-w-[120px]",children:(D==null?void 0:D.substring(0,20))||"Untitled"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-0 h-0 border-t-4 border-b-4 border-r-8 border-transparent border-r-emerald-400"}),e.jsx("div",{className:"w-8 h-0.5 bg-emerald-300"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"bg-emerald-100 border-2 border-emerald-300 rounded-lg p-3 flex flex-col items-center min-w-[120px]",children:[e.jsx(B,{className:"h-6 w-6 text-emerald-600 mb-1"}),e.jsx("span",{className:"text-sm font-medium text-emerald-900",children:"Controls"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-700",children:(a==null?void 0:a.totalControls)||0})]}),a&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(ae,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"text-green-700",children:[a.implementedCount," Implemented"]})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex items-center justify-center gap-6 text-xs text-muted-foreground",children:[n&&e.jsxs("span",{children:["Total Risk Exposure: ",e.jsx("strong",{className:"text-orange-700",children:n.totalInherentScore})]}),n&&n.riskReduction>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-3 w-3 text-green-600"}),"Risk Reduced by ",e.jsxs("strong",{className:"text-green-700",children:[n.riskReduction,"%"]})]}),a&&e.jsxs("span",{children:["Control Coverage: ",e.jsxs("strong",{className:a.implementationRate===100?"text-green-700":"text-amber-700",children:[a.implementationRate,"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",id:"linked-risks-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-orange-600"}),"Linked Risks",n&&e.jsx(I,{variant:"secondary",className:"ml-1 text-xs",children:n.totalRisks})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Risks mitigated by this policy"})]}),e.jsxs(ve,{open:Is,onOpenChange:J,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(gs,{className:"h-3 w-3 mr-2"})," Link Risk"]})}),e.jsxs(ke,{className:"max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Link Risks to Policy"}),e.jsx(Se,{children:"Select one or more risks to link, or use AI to suggest relevant risks based on policy content."})]}),e.jsxs("div",{className:"py-4 space-y-4 flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{name:xs.POLICY_RISK_SUGGESTION,props:{content:y,availableRisks:$,linkedRisks:f,onSuggest:s=>{X(s),M(s)}}}),C.length>0&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{M([]),X([])},children:"Clear All"})]}),C.length>0&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 border",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:[C.length," risk(s) selected",qe.length>0&&" (AI suggested)"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:C.map(s=>{var r,c;const t=$==null?void 0:$.find(u=>u.id===s);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-orange-100 text-orange-800 text-xs",children:[((r=t==null?void 0:t.title)==null?void 0:r.substring(0,30))||`Risk ${s}`,((c=t==null?void 0:t.title)==null?void 0:c.length)>30&&"...",e.jsx("button",{onClick:()=>M(u=>u.filter(b=>b!==s)),className:"ml-1 hover:text-red-600",children:"×"})]},`selected-${s}`)})})]}),e.jsx("div",{className:"border rounded-lg flex-1 min-h-0 overflow-y-auto",children:e.jsxs(ns,{shouldFilter:Array.isArray($)&&$.length>0,children:[e.jsx(is,{placeholder:"Search risks..."}),e.jsxs(rs,{children:[e.jsx(ls,{children:"No risk found."}),e.jsx(os,{children:($??[]).filter(s=>s&&s.id!=null).filter(s=>!(f!=null&&f.some(t=>{var r;return((r=t.risk)==null?void 0:r.id)===s.id}))).map(s=>{const t=C.includes(s.id),r=qe.includes(s.id);return e.jsxs(as,{value:s.title||String(s.id),onSelect:()=>{M(c=>t?c.filter(u=>u!==s.id):[...c,s.id])},className:q(r&&!t&&"bg-amber-50"),children:[e.jsx("div",{className:q("mr-2 h-4 w-4 border rounded flex items-center justify-center",t?"bg-orange-500 border-orange-500":"border-muted-foreground"),children:t&&e.jsx(ts,{className:"h-3 w-3 text-white"})}),e.jsxs("div",{className:"flex-1 truncate",children:[e.jsx("span",{children:s.title}),r&&!t&&e.jsx("span",{className:"ml-2 text-xs text-amber-600",children:"(suggested)"})]})]},`risk-${s.id}`)})})]})]})})]}),e.jsxs(Re,{children:[e.jsx(m,{variant:"outline",onClick:()=>{J(!1),M([]),X([])},children:"Cancel"}),e.jsxs(m,{onClick:Us,disabled:C.length===0,children:["Link ",C.length>0?`${C.length} Risk(s)`:"Risks"]})]})]})]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:f&&f.length>0?f.filter(s=>s&&s.risk).map(s=>{const t=s.risk.inherentScore||0,r=t>=20?"bg-red-500":t>=15?"bg-orange-500":t>=9?"bg-yellow-500":"bg-green-500",c=s.risk.residualScore||s.risk.inherentScore||0;return e.jsxs("div",{className:"group flex items-center justify-between p-3 border rounded-lg bg-gradient-to-r from-orange-50/50 to-transparent border-orange-100 hover:border-orange-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`${r} text-white font-bold text-xs w-8 h-8 rounded-lg flex items-center justify-center shrink-0`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("a",{href:"#",onClick:u=>{u.preventDefault(),Je(s.risk)},className:"font-medium text-sm text-orange-950 hover:text-orange-700 hover:underline flex items-center gap-1 truncate cursor-pointer",children:[s.risk.title,e.jsx(js,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-700/70 mt-0.5",children:[e.jsxs("span",{children:["Inherent: ",s.risk.inherentRisk||t]}),c<t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"→"}),e.jsxs("span",{className:"text-green-700 flex items-center gap-0.5",children:[e.jsx(Le,{className:"h-3 w-3"}),"Residual: ",c]})]})]})]})]}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-600 hover:bg-red-50 shrink-0 transition-colors",title:"Unlink Risk",onClick:()=>Hs(s.risk.id),children:e.jsx(fs,{className:"h-4 w-4"})})]},`linked-risk-${s.risk.id}`)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground bg-muted/20 rounded-lg border border-dashed",children:[e.jsx(ne,{className:"h-8 w-8 mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"No linked risks"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",id:"linked-controls-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-emerald-600"}),"Linked Controls",a&&e.jsx(I,{variant:"secondary",className:"ml-1 text-xs",children:a.totalControls})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Controls enforcing this policy"})]}),e.jsxs(ve,{open:As,onOpenChange:K,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(gs,{className:"h-3 w-3 mr-2"})," Link Control"]})}),e.jsxs(ke,{className:"max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Link Controls to Policy"}),e.jsx(Se,{children:"Select one or more controls to link, or use AI to suggest relevant controls based on policy content."})]}),e.jsxs("div",{className:"py-4 space-y-4 flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{name:xs.POLICY_CONTROL_SUGGESTION,props:{content:y,availableControls:O,linkedControls:w,onSuggest:s=>{Z(s),U(s)}}}),S.length>0&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{U([]),Z([])},children:"Clear All"})]}),S.length>0&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 border",children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:[S.length," control(s) selected",Qe.length>0&&" (AI suggested)"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:S.map(s=>{var c,u,b;const t=(O??[]).find(v=>{var x;return((x=v==null?void 0:v.clientControl)==null?void 0:x.id)===s}),r=((c=t==null?void 0:t.clientControl)==null?void 0:c.clientControlId)||((b=(u=t==null?void 0:t.control)==null?void 0:u.name)==null?void 0:b.substring(0,20))||`ID: ${s}`;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-emerald-100 text-emerald-800 text-xs",children:[e.jsx("span",{className:"font-mono font-semibold",children:r}),e.jsx("button",{type:"button",onClick:v=>{v.stopPropagation(),U(x=>x.filter(l=>l!==s))},className:"ml-0.5 text-emerald-600 hover:text-red-600 font-bold",children:"×"})]},`selected-control-${s}`)})})]}),e.jsx("div",{className:"border rounded-lg flex-1 min-h-0 overflow-y-auto",children:e.jsxs(ns,{shouldFilter:Array.isArray(O)&&O.length>0,children:[e.jsx(is,{placeholder:"Search controls..."}),e.jsxs(rs,{children:[e.jsx(ls,{children:"No control found."}),e.jsx(os,{children:(O??[]).filter(s=>s&&s.clientControl&&s.clientControl.id!=null).filter(s=>!(w!=null&&w.some(t=>{var r;return((r=t.clientControl)==null?void 0:r.id)===s.clientControl.id}))).map(s=>{var c,u;const t=S.includes(s.clientControl.id),r=Qe.includes(s.clientControl.id);return e.jsxs(as,{value:(s.clientControl.clientControlId||"")+" "+(((c=s.control)==null?void 0:c.name)||""),onSelect:()=>{U(b=>t?b.filter(v=>v!==s.clientControl.id):[...b,s.clientControl.id])},className:q(r&&!t&&"bg-amber-50"),children:[e.jsx("div",{className:q("mr-2 h-4 w-4 border rounded flex items-center justify-center shrink-0",t?"bg-emerald-500 border-emerald-500":"border-muted-foreground"),children:t&&e.jsx(ts,{className:"h-3 w-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("span",{className:"truncate block",children:[s.clientControl.clientControlId&&e.jsx("span",{className:"font-mono font-bold text-emerald-700 mr-1.5",children:s.clientControl.clientControlId}),e.jsx("span",{className:"text-foreground",children:((u=s.control)==null?void 0:u.name)||"Unnamed Control"})]}),r&&!t&&e.jsx("span",{className:"text-xs text-amber-600 ml-1",children:"(suggested)"})]})]},`control-${s.clientControl.id}`)})})]})]})})]}),e.jsxs(Re,{children:[e.jsx(m,{variant:"outline",onClick:()=>{K(!1),U([]),Z([])},children:"Cancel"}),e.jsxs(m,{onClick:Os,disabled:S.length===0,children:["Link ",S.length>0?`${S.length} Control(s)`:"Controls"]})]})]})]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:w&&w.length>0?w.filter(s=>s&&s.clientControl).map(s=>{var u,b;const t=((u=s.clientControl)==null?void 0:u.status)||"not_implemented",r={implemented:{color:"bg-green-500",icon:e.jsx(ae,{className:"h-3 w-3"}),label:"Implemented"},in_progress:{color:"bg-blue-500",icon:e.jsx(bs,{className:"h-3 w-3"}),label:"In Progress"},not_implemented:{color:"bg-gray-400",icon:e.jsx(ps,{className:"h-3 w-3"}),label:"Not Implemented"},not_applicable:{color:"bg-slate-500",icon:e.jsx(ce,{className:"h-3 w-3"}),label:"N/A"}},c=r[t]||r.not_implemented;return e.jsxs("div",{className:"group flex items-center justify-between p-3 border rounded-lg bg-gradient-to-r from-emerald-50/50 to-transparent border-emerald-100 hover:border-emerald-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`${c.color} text-white w-8 h-8 rounded-lg flex items-center justify-center shrink-0`,children:c.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("a",{href:"#",onClick:v=>{v.preventDefault(),Ke(s)},className:"font-medium text-sm text-emerald-950 hover:text-emerald-700 hover:underline flex items-center gap-1 cursor-pointer",children:[s.clientControl.clientControlId&&e.jsx("span",{className:"font-mono font-bold text-emerald-700",children:s.clientControl.clientControlId}),e.jsx("span",{className:"truncate",children:((b=s.control)==null?void 0:b.name)||"Unnamed Control"}),e.jsx(js,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(I,{variant:"outline",className:"text-xs px-1.5 py-0",children:c.label}),s.clientControl.owner&&e.jsxs("span",{className:"text-xs text-emerald-700/70",children:["Owner: ",s.clientControl.owner]})]})]})]}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-600 hover:bg-red-50 shrink-0 transition-colors",title:"Unlink Control",onClick:()=>Vs(s.clientControl.id),children:e.jsx(fs,{className:"h-4 w-4"})})]},`linked-control-${s.clientControl.id}`)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground bg-muted/20 rounded-lg border border-dashed",children:[e.jsx(B,{className:"h-8 w-8 mx-auto mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"No linked controls"})]})})]})]}),e.jsxs("div",{className:"mt-8 border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Auditor Comments"}),e.jsx(ds,{clientId:o,entityType:"policy",entityId:i})]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Policy Details"}),e.jsx(Te,{children:"Manage policy metadata and status"})]}),e.jsxs(oe,{className:"space-y-4",children:[E.isAiGenerated&&e.jsxs("div",{className:"mb-2 p-3 bg-purple-50 border border-purple-200 rounded-md text-sm text-purple-900 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center font-medium",children:[e.jsx(us,{className:"h-4 w-4 mr-2 text-purple-600"}),"Review Required"]}),e.jsx("p",{className:"text-purple-800/80 text-xs",children:"This policy was drafted by AI. Please review carefully before publishing."})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"policy-status",children:"Status"}),e.jsxs(Qs,{value:Ee,onValueChange:$e,children:[e.jsx(Ys,{children:e.jsx(Js,{placeholder:"Select status"})}),e.jsxs(Ks,{children:[e.jsx(te,{value:"draft",children:"Draft"}),e.jsx(te,{value:"review",children:"In Review"}),e.jsx(te,{value:"approved",children:"Approved"}),e.jsx(te,{value:"archived",children:"Archived"})]})]})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"policy-owner",children:"Owner"}),e.jsx(ye,{id:"policy-owner",value:_e,onChange:s=>Fe(s.target.value),placeholder:"Policy owner or department"})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Policy ID"}),e.jsx("div",{className:"text-sm text-muted-foreground font-mono p-2 bg-muted rounded",children:i})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Client ID"}),e.jsx("div",{className:"text-sm text-muted-foreground font-mono p-2 bg-muted rounded",children:o})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Last Updated"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:E.updatedAt?new Date(E.updatedAt).toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Created"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:E.createdAt?new Date(E.createdAt).toLocaleString():"Unknown"})]})]})]}),e.jsxs(ie,{children:[e.jsx(re,{children:e.jsx(le,{children:"Quick Actions"})}),e.jsxs(oe,{className:"space-y-2",children:[e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>be(!0),children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Assign to Employees"]}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:Bs,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Export as Word"]}),e.jsxs(ve,{open:Ds,onOpenChange:fe,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ss,{className:"mr-2 h-4 w-4"}),"Publish Version"]})}),e.jsxs(ke,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Publish New Version"}),e.jsx(Se,{children:"Create a permanent snapshot of the current draft. This version will be listed in the history and can be restored later."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"version-name",children:"Version (optional)"}),e.jsx(ye,{id:"version-name",placeholder:"e.g. v1.1, 2024-Q1 Update",value:Ge,onChange:s=>We(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"version-notes",children:"Change Summary"}),e.jsx(Xs,{id:"version-notes",placeholder:"What changed in this version?",value:ze,onChange:s=>Be(s.target.value)})]})]}),e.jsxs(Re,{children:[e.jsx(m,{variant:"outline",onClick:()=>fe(!1),children:"Cancel"}),e.jsxs(m,{onClick:Fs,disabled:Oe,children:[Oe&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Publish Version"]})]})]})]}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Create Version"]})]})]})]})]})]}),e.jsx(lt,{open:!!Ye,onOpenChange:s=>!s&&Je(null),risk:Ye,clientId:o}),ee&&e.jsx(rt,{open:!!ee,onOpenChange:s=>!s&&Ke(null),clientControl:ee.clientControl,control:ee.control,clientId:o,onUpdate:()=>he()}),e.jsx(ot,{policyId:i,clientId:o,open:Es,onOpenChange:be})]})}export{In as default};
