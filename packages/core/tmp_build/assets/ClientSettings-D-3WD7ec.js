import{M as ns,r as n,t as S,i as l,j as e,C as E,d as R,e as U,f as B,m as L,L as p,I as T,c as j,x as ie,E as W,G as K,H as Z,J as Y,K as O,N as ge,O as je,P as se,Q as $,V as fe,W as H,X as ls,Y as is,k as V,Z as cs,_ as os,$ as ds,a0 as ms,a2 as xs,a1 as hs,ay as ve,S as ue,bx as Ge,l as Ue,h as Ne,a4 as us,z as ps,D as be,o as ye,p as we,q as Ce,s as ze,v as Be,w as Se,ab as gs,b as js,u as fs,U as He,F as vs}from"./index-DOc7Nwb7.js";import{D as Ie,L as Ns}from"./DashboardLayout-aHnUqq57.js";import{B as bs}from"./Breadcrumb-CRi3LAxS.js";import{T as Ve,a as _e,b as te,c as re}from"./tabs-CBDTXbEn.js";import{E as he}from"./enhanced-dialog-CeRPsI16.js";import{D as ys}from"./DemoImportDialog-CCqxm96L.js";import{T as Oe}from"./textarea-BtxBxzdY.js";import{U as ws}from"./user-CqRnJLgW.js";import{B as Cs}from"./briefcase-BxorFA78.js";import{M as Pe}from"./mail-xRDvl6QK.js";import{P as Ss}from"./phone-BFakwHvb.js";import{M as Je}from"./map-pin-B9L2P8nv.js";import{S as xe}from"./save-CvVmWchr.js";import{P as Ae}from"./plus-BaQ35Jcx.js";import{E as ks}from"./ellipsis-BXWwt8ER.js";import{T as ce}from"./trash-2-CFEfisbM.js";import{u as Ms}from"./useBilling-BnCJ_sUa.js";import{Z as Ts}from"./zap-B01fFOkT.js";import{A as Qe,a as We,b as Ke,c as Ze,d as Ye,e as Xe,f as es,g as ss}from"./alert-dialog-V7xGXdVc.js";import{U as ke}from"./upload-BBmUECj8.js";import{P as Ps}from"./palette-BSVFoiqZ.js";import{L as As}from"./layout-template-CfpBjxAB.js";import{S as Re}from"./switch-B74-5eCi.js";import{A as Is,a as Ds,b as Fs}from"./alert-BudCfM-X.js";import{R as de}from"./rotate-cw-asiX3B-o.js";import{C as Es}from"./circle-check-big-BSqJVrgh.js";import{G as qe}from"./globe-BMGZmoaJ.js";import{F as Ls,r as Rs,u as $e,a as Us}from"./xlsx-DM7iXGTE.js";import{L as zs}from"./link-2-CtlmhYuV.js";import{S as Me}from"./sparkles-CoQ80pK2.js";import{A as as}from"./arrow-right-M96iV-v9.js";import{S as ts}from"./settings-CIu9FFiX.js";import{R as Te}from"./RichTextEditor-NQxhVz6n.js";import{P as rs}from"./pen-BlTNmlLB.js";import{E as Os}from"./eye-CIq9q9s6.js";import{A as Bs,a as De,b as Fe,c as Ee}from"./accordion-BvRtf4FI.js";import{I as Hs}from"./info-By5wLOUH.js";import{A as qs}from"./arrow-left-CpuUojG-.js";import{S as $s}from"./server-Dvm2PAz3.js";import{D as Le}from"./database-Bjtecw5f.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./star-BTvaCCU4.js";import"./target-cfAj3L6j.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./progress-B-1k4ZZX.js";import"./utils-BC5CVi_C.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=ns("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);function Vs({clientId:d,contactName:s,contactTitle:f,contactEmail:i,contactPhone:x,address:N}){const[g,w]=n.useState(s||""),[a,C]=n.useState(f||""),[y,h]=n.useState(i||""),[k,c]=n.useState(x||""),[r,o]=n.useState(N||""),[I,z]=n.useState(!1),b=S.useUtils();n.useEffect(()=>{z(g!==(s||"")||a!==(f||"")||y!==(i||"")||k!==(x||"")||r!==(N||""))},[g,a,y,k,r,s,f,i,x,N]);const q=S.clients.updateContactInfo.useMutation({onSuccess:()=>{l.success("Contact information saved"),b.clients.get.invalidate({id:d}),z(!1)},onError:M=>{l.error(M.message||"Failed to save contact information")}}),P=()=>{q.mutate({clientId:d,contactName:g||void 0,contactTitle:a||void 0,contactEmail:y||void 0,contactPhone:k||void 0,address:r||void 0})};return e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{className:"text-lg",children:"Contact Information"}),e.jsx(B,{children:"Primary contact details that will appear in exported document headers"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contactName",className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"}),"Contact Name"]}),e.jsx(T,{id:"contactName",placeholder:"John Smith",value:g,onChange:M=>w(M.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contactTitle",className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4 text-muted-foreground"}),"Title / Role"]}),e.jsx(T,{id:"contactTitle",placeholder:"Chief Information Security Officer",value:a,onChange:M=>C(M.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contactEmail",className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),"Email Address"]}),e.jsx(T,{id:"contactEmail",type:"email",placeholder:"john.smith@company.com",value:y,onChange:M=>h(M.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contactPhone",className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-muted-foreground"}),"Phone Number"]}),e.jsx(T,{id:"contactPhone",placeholder:"+1 (555) 123-4567",value:k,onChange:M=>c(M.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"address",className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),"Business Address"]}),e.jsx(Oe,{id:"address",placeholder:`123 Business Street
Suite 456
City, State 12345
Country`,value:r,onChange:M=>o(M.target.value),rows:3})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(j,{onClick:P,disabled:!I||q.isPending,children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Save Contact Info"]})})}),(g||y||k||r)&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Preview in document header:"}),e.jsxs("div",{className:"text-sm space-y-0.5",children:[g&&e.jsxs("p",{className:"font-medium",children:[g,a&&e.jsxs("span",{className:"font-normal text-muted-foreground",children:[" - ",a]})]}),y&&e.jsx("p",{className:"text-muted-foreground",children:y}),k&&e.jsx("p",{className:"text-muted-foreground",children:k}),r&&e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:r})]})]})]})]})}function _s({clientId:d}){const[s,f]=n.useState(!1),[i,x]=n.useState(""),[N,g]=n.useState("viewer"),{data:w,isLoading:a,refetch:C}=S.clients.getUsers.useQuery({clientId:d}),y=S.clients.inviteUser.useMutation({onSuccess:()=>{l.success("User invited successfully"),c(),C()},onError:b=>{l.error(b.message)}}),h=S.auditors.invite.useMutation({onSuccess:()=>{l.success("Auditor invited successfully via Magic Link"),c(),C()},onError:b=>{l.error(b.message)}}),k=S.auditors.revoke.useMutation({onSuccess:()=>{l.success("Auditor access revoked"),C()},onError:b=>{l.error(b.message)}}),c=()=>{f(!1),x(""),g("viewer")},r=()=>{if(!i){l.error("Please enter an email address");return}N==="auditor"?h.mutate({clientId:d,email:i}):y.mutate({clientId:d,email:i,role:N})},o=b=>{confirm("Are you sure you want to revoke access for this auditor?")&&k.mutate({clientId:d,userId:b})},I=b=>b?b.split(" ").map(q=>q[0]).join("").toUpperCase().slice(0,2):"U",z=y.isPending||h.isPending;return e.jsxs(E,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Team Access"}),e.jsx(B,{children:"Manage who has access to this workspace."})]}),e.jsx(he,{open:s,onOpenChange:f,trigger:e.jsxs(j,{size:"sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Invite Member"]}),title:"Invite Team Member",description:"Send an invitation to join this workspace.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(j,{onClick:r,disabled:z,children:z?"Inviting...":"Send Invite"})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email Address"}),e.jsx(T,{id:"email",type:"email",placeholder:"colleague@company.com",value:i,onChange:b=>x(b.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"role",children:"Role"}),e.jsxs(W,{value:N,onValueChange:b=>g(b),children:[e.jsx(K,{children:e.jsx(Z,{})}),e.jsxs(Y,{children:[e.jsx(O,{value:"viewer",children:"Viewer (Read-only)"}),e.jsx(O,{value:"editor",children:"Editor (Can edit controls/policies)"}),e.jsx(O,{value:"owner",children:"Owner (Full admin access)"}),e.jsx(O,{value:"auditor",children:"Auditor (Limited external access)"})]})]})]})]})})]}),e.jsx(L,{children:a?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading team..."}):e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(se,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx($,{className:"text-white font-semibold py-4",children:"User"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Email"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Role"}),e.jsx($,{className:"w-[100px] text-white font-semibold py-4"})]})}),e.jsxs(fe,{children:[w==null?void 0:w.map(b=>e.jsxs(se,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsxs(H,{className:"flex items-center gap-3 py-4",children:[e.jsx(ls,{className:"h-8 w-8",children:e.jsx(is,{children:I(b.name)})}),e.jsx("span",{className:"font-medium text-black",children:b.name||"Unknown"})]}),e.jsx(H,{className:"text-gray-600 py-4",children:b.email}),e.jsx(H,{className:"py-4",children:e.jsx(V,{variant:b.role==="owner"?"default":b.role==="auditor"?"outline":"secondary",children:b.role})}),e.jsx(H,{className:"py-4",children:b.role==="auditor"&&e.jsxs(cs,{children:[e.jsx(os,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ks,{className:"h-4 w-4"})]})}),e.jsxs(ds,{align:"end",children:[e.jsx(ms,{children:"Actions"}),e.jsx(xs,{}),e.jsxs(hs,{className:"text-red-600 focus:text-red-600",onClick:()=>o(b.id),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Revoke Access"]})]})]})})]},b.id)),(w==null?void 0:w.length)===0&&e.jsx(se,{children:e.jsx(H,{colSpan:4,className:"text-center h-24 text-gray-500 bg-white",children:"No users found."})})]})]})})})]})}function Js({client:d}){const{billingEnabled:s,upgradeToPro:f,upgradeToEnterprise:i,manageSubscription:x,isLoading:N}=Ms();if(!s)return e.jsx("div",{className:"p-6",children:e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(U,{children:"Subscription Management"}),e.jsx(B,{children:"Billing is currently disabled for this instance."})]})})});if(!d)return e.jsx("div",{children:"Loading..."});const g=d.planTier==="pro"||d.planTier==="enterprise",w=!g;return e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Subscription & Billing"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your plan and payment details."})]}),g&&e.jsx(j,{variant:"outline",onClick:()=>x(d.id),disabled:N,children:N?"Loading...":"Manage Subscription"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(E,{className:w?"border-primary":"",children:[e.jsx(R,{children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(U,{className:"flex items-center gap-2 text-lg",children:["Subscription (DIY)",w&&e.jsx(V,{variant:"default",className:"bg-green-100 text-green-700 hover:bg-green-100 border-green-200",children:"Current"})]}),e.jsx(B,{children:"Perfect for small teams starting their journey."})]})})}),e.jsxs(L,{className:"grid gap-2",children:[e.jsx(Q,{text:"Self-Service Dashboard",checked:!0}),e.jsx(Q,{text:"Compliance Success Path",checked:!0}),e.jsx(Q,{text:"Basic Policy Templates",checked:!0}),e.jsx(Q,{text:"1 Organization Limit"}),e.jsx(Q,{text:"Community Support"})]}),e.jsx(ve,{children:w?e.jsx(j,{variant:"ghost",disabled:!0,className:"w-full",children:"Active Plan"}):e.jsx(j,{variant:"ghost",disabled:!0,className:"w-full",children:"Included in Higher Tiers"})})]}),e.jsxs(E,{className:d.planTier==="pro"?"border-indigo-600 shadow-lg":"bg-muted/50",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(U,{className:"flex items-center gap-2 text-lg",children:["vCISO (Guided)",d.planTier==="pro"&&e.jsx(V,{variant:"default",className:"bg-indigo-600",children:"Current"})]}),e.jsx(B,{children:"Expert guidance for your security roadmap."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:"$49"}),e.jsx("span",{className:"text-muted-foreground",children:"/mo"})]})]})}),e.jsxs(L,{className:"grid gap-2",children:[e.jsx(Q,{text:"Advisor-Set Weekly Focus",checked:!0}),e.jsx(Q,{text:"AI Evidence Triage (Basic)",checked:!0}),e.jsx(Q,{text:"Guided Compliance Review",checked:!0}),e.jsx(Q,{text:"Up to 5 Organizations",checked:!0}),e.jsx(Q,{text:"Priority Support",checked:!0})]}),e.jsx(ve,{children:d.planTier==="pro"?e.jsx(j,{className:"w-full bg-indigo-600 hover:bg-indigo-700",onClick:()=>x(d.id),disabled:N,children:"Manage Billing"}):e.jsxs(j,{className:"w-full border-indigo-600 text-indigo-600 hover:bg-indigo-50",variant:"outline",onClick:()=>f(d.id),disabled:N,children:[e.jsx(Ts,{className:"mr-2 h-4 w-4"}),d.planTier==="enterprise"?"Downgrade to Guided":"Upgrade to Guided"]})})]}),e.jsxs(E,{className:d.planTier==="enterprise"?"border-amber-500 shadow-lg":"bg-slate-900 text-white",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(U,{className:"flex items-center gap-2 text-lg",children:["Full Service (Managed)",d.planTier==="enterprise"&&e.jsx(V,{variant:"default",className:"bg-amber-500",children:"Current"})]}),e.jsx(B,{className:d.planTier==="enterprise"?"":"text-slate-400",children:"We handle everything for you."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xl font-bold",children:"$499"}),e.jsx("span",{className:"text-muted-foreground",children:"/mo"})]})]})}),e.jsxs(L,{className:"grid gap-2",children:[e.jsx(Q,{text:"Full Managed Compliance",checked:!0}),e.jsx(Q,{text:"AI Document Processing",checked:!0}),e.jsx(Q,{text:"Automated Evidence Mapping",checked:!0}),e.jsx(Q,{text:"Unlimited Organizations",checked:!0}),e.jsx(Q,{text:"Dedicated Account Manager",checked:!0})]}),e.jsx(ve,{children:d.planTier==="enterprise"?e.jsx(j,{className:"w-full bg-amber-500 hover:bg-amber-600 text-white",onClick:()=>x(d.id),disabled:N,children:"Manage Billing"}):e.jsxs(j,{className:"w-full bg-amber-500 hover:bg-amber-600 text-white",onClick:()=>i(d.id),disabled:N,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Upgrade to Managed"]})})]})]}),g&&e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"Billing History"}),e.jsx(B,{children:"View your past invoices and payment receipts."})]}),e.jsx(L,{children:e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Manage invoices in the Stripe Portal."]})})]})]})}function Q({text:d,checked:s=!1}){return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`flex items-center justify-center h-5 w-5 rounded-full ${s?"bg-primary/20 text-primary":"bg-muted text-muted-foreground"}`,children:e.jsx(Ue,{className:"h-3 w-3"})}),e.jsx("span",{className:s?"font-medium":"text-muted-foreground",children:d})]})}function Qs({clientId:d,initialData:s}){const[f,i]=n.useState(s.name),[x,N]=n.useState(s.description||""),[g,w]=n.useState(s.industry||""),[a,C]=n.useState(s.size||""),[y,h]=n.useState(s.cisoName||""),[k,c]=n.useState(s.dpoName||""),[r,o]=n.useState(s.headquarters||""),[I,z]=n.useState(s.mainServiceRegion||""),[b,q]=n.useState(!1),P=S.useUtils();n.useEffect(()=>{const A=f!==s.name||x!==(s.description||"")||g!==(s.industry||"")||a!==(s.size||"")||y!==(s.cisoName||"")||k!==(s.dpoName||"")||r!==(s.headquarters||"")||I!==(s.mainServiceRegion||"");q(A)},[f,x,g,a,y,k,r,I,s]);const M=S.clients.update.useMutation({onSuccess:()=>{l.success("Client settings updated successfully"),P.clients.get.invalidate({id:d}),q(!1)},onError:A=>{l.error(A.message||"Failed to update client settings")}}),G=()=>{if(!f.trim()){l.error("Client name is required");return}M.mutate({id:d,name:f,description:x,industry:g,size:a,cisoName:y,dpoName:k,headquarters:r,mainServiceRegion:I})};return e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{className:"text-lg",children:"General Information"}),e.jsx(B,{children:"Basic information about the client organization"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"clientName",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"}),"Company Name"]}),e.jsx(T,{id:"clientName",placeholder:"Acme Corp",value:f,onChange:A=>i(A.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"industry",children:"Industry"}),e.jsx(T,{id:"industry",placeholder:"Technology, Healthcare, etc.",value:g,onChange:A=>w(A.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"size",children:"Company Size"}),e.jsxs(W,{value:a,onValueChange:C,children:[e.jsx(K,{id:"size",children:e.jsx(Z,{placeholder:"Select size"})}),e.jsxs(Y,{children:[e.jsx(O,{value:"1-10",children:"1-10 employees"}),e.jsx(O,{value:"11-50",children:"11-50 employees"}),e.jsx(O,{value:"51-200",children:"51-200 employees"}),e.jsx(O,{value:"201-500",children:"201-500 employees"}),e.jsx(O,{value:"500+",children:"500+ employees"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cisoName",children:"CISO Name"}),e.jsx(T,{id:"cisoName",placeholder:"John Doe",value:y,onChange:A=>h(A.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"dpoName",children:"DPO Name (Data Protection Officer)"}),e.jsx(T,{id:"dpoName",placeholder:"Jane Smith",value:k,onChange:A=>c(A.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"headquarters",children:"Headquarters Location"}),e.jsx(T,{id:"headquarters",placeholder:"San Francisco, CA",value:r,onChange:A=>o(A.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"mainServiceRegion",children:"Main Service Region"}),e.jsx(T,{id:"mainServiceRegion",placeholder:"USA, EU, Global",value:I,onChange:A=>z(A.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx(Oe,{id:"description",placeholder:"Brief description of the client...",value:x,onChange:A=>N(A.target.value),rows:3})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(j,{onClick:G,disabled:!b||M.isPending,children:M.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})})]})]})}function Ws({clientId:d,currentLogoUrl:s,clientName:f}){const[i,x]=n.useState(!1),[N,g]=n.useState(s||null),w=n.useRef(null),[a,C]=n.useState(!1),y=S.useUtils(),h=S.clients.uploadLogo.useMutation({onSuccess:()=>{l.success("Logo uploaded successfully"),y.clients.get.invalidate({id:d})},onError:r=>{l.error(r.message||"Failed to upload logo")}}),k=S.clients.removeLogo.useMutation({onSuccess:()=>{g(null),C(!1),l.success("Logo removed"),y.clients.get.invalidate({id:d})},onError:r=>{l.error(r.message||"Failed to remove logo")}}),c=async r=>{var I;const o=(I=r.target.files)==null?void 0:I[0];if(o){if(!o.type.startsWith("image/")){l.error("Please select an image file");return}if(o.size>2*1024*1024){l.error("Image must be less than 2MB");return}x(!0);try{const z=new FileReader;z.onload=async()=>{try{const q=z.result.split(",")[1],P=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:`logo-${d}-${Date.now()}.${o.name.split(".").pop()}`,data:q,contentType:o.type,folder:"branding"})});if(!P.ok){const G=await P.text().catch(()=>"Unknown error");throw new Error(`Upload failed: ${P.status} ${P.statusText}`)}const{url:M}=await P.json();await h.mutateAsync({clientId:d,logoUrl:M}),g(M)}catch(b){console.error("Logo upload error:",b),l.error(b.message||"Failed to upload logo")}finally{x(!1),w.current&&(w.current.value="")}},z.onerror=()=>{l.error("Failed to read file"),x(!1)},z.readAsDataURL(o)}catch{l.error("Failed to initiate upload"),x(!1)}}};return e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{className:"text-lg",children:"Company Logo"}),e.jsx(B,{children:"Upload your company logo to appear on exported policy documents"})]}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-lg border-2 border-dashed border-muted-foreground/25 flex items-center justify-center bg-muted/50 overflow-hidden",children:N?e.jsx("img",{src:N,alt:`${f} logo`,className:"w-full h-full object-contain p-2"}):e.jsx(Ne,{className:"w-12 h-12 text-muted-foreground/50"})}),N&&e.jsx(j,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>C(!0),disabled:k.isPending,children:e.jsx(us,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:c,className:"hidden"}),e.jsx(j,{variant:"outline",onClick:()=>{var r;return(r=w.current)==null?void 0:r.click()},disabled:i,className:"w-full",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),N?"Replace Logo":"Upload Logo"]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: Square image, PNG or JPG, max 2MB"})]})]})}),e.jsx(Qe,{open:a,onOpenChange:C,children:e.jsxs(We,{children:[e.jsxs(Ke,{children:[e.jsx(Ze,{children:"Remove Logo?"}),e.jsx(Ye,{children:"Are you sure you want to remove the company logo? This will affect all generated documents."})]}),e.jsxs(Xe,{children:[e.jsx(es,{children:"Cancel"}),e.jsx(ss,{className:"bg-red-600 hover:bg-red-700",onClick:()=>k.mutate({clientId:d}),disabled:k.isPending,children:k.isPending?"Removing...":"Remove"})]})]})})]})}function Ks({clientId:d,clientName:s,initialData:f,onUpdate:i}){const[x,N]=n.useState(f.brandPrimaryColor||"#2563eb"),[g,w]=n.useState(f.brandSecondaryColor||"#0f172a"),[a,C]=n.useState(f.portalTitle||s),[y,h]=n.useState(!1),k=S.useUtils();n.useEffect(()=>{const o=x!==(f.brandPrimaryColor||"#2563eb")||g!==(f.brandSecondaryColor||"#0f172a")||a!==(f.portalTitle||s);h(o)},[x,g,a,f,s]);const c=S.clients.update.useMutation({onSuccess:()=>{l.success("Branding settings saved successfully"),k.clients.get.invalidate({id:d}),i&&i(),h(!1)},onError:o=>{l.error(o.message||"Failed to save branding settings")}}),r=()=>{c.mutate({id:d,brandPrimaryColor:x,brandSecondaryColor:g,portalTitle:a})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ws,{clientId:d,currentLogoUrl:f.logoUrl,clientName:s}),e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-indigo-500"}),"Color Theme"]}),e.jsx(B,{children:"Customize the look and feel of your client portal."})]}),e.jsx(L,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"primaryColor",children:"Primary Brand Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative h-10 w-10 rounded-lg overflow-hidden border border-slate-200 shadow-sm cursor-pointer group",children:e.jsx("input",{type:"color",id:"primaryColor",value:x,onChange:o=>N(o.target.value),className:"absolute -top-2 -left-2 w-16 h-16 cursor-pointer p-0 border-0 bg-transparent"})}),e.jsx("div",{className:"flex-1",children:e.jsx(T,{value:x,onChange:o=>N(o.target.value),placeholder:"#000000",className:"font-mono"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used for buttons, links, and active states."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"secondaryColor",children:"Secondary Brand Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative h-10 w-10 rounded-lg overflow-hidden border border-slate-200 shadow-sm cursor-pointer group",children:e.jsx("input",{type:"color",id:"secondaryColor",value:g,onChange:o=>w(o.target.value),className:"absolute -top-2 -left-2 w-16 h-16 cursor-pointer p-0 border-0 bg-transparent"})}),e.jsx("div",{className:"flex-1",children:e.jsx(T,{value:g,onChange:o=>w(o.target.value),placeholder:"#000000",className:"font-mono"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used for navigation bars, sidebars, and headers."})]})]})})]}),e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5 text-blue-500"}),"Portal Identity"]}),e.jsx(B,{children:"Configure how the application appears in the browser."})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"portalTitle",children:"Portal Title"}),e.jsx(T,{id:"portalTitle",value:a,onChange:o=>C(o.target.value),placeholder:`${s} Compliance Portal`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This title appears in the browser tab and search results."})]}),e.jsxs("div",{className:"mt-6 p-4 border border-slate-200 rounded-lg bg-slate-50/50",children:[e.jsx(p,{className:"mb-3 block text-xs uppercase tracking-wider text-slate-500 font-semibold",children:"Live Preview"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"bg-[#dee1e6] p-2 rounded-t-lg w-full max-w-md mx-auto shadow-sm",children:e.jsxs("div",{className:"bg-white rounded-md py-1.5 px-3 flex items-center gap-2 text-xs text-slate-700 max-w-[200px] shadow-sm border border-slate-200",children:[f.logoUrl?e.jsx("img",{src:f.logoUrl,className:"w-3 h-3 object-contain",alt:""}):e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"truncate",children:a})]})}),e.jsxs("div",{className:"w-full max-w-md mx-auto bg-white rounded-lg shadow-md overflow-hidden border border-slate-200",children:[e.jsxs("div",{className:"h-12 flex items-center px-4 justify-between",style:{backgroundColor:g},children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-white font-medium text-sm",children:s})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/20"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/20"})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-2 w-2/3 bg-slate-100 rounded"}),e.jsx("div",{className:"h-2 w-1/2 bg-slate-100 rounded"}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"px-3 py-1.5 rounded text-xs font-medium text-white transition-opacity hover:opacity-90",style:{backgroundColor:x},children:"Primary Action"})})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(j,{onClick:r,disabled:!y||c.isPending,children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})})]})]})]})}function Zs({clientId:d}){const[s,f]=n.useState(!0),[i,x]=n.useState(""),[N,g]=n.useState(587),[w,a]=n.useState(""),[C,y]=n.useState(""),[h,k]=n.useState(""),[c,r]=n.useState(""),[o,I]=n.useState(""),z=S.useContext(),{data:b,isLoading:q}=S.integrations.get.useQuery({clientId:d,provider:"smtp"}),P=S.integrations.update.useMutation({onSuccess:()=>{l.success("Settings Saved",{description:"SMTP configuration updated."}),z.integrations.get.invalidate({clientId:d})},onError:m=>{l.error("Save Failed",{description:m.message})}}),M=S.integrations.testConnection.useMutation({onSuccess:()=>{l.success("Success!",{description:"Test email sent successfully."})},onError:m=>{l.error("Test Failed",{description:m.message})}});n.useEffect(()=>{if(b){if(b.settings){const m=b.settings;x(m.host||""),g(Number(m.port)||587),a(m.user||""),y(m.pass||""),k(m.fromName||""),r(m.fromEmail||"")}f(b.isEnabled||!1)}},[b]);const G=()=>{P.mutate({clientId:d,provider:"smtp",isEnabled:s,settings:{host:i,port:Number(N),user:w,pass:C,fromName:h,fromEmail:c}})},A=()=>{if(!o){l.error("Email Required",{description:"Please enter a test recipient email."});return}M.mutate({clientId:d,email:o,provider:"smtp"})};return q?e.jsx("div",{className:"p-4 flex justify-center",children:e.jsx(de,{className:"animate-spin text-gray-400"})}):e.jsxs(E,{className:"w-full border-l-4 border-l-indigo-500 shadow-sm",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-indigo-600"}),"Custom SMTP Settings"]}),e.jsx(B,{children:"Connect your own email provider to send emails from your domain."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{htmlFor:"smtp-enable",className:"text-sm font-medium text-gray-600",children:s?"Enabled":"Disabled"}),e.jsx(Re,{id:"smtp-enable",checked:s,onCheckedChange:f})]})]})}),e.jsxs(L,{className:"space-y-6",children:[!s&&e.jsxs(Is,{className:"bg-gray-50 text-gray-600 border-gray-200",children:[e.jsx(ps,{className:"h-4 w-4"}),e.jsx(Ds,{children:"System Default Active"}),e.jsx(Fs,{children:"Emails are currently being sent via the default System Mailer. Enable this integration to override it."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"SMTP Host"}),e.jsx(T,{placeholder:"smtp.gmail.com",value:i,onChange:m=>x(m.target.value),disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Port"}),e.jsx(T,{type:"number",placeholder:"587",value:N,onChange:m=>g(Number(m.target.value)),disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Username"}),e.jsx(T,{placeholder:"user@example.com",value:w,onChange:m=>a(m.target.value),disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Password"}),e.jsx(T,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:C,onChange:m=>y(m.target.value),disabled:!s}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Stored securely."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Send As (Name)"}),e.jsx(T,{placeholder:"Acme Compliance Team",value:h,onChange:m=>k(m.target.value),disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Send As (Email)"}),e.jsx(T,{placeholder:"compliance@acme.com",value:c,onChange:m=>r(m.target.value),disabled:!s}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must match your SMTP user or be allowed by your provider."})]})]})]}),e.jsxs(ve,{className:"bg-gray-50 flex justify-between items-center py-4 rounded-b-lg",children:[e.jsxs("div",{className:"flex gap-2 items-center w-full max-w-sm",children:[e.jsx(T,{placeholder:"test@example.com",value:o,onChange:m=>I(m.target.value),className:"h-9 bg-white"}),e.jsxs(j,{variant:"outline",size:"sm",onClick:A,disabled:!s||M.isLoading,children:[M.isLoading?e.jsx(de,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Es,{className:"h-4 w-4 mr-2 text-green-600"}),"Test"]})]}),e.jsxs(j,{onClick:G,disabled:P.isLoading,className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[P.isLoading?e.jsx(de,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Save Configuration"]})]})]})}const Ys=[{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",name:"German (Deutsch)",flag:"ðŸ‡©ðŸ‡ª"},{code:"fr",name:"French (FranÃ§ais)",flag:"ðŸ‡«ðŸ‡·"},{code:"es",name:"Spanish (EspaÃ±ol)",flag:"ðŸ‡ªðŸ‡¸"},{code:"it",name:"Italian (Italiano)",flag:"ðŸ‡®ðŸ‡¹"},{code:"pt",name:"Portuguese (PortuguÃªs)",flag:"ðŸ‡µðŸ‡¹"},{code:"nl",name:"Dutch (Nederlands)",flag:"ðŸ‡³ðŸ‡±"},{code:"pl",name:"Polish (Polski)",flag:"ðŸ‡µðŸ‡±"},{code:"sv",name:"Swedish (Svenska)",flag:"ðŸ‡¸ðŸ‡ª"},{code:"da",name:"Danish (Dansk)",flag:"ðŸ‡©ðŸ‡°"},{code:"fi",name:"Finnish (Suomi)",flag:"ðŸ‡«ðŸ‡®"},{code:"no",name:"Norwegian (Norsk)",flag:"ðŸ‡³ðŸ‡´"},{code:"cs",name:"Czech (ÄŒeÅ¡tina)",flag:"ðŸ‡¨ðŸ‡¿"},{code:"hu",name:"Hungarian (Magyar)",flag:"ðŸ‡­ðŸ‡º"},{code:"ro",name:"Romanian (RomÃ¢nÄƒ)",flag:"ðŸ‡·ðŸ‡´"},{code:"bg",name:"Bulgarian (Ð‘ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸)",flag:"ðŸ‡§ðŸ‡¬"},{code:"el",name:"Greek (Î•Î»Î»Î·Î½Î¹ÎºÎ¬)",flag:"ðŸ‡¬ðŸ‡·"},{code:"ja",name:"Japanese (æ—¥æœ¬èªž)",flag:"ðŸ‡¯ðŸ‡µ"},{code:"zh",name:"Chinese (ä¸­æ–‡)",flag:"ðŸ‡¨ðŸ‡³"},{code:"ko",name:"Korean (í•œêµ­ì–´)",flag:"ðŸ‡°ðŸ‡·"},{code:"ar",name:"Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)",flag:"ðŸ‡¸ðŸ‡¦"},{code:"he",name:"Hebrew (×¢×‘×¨×™×ª)",flag:"ðŸ‡®ðŸ‡±"},{code:"tr",name:"Turkish (TÃ¼rkÃ§e)",flag:"ðŸ‡¹ðŸ‡·"},{code:"ru",name:"Russian (Ð ÑƒÑÑÐºÐ¸Ð¹)",flag:"ðŸ‡·ðŸ‡º"},{code:"uk",name:"Ukrainian (Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°)",flag:"ðŸ‡ºðŸ‡¦"}],Xs=[{value:"public",label:"Public"},{value:"internal",label:"Internal"},{value:"confidential",label:"Confidential"},{value:"restricted",label:"Restricted"}],ea=[{value:"EU",label:"European Union"},{value:"US",label:"United States"},{value:"UK",label:"United Kingdom"},{value:"CH",label:"Switzerland"},{value:"APAC",label:"Asia Pacific"},{value:"MENA",label:"Middle East & North Africa"},{value:"LATAM",label:"Latin America"}];function sa({clientId:d,client:s,onUpdate:f}){const[i,x]=n.useState("en"),[N,g]=n.useState(""),[w,a]=n.useState("internal"),[C,y]=n.useState([]),h=S.clients.update.useMutation({onSuccess:()=>{l.success("Settings saved successfully"),f&&f()},onError:r=>l.error(r.message)});n.useEffect(()=>{if(s){x(s.policyLanguage||"en"),g(s.legalEntityName||s.name||""),a(s.defaultDocumentClassification||"internal");try{const r=s.regulatoryJurisdictions;y(r||[])}catch{y([])}}},[s]);const k=()=>{h.mutate({id:d,policyLanguage:i,legalEntityName:N,defaultDocumentClassification:w,regulatoryJurisdictions:C})},c=r=>{y(o=>o.includes(r)?o.filter(I=>I!==r):[...o,r])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-primary"}),"Policy Generation Preferences"]}),e.jsx(B,{children:"Configure how policies are generated for this organization. These settings apply to all AI-generated policy content."})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Policy Language"]}),e.jsxs(W,{value:i,onValueChange:x,children:[e.jsx(K,{className:"w-full max-w-md",children:e.jsx(Z,{placeholder:"Select language"})}),e.jsx(Y,{children:Ys.map(r=>e.jsx(O,{value:r.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.flag}),e.jsx("span",{children:r.name})]})},r.code))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All AI-generated policy content will be written in this language."})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(p,{children:"Legal Entity Name"}),e.jsx(T,{value:N,onChange:r=>g(r.target.value),placeholder:"e.g. Acme Corporation Ltd.",className:"max-w-md"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This name will appear in policy headers and official documents."})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(p,{children:"Default Document Classification"}),e.jsxs(W,{value:w,onValueChange:a,children:[e.jsx(K,{className:"w-full max-w-md",children:e.jsx(Z,{})}),e.jsx(Y,{children:Xs.map(r=>e.jsx(O,{value:r.value,children:r.label},r.value))})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Default classification level for new policies."})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(j,{onClick:k,disabled:h.isPending,children:[h.isPending?e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Save Policy Settings"]})})]})]}),e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),"Regulatory Jurisdictions"]}),e.jsx(B,{children:"Select the regions where your organization operates. Policies will be tailored to meet requirements in these jurisdictions."})]}),e.jsxs(L,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:ea.map(r=>e.jsx(j,{variant:C.includes(r.value)?"default":"outline",size:"sm",onClick:()=>c(r.value),className:"transition-all",children:r.label},r.value))}),C.length>0&&e.jsxs("p",{className:"mt-4 text-sm text-muted-foreground",children:["Selected: ",C.join(", ")]})]})]})]})}function aa({clientId:d}){const[s,f]=n.useState(null),[i,x]=n.useState(null),[N,g]=n.useState("equivalent"),[w,a]=n.useState(""),[C,y]=n.useState(""),[h,k]=n.useState(""),[c,r]=n.useState([]),[o,I]=n.useState(new Set),[z,b]=n.useState(!1),{data:q=[],isLoading:P}=S.controls.list.useQuery({framework:"all",clientId:d}),M=Array.isArray(q)?q:[],G=n.useMemo(()=>{const t=new Set(M.map(D=>D.framework).filter(Boolean));return Array.from(t).sort()},[M]),{data:A=[],isLoading:m,refetch:X}=S.compliance.frameworkMappings.list.useQuery({}),me=S.compliance.frameworkMappings.create.useMutation({onSuccess:()=>{l.success("Mapping created successfully"),f(null),x(null),a(""),X()},onError:t=>l.error(t.message)}),pe=S.compliance.frameworkMappings.delete.useMutation({onSuccess:()=>{l.success("Mapping deleted"),X()},onError:t=>l.error(t.message)}),u=S.compliance.frameworkMappings.bulkCreate.useMutation({onSuccess:t=>{l.success(`Successfully saved ${t.count} mappings.`),r([]),I(new Set),b(!1),X()},onError:t=>l.error("Failed to save mappings: "+t.message)}),_=S.compliance.frameworkMappings.autoMapControls.useMutation({onSuccess:t=>{r(t),I(new Set(t.map((D,F)=>F))),b(!0),l.success(`AI found ${t.length} potential mappings`)},onError:t=>l.error("Auto-Map Failed: "+t.message)}),J=t=>M.find(D=>D.id===t),oe=()=>{if(!s||!i){l.error("Please select both source and target controls");return}if(s===i){l.error("Source and target cannot be the same control");return}me.mutate({sourceControlId:s,targetControlId:i,mappingType:N,notes:w||void 0})},v=async()=>{if(!C){l.error("Please select a Source framework.");return}if(!h){l.error("Please select a Target framework.");return}if(h==="all_frameworks"){const t=G.filter(ne=>ne!==C);if(t.length===0){l.error("No other frameworks available to map against.");return}let D=[],F=0;const ae=l.loading(`Harmonizing ${C} with ${t.length} frameworks...`);try{for(const ne of t)try{const le=await _.mutateAsync({sourceFramework:C,targetFramework:ne});le&&Array.isArray(le)&&(D=[...D,...le]),F++}catch(le){console.error(`Failed to map ${C} -> ${ne}`,le)}l.dismiss(ae),D.length>0?(r(D),I(new Set(D.map((ne,le)=>le))),b(!0),l.success(`Harmonization complete! AI found ${D.length} mappings across ${F} frameworks.`)):l.info("Harmonization complete, but no high-confidence mappings were found.")}catch{l.dismiss(ae),l.error("Harmonization process encountered an error.")}}else{if(C===h){l.error("Source and Target frameworks must be different.");return}_.mutate({sourceFramework:C,targetFramework:h})}},ee=async()=>{if(o.size===0){b(!1);return}const t=Array.from(o).map(D=>{const F=c[D];return{sourceControlId:F.sourceId,targetControlId:F.targetId,mappingType:F.mappingType,confidence:F.confidence.toString(),notes:`AI Auto-Map (Semantic Similarity: ${F.confidence}%)`}});u.mutate(t)};return e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5 text-primary"}),"Cross-Framework Control Mappings"]}),e.jsx(B,{children:"Map equivalent controls across frameworks to reduce redundant compliance work."})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-primary/5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Me,{className:"h-4 w-4 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"AI Framework Auto-Mapper"}),e.jsx(V,{variant:"outline",className:"ml-2 bg-purple-100 text-purple-700 border-purple-200",children:"Semantic Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(p,{className:"text-xs",children:"Source Framework"}),e.jsxs(W,{value:C,onValueChange:y,children:[e.jsx(K,{className:"bg-white",children:e.jsx(Z,{placeholder:"Select Framework..."})}),e.jsxs(Y,{children:[e.jsx(O,{value:"all_frameworks",className:"font-bold text-purple-700 bg-purple-50",children:"âœ¨ All Existing Frameworks (Harmonize Library)"}),G.map(t=>e.jsx(O,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(p,{className:"text-xs",children:"Target Framework"}),e.jsxs(W,{value:h,onValueChange:k,children:[e.jsx(K,{className:"bg-white",children:e.jsx(Z,{placeholder:"Select Framework..."})}),e.jsx(Y,{children:G.map(t=>e.jsx(O,{value:t,children:t},t))})]})]}),e.jsxs(j,{onClick:v,disabled:_.isPending||P,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[_.isPending?e.jsx(ie,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Auto-Map Controls"]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-muted/30 space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Manual Mapping"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(p,{className:"text-xs",children:"Source Control"}),e.jsxs(W,{value:(s==null?void 0:s.toString())||"",onValueChange:t=>f(parseInt(t)),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Select control..."})}),e.jsx(Y,{className:"max-h-[300px]",children:M.filter(t=>!C||t.framework===C).map(t=>e.jsxs(O,{value:t.id.toString(),children:[e.jsx("span",{className:"font-mono text-xs",children:t.controlId}),e.jsxs("span",{className:"ml-2 text-muted-foreground text-xs",children:["(",t.framework,")"]})]},t.id))})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(as,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(p,{className:"text-xs",children:"Target Control"}),e.jsxs(W,{value:(i==null?void 0:i.toString())||"",onValueChange:t=>x(parseInt(t)),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Select control..."})}),e.jsx(Y,{className:"max-h-[300px]",children:M.filter(t=>!h||t.framework===h).map(t=>e.jsxs(O,{value:t.id.toString(),children:[e.jsx("span",{className:"font-mono text-xs",children:t.controlId}),e.jsxs("span",{className:"ml-2 text-muted-foreground text-xs",children:["(",t.framework,")"]})]},t.id))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(p,{className:"text-xs",children:"Relationship Type"}),e.jsxs(W,{value:N,onValueChange:t=>g(t),children:[e.jsx(K,{children:e.jsx(Z,{})}),e.jsxs(Y,{children:[e.jsx(O,{value:"equivalent",children:e.jsx(V,{variant:"default",className:"bg-green-600",children:"Equivalent"})}),e.jsx(O,{value:"partial",children:e.jsx(V,{variant:"default",className:"bg-yellow-600",children:"Partial"})}),e.jsx(O,{value:"related",children:e.jsx(V,{variant:"default",className:"bg-blue-600",children:"Related"})})]})]})]}),e.jsxs(j,{onClick:oe,disabled:me.isPending,children:[me.isPending?e.jsx(ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs",children:"Notes (Optional)"}),e.jsx(Oe,{value:w,onChange:t=>a(t.target.value),placeholder:"e.g., Both controls address access management for privileged accounts.",className:"h-16 mt-1.5"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Existing Mappings (",A.length,")"]}),m?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):A.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground border rounded-lg",children:"No control mappings defined yet."}):e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(se,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx($,{className:"text-white font-semibold py-4",children:"Source Control"}),e.jsx($,{className:"w-[100px] text-center text-white font-semibold py-4",children:"Type"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Target Control"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Notes"}),e.jsx($,{className:"w-[60px] text-white font-semibold py-4"})]})}),e.jsx(fe,{children:A.map(t=>{var ae,ne;const D=J(t.sourceControlId),F=J(t.targetControlId);return e.jsxs(se,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsxs(H,{className:"py-4",children:[e.jsx("div",{className:"font-mono text-sm text-black",children:(D==null?void 0:D.controlId)||`ID:${t.sourceControlId}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[D==null?void 0:D.framework," - ",(ae=D==null?void 0:D.name)==null?void 0:ae.substring(0,30),"..."]})]}),e.jsx(H,{className:"text-center py-4",children:e.jsx(V,{className:t.mappingType==="equivalent"?"bg-green-600":t.mappingType==="partial"?"bg-yellow-600":"bg-blue-600",children:t.mappingType})}),e.jsxs(H,{className:"py-4",children:[e.jsx("div",{className:"font-mono text-sm text-black",children:(F==null?void 0:F.controlId)||`ID:${t.targetControlId}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[F==null?void 0:F.framework," - ",(ne=F==null?void 0:F.name)==null?void 0:ne.substring(0,30),"..."]})]}),e.jsx(H,{className:"text-xs text-gray-500 max-w-[200px] truncate py-4",children:t.notes||"-"}),e.jsx(H,{className:"py-4",children:e.jsx(j,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50 transition-colors duration-200",onClick:()=>pe.mutate({id:t.id}),children:e.jsx(ce,{className:"h-4 w-4"})})})]},t.id)})})]})})]})]}),e.jsx(be,{open:z,onOpenChange:b,children:e.jsxs(ye,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Review AI Suggested Mappings"}),e.jsxs(ze,{children:["The AI has analyzed controls from ",e.jsx("strong",{children:C})," and ",e.jsx("strong",{children:h})," and found the following matches. Please review and select the ones you want to save."]})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(se,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx($,{className:"w-[50px] text-white font-semibold py-4",children:e.jsx(Be,{checked:o.size===c.length&&c.length>0,onCheckedChange:t=>{I(t?new Set(c.map((D,F)=>F)):new Set)}})}),e.jsx($,{className:"text-white font-semibold py-4",children:"Source Control"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Target Control"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Type"}),e.jsx($,{className:"text-white font-semibold py-4",children:"Confidence"})]})}),e.jsx(fe,{children:c.map((t,D)=>{const F=J(t.sourceId),ae=J(t.targetId);return e.jsxs(se,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(H,{className:"py-4",children:e.jsx(Be,{checked:o.has(D),onCheckedChange:ne=>{const le=new Set(o);ne?le.add(D):le.delete(D),I(le)}})}),e.jsxs(H,{className:"py-4",children:[e.jsx("div",{className:"font-mono font-medium text-xs text-black",children:F==null?void 0:F.controlId}),e.jsx("div",{className:"text-sm text-gray-600",children:F==null?void 0:F.name})]}),e.jsxs(H,{className:"py-4",children:[e.jsx("div",{className:"font-mono font-medium text-xs text-black",children:ae==null?void 0:ae.controlId}),e.jsx("div",{className:"text-sm text-gray-600",children:ae==null?void 0:ae.name})]}),e.jsx(H,{className:"py-4",children:e.jsx(V,{variant:"outline",className:"capitalize bg-white border-gray-300 text-gray-700",children:t.mappingType})}),e.jsx(H,{className:"py-4",children:e.jsxs(V,{variant:t.confidence>80?"default":"secondary",children:[t.confidence,"%"]})})]},D)})})]})}),e.jsxs(Se,{children:[e.jsx(j,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(j,{onClick:ee,children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Save ",o.size," Mappings"]})]})]})})]})}function ta({open:d,onOpenChange:s,clientId:f,onSuccess:i}){const[x,N]=n.useState(1),[g,w]=n.useState(null),[a,C]=n.useState(null),[y,h]=n.useState(""),[k,c]=n.useState(1),[r,o]=n.useState([]),[I,z]=n.useState(""),[b,q]=n.useState("1.0"),[P,M]=n.useState({controlCode:"",title:"",description:"",grouping:"",status:""}),G=n.useRef(null),A=S.frameworkImport.importCustomFramework.useMutation({onSuccess:u=>{l.success(`Successfully imported ${u.count} controls to the library!`),s(!1),i==null||i(),m()},onError:u=>{l.error(`Import failed: ${u.message}`)}}),m=()=>{N(1),w(null),C(null),h(""),c(1),o([]),z(""),q("1.0"),M({controlCode:"",title:"",description:"",grouping:"",status:""})},X=u=>{if(u.target.files&&u.target.files[0]){const _=u.target.files[0];w(_),I||z(_.name.replace(/\.[^/.]+$/,""));const J=new FileReader;J.onload=oe=>{var t;const v=(t=oe.target)==null?void 0:t.result,ee=Rs(v,{type:"binary"});C(ee),ee.SheetNames.length>0&&h(ee.SheetNames[0])},J.readAsBinaryString(_)}},me=()=>{if(!a||!y)return;const u=a.Sheets[y];$e.decode_range(u["!ref"]||"A1:Z100");const _=$e.sheet_to_json(u,{header:1,range:0}),J=k-1;if(_[J]&&Array.isArray(_[J])){const v=_[J].map((ee,t)=>ee?String(ee).trim():`Column ${t+1}`);o(v),N(2)}else l.error(`Row ${k} appears to be empty.`)},pe=async()=>{if(!g)return;const u=new FileReader;u.onload=()=>{const _=u.result.split(",")[1],J={};Object.entries(P).forEach(([oe,v])=>{v&&(J[v]=oe)}),A.mutate({clientId:f,frameworkName:I,frameworkVersion:b,fileContent:_,sheetName:y,headerRow:k,columnMappings:J})},u.readAsDataURL(g)};return e.jsx(be,{open:d,onOpenChange:u=>{u||m(),s(u)},children:e.jsxs(ye,{className:"sm:max-w-[600px]",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Import Custom Framework"}),e.jsx(ze,{children:"Upload any Excel sheet and map its columns to create a new framework in your library."})]}),x===1&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Framework Name"}),e.jsx(T,{value:I,onChange:u=>z(u.target.value),placeholder:"e.g. My Custom Standard"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Version"}),e.jsx(T,{value:b,onChange:u=>q(u.target.value),placeholder:"1.0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Upload Excel File"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{var u;return(u=G.current)==null?void 0:u.click()},children:[g?e.jsxs("div",{className:"text-center",children:[e.jsx(Ls,{className:"h-10 w-10 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:g.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(g.size/1024).toFixed(1)," KB"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(ke,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Click to upload .xlsx"})]}),e.jsx("input",{ref:G,type:"file",accept:".xlsx",className:"hidden",onChange:X})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Select Sheet"}),e.jsxs(W,{value:y,onValueChange:h,children:[e.jsx(K,{children:e.jsx(Z,{})}),e.jsx(Y,{children:a.SheetNames.map(u=>e.jsx(O,{value:u,children:u},u))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Header Row Number"}),e.jsx(T,{type:"number",min:1,value:k,onChange:u=>c(parseInt(u.target.value)||1)})]})]})]}),x===2&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-slate-50 p-3 rounded-md border text-sm",children:[e.jsx("p",{className:"font-medium text-slate-700",children:"Instructions:"}),e.jsx("p",{className:"text-slate-600",children:"Map the columns from your Excel file to the required system fields."})]}),e.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsxs(p,{className:"col-span-4",children:["Control ID / Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-8",children:e.jsxs(W,{value:P.controlCode,onValueChange:u=>M({...P,controlCode:u}),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Select Excel Column"})}),e.jsx(Y,{children:r.map(u=>e.jsx(O,{value:u,children:u},u))})]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsxs(p,{className:"col-span-4",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"col-span-8",children:e.jsxs(W,{value:P.title,onValueChange:u=>M({...P,title:u}),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"Select Excel Column"})}),e.jsx(Y,{children:r.map(u=>e.jsx(O,{value:u,children:u},u))})]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx(p,{className:"col-span-4",children:"Description"}),e.jsx("div",{className:"col-span-8",children:e.jsxs(W,{value:P.description,onValueChange:u=>M({...P,description:u}),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"(Optional)"})}),e.jsx(Y,{children:r.map(u=>e.jsx(O,{value:u,children:u},u))})]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx(p,{className:"col-span-4",children:"Grouping / Domain"}),e.jsx("div",{className:"col-span-8",children:e.jsxs(W,{value:P.grouping,onValueChange:u=>M({...P,grouping:u}),children:[e.jsx(K,{children:e.jsx(Z,{placeholder:"(Optional)"})}),e.jsx(Y,{children:r.map(u=>e.jsx(O,{value:u,children:u},u))})]})})]})]})]}),e.jsx(Se,{children:x===1?e.jsxs(j,{onClick:me,disabled:!g,children:["Next ",e.jsx(as,{className:"ml-2 h-4 w-4"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>N(1),children:"Back"}),e.jsxs(j,{onClick:pe,disabled:!P.controlCode||!P.title||A.isPending,children:[A.isPending?e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Import Framework"]})]})})]})})}function ra({clientId:d}){const[s,f]=n.useState(!1),[i,x]=n.useState(!1),[N,g]=n.useState(null),{data:w,isLoading:a,refetch:C}=S.frameworks.list.useQuery({clientId:d}),y=S.frameworks.delete.useMutation({onSuccess:()=>{l.success("Framework deleted successfully"),g(null),C()},onError:o=>l.error("Failed to delete: "+o.message)}),{data:h,isLoading:k,refetch:c}=S.frameworkImport.listFrameworks.useQuery({clientId:d}),r=S.frameworkImport.deleteFramework.useMutation({onSuccess:()=>{l.success("Framework removed from library"),c()},onError:o=>l.error(o.message)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-900 flex items-start gap-3",children:[e.jsx("div",{className:"min-w-5 pt-0.5",children:e.jsx(ts,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Where to get the official framework files?"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1 mb-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"PCI DSS v4.0:"}),' Download the "PCI DSS v4.0" Excel file from the ',e.jsx("a",{href:"https://docs-library.pcisecuritystandards.org/",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-700 font-medium",children:"PCI-SSC Document Library"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CIS Controls v8.1:"})," Download the Excel file from the ",e.jsx("a",{href:"https://www.cisecurity.org/controls/cis-controls-list",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-700 font-medium",children:"official CIS website"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CSA CCM v4:"}),' Download the "CCM v4.0.x" Excel file from the ',e.jsx("a",{href:"https://cloudsecurityalliance.org/artifacts/cloud-controls-matrix-v4",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-700 font-medium",children:"Cloud Security Alliance website"}),"."]})]}),e.jsx("p",{className:"text-xs text-blue-700",children:"Please ensure you download the official Excel (.xlsx) versions."})]})]}),e.jsxs(E,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),"Compliance Frameworks"]}),e.jsx(B,{children:"Manage the compliance frameworks active for this organization. You can import licensed frameworks regarding PCI DSS, CIS, and CCM here."})]}),e.jsxs(j,{onClick:()=>f(!0),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Import Framework"]})]})}),e.jsx(L,{children:a?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(ie,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(w==null?void 0:w.length)===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg bg-muted/10",children:[e.jsx(ue,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium",children:"No Custom Frameworks"}),e.jsx("p",{className:"text-muted-foreground max-w-sm mx-auto mt-1 mb-4",children:"You haven't imported any client-specific frameworks yet. Import PCI DSS, CIS, or CCM to get started."}),e.jsx(j,{variant:"outline",onClick:()=>f(!0),children:"Import Framework"})]}):e.jsx("div",{className:"space-y-4",children:w==null?void 0:w.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 font-bold text-xs",children:o.name.substring(0,3).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:[o.name," ",e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:["(",o.scope,")"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.controlCount," controls â€¢ Imported: ",new Date(o.importedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Active"}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-destructive",onClick:()=>g(o),disabled:y.isPending,children:e.jsx(ce,{className:"h-4 w-4"})})]})]},o.id))})})]}),e.jsx(Qe,{open:!!N,onOpenChange:o=>!o&&g(null),children:e.jsxs(We,{children:[e.jsxs(Ke,{children:[e.jsx(Ze,{children:"Delete Framework?"}),e.jsxs(Ye,{children:["Are you sure you want to delete ",e.jsx("b",{children:N==null?void 0:N.name}),"? This will remove all associated controls and mappings. This action cannot be undone."]})]}),e.jsxs(Xe,{children:[e.jsx(es,{children:"Cancel"}),e.jsx(ss,{className:"bg-red-600 hover:bg-red-700",onClick:()=>{N&&y.mutate({frameworkName:N.name,clientId:d})},disabled:y.isPending,children:y.isPending?"Deleting...":"Delete"})]})]})}),e.jsxs("div",{className:"pt-8 border-t border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Framework Library (Reference)"}),e.jsxs(j,{variant:"outline",onClick:()=>x(!0),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Import to Library"]})]}),e.jsxs(E,{className:"mb-8",children:[e.jsxs(R,{children:[e.jsx(U,{children:"Imported Frameworks"}),e.jsx(B,{children:"These frameworks are available for mapping and gap analysis but are not active controls."})]}),e.jsx(L,{children:k?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(ie,{className:"animate-spin"})}):(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No frameworks in library. Import one to get started."}):e.jsx("div",{className:"space-y-4",children:h==null?void 0:h.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-xs",children:o.name.substring(0,3).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:[o.name," ",e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:["v",o.version]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.controlCount," controls â€¢ Imported: ",new Date(o.importedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"outline",className:"bg-slate-100 text-slate-700 border-slate-200",children:"Reference"}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-red-600",onClick:()=>r.mutate({frameworkId:o.id}),children:e.jsx(ce,{className:"h-4 w-4"})})]})]},o.id))})})]}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-slate-900",children:"Advanced Harmonization"}),e.jsx(aa,{clientId:d})]}),e.jsx(Us,{open:s,onOpenChange:f,clientId:d,onSuccess:()=>C()}),e.jsx(ta,{open:i,onOpenChange:x,clientId:d,onSuccess:()=>c()})]})}function na({clientId:d}){var q,P,M,G,A;const[s,f]=n.useState(!1),[i,x]=n.useState(null),{data:N,refetch:g}=(q=S.onboarding.getRequirements)==null?void 0:q.useQuery({clientId:d},{enabled:!!d}),w=(P=S.onboarding.createRequirement)==null?void 0:P.useMutation({onSuccess:()=>{l.success("Requirement created successfully"),f(!1),r({title:"",key:"",description:"",isMandatory:!0}),g()}}),a=(M=S.onboarding.updateRequirement)==null?void 0:M.useMutation({onSuccess:()=>{l.success("Requirement updated successfully"),x(null),g()}}),C=(G=S.onboarding.deleteRequirement)==null?void 0:G.useMutation({onSuccess:()=>{l.success("Requirement deleted successfully"),g()}}),[y,h]=n.useState(!1),k=(A=S.onboarding.generateRequirementContent)==null?void 0:A.useMutation({onSuccess:m=>{s?r(X=>({...X,description:m.content})):i&&x(X=>({...X,description:m.content})),h(!1),l.success("Content generated successfully")},onError:m=>{h(!1),l.error(`Failed to generate content: ${m.message}`)}}),[c,r]=n.useState({title:"",key:"",description:"",isMandatory:!0}),o=()=>{d&&w.mutate({clientId:d,...c})},I=()=>{!d||!i||a.mutate({clientId:d,id:i.id,title:i.title,description:i.description,isMandatory:i.isMandatory})},z=m=>{d&&confirm("Are you sure? This will remove this requirement for future onboardings.")&&C.mutate({clientId:d,id:m})},b=m=>{if(!m){l.error("Please enter a title first");return}h(!0),k.mutate({clientId:d,title:m,tone:"Professional"})};return e.jsxs(E,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Compliance Acknowledgments"}),e.jsx(B,{children:"Configuration for documents employees must read and acknowledge during onboarding."})]}),e.jsxs(j,{onClick:()=>f(!0),className:"gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Add Requirement"]})]}),e.jsxs(L,{children:[e.jsxs("div",{className:"space-y-4",children:[N==null?void 0:N.map(m=>{var X;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-medium text-lg",children:m.title}),m.isMandatory&&e.jsx(V,{variant:"secondary",children:"Mandatory"}),e.jsx("span",{className:"text-xs text-mono text-gray-400 font-mono bg-gray-100 px-2 py-0.5 rounded",children:m.key})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-1",children:((X=m.description)==null?void 0:X.replace(/<[^>]*>/g,""))||"No description provided."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>x(m),children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>z(m.id),children:e.jsx(ce,{className:"h-4 w-4"})})]})]},m.id)}),(!N||N.length===0)&&e.jsx("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg border border-dashed",children:"No requirements configured. Default system requirements will be applied."})]}),e.jsx(be,{open:s,onOpenChange:f,children:e.jsxs(ye,{className:"sm:max-w-[900px]",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Add Compliance Requirement"}),e.jsx(ze,{children:"Create a new document or policy for employees to acknowledge."})]}),e.jsxs("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto px-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"title",children:"Title"}),e.jsx(T,{id:"title",placeholder:"e.g. Remote Work Policy",value:c.title,onChange:m=>r({...c,title:m.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"key",children:"Key (Unique ID)"}),e.jsx(T,{id:"key",placeholder:"e.g. remote_work_policy",value:c.key,onChange:m=>r({...c,key:m.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lowercase, underscores only."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{htmlFor:"description",children:"Content"}),e.jsx(j,{type:"button",variant:"outline",size:"sm",disabled:y||!c.title,onClick:()=>b(c.title),className:"h-7 text-xs gap-1",children:y?e.jsx(e.Fragment,{children:"Generating..."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-3 w-3 text-purple-500"}),"Generate with AI"]})})]}),e.jsx("div",{className:"h-[350px]",children:e.jsx(Te,{value:c.description,onChange:m=>r({...c,description:m}),className:"h-full",minHeight:"300px"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Re,{id:"mandatory",checked:c.isMandatory,onCheckedChange:m=>r({...c,isMandatory:m})}),e.jsx(p,{htmlFor:"mandatory",children:"Mandatory Acknowledgment"})]})]}),e.jsxs(Se,{children:[e.jsx(j,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(j,{onClick:o,disabled:!c.title||!c.key,children:"Create Requirement"})]})]})}),e.jsx(be,{open:!!i,onOpenChange:m=>!m&&x(null),children:e.jsxs(ye,{className:"sm:max-w-[900px]",children:[e.jsx(we,{children:e.jsx(Ce,{children:"Edit Requirement"})}),e.jsxs("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto px-1",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Title"}),e.jsx(T,{value:(i==null?void 0:i.title)||"",onChange:m=>x({...i,title:m.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Content"}),e.jsx(j,{type:"button",variant:"outline",size:"sm",disabled:y||!(i!=null&&i.title),onClick:()=>b(i.title),className:"h-7 text-xs gap-1",children:y?e.jsx(e.Fragment,{children:"Generating..."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-3 w-3 text-purple-500"}),"Generate with AI"]})})]}),e.jsx("div",{className:"h-[350px]",children:e.jsx(Te,{value:(i==null?void 0:i.description)||"",onChange:m=>x({...i,description:m}),className:"h-full",minHeight:"300px"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Re,{checked:(i==null?void 0:i.isMandatory)||!1,onCheckedChange:m=>x({...i,isMandatory:m})}),e.jsx(p,{children:"Mandatory Acknowledgment"})]})]}),e.jsxs(Se,{children:[e.jsx(j,{variant:"outline",onClick:()=>x(null),children:"Cancel"}),e.jsx(j,{onClick:I,children:"Save Changes"})]})]})})]})]})}function la({clientId:d}){const[s,f]=n.useState(!1),[i,x]=n.useState(!1),[N,g]=n.useState(!1),[w,a]=n.useState(!1),[C,y]=n.useState(null),[h,k]=n.useState(null),[c,r]=n.useState({slug:"",subject:"",content:"",name:""}),{data:o=[],isLoading:I,refetch:z}=S.emailTemplates.list.useQuery(),{data:b=[],isLoading:q,refetch:P}=S.emailTriggers.list.useQuery(),M=S.emailTemplates.create.useMutation({onSuccess:()=>{l.success("Template Created"),f(!1),z()},onError:v=>l.error(v.message)}),G=S.emailTemplates.update.useMutation({onSuccess:()=>{l.success("Template Updated"),x(!1),z()},onError:v=>l.error(v.message)}),A=S.emailTriggers.assign.useMutation({onSuccess:()=>{l.success("Trigger Assignment Updated"),P()},onError:v=>l.error(v.message)}),m=S.emailTemplates.delete.useMutation({onSuccess:()=>{l.success("Template Deleted"),a(!1),y(null),z()},onError:v=>l.error(v.message)}),X=v=>{k(v),r({slug:v.slug,name:v.name,subject:v.subject,content:v.content}),x(!0)},me=v=>{k(v),g(!0)},pe=()=>{h&&G.mutate({id:h.id,subject:c.subject,content:c.content,name:c.name})},u=()=>{if(!c.slug||!c.name||!c.subject){l.error("Please fill in all required fields");return}M.mutate({slug:c.slug,name:c.name,subject:c.subject,content:c.content})},_=(v,ee)=>{A.mutate({eventSlug:v,templateId:ee==="none"?null:parseInt(ee)})},J=v=>{y(v),a(!0)},oe=()=>{C&&m.mutate({id:C.id})};return I||q?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx(de,{className:"animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ve,{defaultValue:"library",className:"w-full",children:[e.jsxs(_e,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(te,{value:"library",children:"Templates Library"}),e.jsx(te,{value:"assignments",children:"Trigger Assignments"})]}),e.jsx(re,{value:"library",children:e.jsxs(E,{className:"shadow-sm border-slate-200",children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-indigo-600"}),"Email Library"]}),e.jsx(B,{children:"Manage your library of reusable email templates."})]}),e.jsxs(j,{onClick:()=>{r({slug:"",name:"",subject:"",content:""}),f(!0)},className:"bg-indigo-600 hover:bg-indigo-700",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Template"]})]}),e.jsx(L,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(se,{className:"bg-slate-50",children:[e.jsx($,{children:"Template Name"}),e.jsx($,{children:"Slug"}),e.jsx($,{children:"Subject Line"}),e.jsx($,{className:"w-32",children:"Actions"})]})}),e.jsx(fe,{children:o.length===0?e.jsx(se,{children:e.jsx(H,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No templates found."})}):o.map(v=>e.jsxs(se,{className:"hover:bg-slate-50 transition-colors",children:[e.jsx(H,{className:"font-medium",children:v.name}),e.jsx(H,{children:e.jsx(V,{variant:"secondary",className:"font-mono text-[10px]",children:v.slug})}),e.jsx(H,{className:"text-slate-600",children:v.subject}),e.jsx(H,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>X(v),title:"Edit Template",children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>me(v),title:"Preview",children:e.jsx(Os,{className:"h-4 w-4 text-slate-400"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>J(v),title:"Delete Template",className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(ce,{className:"h-4 w-4"})})]})})]},v.id))})]})})})]})}),e.jsx(re,{value:"assignments",children:e.jsxs(E,{className:"shadow-sm border-slate-200",children:[e.jsxs(R,{children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-indigo-600"}),"Trigger Assignments"]}),e.jsx(B,{children:"Map system events (transactions) to specific templates from your library."})]}),e.jsx(L,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(se,{className:"bg-slate-50",children:[e.jsx($,{children:"System Event"}),e.jsx($,{children:"Description"}),e.jsx($,{className:"w-64",children:"Assigned Template"})]})}),e.jsx(fe,{children:b.length===0?e.jsx(se,{children:e.jsx(H,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No system triggers configured."})}):b.map(v=>{var ee;return e.jsxs(se,{children:[e.jsx(H,{className:"font-semibold",children:e.jsx(V,{variant:"outline",className:"bg-blue-50 text-blue-700 font-mono",children:v.eventSlug})}),e.jsx(H,{className:"text-sm text-slate-500",children:v.description}),e.jsx(H,{children:e.jsxs(W,{value:((ee=v.templateId)==null?void 0:ee.toString())||"none",onValueChange:t=>_(v.eventSlug,t),children:[e.jsx(K,{className:"w-full",children:e.jsx(Z,{placeholder:"Select a template"})}),e.jsxs(Y,{children:[e.jsx(O,{value:"none",children:"Disabled (No Email)"}),o.map(t=>e.jsx(O,{value:t.id.toString(),children:t.name},t.id))]})]})})]},v.id)})})]})})})]})})]}),e.jsx(he,{open:s,onOpenChange:f,title:"Create New Template",description:"Create a custom email template that can be assigned to system triggers.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(j,{onClick:u,disabled:M.isPending,className:"bg-indigo-600 hover:bg-indigo-700",children:[M.isPending?e.jsx(de,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Create Template"]})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Template Name"}),e.jsx(T,{placeholder:"e.g. Custom Welcome",value:c.name,onChange:v=>r({...c,name:v.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Internal Slug"}),e.jsx(T,{placeholder:"e.g. custom-welcome",value:c.slug,onChange:v=>r({...c,slug:v.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subject Line"}),e.jsx(T,{placeholder:"e.g. Welcome to our platform!",value:c.subject,onChange:v=>r({...c,subject:v.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Content"}),e.jsx(Te,{minHeight:"400px",value:c.content,onChange:v=>r({...c,content:v})})]})]})}),e.jsx(he,{open:i,onOpenChange:x,title:`Edit Template: ${h==null?void 0:h.name}`,description:"Modify the subject and body of this email. Placeholders will be replaced at runtime.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(j,{onClick:pe,disabled:G.isPending,className:"bg-indigo-600 hover:bg-indigo-700",children:[G.isPending?e.jsx(de,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Display Name"}),e.jsx(T,{value:c.name,onChange:v=>r({...c,name:v.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subject Line"}),e.jsx(T,{value:c.subject,onChange:v=>r({...c,subject:v.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Content"}),e.jsx(Te,{minHeight:"400px",value:c.content,onChange:v=>r({...c,content:v})})]})]})}),e.jsx(he,{open:N,onOpenChange:g,title:"Email Preview",description:"This is how the email will roughly appear to the recipient (rendered without CSS styles).",children:e.jsxs("div",{className:"py-4 border rounded-md bg-white p-6 max-h-[600px] overflow-auto",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-500",children:"Subject:"}),e.jsx("p",{className:"text-lg font-bold",children:h==null?void 0:h.subject})]}),e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:(h==null?void 0:h.content)||""}})]})}),e.jsx(he,{open:w,onOpenChange:a,title:"Delete Template?",description:`Are you sure you want to delete "${C==null?void 0:C.name}"? Any triggers using this template will need to be re-assigned.`,footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(j,{variant:"destructive",onClick:oe,disabled:m.isPending,children:[m.isPending?e.jsx(de,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Delete Permanently"]})]})})]})}function ia(){return e.jsxs(E,{className:"bg-blue-50/30 border-blue-100 shadow-sm",children:[e.jsx(R,{className:"pb-3",children:e.jsxs(U,{className:"text-sm font-medium uppercase tracking-wider text-blue-600 flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),"Personalization Guide"]})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed",children:["Use double curly braces (e.g., ",e.jsx("code",{children:"{{userName}}"}),") to insert dynamic data into your email templates."]}),e.jsxs(Bs,{type:"single",collapsible:!0,className:"w-full",children:[e.jsxs(De,{value:"user",className:"border-blue-100",children:[e.jsx(Fe,{className:"text-[11px] py-2 font-semibold text-slate-700 hover:no-underline",children:"User Information"}),e.jsx(Ee,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1.5 pt-1",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{userName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Full name of the recipient"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{firstName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"First name only"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{email}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Recipient email address"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{managerName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Assigned manager name"})]})]})})]}),e.jsxs(De,{value:"app",className:"border-blue-100",children:[e.jsx(Fe,{className:"text-[11px] py-2 font-semibold text-slate-700 hover:no-underline",children:"App & Company"}),e.jsx(Ee,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1.5 pt-1",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{appName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Product name (ComplianceOS)"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{companyName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Client's organization name"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{magicLink}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Secure login/access URL"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{supportEmail}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"System contact address"})]})]})})]}),e.jsxs(De,{value:"compliance",className:"border-blue-100 last:border-b-0",children:[e.jsx(Fe,{className:"text-[11px] py-2 font-semibold text-slate-700 hover:no-underline",children:"Compliance & Timing"}),e.jsx(Ee,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1.5 pt-1",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{frameworkName}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"SOC2, ISO 27001, etc."})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{complianceScore}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Current readiness %"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{dueDate}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Target completion date"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 p-1.5 border rounded bg-white",children:[e.jsx("code",{className:"text-indigo-600 font-bold text-[10px]",children:"{{daysRemaining}}"}),e.jsx("span",{className:"text-[9px] text-slate-500",children:"Countdown to deadline"})]})]})})]})]})]})]})}function vt(){const d=gs(),s=Number(d.id),[,f]=js(),{user:i}=fs(),[x,N]=n.useState(!1),[g,w]=n.useState(!1),{data:a,isLoading:C,refetch:y}=S.clients.get.useQuery({id:s}),h=S.clients.delete.useMutation({onSuccess:()=>{l.success("Client deleted successfully"),f("/clients")},onError:c=>l.error(c.message)}),k=S.clients.importDemoData.useMutation({onSuccess:()=>{l.success("Demo data imported successfully!"),w(!1),y()},onError:c=>l.error(c.message)});return C?e.jsx(Ie,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-primary"})})}):a?e.jsx(Ie,{children:e.jsxs("div",{className:"space-y-8 w-full max-w-full pb-10 px-6",children:[e.jsx(bs,{items:[{label:"Clients",href:"/clients"},{label:a.name,href:`/clients/${s}`},{label:"Settings"}]}),e.jsxs(E,{className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white border-none shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-32 bg-primary/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 p-24 bg-indigo-500/10 rounded-full blur-2xl -ml-12 -mb-12 pointer-events-none"}),e.jsx(L,{className:"p-8 relative z-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{className:"flex items-start gap-5",children:[e.jsx("div",{className:"p-4 bg-white/10 backdrop-blur-md rounded-2xl border border-white/10 shadow-inner",children:a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:a.name,className:"h-12 w-12 object-contain"}):e.jsx(ts,{className:"h-12 w-12 text-blue-200"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-white",children:a.name}),e.jsx(V,{variant:"secondary",className:"bg-primary/20 text-primary-foreground hover:bg-primary/30 border-none",children:"Settings"})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ne,{className:"w-4 h-4 text-slate-400"}),a.industry||"Industry not set"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(He,{className:"w-4 h-4 text-slate-400"}),a.size||"Size not set"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Je,{className:"w-4 h-4 text-slate-400"}),a.headquarters||"HQ not set"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(j,{variant:"outline",className:"bg-white/5 border-white/10 text-white hover:bg-white/10 hover:text-white",onClick:()=>f(`/clients/${s}`),children:[e.jsx(qs,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})})]})})]}),e.jsxs(Ve,{defaultValue:"general",className:"space-y-8",children:[e.jsxs(_e,{className:"bg-slate-100/50 p-1.5 h-auto flex flex-wrap justify-start gap-2 w-full border border-slate-200/60 rounded-xl",children:[e.jsxs(te,{value:"general",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"General"]}),e.jsxs(te,{value:"policy",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(vs,{className:"mr-2 h-4 w-4"}),"Policy Settings"]}),e.jsxs(te,{value:"team",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Team"]}),e.jsxs(te,{value:"branding",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Branding"]}),e.jsxs(te,{value:"billing",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Billing"]}),e.jsxs(te,{value:"integrations",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Integrations"]}),e.jsxs(te,{value:"frameworks",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Frameworks"]}),e.jsxs(te,{value:"data",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Demo Data"]}),e.jsxs(te,{value:"onboarding",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Ns,{className:"mr-2 h-4 w-4"}),"Onboarding"]}),e.jsxs(te,{value:"email-templates",className:"data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-sm data-[state=active]:border-slate-200 border border-transparent px-4 py-2.5 rounded-lg transition-all",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Emails"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(re,{value:"general",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"Organization Details"}),e.jsx(B,{children:"Manage the core profile information for this client."})]}),e.jsx(L,{children:e.jsx(Qs,{clientId:s,initialData:{name:a.name,description:a.description,industry:a.industry,size:a.size,cisoName:a.cisoName,dpoName:a.dpoName,headquarters:a.headquarters,mainServiceRegion:a.mainServiceRegion}})})]}),e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"Contact Information"}),e.jsx(B,{children:"Primary point of contact for this organization."})]}),e.jsx(L,{children:e.jsx(Vs,{clientId:s,contactName:a==null?void 0:a.primaryContactName,contactTitle:void 0,contactEmail:a==null?void 0:a.primaryContactEmail,contactPhone:a==null?void 0:a.primaryContactPhone,address:void 0})})]})]}),e.jsx(re,{value:"onboarding",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(na,{clientId:s})}),e.jsx(re,{value:"policy",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(sa,{clientId:s,client:a,onUpdate:y})}),e.jsx(re,{value:"team",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"Team Management"}),e.jsx(B,{children:"Manage members who have access to this workspace."})]}),e.jsx(L,{children:e.jsx(_s,{clientId:s})})]})}),e.jsx(re,{value:"branding",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(Ks,{clientId:s,clientName:(a==null?void 0:a.name)||"Client",initialData:{logoUrl:a==null?void 0:a.logoUrl,brandPrimaryColor:a==null?void 0:a.brandPrimaryColor,brandSecondaryColor:a==null?void 0:a.brandSecondaryColor,portalTitle:a==null?void 0:a.portalTitle},onUpdate:y})}),e.jsx(re,{value:"billing",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(Js,{client:a})}),e.jsx(re,{value:"integrations",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"SMTP Configuration"}),e.jsx(B,{children:"Configure email server settings for outgoing notifications."})]}),e.jsx(L,{children:e.jsx(Zs,{clientId:s})})]})}),e.jsx(re,{value:"email-templates",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(la,{clientId:s})}),e.jsx(re,{value:"frameworks",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsx(ra,{clientId:s})}),e.jsx(re,{value:"data",className:"m-0 space-y-6 animate-in fade-in-50 duration-300",children:e.jsxs(E,{children:[e.jsxs(R,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),"Import Demo Data"]}),e.jsx(B,{children:"Populate this organization with comprehensive sample data for testing purposes."})]}),e.jsxs(L,{children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(ue,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-amber-800 mb-1",children:"Warning: Use with caution"}),e.jsxs("p",{className:"text-sm text-amber-700 leading-relaxed",children:["This action will generate significant amounts of data including employees, assets, risks, vendors, and policies. It is strictly intended for ",e.jsx("strong",{children:"empty"})," or ",e.jsx("strong",{children:"demo"})," organizations."]})]})]})}),e.jsxs(j,{onClick:()=>w(!0),children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Import Demo Data"]}),e.jsx(ys,{open:g,onOpenChange:w,onImport:async()=>{await k.mutateAsync({clientId:s})}})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"bg-slate-50/50 border-slate-200 shadow-sm",children:[e.jsx(R,{children:e.jsx(U,{className:"text-sm font-medium uppercase tracking-wider text-slate-500",children:"Quick Tips"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:[e.jsx("p",{className:"mb-2 font-medium text-slate-900",children:"Keeping profiles updated"}),e.jsx("p",{children:"Accurate industry and size information helps us benchmark your compliance posture against peers."})]}),e.jsx("div",{className:"h-px bg-slate-200"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[e.jsx("p",{className:"mb-2 font-medium text-slate-900",children:"Policy Management"}),e.jsx("p",{children:"Configure default review cycles and approval workflows in the Policy Settings tab."})]})]})]}),e.jsx(ia,{}),((i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="owner"||(i==null?void 0:i.role)==="super_admin")&&e.jsxs(E,{className:"border-red-200 bg-red-50/30 overflow-hidden",children:[e.jsxs(R,{className:"bg-red-50/50 border-b border-red-100 pb-4",children:[e.jsxs(U,{className:"text-red-700 flex items-center gap-2 text-lg",children:[e.jsx(ce,{className:"h-5 w-5"}),"Danger Zone"]}),e.jsx(B,{className:"text-red-600/80",children:"Irreversible actions for this organization."})]}),e.jsxs(L,{className:"pt-6",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Permanently delete this client and all associated data. This action cannot be undone and will remove:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-slate-600 mb-6 space-y-1 ml-1",children:[e.jsx("li",{children:"All policies and procedures"}),e.jsx("li",{children:"Risk assessments and registers"}),e.jsx("li",{children:"Employee records and evidence"}),e.jsx("li",{children:"Access controls and settings"})]}),e.jsx(he,{open:x,onOpenChange:N,title:"Delete Client",description:e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold text-foreground",children:a.name}),"? This will permanently delete all associated controls, policies, evidence, mappings, and assignments."]}),footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:()=>h.mutate({id:s}),disabled:h.isPending,children:h.isPending?"Deleting...":"Delete Permanently"})]}),trigger:e.jsxs(j,{variant:"destructive",className:"w-full",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Delete Organization"]})})]})]})]})]})]})]})}):e.jsx(Ie,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Client not found"})})})}export{vt as default};
