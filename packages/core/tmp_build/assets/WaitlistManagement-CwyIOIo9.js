import{t as l,r as d,j as e,k as y,c as m,N as W,O as H,P as h,Q as o,V as Q,W as a,Z as _,_ as q,$ as V,a1 as u,D as Z,o as J,p as K,q as X,L as j,I as A,w as Y,i as n}from"./index-DOc7Nwb7.js";import{D as ee}from"./DashboardLayout-aHnUqq57.js";import{D as te}from"./download-ByfWg1Mi.js";import{M as se}from"./mail-xRDvl6QK.js";import{E as ie}from"./ellipsis-BXWwt8ER.js";import{U as ae}from"./user-plus-DI6Ajm-6.js";import{L as ne}from"./link-FmUqdGRG.js";import{T as re}from"./trash-2-CFEfisbM.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function _e(){const{data:r,isLoading:R,refetch:x}=l.waitlist.list.useQuery(),{data:oe}=l.clients.list.useQuery(),f=l.waitlist.updateStatus.useMutation(),E=l.waitlist.remove.useMutation(),P=l.globalCrm.convertFromWaitlist.useMutation(),g=l.waitlist.invite.useMutation(),[U,p]=d.useState(!1),[b,N]=d.useState(null),[w,C]=d.useState("viewer"),[S,D]=d.useState("pro"),[I,k]=d.useState(30),[L,T]=d.useState(1),M=async(t,s)=>{console.log("Updating status for:",t,"to",s);try{await f.mutateAsync({id:t,status:s}),console.log("Status updated successfully"),n.success("Status updated"),x()}catch(v){console.error("Status update failed:",v),n.error("Failed to update status")}},O=async t=>{try{await E.mutateAsync({id:t}),n.success("Lead deleted"),x()}catch(s){n.error("Failed to delete lead: "+s.message)}},$=async t=>{try{const s=await P.mutateAsync({firstName:t.firstName||"",lastName:t.lastName||"",email:t.email,company:t.company||"",role:t.role||""});await f.mutateAsync({id:t.id,status:"converted"}),s.alreadyExisted?n.info("Contact already exists in Global CRM"):n.success("Converted to Global CRM contact"),x()}catch(s){console.error("Conversion failed:",s),n.error("Failed to convert: "+s.message)}},z=t=>{N(t),C("viewer"),D("pro"),k(30),T(1),p(!0)},F=async()=>{if(b)try{const t=await g.mutateAsync({id:b.id,role:w,planTier:S,expiresInDays:I,usageLimit:L}),s=`${window.location.origin}/auth/redeem-link?token=${t.token}`;await navigator.clipboard.writeText(s),n.success("Invitation sent and link copied to clipboard!"),p(!1),N(null),x()}catch(t){console.error("Invite failed:",t),n.error("Failed to send invite: "+t.message)}},B=()=>{if(!r)return;const s=[["First Name","Last Name","Email","Company","Industry","Org Size","Certification","Status","Date"].join(","),...r.map(i=>[i.firstName,i.lastName,`"${i.email}"`,`"${i.company}"`,i.industry,i.orgSize,i.certification,i.status,new Date(i.createdAt).toLocaleDateString()].join(","))].join(`
`),v=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),G=URL.createObjectURL(v);c.setAttribute("href",G),c.setAttribute("download",`waitlist_leads_${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)};return e.jsxs(ee,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Waitlist Management"}),e.jsx(y,{className:"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-none px-3 py-1 text-[10px] font-bold tracking-widest shadow-lg shadow-indigo-200 uppercase",children:"Premium"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Review and manage early access requests."})]}),e.jsxs(m,{onClick:B,variant:"outline",className:"gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Export CSV"]})]}),e.jsx("div",{className:"border rounded-lg bg-card",children:e.jsxs(W,{children:[e.jsx(H,{children:e.jsxs(h,{children:[e.jsx(o,{children:"Contact"}),e.jsx(o,{children:"Company"}),e.jsx(o,{children:"Details"}),e.jsx(o,{children:"Target Cert"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Date"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:R?e.jsx(h,{children:e.jsx(a,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Loading leads..."})}):(r==null?void 0:r.length)===0?e.jsx(h,{children:e.jsx(a,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No leads yet."})}):r==null?void 0:r.map(t=>{var s;return e.jsxs(h,{children:[e.jsxs(a,{children:[e.jsxs("div",{className:"font-medium",children:[t.firstName," ",t.lastName]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),t.email]})]}),e.jsxs(a,{children:[e.jsx("div",{className:"font-medium",children:t.company||"N/A"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.industry||t.orgSize?`${t.industry} â€¢ ${t.orgSize}`:""})]}),e.jsx(a,{children:e.jsxs("div",{className:"text-xs",children:[t.role&&e.jsxs("div",{children:["Role: ",t.role]}),t.source&&e.jsxs("div",{children:["Src: ",t.source]})]})}),e.jsx(a,{children:e.jsx(y,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:t.certification||"Any"})}),e.jsx(a,{children:e.jsx(y,{variant:t.status==="converted"?"success":t.status==="pending"?"secondary":"default",className:t.status==="contacted"?"bg-amber-100 text-amber-700 border-amber-200":"",children:(s=t.status)==null?void 0:s.toUpperCase()})}),e.jsx(a,{className:"text-muted-foreground text-sm",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{className:"text-right",children:e.jsxs(_,{children:[e.jsx(q,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(V,{align:"end",children:[e.jsxs(u,{onClick:()=>$(t),disabled:t.status==="converted",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Convert to Contact"]}),e.jsx(u,{onClick:()=>M(t.id,"contacted"),children:"Mark as Contacted"}),e.jsxs(u,{onClick:()=>z(t),disabled:t.status==="invited",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Send Invitation"]}),e.jsx(u,{onClick:()=>M(t.id,"pending"),children:"Reset to Pending"}),e.jsxs(u,{onClick:()=>O(t.id),className:"text-destructive",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete Lead"]})]})]})})]},t.id)})})]})}),e.jsx(Z,{open:U,onOpenChange:p,children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(X,{children:"Send Invitation"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Role"}),e.jsx("div",{className:"flex gap-2",children:["viewer","editor","user","admin"].map(t=>e.jsx(m,{type:"button",variant:w===t?"default":"outline",onClick:()=>C(t),className:"capitalize",children:t==="admin"?"Global Admin":t==="user"?"Org Admin":t},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Plan Tier"}),e.jsx("div",{className:"flex gap-2",children:["free","pro","enterprise"].map(t=>e.jsx(m,{type:"button",variant:S===t?"default":"outline",onClick:()=>D(t),className:"capitalize",children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Expires In (Days)"}),e.jsx(A,{type:"number",value:I,onChange:t=>k(parseInt(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Usage Limit (1 = single use, 0 = unlimited)"}),e.jsx(A,{type:"number",value:L??0,onChange:t=>{const s=parseInt(t.target.value);T(s===0?null:s)}})]})]})]}),e.jsxs(Y,{children:[e.jsx(m,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(m,{onClick:F,disabled:g.isPending,children:g.isPending?"Sending...":"Send Invitation"})]})]})})]})}export{_e as default};
