import{au as I,t as h,r as i,i as p,j as e,x as k,F as P,c as d,k as L,C as g,d as j,e as f,m as N,L as v,I as M,E as z,G as V,H as B,J as G,K as o,ao as H}from"./index-DOc7Nwb7.js";import{R as U}from"./RichTextEditor-NQxhVz6n.js";import{P as q}from"./PageGuide-CPKKXXS6.js";import{A as Q}from"./arrow-left-CpuUojG-.js";import{D as J}from"./download-ByfWg1Mi.js";import{S as K}from"./save-CvVmWchr.js";import{T as O}from"./trash-2-CFEfisbM.js";import{f as b}from"./format-H2tx8_vS.js";import"./scroll-area-DPaNxEJD.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function oe(){const[,x]=I("/tprm/dpa-editor/:dpaId"),[,t]=I("/clients/:id/vendors/dpa-editor/:dpaId"),c=parseInt((x==null?void 0:x.dpaId)||(t==null?void 0:t.dpaId)||"0"),E=new URLSearchParams(window.location.search),m=parseInt((t==null?void 0:t.id)||E.get("clientId")||"0"),{data:s,isLoading:R,refetch:T}=h.vendorDpas.get.useQuery({id:c,clientId:m},{enabled:!!c&&!!m}),{data:a}=h.vendors.get.useQuery({id:s==null?void 0:s.vendorId},{enabled:!!(s!=null&&s.vendorId)}),[w,y]=i.useState(""),[l,D]=i.useState(""),[r,A]=i.useState("Draft"),[S,C]=i.useState("");i.useEffect(()=>{s&&(y(s.content||""),D(s.name||""),A(s.status||"Draft"),C(s.signedAt?b(new Date(s.signedAt),"yyyy-MM-dd"):""))},[s]);const u=h.vendorDpas.update.useMutation({onSuccess:()=>{p.success("DPA saved successfully"),T()},onError:n=>p.error("Failed to save DPA: "+n.message)}),F=()=>{if(!l)return p.error("Document name is required");u.mutate({id:c,clientId:m,name:l,content:w,status:r,signedAt:S||void 0})};return R?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-blue-500"})}):s?e.jsxs("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[e.jsx(q,{title:"DPA Editor",description:"Draft and customize Data Processing Agreements.",rationale:"Tailor legal terms to specific data categories and processing activities.",howToUse:[{step:"Draft",description:"Edit clauses using the rich text editor."},{step:"Review",description:"Collaborate on terms and version control."},{step:"Finalize",description:"Mark as signed and export PDF for records."}]}),e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-lg border shadow-sm sticky top-0 z-10 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>window.history.back(),children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[l,e.jsx(L,{variant:"outline",className:r==="Signed"?"bg-green-50 text-green-700 border-green-200":r==="Review"?"bg-amber-50 text-amber-700 border-amber-200":"bg-slate-50 text-slate-700 border-slate-200",children:r})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vendor: ",e.jsx("span",{className:"font-medium text-slate-900",children:a==null?void 0:a.name})," â€¢ ID: ",e.jsx("span",{className:"font-medium text-slate-900",children:c})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>window.print(),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Export PDF"]}),e.jsxs(d,{className:"bg-blue-600 hover:bg-blue-700",onClick:F,disabled:u.isPending,children:[u.isPending?e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(K,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx("div",{className:"col-span-3 space-y-4",children:e.jsxs(g,{children:[e.jsx(j,{className:"pb-3 border-b bg-slate-50/50",children:e.jsxs(f,{className:"text-sm font-medium uppercase tracking-wider text-muted-foreground flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Agreement Content"]})}),e.jsx(N,{className:"p-0",children:e.jsx(U,{value:w,onChange:y,className:"border-0 rounded-none min-h-[600px]"})})]})}),e.jsxs("div",{className:"col-span-1 space-y-6",children:[e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(f,{className:"text-sm",children:"Metadata & Status"})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{className:"text-xs",children:"Document Name"}),e.jsx(M,{value:l,onChange:n=>D(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{className:"text-xs",children:"Processing Status"}),e.jsxs(z,{value:r,onValueChange:A,children:[e.jsx(V,{children:e.jsx(B,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"Draft",children:"Draft"}),e.jsx(o,{value:"Review",children:"In Review"}),e.jsx(o,{value:"Signed",children:"Signed / Active"}),e.jsx(o,{value:"Archived",children:"Archived"})]})]})]}),r==="Signed"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{className:"text-xs",children:"Date Signed"}),e.jsx(M,{type:"date",value:S,onChange:n=>C(n.target.value)})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Version:"}),e.jsxs("span",{className:"font-medium",children:["v",s.version]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"font-medium",children:s.createdAt?b(new Date(s.createdAt),"MMM d, yyyy"):"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Updated:"}),e.jsx("span",{className:"font-medium",children:s.updatedAt?b(new Date(s.updatedAt),"MMM d, yyyy"):"N/A"})]})]})]})]}),e.jsxs(g,{className:"bg-blue-50/50 border-blue-100",children:[e.jsx(j,{children:e.jsxs(f,{className:"text-sm flex items-center gap-2 text-blue-800",children:[e.jsx(H,{className:"h-4 w-4"}),"Audit Note"]})}),e.jsxs(N,{className:"text-xs text-blue-700 space-y-2",children:[e.jsxs("p",{children:["This document is a legally binding Data Processing Agreement between your organization and ",e.jsx("strong",{children:a==null?void 0:a.name}),"."]}),e.jsx("p",{children:'Once signed, update the status to "Signed" and record the execution date for compliance tracking.'})]})]}),e.jsxs(d,{variant:"ghost",className:"w-full text-rose-500 hover:text-rose-600 hover:bg-rose-50 justify-start h-9 text-xs",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Delete Document"]})]})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(P,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold",children:"DPA Not Found"}),e.jsx(d,{variant:"link",onClick:()=>window.history.back(),children:"Go Back"})]})}export{oe as default};
