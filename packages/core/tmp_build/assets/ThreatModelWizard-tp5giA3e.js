import{M as Me,r as x,j as e,S as ps,b5 as xs,C as ee,d as se,e as te,f as ae,a3 as ke,aa as _e,m as be,L as y,I as A,c as p,k as P,T as us,ac as gs,ab as bs,b as js,t as k,R as fe,E as Ve,G as He,H as Ke,J as $e,K as le,i as N,D as ys,o as fs,p as vs,q as Ns,s as ws,v as qe,w as Ss,ay as Cs,az as ks,aA as As,aB as Ps,aC as Ms,an as Qe,x as Is}from"./index-DOc7Nwb7.js";import"./separator-BWuYil37.js";import"./textarea-BtxBxzdY.js";import"./tabs-CBDTXbEn.js";import"./scroll-area-DPaNxEJD.js";import"./alert-dialog-V7xGXdVc.js";import{D as Es}from"./DashboardLayout-aHnUqq57.js";import{B as Ds}from"./Breadcrumb-CRi3LAxS.js";import{c as D}from"./utils-BC5CVi_C.js";import{T as Xe}from"./target-cfAj3L6j.js";import{L as Ts}from"./layers-ZuBPQb1T.js";import{G as zs}from"./git-branch-Cp8-LWxO.js";import{S as Rs}from"./swords-ZtChPoEW.js";import{T as Os}from"./trending-up-eUiO956o.js";import{C as ve}from"./circle-check-C5kiwRoG.js";import{R as Fs}from"./RichTextEditor-NQxhVz6n.js";import{P as Bs,a as Je}from"./PageGuide-CPKKXXS6.js";import{A as Ce}from"./arrow-right-M96iV-v9.js";import{U as Ls}from"./upload-BBmUECj8.js";import{D as Ws}from"./download-ByfWg1Mi.js";import{P as Us}from"./plus-BaQ35Jcx.js";import{L as Gs}from"./lock-czWF3qbC.js";import{U as _s}from"./user-CqRnJLgW.js";import{A as Ye}from"./activity-B1F2IRm3.js";import{B as Ae}from"./box-CVKFmOr5.js";import{N as Vs}from"./network-CgrL7DP_.js";import{S as Pe}from"./shield-check-ETs8j4-d.js";import{S as ge}from"./sparkles-CoQ80pK2.js";import{G as Hs}from"./globe-BMGZmoaJ.js";import{I as Ks}from"./info-By5wLOUH.js";import{D as $s}from"./database-Bjtecw5f.js";import{S as qs}from"./shield-alert-iAruRy4W.js";import{S as Qs}from"./save-CvVmWchr.js";import{S as Ys}from"./search-CwuIBBPE.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=Me("Cylinder",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=Me("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=Me("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),et=[{name:"External Hacker",motivation:"Financial gain, Data theft",capability:"High"},{name:"Insider Threat",motivation:"Revenge, Financial gain",capability:"Medium-High"},{name:"Nation State",motivation:"Espionage, Disruption",capability:"Very High"},{name:"Competitor",motivation:"Competitive advantage",capability:"Medium"},{name:"Script Kiddie",motivation:"Notoriety",capability:"Low"}];function st({onComplete:H,initialData:c,components:T}){const[Ne,g]=x.useState(1),[b,K]=x.useState(1),[t,m]=x.useState({businessObjectives:(c==null?void 0:c.businessObjectives)||[],securityObjectives:(c==null?void 0:c.securityObjectives)||[],complianceRequirements:(c==null?void 0:c.complianceRequirements)||[],technicalScope:(c==null?void 0:c.technicalScope)||{applications:[],infrastructureComponents:[],dataAssets:[],externalDependencies:[]},decomposition:(c==null?void 0:c.decomposition)||{dataFlows:[],trustBoundaries:[],entryExitPoints:[]},threatAnalysis:(c==null?void 0:c.threatAnalysis)||{threatActors:[],threatScenarios:[]},vulnerabilities:(c==null?void 0:c.vulnerabilities)||[],attackTrees:(c==null?void 0:c.attackTrees)||[],riskAnalysis:(c==null?void 0:c.riskAnalysis)||[]}),[R,$]=x.useState(""),[W,S]=x.useState(""),[q,I]=x.useState(""),[U,f]=x.useState(""),[w,oe]=x.useState(""),[Q,ce]=x.useState(""),[G,je]=x.useState(""),[z,ie]=x.useState(""),[Y,de]=x.useState(""),[ne,X]=x.useState(""),_=[{id:1,title:"Business Objectives",icon:Xe,description:"Define business and security goals"},{id:2,title:"Technical Scope",icon:Ts,description:"Identify technical boundaries"},{id:3,title:"Decomposition",icon:zs,description:"Analyze application structure"},{id:4,title:"Threat Analysis",icon:ps,description:"Identify threat actors & scenarios"},{id:5,title:"Vulnerabilities",icon:xs,description:"Analyze weaknesses"},{id:6,title:"Attack Modeling",icon:Rs,description:"Model attack paths"},{id:7,title:"Risk & Impact",icon:Os,description:"Assess and prioritize risks"}],O=u=>{switch(u){case 1:return t.businessObjectives.length>0&&t.securityObjectives.length>0;case 2:return t.technicalScope.applications.length>0;case 3:return t.decomposition.trustBoundaries.length>0||t.decomposition.entryExitPoints.length>0;case 4:return t.threatAnalysis.threatActors.length>0;case 5:return t.vulnerabilities.length>0;case 6:return t.attackTrees.length>0;case 7:return t.riskAnalysis.length>0;default:return!1}},me=()=>{R.trim()&&(m({...t,businessObjectives:[...t.businessObjectives,R.trim()]}),$(""))},l=()=>{W.trim()&&(m({...t,securityObjectives:[...t.securityObjectives,W.trim()]}),S(""))},J=()=>{q.trim()&&(m({...t,complianceRequirements:[...t.complianceRequirements,q.trim()]}),I(""))},he=u=>{m({...t,threatAnalysis:{...t.threatAnalysis,threatActors:[...t.threatAnalysis.threatActors,u]}})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"PASTA Progress"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.filter(u=>O(u.id)).length," / ",_.length," Complete"]})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-600 transition-all duration-500",style:{width:`${_.filter(u=>O(u.id)).length/_.length*100}%`}})})]}),_.map(u=>{const we=u.icon,pe=O(u.id),xe=b===u.id;return e.jsxs(ee,{className:D("border-2 transition-all",pe?"border-green-200 bg-green-50/30":"border-gray-200"),children:[e.jsx(se,{className:"cursor-pointer hover:bg-gray-50/50 transition-colors",onClick:()=>K(xe?null:u.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:D("p-2 rounded-lg",pe?"bg-green-100 text-green-600":"bg-blue-100 text-blue-600"),children:pe?e.jsx(ve,{className:"w-5 h-5"}):e.jsx(we,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs(te,{className:"text-base",children:["Stage ",u.id,": ",u.title]}),e.jsx(ae,{className:"text-xs",children:u.description})]})]}),xe?e.jsx(ke,{className:"w-5 h-5"}):e.jsx(_e,{className:"w-5 h-5"})]})}),xe&&e.jsxs(be,{className:"pt-0",children:[u.id===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Business Objectives"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Ensure 99.9% uptime for customer portal",value:R,onChange:a=>$(a.target.value),onKeyPress:a=>a.key==="Enter"&&me()}),e.jsx(p,{onClick:me,size:"sm",children:"Add"})]}),e.jsx("div",{className:"space-y-1",children:t.businessObjectives.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded text-sm",children:[e.jsx("span",{children:a}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,businessObjectives:t.businessObjectives.filter((E,j)=>j!==h)}),children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Security Objectives"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Protect customer PII from unauthorized access",value:W,onChange:a=>S(a.target.value),onKeyPress:a=>a.key==="Enter"&&l()}),e.jsx(p,{onClick:l,size:"sm",children:"Add"})]}),e.jsx("div",{className:"space-y-1",children:t.securityObjectives.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded text-sm",children:[e.jsx("span",{children:a}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,securityObjectives:t.securityObjectives.filter((E,j)=>j!==h)}),children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Compliance Requirements"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., GDPR Article 32 - Security of Processing",value:q,onChange:a=>I(a.target.value),onKeyPress:a=>a.key==="Enter"&&J()}),e.jsx(p,{onClick:J,size:"sm",children:"Add"})]}),e.jsx("div",{className:"space-y-1",children:t.complianceRequirements.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded text-sm",children:[e.jsx("span",{children:a}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,complianceRequirements:t.complianceRequirements.filter((E,j)=>j!==h)}),children:"×"})]},h))})]})]}),u.id===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Applications in Scope"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Customer Portal Web App",value:U,onChange:a=>f(a.target.value),onKeyPress:a=>{a.key==="Enter"&&U.trim()&&(m({...t,technicalScope:{...t.technicalScope,applications:[...t.technicalScope.applications,U.trim()]}}),f(""))}}),e.jsx(p,{onClick:()=>{U.trim()&&(m({...t,technicalScope:{...t.technicalScope,applications:[...t.technicalScope.applications,U.trim()]}}),f(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.technicalScope.applications.map((a,h)=>e.jsxs(P,{variant:"secondary",className:"gap-1",children:[a,e.jsx("button",{onClick:()=>{m({...t,technicalScope:{...t.technicalScope,applications:t.technicalScope.applications.filter((E,j)=>j!==h)}})},children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Infrastructure Components"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., AWS EC2, PostgreSQL Database",value:w,onChange:a=>oe(a.target.value),onKeyPress:a=>{a.key==="Enter"&&w.trim()&&(m({...t,technicalScope:{...t.technicalScope,infrastructureComponents:[...t.technicalScope.infrastructureComponents,w.trim()]}}),oe(""))}}),e.jsx(p,{onClick:()=>{w.trim()&&(m({...t,technicalScope:{...t.technicalScope,infrastructureComponents:[...t.technicalScope.infrastructureComponents,w.trim()]}}),oe(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.technicalScope.infrastructureComponents.map((a,h)=>e.jsxs(P,{variant:"secondary",className:"gap-1",children:[a,e.jsx("button",{onClick:()=>{m({...t,technicalScope:{...t.technicalScope,infrastructureComponents:t.technicalScope.infrastructureComponents.filter((E,j)=>j!==h)}})},children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Critical Data Assets"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Customer PII, Payment Card Data",value:Q,onChange:a=>ce(a.target.value),onKeyPress:a=>{a.key==="Enter"&&Q.trim()&&(m({...t,technicalScope:{...t.technicalScope,dataAssets:[...t.technicalScope.dataAssets,Q.trim()]}}),ce(""))}}),e.jsx(p,{onClick:()=>{Q.trim()&&(m({...t,technicalScope:{...t.technicalScope,dataAssets:[...t.technicalScope.dataAssets,Q.trim()]}}),ce(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.technicalScope.dataAssets.map((a,h)=>e.jsxs(P,{variant:"secondary",className:"gap-1 bg-yellow-100 text-yellow-800 border-yellow-300",children:[a,e.jsx("button",{onClick:()=>{m({...t,technicalScope:{...t.technicalScope,dataAssets:t.technicalScope.dataAssets.filter((E,j)=>j!==h)}})},children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"External Dependencies"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Stripe Payment API, SendGrid Email",value:G,onChange:a=>je(a.target.value),onKeyPress:a=>{a.key==="Enter"&&G.trim()&&(m({...t,technicalScope:{...t.technicalScope,externalDependencies:[...t.technicalScope.externalDependencies,G.trim()]}}),je(""))}}),e.jsx(p,{onClick:()=>{G.trim()&&(m({...t,technicalScope:{...t.technicalScope,externalDependencies:[...t.technicalScope.externalDependencies,G.trim()]}}),je(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.technicalScope.externalDependencies.map((a,h)=>e.jsxs(P,{variant:"secondary",className:"gap-1 bg-purple-100 text-purple-800 border-purple-300",children:[a,e.jsx("button",{onClick:()=>{m({...t,technicalScope:{...t.technicalScope,externalDependencies:t.technicalScope.externalDependencies.filter((E,j)=>j!==h)}})},children:"×"})]},h))})]})]}),u.id===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Note:"})," Data flows are automatically captured from your architecture diagram in the previous step.",T&&T.length>0&&` You have ${T.length} components defined.`]})}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Trust Boundaries"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., Internet/DMZ, DMZ/Internal Network",value:z,onChange:a=>ie(a.target.value),onKeyPress:a=>{a.key==="Enter"&&z.trim()&&(m({...t,decomposition:{...t.decomposition,trustBoundaries:[...t.decomposition.trustBoundaries,z.trim()]}}),ie(""))}}),e.jsx(p,{onClick:()=>{z.trim()&&(m({...t,decomposition:{...t.decomposition,trustBoundaries:[...t.decomposition.trustBoundaries,z.trim()]}}),ie(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"space-y-1",children:t.decomposition.trustBoundaries.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-orange-50 rounded text-sm",children:[e.jsx("span",{children:a}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,decomposition:{...t.decomposition,trustBoundaries:t.decomposition.trustBoundaries.filter((E,j)=>j!==h)}}),children:"×"})]},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Entry/Exit Points"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., HTTPS Endpoint /api/login, SSH Port 22",value:Y,onChange:a=>de(a.target.value),onKeyPress:a=>{a.key==="Enter"&&Y.trim()&&(m({...t,decomposition:{...t.decomposition,entryExitPoints:[...t.decomposition.entryExitPoints,Y.trim()]}}),de(""))}}),e.jsx(p,{onClick:()=>{Y.trim()&&(m({...t,decomposition:{...t.decomposition,entryExitPoints:[...t.decomposition.entryExitPoints,Y.trim()]}}),de(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.decomposition.entryExitPoints.map((a,h)=>e.jsxs(P,{variant:"secondary",className:"gap-1",children:[a,e.jsx("button",{onClick:()=>{m({...t,decomposition:{...t.decomposition,entryExitPoints:t.decomposition.entryExitPoints.filter((E,j)=>j!==h)}})},children:"×"})]},h))})]})]}),u.id===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-3 block",children:"Threat Actors"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-4",children:et.map((a,h)=>e.jsxs("button",{onClick:()=>he(a),className:"p-3 border-2 border-dashed rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-all text-left",children:[e.jsx("div",{className:"font-semibold text-sm",children:a.name}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:a.motivation}),e.jsxs(P,{variant:"outline",className:"mt-2 text-xs",children:[a.capability," Capability"]})]},h))}),e.jsx("div",{className:"space-y-2",children:t.threatAnalysis.threatActors.map((a,h)=>e.jsx("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Motivation: ",a.motivation]}),e.jsxs(P,{variant:"outline",className:"mt-2 text-xs bg-white",children:[a.capability," Capability"]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,threatAnalysis:{...t.threatAnalysis,threatActors:t.threatAnalysis.threatActors.filter((E,j)=>j!==h)}}),children:"×"})]})},h))})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-semibold mb-2 block",children:"Threat Scenarios"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{placeholder:"e.g., External attacker exploits SQL injection to access customer database",value:ne,onChange:a=>X(a.target.value),onKeyPress:a=>{a.key==="Enter"&&ne.trim()&&(m({...t,threatAnalysis:{...t.threatAnalysis,threatScenarios:[...t.threatAnalysis.threatScenarios,ne.trim()]}}),X(""))}}),e.jsx(p,{onClick:()=>{ne.trim()&&(m({...t,threatAnalysis:{...t.threatAnalysis,threatScenarios:[...t.threatAnalysis.threatScenarios,ne.trim()]}}),X(""))},size:"sm",children:"Add"})]}),e.jsx("div",{className:"space-y-1",children:t.threatAnalysis.threatScenarios.map((a,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-amber-50 rounded text-sm",children:[e.jsx("span",{children:a}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m({...t,threatAnalysis:{...t.threatAnalysis,threatScenarios:t.threatAnalysis.threatScenarios.filter((E,j)=>j!==h)}}),children:"×"})]},h))})]})]}),u.id>=5&&e.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-dashed border-blue-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx(us,{className:"w-12 h-12 mx-auto text-blue-500 mb-3"}),e.jsxs("h3",{className:"font-semibold text-lg mb-2",children:["Stage ",u.id,": ",u.title]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This stage is integrated with the existing threat analysis workflow. Continue to the Analysis step to proceed."})]})})]})]},u.id)}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(p,{variant:"outline",onClick:()=>{},children:"Save Progress"}),e.jsxs(p,{onClick:()=>H(t),className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",disabled:!O(1)||!O(2),children:["Continue to Threat Analysis",e.jsx(_e,{className:"ml-2 h-4 w-4"})]})]})]})}const Ze={General:["Process","Store","Actor"],Clients:["Web Client","Mobile Client","Desktop Client","IoT Device"],Compute:["API","Microservice","Serverless Function","Container","Virtual Machine"],Data:["Database","Data Warehouse","Object Storage","Cache","Message Queue","File Storage","Vector DB"],Network:["Load Balancer","API Gateway","Firewall/WAF","CDN","VPN"],Security:["Identity Provider","Key Management","HSM"],AI:["LLM Model","Training Pipeline","AI Agent"],"Third Party":["External Service","SaaS Provider","Legacy System"]};Object.values(Ze).flat();const tt=({currentStep:H})=>{const c=[{id:1,title:"Architecture",subtitle:"What are we building?",icon:Ae},{id:2,title:"Analysis",subtitle:"What can go wrong?",icon:Ys},{id:3,title:"Mitigation",subtitle:"What will we do?",icon:Pe},{id:4,title:"Verification",subtitle:"Did we do enough?",icon:Je}];return e.jsx("div",{className:"w-full py-8 px-4 bg-white/50 backdrop-blur-sm rounded-xl border border-blue-100 mb-8 shadow-sm",children:e.jsxs("div",{className:"relative flex justify-between max-w-4xl mx-auto",children:[e.jsx("div",{className:"absolute top-1/2 left-0 w-full h-1 bg-slate-100 -translate-y-1/2 z-0 rounded-full"}),e.jsx("div",{className:"absolute top-1/2 left-0 h-1 bg-gradient-to-r from-blue-500 to-indigo-600 -translate-y-1/2 z-0 transition-all duration-700 ease-in-out rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:{width:`${(H-1)/(c.length-1)*100}%`}}),c.map((T,Ne)=>{const g=T.icon,b=H===T.id,K=H>T.id;return e.jsxs("div",{className:"relative z-10 flex flex-col items-center group",children:[e.jsx("div",{className:D("h-14 w-14 rounded-2xl flex items-center justify-center border-2 transition-all duration-500 rotate-45 group-hover:rotate-0",b?"bg-blue-600 border-blue-600 text-white shadow-xl scale-110":K?"bg-white border-blue-500 text-blue-500 shadow-md":"bg-white border-slate-200 text-slate-400 group-hover:border-blue-200"),children:e.jsx("div",{className:"-rotate-45 group-hover:rotate-0 transition-all duration-500",children:K?e.jsx(ve,{className:"h-7 w-7"}):e.jsx(g,{className:"h-7 w-7"})})}),e.jsxs("div",{className:"mt-5 text-center",children:[e.jsx("p",{className:D("text-xs font-black uppercase tracking-widest",b?"text-blue-600":"text-slate-500"),children:T.title}),e.jsx("p",{className:"text-[10px] text-slate-400 font-medium max-w-[100px] leading-tight mt-1",children:T.subtitle})]})]},T.id)})]})})};function sa(){var Fe,Be,Le,We,Ue,Ge;const{selectedClientId:H}=gs(),c=bs(),[T,Ne]=js(),g=c.clientId?parseInt(c.clientId):H,b=parseInt((c==null?void 0:c.projectId)||"0"),K=c==null?void 0:c.modelId,t=K==="new",[m,R]=x.useState(1),[$,W]=x.useState(1),[S,q]=x.useState({name:"",methodology:"STRIDE"}),[I,U]=x.useState(t?null:parseInt(K)),[f,w]=x.useState([]),[oe,Q]=x.useState(null),[ce,G]=x.useState(!1),z=new URLSearchParams(window.location.search).get("source")==="general",{data:ie,error:Y,isFetched:de}=k.devProjects.get.useQuery({id:b,clientId:g},{enabled:!!b&&!!g&&!z,retry:!1}),X=!!b&&!!g&&(z||!!Y||de&&!ie),{data:_}=k.projects.get.useQuery({id:b,clientId:g},{enabled:X}),O=z||X?_:ie,me=z||!!_,{data:l,refetch:J}=k.threatModels.get.useQuery({id:I,clientId:g},{enabled:!!I&&!!g}),he=k.useUtils(),u=k.threatModels.create.useMutation(),we=k.threatModels.addComponent.useMutation();k.threatModels.removeComponent.useMutation();const pe=k.threatModels.generateRisks.useMutation(),xe=k.threatModels.updateComponentPosition.useMutation(),a=k.threatModels.saveFlow.useMutation(),h=k.threatModels.updateFlow.useMutation();k.threatModels.removeFlow.useMutation();const E=k.threatModels.commitRisks.useMutation(),j=k.advisor.generateRiskMitigationPlan.useMutation(),[F,re]=x.useState(null),[M,Z]=x.useState(null),[B,Ie]=x.useState(null),[Ee,es]=x.useState({x:0,y:0}),[V,De]=x.useState({x:0,y:0}),ue=fe.useRef(null),ss=async()=>{if(M)try{await h.mutateAsync({id:M.id,protocol:M.protocol,description:M.description,isEncrypted:M.isEncrypted}),Z(null),J(),N.success("Flow updated")}catch{N.error("Failed to update flow")}};fe.useEffect(()=>{l&&(q({name:l.name,methodology:l.methodology}),l.risks&&l.risks.length>0&&f.length===0&&w(l.risks.map(s=>({...s,selected:!0,expanded:!1,planExpanded:!1,likelihood:s.likelihood||3,impact:s.impact||3,selectedMitigations:s.mitigations||[]}))),$===1&&W(2))},[l,f.length,$]);const ts=async()=>{if(!(!g||!b))try{const s=await u.mutateAsync({clientId:g,devProjectId:me?void 0:b,projectId:me?b:void 0,name:S.name,methodology:S.methodology});U(s.id),S.methodology==="PASTA"||S.methodology==="COMBINED"?G(!0):W(2),N.success("Threat Model Created")}catch{N.error("Failed to create threat model")}},[L,Se]=x.useState({name:"",type:"",description:""}),as=async()=>{var s;if(!(!I||!L.name||!L.type))try{const i=(s=ue.current)==null?void 0:s.getBoundingClientRect(),r=i?i.width/2-80:0,d=i?i.height/2-20:0;await we.mutateAsync({threatModelId:I,...L,x:r,y:d}),Se({name:"",type:"",description:""}),J()}catch(i){N.error(i.message)}},is=s=>{if(B!==null&&ue.current){const i=ue.current.getBoundingClientRect(),r=s.clientX-i.left-Ee.x,d=s.clientY-i.top-Ee.y;De({x:r,y:d})}},Te=async()=>{if(B!==null){const s=B;Ie(null),await ns(s,V.x,V.y)}},ns=async(s,i,r)=>{try{await xe.mutateAsync({id:s,x:i,y:r}),J()}catch{N.error("Failed to update component position")}},rs=async s=>{if(!F||F===s){re(null);return}try{await a.mutateAsync({threatModelId:I,sourceComponentId:F,targetComponentId:s,isEncrypted:!1}),N.success("Flow created!"),re(null),J()}catch{N.error("Failed to create flow")}},ls=async()=>{if(I)try{const s=await pe.mutateAsync({threatModelId:I});w(s.map(i=>{var r;return{...i,selected:!0,expanded:!1,planExpanded:!1,likelihood:3,impact:3,selectedMitigations:((r=i.mitigations)==null?void 0:r.slice(0,1))||[]}})),R(2)}catch(s){N.error("Analysis failed",{description:s.message})}},os=k.threatModels.importFromThreatDragon.useMutation(),ze=fe.useRef(null),cs=async()=>{try{if(!l)return;const s=[];l.components.forEach(o=>{s.push({id:String(o.id),shape:o.type==="Actor"?"actor":o.type==="Store"?"store":"process",data:{name:o.name,type:o.type,description:o.description},position:{x:o.x,y:o.y},size:{width:160,height:80},zIndex:10})}),l.flows.forEach(o=>{s.push({id:String(o.id),shape:"flow",source:{cell:String(o.sourceComponentId)},target:{cell:String(o.targetComponentId)},data:{name:o.protocol||"Flow",protocol:o.protocol,isEncrypted:o.isEncrypted},zIndex:20})});const i=JSON.stringify({summary:{title:l.name,owner:"ComplianceOS",description:"Exported from ComplianceOS"},detail:{diagrams:[{title:"Main",cells:s}]}},null,2),r=new Blob([i],{type:"application/json"}),d=URL.createObjectURL(r),n=document.createElement("a");n.href=d,n.download=`${l.name.replace(/\s+/g,"_")}_threat_dragon.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),N.success("Model exported")}catch{N.error("Export failed")}},ds=()=>{var s;(s=ze.current)==null||s.click()},ms=async s=>{var d;const i=(d=s.target.files)==null?void 0:d[0];if(!i)return;const r=new FileReader;r.onload=async n=>{var v;const o=(v=n.target)==null?void 0:v.result;if(o&&g&&b)try{const C=await os.mutateAsync({clientId:g,devProjectId:b,json:o});U(C.id),W(2),N.success("Model imported successfully")}catch{N.error("Failed to import model",{description:"Invalid Threat Dragon JSON"})}},r.readAsText(i)},[Re,Oe]=x.useState(!1),hs=async()=>{if(!I||!g||!b)return;Oe(!0);const s=Date.now(),i=f.filter(r=>r.selected);try{await E.mutateAsync({clientId:g,devProjectId:b,threatModelId:I,risks:i.map(n=>{var o,v,C,ye;return{title:n.title,description:n.description,likelihood:n.likelihood,impact:n.impact,privacyImpact:((o=n.source)==null?void 0:o.includes("Privacy"))||((v=n.source)==null?void 0:v.includes("LINDDUN"))||n.category==="Privacy"||((C=l==null?void 0:l.methodology)==null?void 0:C.includes("LINDDUN"))||((ye=S.methodology)==null?void 0:ye.includes("LINDDUN"))||!!n.privacyImpact,category:n.category,selectedMitigations:n.selectedMitigations||[],customMitigationPlan:n.customMitigationPlan}})});const r=Date.now()-s;r<1e3&&await new Promise(n=>setTimeout(n,1e3-r)),await Promise.all([he.projects.getProjectSecurityPosture.invalidate({projectId:b,clientId:g}),he.risks.list.invalidate({projectId:b,clientId:g}),he.threatModels.list.invalidate({projectId:b,clientId:g})]),N.success("Success",{description:"Risks committed to register."});const d=z||X?`/clients/${g}/projects/${b}`:`/clients/${g}/dev/projects/${b}`;Ne(d)}catch(r){console.error(r),N.error("Failed to commit risks"),Oe(!1)}};return!O&&b?e.jsx("div",{className:"p-8",children:"Loading..."}):e.jsx(Es,{children:e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx(Ds,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Developer Projects",href:`/clients/${g}/dev/projects`},{label:(O==null?void 0:O.name)||"Project",href:`/clients/${g}/dev/projects/${b}`},{label:`${S.methodology||"STRIDE"} Framework`}]}),e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(Bs,{title:"Threat Modeling Wizard",description:"Identify architectural flaws and security risks.",rationale:"Systematic analysis of your design prevents costly security fixes later.",howToUse:[{step:"Architecture",description:"Design your system using the drag-and-drop canvas."},{step:"Analysis",description:"Automatically generate threats based on the design."},{step:"Mitigation",description:"Select controls to reduce risk."}]})}),e.jsx(tt,{currentStep:m}),e.jsxs("div",{className:D("mx-auto pb-20 transition-all duration-500 ease-in-out",m===1&&$===2?"max-w-[1800px] px-4":"max-w-4xl"),children:[m===1&&e.jsx("div",{className:"space-y-6",children:$===1?e.jsxs(ee,{className:"border-blue-100 shadow-md",children:[e.jsxs(se,{className:"bg-blue-50/30",children:[e.jsx(te,{className:"text-xl",children:"1. Architecture Definition"}),e.jsx(ae,{children:"What are we building? Define the scope of this threat model."})]}),e.jsxs(be,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Threat Model Name"}),e.jsx(A,{value:S.name,onChange:s=>q({...S,name:s.target.value}),placeholder:"e.g. Core API Authentication Flow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Methodology"}),e.jsxs(Ve,{value:S.methodology,onValueChange:s=>q({...S,methodology:s}),children:[e.jsx(He,{children:e.jsx(Ke,{placeholder:"Select Methodology"})}),e.jsxs($e,{children:[e.jsx(le,{value:"STRIDE",children:"STRIDE (Microsoft)"}),e.jsx(le,{value:"PASTA",children:"PASTA (Risk-Centric)"}),e.jsx(le,{value:"LINDDUN",children:"LINDDUN (Privacy)"}),e.jsx(le,{value:"STRIDE+LINDDUN",children:"STRIDE + LINDDUN (Sec + Priv)"}),e.jsx(le,{value:"COMBINED",children:"Combined (Security + Privacy + Business)"})]})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs(p,{onClick:ts,disabled:!S.name,className:"bg-blue-600 hover:bg-blue-700",children:["Next: Component Decomposition ",e.jsx(Ce,{className:"ml-2 h-4 w-4"})]})})]})]}):ce?e.jsxs("div",{children:[e.jsx(ee,{className:"border-blue-100 shadow-md mb-4",children:e.jsxs(se,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs(te,{className:"text-xl flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-600"}),"PASTA Methodology - 7 Stage Risk-Centric Analysis"]}),e.jsx(ae,{children:"Complete the following stages to perform a comprehensive risk-focused threat analysis"})]})}),e.jsx(st,{onComplete:s=>{Q(s),G(!1),W(2),N.success("PASTA analysis complete! Proceeding to architecture decomposition.")},initialData:oe||void 0,components:(l==null?void 0:l.components)||[]})]}):e.jsxs(ee,{className:"border-blue-100 shadow-md h-full flex flex-col",children:[e.jsx(ys,{open:!!M,onOpenChange:()=>Z(null),children:e.jsxs(fs,{children:[e.jsxs(vs,{children:[e.jsx(Ns,{children:"Edit Flow"}),e.jsx(ws,{children:"Modify the properties of this data flow."})]}),M&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"protocol",className:"text-right",children:"Protocol"}),e.jsx(A,{id:"protocol",value:M.protocol||"",onChange:s=>Z({...M,protocol:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(A,{id:"description",value:M.description||"",onChange:s=>Z({...M,description:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"isEncrypted",className:"text-right",children:"Encrypted"}),e.jsx(qe,{id:"isEncrypted",checked:M.isEncrypted,onCheckedChange:s=>Z({...M,isEncrypted:!!s}),className:"col-span-3"})]})]}),e.jsxs(Ss,{children:[e.jsx(p,{variant:"outline",onClick:()=>Z(null),children:"Cancel"}),e.jsx(p,{onClick:ss,children:"Save changes"})]})]})}),e.jsx(se,{className:"bg-blue-50/30 shrink-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(te,{className:"text-xl",children:"System Architecture Canvas"}),e.jsx(ae,{children:"Drag components to arrange. Hover over a component and click blue connection points to define data flows."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",ref:ze,className:"hidden",accept:".json",onChange:ms}),e.jsxs(p,{size:"sm",variant:"outline",className:"gap-2",onClick:ds,children:[e.jsx(Ls,{size:14})," Import"]}),e.jsxs(p,{size:"sm",variant:"outline",className:"gap-2",onClick:cs,children:[e.jsx(Ws,{size:14})," Export"]}),e.jsx("div",{className:"h-6 w-px bg-slate-200 mx-2"}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 p-1 rounded-lg border",children:[e.jsx(A,{value:L.name,onChange:s=>Se({...L,name:s.target.value}),placeholder:"Name",className:"h-8 w-32 border-none bg-transparent"}),e.jsxs(Ve,{value:L.type,onValueChange:s=>Se({...L,type:s}),children:[e.jsx(He,{className:"h-8 w-38 border-none bg-white shadow-sm",children:e.jsx(Ke,{placeholder:"Type"})}),e.jsx($e,{className:"max-h-[300px]",children:Object.entries(Ze).map(([s,i])=>e.jsxs(fe.Fragment,{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-slate-500 bg-slate-50",children:s}),i.map(r=>e.jsx(le,{value:r,children:r},r))]},s))})]}),e.jsx(p,{size:"sm",onClick:as,disabled:!L.name||!L.type,children:e.jsx(Us,{className:"h-4 w-4"})})]})]})]})}),e.jsxs("div",{className:"relative flex-1 bg-slate-50 overflow-hidden min-h-[750px] border-y inner-shadow",ref:ue,onMouseMove:is,onMouseUp:Te,onMouseLeave:Te,children:[e.jsx("div",{className:"absolute inset-0 z-0 opacity-10 pointer-events-none",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsxs("svg",{className:"absolute inset-0 w-full h-full z-0 pointer-events-none",children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"28",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})})}),(Fe=l==null?void 0:l.flows)==null?void 0:Fe.map(s=>{const i=l.components.find(C=>C.id===s.sourceComponentId),r=l.components.find(C=>C.id===s.targetComponentId);if(!i||!r)return null;const d=(B===i.id?V.x:i.x||0)+80,n=(B===i.id?V.y:i.y||0)+40,o=(B===r.id?V.x:r.x||0)+80,v=(B===r.id?V.y:r.y||0)+40;return e.jsxs("g",{onClick:C=>{C.stopPropagation(),Z(s)},className:"cursor-pointer pointer-events-auto group",children:[e.jsx("line",{x1:d,y1:n,x2:o,y2:v,stroke:s.isEncrypted?"#3b82f6":"#ef4444",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"transition-all group-hover:stroke-[4px]"}),e.jsx("circle",{cx:(d+o)/2,cy:(n+v)/2,r:"12",fill:"white",stroke:"#e2e8f0"}),e.jsx("text",{x:(d+o)/2,y:(n+v)/2,textAnchor:"middle",dy:"4",fontSize:"10",fill:"#64748b",children:s.isEncrypted?e.jsx(Gs,{size:10}):e.jsx(Zs,{size:10})})]},s.id)}),F&&e.jsx("rect",{width:"100%",height:"100%",fill:"rgba(59, 130, 246, 0.05)"})]}),(Be=l==null?void 0:l.components)==null?void 0:Be.map(s=>e.jsxs("div",{style:{left:B===s.id?V.x:s.x||0,top:B===s.id?V.y:s.y||0},className:D("absolute w-40 p-3 rounded-xl border shadow-sm bg-white cursor-move transition-shadow z-10 select-none group",F===s.id?"ring-2 ring-blue-500 shadow-lg scale-105":"hover:shadow-md",B===s.id?"z-50 shadow-xl ring-2 ring-blue-500/50":"",F&&F!==s.id?"hover:ring-2 hover:ring-green-400 cursor-copy":""),onMouseDown:i=>{var r;if(i.stopPropagation(),F)F!==s.id&&rs(s.id);else{const d=(r=ue.current)==null?void 0:r.getBoundingClientRect();d&&(es({x:i.clientX-d.left-(s.x||0),y:i.clientY-d.top-(s.y||0)}),Ie(s.id),De({x:s.x||0,y:s.y||0}))}},children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-2",children:[e.jsx("div",{className:D("p-2 rounded-lg mb-2",["Actor","Web Client","Mobile Client","Desktop Client","IoT Device"].includes(s.type)?"bg-amber-100/50 text-amber-600":["Store","Database","File Storage","Data Warehouse","Object Storage","Vector DB"].includes(s.type)?"bg-indigo-100/50 text-indigo-600":["Identity Provider","Key Management","HSM","Firewall/WAF"].includes(s.type)?"bg-red-100/50 text-red-600":["LLM Model","AI Agent","Training Pipeline"].includes(s.type)?"bg-purple-100/50 text-purple-600":"bg-blue-100/50 text-blue-600"),children:["Actor","Web Client","Mobile Client","Desktop Client"].includes(s.type)?e.jsx(_s,{size:24}):["IoT Device","Sensor"].includes(s.type)?e.jsx(Ye,{size:24}):["Store","Database","File Storage","Data Warehouse","Object Storage","Vector DB"].includes(s.type)?e.jsx(Xs,{size:24}):["Queue/Broker","Message Queue","Cache"].includes(s.type)?e.jsx(Layers,{size:24}):["Serverless Function"].includes(s.type)?e.jsx(Ye,{size:24}):["Container","Microservice"].includes(s.type)?e.jsx(Ae,{size:24}):["Load Balancer","API Gateway","CDN","VPN"].includes(s.type)?e.jsx(Vs,{size:24}):["Firewall/WAF","Identity Provider","Key Management","HSM"].includes(s.type)?e.jsx(Pe,{size:24}):["LLM Model","AI Agent"].includes(s.type)?e.jsx(ge,{size:24}):["External Service","SaaS Provider"].includes(s.type)?e.jsx(Hs,{size:24}):e.jsx(Ae,{size:24})}),e.jsx("div",{className:"font-bold text-xs text-center truncate w-full",children:s.name}),e.jsx("div",{className:"text-[9px] text-slate-400 uppercase tracking-wider truncate w-full text-center",children:s.type})]}),!F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-crosshair",onClick:i=>{i.stopPropagation(),re(s.id)}}),e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-crosshair",onClick:i=>{i.stopPropagation(),re(s.id)}}),e.jsx("div",{className:"absolute top-1/2 -left-1 -translate-y-1/2 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-crosshair",onClick:i=>{i.stopPropagation(),re(s.id)}}),e.jsx("div",{className:"absolute top-1/2 -right-1 -translate-y-1/2 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-crosshair",onClick:i=>{i.stopPropagation(),re(s.id)}})]})]},s.id))]}),e.jsxs(Cs,{className:"pt-4 border-t bg-slate-50 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:[((Le=l==null?void 0:l.components)==null?void 0:Le.length)||0," Components • ",((We=l==null?void 0:l.flows)==null?void 0:We.length)||0," Flows"]}),e.jsxs(p,{onClick:ls,disabled:!((Ue=l==null?void 0:l.components)!=null&&Ue.length),className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-md shadow-indigo-100",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Analyze ",S.methodology||"Architecture"]})]})]})}),m===2&&e.jsxs(ee,{className:"border-blue-100 shadow-md",children:[e.jsxs(se,{className:"bg-blue-50/30",children:[e.jsx(te,{className:"text-xl",children:"2. Threat Analysis"}),e.jsx(ae,{children:"What can go wrong? Analysis identifies potential threats within trust boundaries."})]}),e.jsxs(be,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-4",children:f.map((s,i)=>{var r,d;return e.jsx("div",{className:D("p-4 border rounded-xl transition-all",s.selected?"border-blue-200 bg-blue-50/20 ring-1 ring-blue-100":"opacity-50 grayscale"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(qe,{checked:s.selected,onCheckedChange:n=>{const o=[...f];o[i].selected=!!n,w(o)},className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.source==="OWASP Intelligence Advisor"&&e.jsx(ks,{children:e.jsxs(As,{delayDuration:200,children:[e.jsx(Ps,{asChild:!0,children:e.jsxs(P,{className:"bg-amber-100 text-amber-700 border-amber-200 cursor-help",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"OWASP Intelligence"]})}),e.jsx(Ms,{side:"top",align:"start",sideOffset:8,className:"max-w-[400px] p-4 bg-amber-50 border-amber-200 text-amber-900 shadow-xl z-[100]",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"font-bold flex items-center gap-1.5 text-xs uppercase tracking-wider",children:[e.jsx(ge,{className:"w-3 h-3"}),"Advisor Intelligence Details"]}),e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap mt-2 text-amber-900/90",children:((r=s.mitigations)==null?void 0:r[0])||"Detailed security guidance from OWASP framework intelligence."})]})})]})}),((d=s.source)==null?void 0:d.includes("LINDDUN"))&&e.jsxs(P,{className:"bg-teal-100 text-teal-700 border-teal-200",children:[e.jsx(Js,{className:"w-3 h-3 mr-1"}),"LINDDUN Privacy"]}),e.jsx(P,{variant:"outline",className:"bg-white",children:s.category}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 ml-1 rounded-full hover:bg-slate-100",onClick:()=>{const n=[...f];n[i].expanded=!n[i].expanded,w(n)},children:s.expanded?e.jsx(Qe,{size:16,className:"text-slate-500"}):e.jsx(ke,{size:16,className:"text-slate-500"})})]})]}),e.jsx("p",{className:"text-sm text-slate-600 mt-2",children:s.description}),s.expanded&&e.jsxs("div",{className:"mt-3 p-4 bg-slate-50 border border-slate-200/60 rounded-xl text-sm text-slate-700 leading-relaxed animate-in slide-in-from-top-2 shadow-sm",children:[e.jsxs("div",{className:"font-bold mb-2 flex items-center gap-2 text-slate-800 text-xs uppercase tracking-wide",children:[e.jsx(Ks,{size:14,className:"text-blue-600"}),"Detailed Threat Explanation"]}),s.explanation||s.description||"No additional detailed explanation is available for this threat automatically. Use the analysis to determine specific impact."]}),s.selected&&e.jsxs("div",{className:"flex gap-6 mt-4 p-3 bg-white/50 rounded-lg border border-white/50 shadow-inner",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-slate-400",children:"Likelihood"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(n=>e.jsx("button",{onClick:()=>{const o=[...f];o[i].likelihood=n,w(o)},className:D("h-6 w-8 rounded flex items-center justify-center text-[10px] font-bold transition-all",s.likelihood===n?"bg-amber-500 text-white":"bg-slate-100 text-slate-400 hover:bg-slate-200"),children:n},n))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-slate-400",children:"Impact"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(n=>e.jsx("button",{onClick:()=>{const o=[...f];o[i].impact=n,w(o)},className:D("h-6 w-8 rounded flex items-center justify-center text-[10px] font-bold transition-all",s.impact===n?"bg-red-500 text-white":"bg-slate-100 text-slate-400 hover:bg-slate-200"),children:n},n))})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Initial Score"}),e.jsx("div",{className:"text-xl font-black text-slate-900",children:s.likelihood*s.impact})]})]})]})]})},i)})}),e.jsxs("div",{className:"pt-6 border-t flex justify-between",children:[e.jsx(p,{variant:"outline",onClick:()=>R(1),children:"Back to Architecture"}),e.jsxs(p,{onClick:()=>R(3),disabled:!f.some(s=>s.selected),children:["Next: Risk Mitigation ",e.jsx(Ce,{className:"ml-2 h-4 w-4"})]})]})]})]}),m===3&&e.jsxs(ee,{className:"border-blue-100 shadow-md",children:[e.jsx(se,{className:"bg-blue-50/30",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(te,{className:"text-xl",children:"3. Risk Mitigation"}),e.jsx(ae,{children:"What can we do about it? Select specific strategies from OWASP and ASVS."})]}),e.jsxs(P,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200 flex items-center gap-1.5 py-1 px-2.5",children:[e.jsx($s,{className:"h-3.5 w-3.5"}),"ASVS v5.0 Database Connected"]})]})}),e.jsxs(be,{className:"pt-6 space-y-6",children:[e.jsx("div",{className:"space-y-6",children:f.filter(s=>s.selected).map((s,i)=>{var r;return e.jsxs("div",{className:"p-6 border rounded-2xl bg-white shadow-sm hover:shadow-md transition-all border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(qs,{className:"h-4 w-4 text-amber-500"}),e.jsx("h4",{className:"font-extrabold text-slate-900",children:s.title})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"secondary",className:"bg-blue-50 text-blue-700 rounded-md py-0",children:s.category}),e.jsx(P,{variant:"outline",className:"text-[10px] uppercase tracking-tighter",children:s.componentName})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest",children:"Severity"}),e.jsx("div",{className:D("text-2xl font-black",s.likelihood*s.impact>=15?"text-red-500":"text-amber-500"),children:s.likelihood*s.impact})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 border border-slate-100 space-y-3",children:[e.jsxs(y,{className:"text-xs font-black text-slate-500 uppercase flex items-center gap-2",children:[e.jsx(Pe,{className:"h-3 w-3"})," Recommended Strategies"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(r=s.mitigations)==null?void 0:r.map(d=>{var o;const n=(o=s.selectedMitigations)==null?void 0:o.includes(d);return e.jsxs("button",{onClick:()=>{const v=[...f],C=v[v.indexOf(s)].selectedMitigations||[];C.includes(d)?v[v.indexOf(s)].selectedMitigations=C.filter(ye=>ye!==d):v[v.indexOf(s)].selectedMitigations=[...C,d],w(v)},className:D("px-3 py-1.5 rounded-lg text-xs font-medium border transition-all flex items-center gap-2",n?"bg-blue-600 border-blue-600 text-white shadow-md scale-105":"bg-white border-slate-200 text-slate-600 hover:border-blue-300 hover:bg-blue-50"),children:[n&&e.jsx(ve,{className:"h-3 w-3"}),d]},d)})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center bg-slate-50/50 p-2 rounded-lg border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:()=>{const d=[...f];d[i].planExpanded=!d[i].planExpanded,w(d)},children:[e.jsx("div",{className:"bg-white p-1 rounded-md border border-slate-200 group-hover:border-indigo-300 transition-colors",children:s.planExpanded?e.jsx(Qe,{className:"h-3 w-3 text-indigo-600"}):e.jsx(ke,{className:"h-3 w-3 text-slate-400"})}),e.jsx(y,{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest cursor-pointer group-hover:text-indigo-600 transition-colors",children:s.customMitigationPlan?"AI Mitigation Plan":"Generate Custom Plan"}),s.customMitigationPlan&&e.jsx(P,{variant:"outline",className:"text-[8px] h-4 bg-white text-indigo-600 border-indigo-100",children:"AI Generated"})]}),e.jsxs(p,{size:"sm",variant:"outline",className:"h-7 text-[10px] gap-1.5 border-indigo-200 bg-white text-indigo-600 hover:bg-indigo-50 hover:text-indigo-700 shadow-sm",onClick:async d=>{d.stopPropagation(),g&&N.promise(j.mutateAsync({clientId:g,riskTitle:s.title,riskDescription:s.description,riskContext:`${s.componentName} (${s.componentType})`,currentMitigations:s.selectedMitigations}),{loading:"Generating comprehensive mitigation plan...",success:n=>{const o=[...f];return o[i].customMitigationPlan=n.mitigationPlan,o[i].planExpanded=!0,w(o),"Mitigation plan generated!"},error:"Failed to generate plan"})},children:[e.jsx(ge,{className:"w-3 h-3"}),s.customMitigationPlan?"Regenerate":"Generate with AI"]})]}),s.planExpanded&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:e.jsx(Fs,{value:s.customMitigationPlan||"",onChange:d=>{const n=[...f];n[i].customMitigationPlan=d,w(n)},minHeight:"200px",className:"bg-white border-slate-200 rounded-xl shadow-inner"})})]})]})]},i)})}),e.jsxs("div",{className:"pt-6 border-t flex justify-between",children:[e.jsx(p,{variant:"outline",onClick:()=>R(2),children:"Back to Analysis"}),e.jsxs(p,{onClick:()=>R(4),className:"bg-indigo-600 hover:bg-indigo-700",children:["Next: Verification ",e.jsx(Ce,{className:"ml-2 h-4 w-4"})]})]})]})]}),m===4&&e.jsxs(ee,{className:"border-green-100 shadow-md",children:[e.jsxs(se,{className:"bg-green-50/30",children:[e.jsx(te,{className:"text-xl",children:"4. Final Verification"}),e.jsx(ae,{children:"Did we do enough? Review the summary and commit findings to the Risk Register."})]}),e.jsxs(be,{className:"pt-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl bg-blue-50 border border-blue-100 text-center",children:[e.jsx("div",{className:"text-3xl font-black text-blue-700",children:((Ge=l==null?void 0:l.components)==null?void 0:Ge.length)||0}),e.jsx("div",{className:"text-[10px] text-blue-500 uppercase font-bold tracking-widest mt-1",children:"Components"})]}),e.jsxs("div",{className:"p-4 rounded-2xl bg-amber-50 border border-amber-100 text-center",children:[e.jsx("div",{className:"text-3xl font-black text-amber-700",children:f.filter(s=>s.selected).length}),e.jsx("div",{className:"text-[10px] text-amber-500 uppercase font-bold tracking-widest mt-1",children:"Identified Risks"})]}),e.jsxs("div",{className:"p-4 rounded-2xl bg-indigo-50 border border-indigo-100 text-center",children:[e.jsx("div",{className:"text-3xl font-black text-indigo-700",children:f.filter(s=>s.selected).reduce((s,i)=>{var r;return s+(((r=i.selectedMitigations)==null?void 0:r.length)||0)},0)}),e.jsx("div",{className:"text-[10px] text-indigo-500 uppercase font-bold tracking-widest mt-1",children:"Planned Mitigations"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{className:"text-xs font-black text-slate-500 uppercase flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"})," Compliance Check"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["Architecture definition complete","STRIDE threats analyzed & prioritized","OWASP/ASVS mitigations mapped","Trust boundaries verified"].map((s,i)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-xl bg-white shadow-sm border-slate-100",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:s})]},i))})]}),e.jsxs("div",{className:"pt-8 border-t flex justify-between gap-4",children:[e.jsx(p,{variant:"outline",onClick:()=>R(3),children:"Back to Mitigation"}),e.jsx(p,{onClick:hs,disabled:Re,className:"bg-green-600 hover:bg-green-700 text-white min-w-[200px] shadow-lg shadow-green-200",children:Re?e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"mr-2 h-4 w-4 animate-spin"}),"Committing Risks..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"mr-2 h-4 w-4"}),"Finalize & Commit Risks"]})})]})]})]})]})]})})}export{sa as ThreatModelWizard};
