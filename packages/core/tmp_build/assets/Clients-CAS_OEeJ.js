import{u as R,b as $,r as m,t as u,i as n,j as e,L as g,I as b,E as G,G as H,H as U,J as Q,K as p,c as r,A,h as T,C as Y,d as V,e as W,m as _}from"./index-DOc7Nwb7.js";import{A as J,a as K,b as q,c as X,d as Z,e as ee,f as se,g as te}from"./alert-dialog-V7xGXdVc.js";import{E as ie}from"./enhanced-dialog-CeRPsI16.js";import{T as ae}from"./textarea-BtxBxzdY.js";import{D as re}from"./DashboardLayout-aHnUqq57.js";import{B as ne}from"./Breadcrumb-CRi3LAxS.js";import{u as le}from"./useBilling-BnCJ_sUa.js";import{P as oe}from"./PageGuide-CPKKXXS6.js";import{P as S}from"./plus-BaQ35Jcx.js";import{S as ce}from"./search-CwuIBBPE.js";import{F as de}from"./folder-open-G4YXLyIS.js";import{S as me}from"./settings-CIu9FFiX.js";import{T as ue}from"./trash-2-CFEfisbM.js";import{A as pe}from"./arrow-right-M96iV-v9.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function ls(){const{user:he}=R(),[,f]=$(),[o,E]=m.useState(""),[O,h]=m.useState(!1),[xe,P]=m.useState(null),[j,C]=m.useState(null),[i,c]=m.useState({name:"",description:"",industry:"",size:""}),{data:l,isLoading:k,error:y,refetch:v}=u.clients.list.useQuery();console.log("Clients page render. isLoading:",k,"clients:",l,"error:",y),y&&console.error("Failed to load clients:",y);const{upgradeAccount:F,isLoading:I}=le(),N=u.clients.create.useMutation({onSuccess:()=>{n.success("Client created successfully"),h(!1),c({name:"",description:"",industry:"",size:""}),v()},onError:s=>{n.error(s.message||"Failed to create client")}});u.clients.update.useMutation({onSuccess:()=>{n.success("Client updated successfully"),P(null),v()},onError:s=>{n.error(s.message||"Failed to update client")}});const w=u.clients.delete.useMutation({onSuccess:()=>{n.success("Client deleted successfully"),C(null),v()},onError:s=>{n.error(s.message||"Failed to delete client")}}),{data:t}=u.users.me.useQuery(),D=Array.isArray(l)?l:(l==null?void 0:l.json)||[],d=(t==null?void 0:t.maxClients)||2,z=D.filter(s=>s.role==="owner").length,a=z>=d&&(t==null?void 0:t.role)!=="admin"&&(t==null?void 0:t.role)!=="owner"&&(t==null?void 0:t.role)!=="super_admin",L=D.filter(s=>{var x;return s.name.toLowerCase().includes(o.toLowerCase())||((x=s.industry)==null?void 0:x.toLowerCase().includes(o.toLowerCase()))}),M=()=>{if(a){n.error(`You have reached your limit of ${d} organizations.`);return}N.mutate(i)},B=s=>{C(s)};return e.jsxs(re,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{items:[{label:"Clients"}]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Clients"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage your client organizations and their compliance workspaces."}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100",children:t.role==="super_admin"?"Unlimited Organizations":`${z} / ${d} used`}),e.jsx(oe,{title:"Client Management",description:"This page allows you to manage different legal entities, departments, or client organizations that you oversee within ComplianceOS.",rationale:"In a tiered compliance environment, isolation is key. Each client represents a dedicated workspace with its own policies, controls, and evidence, ensuring multi-tenant security and focused compliance management.",howToUse:[{step:"Create a Client",description:"Click 'New Client' to set up a new organization. This initializes a fresh compliance workspace with default settings."},{step:"Access Workspace",description:"Click 'Open Workspace' on any client card to enter their dedicated compliance dashboard and start managing their security posture."},{step:"Manage Team",description:"Use the 'Settings' icon to invite team members and assign roles (Owner, Admin, Editor, Viewer) specific to that client's workspace."},{step:"Policy Generation",description:"Once inside a workspace, use the Policy module to generate baseline documentation tailored to that client's specific industry and regulatory needs."}],integrations:[{name:"Global Dashboard",description:"Aggregated statistics and risk metrics across all your managed clients are visible from the main dashboard."},{name:"Evidence Repository",description:"Each client has a secure, isolated document storage for audit-ready evidence and compliance artifacts."},{name:"Automated Controls",description:"Connect external systems (Cloud, IAM, HRIS) to automatically verify and monitor controls within each client's environment."}]})]})]})]}),e.jsx(ie,{open:O,onOpenChange:h,trigger:e.jsxs(r,{className:"gap-2",disabled:a,variant:a?"outline":"default",children:[e.jsx(S,{className:"h-4 w-4"}),a?"Limit Reached":"New Client"]}),title:"Add New Client",description:a?`You have reached the limit for your current plan (${d} organizations).`:"Create a new client workspace to manage.",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(r,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),!a&&e.jsx(r,{onClick:M,disabled:N.isPending,children:N.isPending?"Creating...":"Create Client"}),a&&e.jsx(r,{className:"bg-indigo-600 hover:bg-indigo-700",onClick:()=>F("pro"),disabled:I,children:"Upgrade Plan"})]}),children:a?e.jsxs("div",{className:"py-8 text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-amber-600 rotate-45"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Subscription Limit Reached"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your current ",e.jsx("strong",{children:"Subscription (DIY)"})," plan allows for up to ",d," organizations. Upgrade to Managed or vCISO tiers for unlimited client management and AI-powered evidence triage."]})]})]}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"name",children:"Company Name"}),e.jsx(b,{id:"name",value:i.name,onChange:s=>c({...i,name:s.target.value}),placeholder:"Acme Corp"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"industry",children:"Industry"}),e.jsx(b,{id:"industry",value:i.industry,onChange:s=>c({...i,industry:s.target.value}),placeholder:"Technology, Healthcare, etc."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"size",children:"Company Size"}),e.jsxs(G,{value:i.size,onValueChange:s=>c({...i,size:s}),children:[e.jsx(H,{children:e.jsx(U,{placeholder:"Select size"})}),e.jsxs(Q,{children:[e.jsx(p,{value:"1-10",children:"1-10 employees"}),e.jsx(p,{value:"11-50",children:"11-50 employees"}),e.jsx(p,{value:"51-200",children:"51-200 employees"}),e.jsx(p,{value:"201-500",children:"201-500 employees"}),e.jsx(p,{value:"500+",children:"500+ employees"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"description",children:"Description"}),e.jsx(ae,{id:"description",value:i.description,onChange:s=>c({...i,description:s.target.value}),placeholder:"Brief description of the client..."})]})]})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ce,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(b,{type:"search",placeholder:"Search clients...",className:"pl-8",value:o,onChange:s=>E(s.target.value)})]})}),k?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(A,{className:"h-[200px] w-full"}),e.jsx(A,{className:"h-[200px] w-full"}),e.jsx(A,{className:"h-[200px] w-full"})]}):L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 custom-dashed-border rounded-lg bg-muted/10 text-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:e.jsx(T,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground max-w-sm mb-6",children:o?"No clients match your search criteria.":"Get started by adding your first client organization."}),!o&&e.jsxs(r,{onClick:()=>h(!0),variant:"outline",className:"gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Add Client"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(s=>e.jsxs(Y,{className:"card-interactive card-accent-left group cursor-pointer",onClick:()=>f(`/clients/${s.id}`),children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(W,{className:"text-xl font-bold",children:s.name}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 min-h-[40px]",children:s.description||"No description provided."}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[s.industry&&e.jsx("div",{className:"bg-secondary px-2 py-1 rounded-md",children:s.industry}),s.size&&e.jsx("div",{className:"bg-secondary px-2 py-1 rounded-md",children:s.size})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"Workspace Ready"]}),e.jsxs("div",{className:"flex gap-2",onClick:x=>x.stopPropagation(),children:[e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>f(`/clients/${s.id}/settings`),title:"Client Settings",children:e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>B(s.id),title:"Delete Client",children:e.jsx(ue,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})}),e.jsxs(r,{size:"sm",variant:"outline",className:"h-8 gap-1",onClick:()=>f(`/clients/${s.id}`),children:["Open",e.jsx(pe,{className:"h-3 w-3"})]})]})]})]})})]},s.id))})]}),e.jsx(J,{open:!!j,onOpenChange:s=>!s&&C(null),children:e.jsxs(K,{children:[e.jsxs(q,{children:[e.jsx(X,{children:"Are you absolutely sure?"}),e.jsx(Z,{children:"This action cannot be undone. This will permanently delete the client organization and all associated data."})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"Cancel"}),e.jsx(te,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{j&&w.mutate({id:j})},disabled:w.isPending,children:w.isPending?"Deleting...":"Delete Client"})]})]})})]})}export{ls as default};
