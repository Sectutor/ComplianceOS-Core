import{u as T,r as f}from"./index-DOc7Nwb7.js";function j(){const{session:c}=T(),[w,a]=f.useState({text:"",isLoading:!1,error:null,isComplete:!1}),b=f.useCallback(async e=>{var o,g,h,y,S,x;console.log("[useStreamingAI] Generate called",{hasSession:!!c,options:e}),a({text:"",isLoading:!0,error:null,isComplete:!1});try{const r={temperature:e.temperature};e.systemPrompt&&(r.systemPrompt=e.systemPrompt),e.userPrompt&&(r.userPrompt=e.userPrompt),e.clientId&&(r.clientId=e.clientId),e.templateId&&(r.templateId=e.templateId),e.tailor!==void 0&&(r.tailor=e.tailor),e.instruction&&(r.instruction=e.instruction),e.sections&&(r.sections=e.sections),e.language&&(r.language=e.language);const t=await fetch("/api/ai/generate-stream",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c==null?void 0:c.access_token}`},body:JSON.stringify(r)});if(console.log("[useStreamingAI] Response received:",{status:t.status,ok:t.ok,headers:Object.fromEntries(t.headers.entries())}),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=(o=t.body)==null?void 0:o.getReader();if(!n)throw new Error("No response body");const L=new TextDecoder;let u="",C="";for(;;){const{done:d,value:A}=await n.read();if(d)break;const E=L.decode(A,{stream:!0}),I=(C+E).split(`
`);C=I.pop()||"";for(const k of I){const i=k.trim();if(!(!i||!i.startsWith("data: ")))try{const m=i.slice(6),s=JSON.parse(m);if(s.error){a(l=>({...l,isLoading:!1,error:s.error})),(g=e.onError)==null||g.call(e,s.error);return}if(s.done){a(l=>({...l,isLoading:!1,isComplete:!0})),(h=e.onComplete)==null||h.call(e,u);return}s.text&&(u+=s.text,a(l=>({...l,text:u})),(y=e.onChunk)==null||y.call(e,s.text))}catch(m){console.warn("[AI Stream] Failed to parse line:",k,m)}}}a(d=>({...d,isLoading:!1,isComplete:!0})),(S=e.onComplete)==null||S.call(e,u)}catch(r){const t=r.message||"Streaming failed";a(n=>({...n,isLoading:!1,error:t})),(x=e.onError)==null||x.call(e,t)}},[]),P=f.useCallback(()=>{a({text:"",isLoading:!1,error:null,isComplete:!1})},[]);return{...w,generate:b,reset:P}}export{j as u};
