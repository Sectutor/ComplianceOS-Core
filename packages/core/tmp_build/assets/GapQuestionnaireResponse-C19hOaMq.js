import{ab as D,r as d,t as S,i as k,j as e,x as I,C as n,m as r,z as P,d as p,S as Y,e as j,f as N,L as f,I as _,k as E,E as H,G as B,H as G,J as F,K as m,c as J}from"./index-DOc7Nwb7.js";import{T as M}from"./textarea-BtxBxzdY.js";import{C as O}from"./clock-osbacZli.js";import{C as V}from"./circle-check-C5kiwRoG.js";import{S as z}from"./send-FW7-3cjH.js";function Z(){var b,v,y,w;const{token:c}=D(),[o,x]=d.useState({}),[R,T]=d.useState(!1),[g,Q]=d.useState(""),{data:a,isLoading:q,error:L}=S.gapQuestionnaire.getByToken.useQuery({token:c||""},{enabled:!!c}),u=S.gapQuestionnaire.submitResponses.useMutation({onSuccess:()=>{T(!0),k.success("Responses submitted successfully!")},onError:s=>k.error(s.message)});d.useEffect(()=>{if(a!=null&&a.controls){const s={};a.controls.forEach(i=>{var t;s[i.id]={status:((t=i.currentResponse)==null?void 0:t.currentStatus)||"not_implemented",notes:""}}),x(s)}},[a]);const A=()=>{if(!c)return;const s=Object.entries(o).map(([i,t])=>({controlId:parseInt(i),currentStatus:t.status,notes:t.notes||void 0}));u.mutate({token:c,responses:s,respondentName:g||void 0})};return q?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading questionnaire..."})]})}):!a||L?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsx(n,{className:"max-w-md",children:e.jsxs(r,{className:"pt-6 text-center",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Questionnaire Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"This link may be invalid or has expired."})]})})}):a.expired?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100",children:e.jsx(n,{className:"max-w-md",children:e.jsxs(r,{className:"pt-6 text-center",children:[e.jsx(O,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Questionnaire Expired"}),e.jsx("p",{className:"text-muted-foreground",children:"This questionnaire has expired. Please contact the sender for a new link."})]})})}):R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-emerald-100",children:e.jsx(n,{className:"max-w-md",children:e.jsxs(r,{className:"pt-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Thank You!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your responses have been submitted successfully. You can close this window."})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs(n,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Y,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(j,{children:"Gap Analysis Questionnaire"}),e.jsxs(N,{children:[(b=a.request)!=null&&b.recipientName?`Hello ${a.request.recipientName},`:"Hello,"," please provide your input on the following controls."]})]})]})}),((v=a.request)==null?void 0:v.message)&&e.jsx(r,{className:"pt-0",children:e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg text-sm italic",children:['"',a.request.message,'"']})})]}),e.jsxs(n,{children:[e.jsxs(p,{className:"pb-4",children:[e.jsx(j,{className:"text-base",children:"Your Detail"}),e.jsx(N,{children:"Optional: Let us know who provided these responses."})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"respondent-name",children:"Your Name / Email"}),e.jsx(_,{id:"respondent-name",placeholder:"e.g. John Doe",value:g,onChange:s=>Q(s.target.value)})]})})]}),e.jsx("div",{className:"space-y-4",children:(y=a.controls)==null?void 0:y.map((s,i)=>{var t,C;return e.jsxs(n,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary text-primary-foreground text-xs font-bold",children:i+1}),e.jsx(E,{variant:"outline",children:s.controlId})]}),e.jsx(j,{className:"text-base",children:s.name}),s.description&&e.jsx(N,{className:"mt-1 text-sm",children:s.description})]}),e.jsx(E,{className:"bg-slate-100 text-slate-700",children:s.framework})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Current Implementation Status"}),e.jsxs(H,{value:((t=o[s.id])==null?void 0:t.status)||"not_implemented",onValueChange:h=>x(l=>({...l,[s.id]:{...l[s.id],status:h}})),children:[e.jsx(B,{children:e.jsx(G,{})}),e.jsxs(F,{children:[e.jsx(m,{value:"implemented",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),"Implemented"]})}),e.jsx(m,{value:"in_progress",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"In Progress"]})}),e.jsx(m,{value:"not_implemented",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),"Not Implemented"]})}),e.jsx(m,{value:"not_applicable",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Not Applicable"]})})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Additional Notes / Evidence Description"}),e.jsx(M,{placeholder:"Describe the current implementation, evidence available, or any relevant notes...",value:((C=o[s.id])==null?void 0:C.notes)||"",onChange:h=>x(l=>({...l,[s.id]:{...l[s.id],notes:h.target.value}})),className:"min-h-[80px]"})]})]})]},s.id)})}),e.jsx(n,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((w=a.controls)==null?void 0:w.length)||0," control(s) to review"]}),e.jsxs(J,{onClick:A,disabled:u.isPending,className:"gap-2",children:[u.isPending?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(z,{className:"h-4 w-4"}),"Submit Responses"]})]})})})]})})}export{Z as default};
