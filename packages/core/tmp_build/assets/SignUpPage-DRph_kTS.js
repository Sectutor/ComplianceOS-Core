import{r as i,b as U,u as M,t as Z,j as e,C as F,d as E,h as G,e as D,f as B,m as R,L as c,I as d,ay as T,c as P,x as W,i as t,ax as x}from"./index-DOc7Nwb7.js";function H(){const[m,I]=i.useState(""),[n,A]=i.useState(""),[p,S]=i.useState(""),[u,L]=i.useState(""),[w,k]=i.useState(""),[b,h]=i.useState(!1),[,g]=U(),{user:$,signIn:q}=M(),f=Z.billing.createUserCheckout.useMutation(),z=async a=>{var v,N;if(a.preventDefault(),n!==p){t.error("Passwords don't match");return}if(u.trim().length<2){t.error("Please enter a valid organization name");return}h(!0);try{const s=new URLSearchParams(window.location.search),r=s.get("tier")||"startup",o=s.get("interval")||"month",{data:l,error:y}=await x.auth.signUp({email:m,password:n,options:{data:{full_name:w,organization_name:u,plan_tier:r,billing_interval:o}}});if(y)throw y;if(!l.user)throw new Error("Failed to create user account");if(!l.session){const{error:C}=await x.auth.signInWithPassword({email:m,password:n});if(C)throw C}if(inviteToken){t.success("Account created! Redirecting to redeem your invitation..."),g(`/auth/redeem-link?token=${inviteToken}`);return}t.success("Account created! Redirecting to payment...");const{url:j}=await f.mutateAsync({tier:r,interval:o,successUrl:`${window.location.origin}/dashboard?onboarding=true&payment_success=true`,cancelUrl:`${window.location.origin}/login`});if(j)window.location.href=j;else throw new Error("Failed to generate payment link")}catch(s){if(console.error("Signup flow error:",s),(v=s.message)!=null&&v.includes("User already registered")||(N=s.message)!=null&&N.includes("already registered")){t.info("User already exists. Attempting to log in...");try{const{data:r,error:o}=await x.auth.signInWithPassword({email:m,password:n});if(o)throw o;if(r.session){if(inviteToken){t.success("Logged in successfully! Redirecting to redeem your invitation..."),g(`/auth/redeem-link?token=${inviteToken}`);return}t.success("Logged in successfully! Proceeding to payment...");const{url:l}=await f.mutateAsync({tier:searchParams.get("tier")||"startup",interval:searchParams.get("interval")||"month",successUrl:`${window.location.origin}/dashboard?onboarding=true`,cancelUrl:`${window.location.origin}/login`});if(l){window.location.href=l;return}}}catch(r){console.error("Auto-login failed:",r),t.error("Account exists but login failed. Please check your password or Sign In manually."),h(!1);return}}else t.error(s.message||"Failed to complete signup");h(!1)}};return e.jsxs("div",{className:"flex items-center justify-center min-h-screen bg-[#002a40]",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMiIvPjwvZz48L2c+PC9zdmc+')] opacity-20"}),e.jsxs(F,{className:"w-full max-w-md relative z-10 bg-[#001e2b] border-slate-700 shadow-2xl",children:[e.jsxs(E,{className:"space-y-1 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 rounded-xl bg-[#0ea5e9] flex items-center justify-center text-white mb-4",children:e.jsx(G,{className:"h-7 w-7 text-white"})}),e.jsx(D,{className:"text-2xl font-bold text-white",children:"Create Account"}),e.jsx(B,{className:"text-slate-400",children:"Start your compliance journey today"})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"fullName",className:"text-slate-300",children:"Full Name"}),e.jsx(d,{id:"fullName",type:"text",placeholder:"John Doe",value:w,onChange:a=>k(a.target.value),required:!0,className:"bg-[#002a40] border-slate-600 text-white placeholder:text-slate-500 focus:border-[#0ea5e9] hover:bg-[#003554] transition-colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"organizationName",className:"text-slate-300",children:"Organization Name"}),e.jsx(d,{id:"organizationName",type:"text",placeholder:"Acme Inc.",value:u,onChange:a=>L(a.target.value),required:!0,className:"bg-[#002a40] border-slate-600 text-white placeholder:text-slate-500 focus:border-[#0ea5e9] hover:bg-[#003554] transition-colors"}),e.jsx("p",{className:"text-xs text-slate-500",children:"The name of your compliance workspace"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",className:"text-slate-300",children:"Email"}),e.jsx(d,{id:"email",type:"email",placeholder:"name@company.com",value:m,onChange:a=>I(a.target.value),required:!0,className:"bg-[#002a40] border-slate-600 text-white placeholder:text-slate-500 focus:border-[#0ea5e9] hover:bg-[#003554] transition-colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"password",className:"text-slate-300",children:"Password"}),e.jsx(d,{id:"password",type:"password",placeholder:"••••••••",value:n,onChange:a=>A(a.target.value),required:!0,minLength:6,className:"bg-[#002a40] border-slate-600 text-white placeholder:text-slate-500 focus:border-[#0ea5e9] hover:bg-[#003554] transition-colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"confirmPassword",className:"text-slate-300",children:"Confirm Password"}),e.jsx(d,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:p,onChange:a=>S(a.target.value),required:!0,minLength:6,className:"bg-[#002a40] border-slate-600 text-white placeholder:text-slate-500 focus:border-[#0ea5e9] hover:bg-[#003554] transition-colors"})]})]})}),e.jsxs(T,{className:"flex flex-col space-y-4 pb-8",children:[e.jsx(P,{type:"submit",className:"w-full bg-emerald-500 hover:bg-emerald-600 text-white h-11 font-medium text-lg border-none",disabled:b,children:b?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):"Create Account & Pay"}),e.jsxs("div",{className:"text-center text-sm text-slate-400",children:["Already have an account?"," ",e.jsx(P,{variant:"link",type:"button",className:"px-0 font-semibold text-[#0ea5e9] hover:text-[#0284c7]",onClick:()=>{const a=new URLSearchParams(window.location.search).get("invite");g(a?`/login?invite=${a}`:"/login")},children:"Sign in"})]})]})]})]})]})}export{H as default};
