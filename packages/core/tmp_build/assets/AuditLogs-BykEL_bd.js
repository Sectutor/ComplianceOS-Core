import{r as d,t as T,j as e,c,C as k,d as L,e as I,f as R,E as v,G as y,H as f,J as b,K as i,m as z,x as P,N as U,O as F,P as p,Q as l,V as O,W as r,k as N,aa as V}from"./index-DOc7Nwb7.js";import{E as B}from"./enhanced-dialog-CeRPsI16.js";import{D as H}from"./DashboardLayout-aHnUqq57.js";import{B as J}from"./Breadcrumb-CRi3LAxS.js";import{R as Q}from"./refresh-cw-Cjym1DSW.js";import{D as _}from"./download-ByfWg1Mi.js";import{E as G}from"./eye-CIq9q9s6.js";import{C as K}from"./chevron-left-DZH-lUm7.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function Ie(){const[o,j]=d.useState(1),[u]=d.useState(50),[m,g]=d.useState("all"),[x,w]=d.useState("all"),{data:t,isLoading:h,isError:C,error:D,refetch:S}=T.auditLogs.list.useQuery({page:o,limit:u,action:m==="all"?void 0:m,entityType:x==="all"?void 0:x}),E=()=>{if(!t)return;const s="data:text/csv;charset=utf-8,"+["ID,Time,User,Action,Entity Type,Entity ID,Details,Severity,IP"].join(",")+`
`+t.map(a=>[a.id,new Date(a.createdAt||"").toISOString(),a.userEmail||a.userId,a.action,a.entityType,a.entityId,JSON.stringify(a.details).replace(/,/g,";"),a.severity,a.ipAddress||""].join(",")).join(`
`),A=encodeURI(s),n=document.createElement("a");n.setAttribute("href",A),n.setAttribute("download",`audit_logs_${new Date().toISOString()}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)};return e.jsx(H,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{items:[{label:"Admin"},{label:"Audit Logs"}]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Audit Logs"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Track all security and administrative events across the platform."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>S(),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"})," Refresh"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:E,disabled:!t||t.length===0,children:[e.jsx(_,{className:"h-4 w-4 mr-2"})," Export CSV"]})]})]}),e.jsxs(k,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{children:"Event Log"}),e.jsx(R,{children:"Search and filter system events."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-[180px]",children:e.jsxs(v,{value:m,onValueChange:g,children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Filter by Action"})}),e.jsxs(b,{children:[e.jsx(i,{value:"all",children:"All Actions"}),e.jsx(i,{value:"create",children:"Create"}),e.jsx(i,{value:"update",children:"Update"}),e.jsx(i,{value:"delete",children:"Delete"}),e.jsx(i,{value:"publish",children:"Publish"}),e.jsx(i,{value:"login",children:"Login"}),e.jsx(i,{value:"restore",children:"Restore"})]})]})}),e.jsx("div",{className:"w-[180px]",children:e.jsxs(v,{value:x,onValueChange:w,children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Filter by Entity"})}),e.jsxs(b,{children:[e.jsx(i,{value:"all",children:"All Entities"}),e.jsx(i,{value:"policy",children:"Policy"}),e.jsx(i,{value:"control",children:"Control"}),e.jsx(i,{value:"client",children:"Client"}),e.jsx(i,{value:"user",children:"User"})]})]})})]})]})}),e.jsxs(z,{children:[h?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):C?e.jsxs("div",{className:"text-center p-8 text-red-500",children:["Error loading logs: ",D.message]}):e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(U,{children:[e.jsx(F,{children:e.jsxs(p,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(l,{className:"text-white font-semibold py-4",children:"Timestamp"}),e.jsx(l,{className:"text-white font-semibold py-4",children:"User"}),e.jsx(l,{className:"text-white font-semibold py-4",children:"Action"}),e.jsx(l,{className:"text-white font-semibold py-4",children:"Entity"}),e.jsx(l,{className:"text-white font-semibold py-4",children:"Severity"}),e.jsx(l,{className:"text-right text-white font-semibold py-4",children:"Details"})]})}),e.jsx(O,{children:(t==null?void 0:t.length)===0?e.jsx(p,{children:e.jsx(r,{colSpan:6,className:"text-center h-24 text-gray-500 bg-white",children:"No logs found matching your criteria."})}):t==null?void 0:t.map(s=>e.jsxs(p,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(r,{className:"whitespace-nowrap font-mono text-xs text-gray-500 py-4",children:new Date(s.createdAt||"").toLocaleString()}),e.jsx(r,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm text-black",children:s.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:s.userEmail})]})}),e.jsx(r,{className:"py-4",children:e.jsx(N,{variant:"outline",className:"capitalize bg-white border-gray-300 text-gray-700",children:s.action})}),e.jsx(r,{className:"py-4",children:e.jsxs("span",{className:"capitalize text-sm text-black",children:[s.entityType," ",s.entityId&&e.jsxs("span",{className:"text-gray-500",children:["#",s.entityId]})]})}),e.jsx(r,{className:"py-4",children:e.jsx(N,{variant:s.severity==="critical"?"destructive":s.severity==="warning"?"secondary":"outline",children:s.severity})}),e.jsx(r,{className:"text-right py-4",children:e.jsx(B,{title:"Log Details",trigger:e.jsxs(c,{variant:"ghost",size:"sm",className:"hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"View"]}),size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Action"}),s.action]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Entity"}),s.entityType," #",s.entityId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"User"}),s.userName," (",s.userEmail,")"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block text-muted-foreground",children:"Time"}),new Date(s.createdAt||"").toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold block mb-2 text-muted-foreground",children:"Raw Data"}),e.jsx("pre",{className:"bg-slate-950 text-slate-50 p-4 rounded-lg overflow-x-auto text-xs font-mono",children:JSON.stringify(typeof s.details=="string"?JSON.parse(s.details):s.details||{},null,2)})]})]})})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.max(1,s-1)),disabled:o===1||h,children:[e.jsx(K,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",o]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>j(s=>s+1),disabled:!t||t.length<u||h,children:["Next",e.jsx(V,{className:"h-4 w-4"})]})]})]})]})]})})}export{Ie as default};
