import{ab as E,u as V,t as b,b as $,i as I,r as L,j as e,c as f,R as B,aA as M,aB as U,k as z,aC as O,D as Q,o as F,p as Z,q as _,s as q,w as G}from"./index-DOc7Nwb7.js";import{D as k}from"./DashboardLayout-aHnUqq57.js";import{B as W}from"./Breadcrumb-CRi3LAxS.js";import{P as Y}from"./PageGuide-CPKKXXS6.js";import{A as J}from"./arrow-left-CpuUojG-.js";import{Z as S}from"./zap-B01fFOkT.js";import{P as X}from"./plus-BaQ35Jcx.js";import{A as H,a as ee}from"./arrow-up-B1n-fuue.js";import{A as se}from"./arrow-up-down-BDk2lJRe.js";import{D as te}from"./database-Bjtecw5f.js";import{S as T}from"./shield-alert-iAruRy4W.js";import{E as ie}from"./external-link-C3PXjBR9.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function qe(){const u=E(),j=u.id?Number(u.id):null,{user:A,client:r}=V(),v=j||(r==null?void 0:r.id),{data:l,isLoading:d}=b.clients.get.useQuery({id:v||0},{enabled:!!v&&!r}),o=r||l,m=(o==null?void 0:o.id)||0,[C,x]=$(),{data:h,isLoading:N,refetch:s}=b.risks.getAssets.useQuery({clientId:m},{enabled:!!m}),i=b.threatIntel.scanAllAssets.useMutation({onSuccess:c=>{var y,D;const p=((y=c.results)==null?void 0:y.reduce((K,P)=>K+(P.count||0),0))||0;I.success(`Scanned ${((D=c.results)==null?void 0:D.length)||0} assets, found ${p} suggestions`),s()},onError:c=>I.error(`Scan failed: ${c.message}`)}),[t,n]=L.useState(null),a=c=>{let p="asc";t&&t.key===c&&t.direction==="asc"&&(p="desc"),n({key:c,direction:p})},g=({label:c,sortKey:p})=>{const y=(t==null?void 0:t.key)===p;return e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors select-none group",onClick:()=>a(p),children:e.jsxs("div",{className:"flex items-center gap-2",children:[c,y?(t==null?void 0:t.direction)==="asc"?e.jsx(H,{className:"w-3.5 h-3.5"}):e.jsx(ee,{className:"w-3.5 h-3.5"}):e.jsx(se,{className:"w-3.5 h-3.5 opacity-0 group-hover:opacity-50 transition-opacity"})]})})},w=()=>{x(`/clients/${m}/risks/assets/new`)},R=c=>{x(`/clients/${m}/risks/assets/${c.id}`)};return d?e.jsx(k,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading client data..."})}):o?e.jsx(k,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(W,{items:[{label:"Clients",href:"/clients"},{label:(o==null?void 0:o.name)||"Client",href:`/clients/${m}`},{label:"Risk Management",href:`/clients/${m}/risks`},{label:"Asset Inventory",href:`/clients/${m}/risks/assets`}]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"mt-2 -ml-3 text-muted-foreground hover:text-foreground",onClick:()=>x(`/clients/${m}/risks`),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Back to Risk Dashboard"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Asset Inventory"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your organization's assets and their valuations."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i.mutate({clientId:m}),className:"px-4 py-2 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 flex items-center gap-2 shadow-sm transition-colors",disabled:i.isPending,title:"Scan all assets against NVD/KEV",children:[e.jsx(S,{className:"w-4 h-4"}),i.isPending?"Scanning...":"Scan All Assets"]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),"Add Asset"]}),e.jsx(Y,{title:"Asset Inventory",description:"Maintain a complete registry of your organization’s critical information assets.",rationale:"You cannot protect what you don't know you have. A comprehensive asset inventory is the starting point for all risk assessments.",howToUse:[{step:"Add Assets",description:"Use the 'Add Asset' button to register hardware, software, data, or people."},{step:"Value Assets",description:"Assign Confidentiality, Integrity, and Availability (CIA) scores to determine criticality."},{step:"Identify Threats",description:"Click the lightning bolt icon to see active threats relevant to that asset's technology stack."}],integrations:[{name:"Risk Assessment",description:"Assets selected here become the targets for risk scenarios."},{name:"Threat Intelligence",description:"The system automatically matches asset technologies (e.g. 'Windows') to CVEs and threat feeds."}]})]})]}),e.jsx("div",{className:"bg-card rounded-xl border shadow-sm min-h-[400px]",children:e.jsx(re,{assets:h||[],loading:N,onEdit:R,sortConfig:t,onSort:a,SortableHeader:g})})]})}):e.jsx(k,{children:e.jsx("div",{className:"p-8 text-center text-destructive",children:"Client not found."})})}function re({assets:u,loading:j,onEdit:A,sortConfig:r,onSort:v,SortableHeader:l}){const[d,o]=L.useState(null),[m,C]=$(),{data:x}=b.adversaryIntel.getSecurityFeeds.useQuery({limit:200},{staleTime:1e3*60*15}),h=s=>{if(!(x!=null&&x.items))return[];const i=[s.name,s.vendor,s.productName,s.type,...s.technologies||[]].filter(Boolean).map(t=>t.toLowerCase());return x.items.filter(t=>t.techStack?t.techStack.some(n=>{const a=n.toLowerCase();return i.some(g=>g.includes(a)||a.includes(g))}):!1)},N=B.useMemo(()=>{if(!u)return[];let s=[...u];return r!==null&&s.sort((i,t)=>{let n=i[r.key],a=t[r.key];if(r.key==="activeThreats")n=h(i).length,a=h(t).length;else if(r.key==="riskCount")n=i.riskCount||0,a=t.riskCount||0;else if(r.key==="vulnerabilityCount")n=i.vulnerabilityCount||0,a=t.vulnerabilityCount||0;else if(r.key==="suggestionCount")n=i.suggestionCount||0,a=t.suggestionCount||0;else if(r.key==="ciaValuation"){const g=(Number(i.valuationC)||0)+(Number(i.valuationI)||0)+(Number(i.valuationA)||0),w=(Number(t.valuationC)||0)+(Number(t.valuationI)||0)+(Number(t.valuationA)||0);n=g,a=w}else typeof n=="string"&&(n=n.toLowerCase(),a=(a==null?void 0:a.toLowerCase())||"");return n<a?r.direction==="asc"?-1:1:n>a?r.direction==="asc"?1:-1:0}),s},[u,r,x]);return j?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading assets..."}):u.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-secondary rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(te,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium",children:"No Assets Found"}),e.jsx("p",{className:"text-muted-foreground mt-1 max-w-md mx-auto",children:"Start by adding assets to your inventory to begin risk assessment."})]}):e.jsxs("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#1C4D8D]",children:[e.jsx(l,{label:"Asset ID",sortKey:"id"}),e.jsx(l,{label:"Asset Name",sortKey:"name"}),e.jsx(l,{label:"Type/Category",sortKey:"type"}),e.jsx(l,{label:"Description",sortKey:"description"}),e.jsx(l,{label:"Active Threats",sortKey:"activeThreats"}),e.jsx(l,{label:"CIA",sortKey:"ciaValuation"}),e.jsx(l,{label:"Owner",sortKey:"owner"}),e.jsx(l,{label:"Location",sortKey:"location"}),e.jsx(l,{label:"Status",sortKey:"status"}),e.jsx(l,{label:"Risks",sortKey:"riskCount"}),e.jsx(l,{label:"Vulnerabilities",sortKey:"vulnerabilityCount"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm cursor-pointer group",onDoubleClick:()=>A(s),children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-mono text-gray-500",children:["#",s.id]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-black",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.type}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-[200px] truncate",title:s.description,children:s.description||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:(()=>{const i=h(s);return i.length>0?e.jsxs(M,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(z,{className:"bg-red-100 text-red-700 border-red-200 hover:bg-red-200 cursor-pointer flex w-fit items-center gap-1 transition-transform active:scale-95",onClick:t=>{t.stopPropagation(),o(s)},children:[e.jsx(S,{className:"w-3 h-3 fill-red-700"}),i.length," Active"]})}),e.jsxs(O,{className:"max-w-[300px]",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Click to view details"}),e.jsx("ul",{className:"list-disc list-inside text-xs space-y-1",children:i.slice(0,3).map((t,n)=>e.jsx("li",{className:"line-clamp-1",children:t.title},n))})]})]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})()}),e.jsxs("td",{className:"px-6 py-4 flex gap-1 items-center h-full",children:[e.jsxs("span",{className:"px-1.5 py-0.5 bg-white text-xs rounded border border-gray-300 text-gray-700",title:"Confidentiality",children:["C:",s.valuationC]}),e.jsxs("span",{className:"px-1.5 py-0.5 bg-white text-xs rounded border border-gray-300 text-gray-700",title:"Integrity",children:["I:",s.valuationI]}),e.jsxs("span",{className:"px-1.5 py-0.5 bg-white text-xs rounded border border-gray-300 text-gray-700",title:"Availability",children:["A:",s.valuationA]})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.owner||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.location||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${s.status==="active"?"bg-green-50 text-green-700 border-green-200":s.status==="archived"?"bg-gray-50 text-gray-700 border-gray-200":"bg-red-50 text-red-700 border-red-200"}`,children:s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Active"})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border ${s.riskCount>0?"bg-orange-50 text-orange-700 border-orange-200":"bg-blue-50 text-blue-700 border-blue-200"}`,children:[s.riskCount||0," Risks"]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border ${s.vulnerabilityCount>0?"bg-red-50 text-red-700 border-red-200":"bg-gray-50 text-gray-400 border-gray-100"}`,children:[s.vulnerabilityCount||0," Vulns"]})})]},s.id))})]})}),e.jsx(Q,{open:!!d,onOpenChange:s=>!s&&o(null),children:e.jsxs(F,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-red-600"}),"Active Threat Intelligence"]}),e.jsxs(q,{children:["The following active threats match the technology stack of ",e.jsx("strong",{children:d==null?void 0:d.name}),"."]})]}),e.jsx("div",{className:"space-y-4 mt-4",children:d&&h(d).map((s,i)=>e.jsx("div",{className:"p-4 border rounded-lg bg-slate-50 hover:bg-slate-100 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-semibold text-sm text-slate-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(s.pubDate).toLocaleDateString()}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.sourceName}),s.severity&&e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] uppercase font-bold ${s.severity==="critical"?"bg-red-100 text-red-700":s.severity==="high"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:s.severity})]}),e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 mt-2",children:s.description})]}),e.jsxs("div",{className:"flex flex-col gap-2 min-w-[120px]",children:[e.jsxs(f,{size:"sm",variant:"outline",className:"w-full text-xs h-8",onClick:()=>window.open(s.link,"_blank"),children:[e.jsx(ie,{className:"w-3 h-3 mr-2"}),"View Source"]}),e.jsxs(f,{size:"sm",className:"w-full text-xs h-8 bg-red-600 hover:bg-red-700",onClick:()=>{const t=new URLSearchParams;t.set("title",`Risk: ${s.title.slice(0,50)}...`),t.set("description",`Derived from active threat: ${s.title}

Source: ${s.sourceName}
Link: ${s.link}

${s.description}`),t.set("assetId",d.id),C(`/clients/${d.clientId}/risks/register?${t.toString()}`)},children:[e.jsx(T,{className:"w-3 h-3 mr-2"}),"Create Risk"]})]})]})},i))}),e.jsx(G,{children:e.jsx(f,{variant:"ghost",onClick:()=>o(null),children:"Close"})})]})})]})}export{qe as default};
