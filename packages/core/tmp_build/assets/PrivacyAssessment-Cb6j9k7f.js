import{ac as $,b as J,r as j,t as k,i as A,j as e,x as P,c as L,C as D,m as E,d as K,e as Y,E as R,G as T,H as _,J as I,K as o}from"./index-DOc7Nwb7.js";import{c as M}from"./utils-BC5CVi_C.js";import{T as O}from"./textarea-BtxBxzdY.js";import{P as F}from"./progress-B-1k4ZZX.js";import{D as U}from"./DashboardLayout-aHnUqq57.js";import{A as W}from"./arrow-left-CpuUojG-.js";import{S as X}from"./save-CvVmWchr.js";import{C as Z}from"./circle-check-C5kiwRoG.js";function de({title:V,type:f,checklist:p,mode:z="assessment"}){const{selectedClientId:x}=$(),[,B]=J(),[n,u]=j.useState({}),[l,G]=j.useState(0),{data:q,isLoading:H}=k.privacy.getAssessment.useQuery({clientId:x||0,type:f},{enabled:!!x,onSuccess:a=>{a!=null&&a.responses&&u(a.responses)}}),g=k.privacy.saveAssessment.useMutation({onSuccess:()=>{A.success("Assessment saved successfully")},onError:a=>A.error(a.message)});j.useEffect(()=>{let a=0,s=0;p.forEach(c=>{c.questions.forEach(i=>{var d,r;s++,((d=n[i.id])==null?void 0:d.answer)==="yes"&&a++,((r=n[i.id])==null?void 0:r.answer)==="partial"&&(a+=.5)})});const t=s>0?Math.round(a/s*100):0;G(t)},[n,p]);const v=(a,s)=>{u(t=>({...t,[a]:{...t[a],answer:s}}))},b=(a,s)=>{u(t=>({...t,[a]:{...t[a],notes:s}}))},Q=()=>{if(!x)return;const a=l===100?"completed":l>0?"in_progress":"not_started";g.mutate({clientId:x||0,type:f,responses:n,score:l,status:a})};return x?H?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(P,{className:"animate-spin"})}):e.jsx(U,{children:e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto pb-12",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(L,{variant:"ghost",className:"mb-2 pl-0 hover:pl-2 transition-all",onClick:()=>B(`/clients/${x}/privacy`),children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:V}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Assess your compliance posture."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Readiness Score"})]}),e.jsxs(L,{onClick:Q,disabled:g.isLoading,children:[g.isLoading&&e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(X,{className:"mr-2 h-4 w-4"})," Save Progress"]})]})]}),e.jsx(D,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Completion Progress"}),e.jsx("span",{className:l>=100?"text-green-600 font-medium":"text-muted-foreground",children:l>=100?"Completed!":`${l}%`})]}),e.jsx(F,{value:l,className:"h-3"})]})})}),e.jsx("div",{className:"space-y-6",children:p.map(a=>e.jsxs(D,{children:[e.jsx(K,{className:"bg-muted/30 pb-4",children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[a.category,a.questions.every(s=>{var t;return((t=n[s.id])==null?void 0:t.answer)==="yes"})&&e.jsx(Z,{className:"h-5 w-5 text-green-500"})]})}),e.jsx(E,{className:"space-y-6 pt-6",children:z==="checklist"?e.jsxs("div",{className:"rounded-md border",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 font-medium text-sm bg-muted/50 border-b",children:[e.jsx("div",{className:"col-span-12 md:col-span-5 pl-2",children:"Requirement"}),e.jsx("div",{className:"col-span-12 md:col-span-2 text-center",children:"Status"}),e.jsx("div",{className:"col-span-12 md:col-span-2 hidden md:block",children:"Owner / Due"}),e.jsx("div",{className:"col-span-12 md:col-span-3 hidden md:block",children:"Evidence / Notes"})]}),a.questions.map((s,t)=>{var c,i,d,r,N,w,y,C,S;return e.jsxs("div",{className:M("grid grid-cols-12 gap-4 p-4 items-start transition-all hover:bg-slate-50",t!==a.questions.length-1&&"border-b"),children:[e.jsxs("div",{className:"col-span-12 md:col-span-5 flex gap-3",children:[e.jsxs("span",{className:"text-muted-foreground text-xs font-mono mt-1 w-6 shrink-0",children:[t+1,"."]}),e.jsx("p",{className:"text-sm leading-relaxed",children:s.text})]}),e.jsx("div",{className:"col-span-12 md:col-span-2",children:e.jsxs(R,{value:((c=n[s.id])==null?void 0:c.answer)||"not_started",onValueChange:m=>v(s.id,m),children:[e.jsx(T,{className:M("h-8 text-xs font-medium border-0 ring-1 ring-inset",((i=n[s.id])==null?void 0:i.answer)==="yes"?"bg-green-50 text-green-700 ring-green-600/20":((d=n[s.id])==null?void 0:d.answer)==="partial"?"bg-yellow-50 text-yellow-700 ring-yellow-600/20":((r=n[s.id])==null?void 0:r.answer)==="na"?"bg-slate-50 text-slate-600 ring-slate-400/20":"bg-red-50 text-red-700 ring-red-600/20"),children:e.jsx(_,{})}),e.jsxs(I,{children:[e.jsx(o,{value:"not_started",children:"Not Started (Gap)"}),e.jsx(o,{value:"partial",children:"In Progress"}),e.jsx(o,{value:"yes",children:"Done / Complete"}),e.jsx(o,{value:"na",children:"N/A"})]})]})}),e.jsxs("div",{className:"col-span-12 md:col-span-2 space-y-2",children:[e.jsx("input",{placeholder:"Owner",className:"flex h-7 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:((N=n[s.id])==null?void 0:N.owner)||"",onChange:m=>u(h=>({...h,[s.id]:{...h[s.id],owner:m.target.value}}))}),e.jsx("input",{type:"date",className:"flex h-7 w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:((w=n[s.id])==null?void 0:w.dueDate)||"",onChange:m=>u(h=>({...h,[s.id]:{...h[s.id],dueDate:m.target.value}}))})]}),e.jsxs("div",{className:"col-span-12 md:col-span-3",children:[e.jsx(O,{placeholder:"Link to ROPA, DPA, Policy...",className:"min-h-[3.5rem] text-xs resize-y mb-1",value:((y=n[s.id])==null?void 0:y.notes)||"",onChange:m=>b(s.id,m.target.value)}),((C=n[s.id])==null?void 0:C.lastReviewed)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground text-right",children:["Rev: ",(S=n[s.id])==null?void 0:S.lastReviewed]})]})]},s.id)})]}):a.questions.map(s=>{var t,c,i,d;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-6 p-4 rounded-lg hover:bg-slate-50 border border-transparent hover:border-slate-100 transition-all",children:[e.jsx("div",{className:"md:col-span-6",children:e.jsx("p",{className:"font-medium text-sm leading-relaxed",children:s.text})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(R,{value:((t=n[s.id])==null?void 0:t.answer)||"no",onValueChange:r=>v(s.id,r),children:[e.jsx(T,{className:((c=n[s.id])==null?void 0:c.answer)==="yes"?"border-green-200 bg-green-50 text-green-700":((i=n[s.id])==null?void 0:i.answer)==="partial"?"border-yellow-200 bg-yellow-50 text-yellow-700":"",children:e.jsx(_,{placeholder:"Select..."})}),e.jsxs(I,{children:[e.jsx(o,{value:"no",children:"No / Not Started"}),e.jsx(o,{value:"partial",children:"Partial"}),e.jsx(o,{value:"yes",children:"Yes / Compliant"}),e.jsx(o,{value:"na",children:"N/A"})]})]})}),e.jsx("div",{className:"md:col-span-4",children:e.jsx(O,{placeholder:"Add notes, evidence links, or gaps...",className:"min-h-[2.5rem] text-xs resize-y",value:((d=n[s.id])==null?void 0:d.notes)||"",onChange:r=>b(s.id,r.target.value)})})]},s.id)})})]},a.id))})]})}):e.jsx("div",{className:"p-8",children:"Please select a client."})}export{de as P};
