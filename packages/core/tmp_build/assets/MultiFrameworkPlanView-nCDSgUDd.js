import{M as Me,t as y,i as h,j as e,r as x,c as u,x as H,C as L,d as $,e as W,k as D,m as Q,n as de,f as he,D as ue,ap as Oe,o as ge,p as je,q as fe,L as q,I as B,z as Fe,R as Le,a6 as qe,a7 as Ge,bu as Be,a8 as Ue,v as Ve,a4 as He,F as $e,by as We,s as Ie,aq as Qe,E as ye,G as Ce,H as Se,J as Pe,K as O,w as _e}from"./index-DOc7Nwb7.js";import{c as E}from"./utils-BC5CVi_C.js";import{T as Ke,a as Je,b as Ae,c as ke}from"./tabs-CBDTXbEn.js";import{S as Ee}from"./scroll-area-DPaNxEJD.js";import{S as me}from"./separator-BWuYil37.js";import{P as be}from"./progress-B-1k4ZZX.js";import{S as G}from"./sparkles-CoQ80pK2.js";import{S as xe}from"./shield-alert-iAruRy4W.js";import{C as z}from"./circle-check-C5kiwRoG.js";import{W as _}from"./wand-sparkles-BtekNLFr.js";import{C as Ne}from"./clock-osbacZli.js";import{A as ze}from"./arrow-right-M96iV-v9.js";import{S as De}from"./shield-check-ETs8j4-d.js";import{B as Ye}from"./building-C0cheRWa.js";import{C as Xe}from"./calendar-BlLJlGbj.js";import{P as Ze}from"./PageGuide-CPKKXXS6.js";import{D as es}from"./DashboardLayout-aHnUqq57.js";import{T as pe}from"./textarea-BtxBxzdY.js";import{L as Te}from"./link-FmUqdGRG.js";import{P as ss}from"./paperclip-CVvoCde1.js";import{E as ts}from"./eye-CIq9q9s6.js";import{P as Re}from"./plus-BaQ35Jcx.js";import{M as as}from"./index-utl_XIpZ.js";import{P as is}from"./pen-BlTNmlLB.js";import{A as ls}from"./arrow-left-CpuUojG-.js";import{E as rs}from"./ellipsis-BXWwt8ER.js";import{L as ns}from"./layout-grid-CGqkIAJU.js";import{L as os}from"./list-BZOuFwEg.js";import{S as cs}from"./square-check-big-BUI41YoI.js";import{B as ds}from"./bar-chart-3-BCngNY6H.js";import"./book-open-BffBrdze.js";import"./info-By5wLOUH.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./brain-C-Zi22rJ.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=Me("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),xs=s=>{if(s.length===0)return 0;const c=s.filter(r=>r.status==="completed"||r.status==="done").length;return Math.round(c/s.length*100)},ps=s=>({GV:"GOVERN",ID:"IDENTIFY",PR:"PROTECT",DE:"DETECT",RS:"RESPOND",RC:"RECOVER"})[s]||s,hs=s=>({GV:"bg-blue-100 text-blue-800 border-blue-200",ID:"bg-purple-100 text-purple-800 border-purple-200",PR:"bg-orange-100 text-orange-800 border-orange-200",DE:"bg-cyan-100 text-cyan-800 border-cyan-200",RS:"bg-red-100 text-red-800 border-red-200",RC:"bg-green-100 text-green-800 border-green-200"})[s]||"bg-slate-100 text-slate-800",us=({planId:s,frameworkName:c,tasks:r,phases:g,isLoading:C,frameworkId:f})=>{const A=y.useContext(),{data:b,isLoading:j}=y.implementation.getFrameworkRequirements.useQuery({frameworkId:f||0},{enabled:!!f}),l=y.implementation.seedBaselineTasks.useMutation({onSuccess:()=>{A.implementation.getPlan.invalidate(),h.success(`${c} baseline seeded!`,{icon:e.jsx(G,{className:"w-4 h-4 text-emerald-500"})})},onError:i=>{h.error("Failed to seed baseline",{description:i.message})}}),o=x.useMemo(()=>{const i={Plan:{tasks:[],requirements:[],description:""},Do:{tasks:[],requirements:[],description:""},Check:{tasks:[],requirements:[],description:""},Act:{tasks:[],requirements:[],description:""}};return g&&g.forEach(n=>{i[n.name]&&(i[n.name].description=n.description||"")}),r&&r.forEach(n=>{const p=n.pdca&&i[n.pdca]?n.pdca:"Plan";i[p].tasks.push(n)}),b&&b.forEach(n=>{var R;const p=(R=n.phase)==null?void 0:R.name;p&&i[p]&&(r!=null&&r.some(S=>S.title===n.requirement.title||S.description&&S.description.includes(n.requirement.identifier))||i[p].requirements.push(n.requirement))}),i},[r,b,g]),d=y.implementation.updateTaskStatus.useMutation({onSuccess:()=>{A.implementation.getPlan.invalidate()},onError:i=>{h.error("Failed to update task",{description:i.message})}}),v=(i,n)=>{const p=n==="done"||n==="completed"?"todo":"done";d.mutate({taskId:i,status:p})};if(C||j)return e.jsxs("div",{className:"p-20 flex flex-col items-center justify-center gap-4 text-slate-400",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-slate-200 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-sm font-medium",children:"Standardizing methodology view..."})]});const N=c.includes("ISO"),m=c.includes("SOC"),k=c.includes("GDPR");return e.jsxs("div",{className:"space-y-8 animate-in fade-in zoom-in-95 duration-700",children:[e.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 w-64 h-64 bg-indigo-500/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute left-0 bottom-0 w-48 h-48 bg-emerald-500/10 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl pointer-events-none"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"p-2 bg-indigo-500/20 rounded-xl border border-indigo-400/30",children:[N&&e.jsx(xe,{className:"w-5 h-5 text-indigo-300"}),m&&e.jsx(z,{className:"w-5 h-5 text-emerald-300"}),k&&e.jsx(G,{className:"w-5 h-5 text-amber-300"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black tracking-tight",children:[c," ISMS Lifecycle"]}),e.jsx("p",{className:"text-indigo-200/60 text-xs font-medium uppercase tracking-widest",children:"Unified PDCA Methodology Architecture"})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex -space-x-2",children:["P","D","C","A"].map((i,n)=>e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-slate-900 bg-slate-800 flex items-center justify-center text-[10px] font-black",style:{zIndex:4-n},children:i},i))}),e.jsxs(u,{variant:"default",size:"sm",className:"bg-white text-slate-900 hover:bg-slate-100 font-bold shadow-lg",onClick:()=>l.mutate({planId:s,frameworkId:f||0}),disabled:l.isPending||!f,children:[l.isPending?e.jsx(H,{className:"w-3.5 h-3.5 mr-2 animate-spin text-indigo-500"}):e.jsx(_,{className:"w-3.5 h-3.5 mr-2"}),l.isPending?"Seeding...":"Baseline Reset"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 relative px-1",children:[e.jsx(re,{step:"1",title:"PLAN",description:o.Plan.description||"Establish objectives and context.",data:o.Plan,colorClass:"#3b82f6",icon:Ne,toggleTaskStatus:v,frameworkName:c}),e.jsx(re,{step:"2",title:"DO",description:o.Do.description||"Implement treatment and controls.",data:o.Do,colorClass:"#f59e0b",icon:ze,toggleTaskStatus:v,frameworkName:c}),e.jsx(re,{step:"3",title:"CHECK",description:o.Check.description||"Monitor and evaluate performance.",data:o.Check,colorClass:"#8b5cf6",icon:xe,toggleTaskStatus:v,frameworkName:c}),e.jsx(re,{step:"4",title:"ACT",description:o.Act.description||"Improve and react to findings.",data:o.Act,colorClass:"#10b981",icon:z,toggleTaskStatus:v,frameworkName:c})]}),e.jsxs("div",{className:"bg-amber-50/50 border border-amber-100 rounded-xl p-4 flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-amber-100 rounded-lg shrink-0",children:e.jsx(G,{className:"w-4 h-4 text-amber-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-black text-amber-900 flex items-center gap-2",children:"Professional Governance Note"}),e.jsx("p",{className:"text-[11px] text-amber-800/70 leading-relaxed mt-1",children:"This view integrates framework-specific requirements (e.g., GDPR Articles or SOC 2 Criteria) into the standardized ISO-based PDCA lifecycle. This ensures cross-framework harmonization and consistent audit readiness across your entire compliance program."})]})]})]})},re=({title:s,description:c,data:r,colorClass:g,icon:C,step:f,toggleTaskStatus:A,frameworkName:b})=>{const j=xs(r.tasks);return e.jsxs(L,{className:"h-full min-h-[650px] border-t-4 shadow-sm hover:shadow-md transition-all duration-300 bg-white group",style:{borderTopColor:g},children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full text-[10px] font-bold text-white shadow-sm",style:{backgroundColor:g},children:f}),e.jsx(W,{className:"text-base font-bold text-slate-800",children:s})]}),e.jsx("p",{className:"text-[11px] leading-relaxed text-slate-500 font-medium max-w-[200px]",children:c})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("span",{className:"text-xl font-black tabular-nums",style:{color:g},children:[j,"%"]}),e.jsxs(D,{variant:"outline",className:"text-[9px] px-1.5 py-0 border-slate-200 text-slate-400 capitalize bg-slate-50/50",children:[r.tasks.filter(l=>l.status==="completed"||l.status==="done").length,"/",r.tasks.length," Done"]})]})]})}),e.jsxs(Q,{className:"space-y-5 flex-1 flex flex-col",children:[e.jsx(be,{value:j,className:"h-1.5 rounded-full overflow-hidden bg-slate-100",style:{"--progress-color":g}}),e.jsxs("div",{className:"space-y-4 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-tighter",children:"Current Implementation"}),r.tasks.length>0&&e.jsx(C,{className:"w-3 h-3 opacity-20",style:{color:g}})]}),e.jsx(Ee,{className:"h-[450px] -mr-2 pr-3",children:e.jsxs("div",{className:"space-y-1.5",children:[r.tasks.map(l=>{var o;return e.jsxs("div",{onClick:()=>A(l.id,l.status),className:"flex items-start gap-2.5 p-2 rounded-lg bg-slate-50/50 border border-slate-100/50 hover:bg-white hover:border-slate-200 hover:shadow-sm transition-all cursor-pointer group/task",children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:l.status==="completed"||l.status==="done"?e.jsx(z,{className:"w-3.5 h-3.5 text-emerald-500"}):l.status==="in_progress"?e.jsx(Ne,{className:"w-3.5 h-3.5 text-amber-500 animate-pulse"}):e.jsx(de,{className:"w-3.5 h-3.5 text-slate-300 group-hover/task:text-indigo-400 transition-colors"})}),e.jsxs("div",{className:"flex flex-col gap-1 overflow-hidden w-full",children:[e.jsx("span",{className:E("text-[11px] font-bold text-slate-700 leading-tight block mb-1",(l.status==="completed"||l.status==="done")&&"text-slate-400 line-through"),children:l.title}),b.includes("NIST")&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-0.5 mb-1.5",children:((o=l.tags)==null?void 0:o.find(d=>d.startsWith("NIST-")))&&e.jsx(D,{variant:"outline",className:E("text-[8px] h-3.5 px-1 border rounded-sm font-bold",hs((l.tags.find(d=>d.startsWith("NIST-"))||"").split("-")[1])),children:ps((l.tags.find(d=>d.startsWith("NIST-"))||"").split("-")[1])})}),l.description&&e.jsx("p",{className:"text-[10px] text-slate-500 leading-tight line-clamp-2 italic",children:l.description.replace(/\*\*/g,"")}),l.tags&&l.tags.length>0&&!b.includes("NIST")&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:l.tags.slice(0,2).map(d=>e.jsx("span",{className:"text-[8px] px-1 bg-white border border-slate-100 rounded text-slate-400",children:d},d))})]})]},l.id)}),r.tasks.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-center border-2 border-dashed border-slate-50 rounded-xl bg-slate-25",children:[e.jsx(de,{className:"w-5 h-5 text-slate-200 mb-2"}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-medium",children:["No tasks assigned to",e.jsx("br",{}),"this phase yet."]})]})]})})]}),r.requirements.length>0&&e.jsxs("div",{className:"pt-2 border-t border-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2.5",children:[e.jsx(xe,{className:"w-3 h-3 text-amber-500"}),e.jsxs("span",{className:"text-[9px] font-bold text-amber-600 uppercase tracking-tighter",children:["Missing Standard Baseline (",r.requirements.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-1.5",children:[r.requirements.slice(0,2).map(l=>e.jsxs("div",{className:"flex items-center justify-between p-1.5 rounded-md bg-amber-50/30 border border-amber-100/50 group/req",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(D,{variant:"outline",className:"text-[8px] h-3.5 px-1 border-amber-200 text-amber-700 bg-white",children:l.identifier}),e.jsx("span",{className:"text-[10px] text-amber-800 font-medium truncate",children:l.title})]}),e.jsx(ze,{className:"w-2.5 h-2.5 text-amber-300 group-hover/req:translate-x-0.5 transition-transform"})]},l.identifier)),r.requirements.length>2&&e.jsxs("p",{className:"text-[9px] text-amber-500 text-center font-bold italic mt-1",children:["+ ",r.requirements.length-2," more requirements missing"]})]})]})]})]})]})},gs=({planId:s,frameworkName:c,tasks:r,phases:g,isLoading:C,frameworkId:f})=>e.jsx(us,{planId:s,frameworkName:c,tasks:r,phases:g,isLoading:C,frameworkId:f}),js=({planId:s,frameworkId:c,planTitle:r})=>{const[g,C]=x.useState(!1),[f,A]=x.useState(!1),[b,j]=x.useState(0),[l,o]=x.useState([]),d=y.harmonization.analyzePlanHarmonization.useMutation({onSuccess:N=>{A(!0),j(N.savingsPercentage||15),o(N.opportunities||[{id:1,title:"Access Control Policy",source:"Internal Security Policy (SOC 2)",confidence:"High"},{id:2,title:"Incident Response Procedure",source:"GDPR Pack",confidence:"Medium"}]),h.success("Harmonization Analysis Complete",{description:"Found 2 reusable controls."})},onError:N=>{h.error("Analysis Failed",{description:N.message})}}),v=()=>{C(!0),d.mutate({planId:s},{onSettled:()=>C(!1)})};return e.jsxs(L,{className:"border-purple-200 bg-purple-50/50",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(_,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx(W,{className:"text-lg text-purple-900",children:"Harmonization Engine"}),e.jsx(he,{className:"text-purple-700/80",children:"Detect cross-framework overlaps to reduce work."})]})]}),f&&e.jsxs(D,{className:"bg-green-600 hover:bg-green-700 text-base px-3 py-1",children:[b,"% Effort Saved"]})]})}),e.jsx(Q,{children:f?e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium text-slate-700",children:[e.jsx("span",{children:"Optimization Score"}),e.jsxs("span",{children:[b,"/100"]})]}),e.jsx(be,{value:b,className:"h-2 bg-purple-100",indicatorClassName:"bg-purple-600"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-purple-100 p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-slate-900",children:"Detected Opportunities"}),e.jsx("div",{className:"space-y-3",children:l.map(N=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-purple-50/50 rounded border border-purple-100",children:[e.jsx(z,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:N.title}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Satisfied by ",e.jsx("strong",{children:N.source})]})]}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-6 text-purple-700 hover:text-purple-900 text-xs",children:"Apply"})]},N.id))})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"We can scan your other active plans (SOC 2, GDPR) to find controls you've already implemented."}),e.jsxs(u,{onClick:v,disabled:g,className:"bg-purple-600 hover:bg-purple-700 text-white shadow-lg shadow-purple-500/20",children:[g?e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(_,{className:"mr-2 h-4 w-4"}),"Run Analysis"]})]})})]})},fs=({clientId:s,frameworkId:c,frameworkName:r})=>{const[g,C]=x.useState(!1),[f,A]=x.useState(""),[b,j]=x.useState(""),[l,o]=x.useState(""),d=y.useContext(),{data:v,isLoading:N}=y.audit.list.useQuery({clientId:s}),{data:m}=y.audit.getReadinessStats.useQuery({planId:s,frameworkId:c}),k=y.audit.create.useMutation({onSuccess:()=>{d.audit.list.invalidate(),C(!1),h.success("Audit Scheduled")}}),i=()=>{k.mutate({clientId:s,frameworkId:c,auditFirm:f,auditorName:b,startDate:l,stage:"stage_1"})},n=v==null?void 0:v[0];return e.jsxs(L,{className:"border-green-200 bg-green-50/30",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(De,{className:"w-5 h-5 text-green-700"})}),e.jsxs("div",{children:[e.jsx(W,{className:"text-lg text-green-900",children:"Audit & Certification"}),e.jsxs(he,{children:["Track your external audit journey for ",r]})]})]}),n&&e.jsx(D,{className:`${n.status==="completed"?"bg-green-600":"bg-blue-600"} text-white capitalize`,children:n.status.replace("_"," ")})]})}),e.jsx(Q,{children:N?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading audit status..."}):n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-white rounded border border-green-100",children:[e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"})," Firm"]}),e.jsx("p",{className:"font-medium text-slate-900",children:n.auditFirm||"N/A"})]}),e.jsxs("div",{className:"p-3 bg-white rounded border-green-100 border",children:[e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"})," Date"]}),e.jsx("p",{className:"font-medium text-slate-900",children:n.startDate?new Date(n.startDate).toLocaleDateString():"TBD"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-green-900",children:"Audit Readiness Checklist"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[m!=null&&m.scopeDefined?e.jsx(z,{className:"w-4 h-4 text-green-600"}):e.jsx(Circle,{className:"w-4 h-4 text-slate-300"}),e.jsx("span",{children:"Scope Defined"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[m!=null&&m.riskAssessment?e.jsx(z,{className:"w-4 h-4 text-green-600"}):e.jsx(Circle,{className:"w-4 h-4 text-slate-300"}),e.jsx("span",{children:"Risk Assessment Completed"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[((m==null?void 0:m.evidencePercentage)||0)>80?e.jsx(z,{className:"w-4 h-4 text-green-600"}):e.jsx(Fe,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{children:["Evidence Collection (",(m==null?void 0:m.evidencePercentage)||0,"%)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[m!=null&&m.internalAudit?e.jsx(z,{className:"w-4 h-4 text-green-600"}):e.jsx(Ne,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{children:"Internal Audit Review"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(u,{variant:"outline",size:"sm",className:"text-green-700 border-green-200 hover:bg-green-50",children:"View Audit Details"})})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"No active audits found."}),e.jsxs(ue,{open:g,onOpenChange:C,children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(u,{className:"bg-green-700 hover:bg-green-800 text-white",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Schedule Audit"]})}),e.jsxs(ge,{children:[e.jsx(je,{children:e.jsx(fe,{children:"Schedule Certification Audit"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Audit Firm"}),e.jsx(B,{placeholder:"e.g. A-LIGN, Coalfire",value:f,onChange:p=>A(p.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Lead Auditor"}),e.jsx(B,{placeholder:"Auditor Name",value:b,onChange:p=>j(p.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Start Date"}),e.jsx(B,{type:"date",value:l,onChange:p=>o(p.target.value)})]}),e.jsx(u,{onClick:i,disabled:k.isLoading,children:k.isLoading?"Scheduling...":"Confirm Schedule"})]})]})]})]})})]})};function bs({task:s,open:c,onOpenChange:r,onUpdate:g}){const[C,f]=x.useState((s==null?void 0:s.title)||""),[A,b]=x.useState((s==null?void 0:s.description)||""),[j,l]=x.useState((s==null?void 0:s.subtasks)||[]),[o,d]=x.useState("");x.useEffect(()=>{s&&(f(s.title),b(s.description||""),l(s.subtasks||[]))},[s]);const v=y.implementation.updateTask.useMutation({onSuccess:()=>{h.success("Task updated"),g()},onError:t=>{h.error("Failed to update task"),console.error(t)}}),N=y.implementation.generateSubtasks.useMutation({onSuccess:t=>{h.success(`Generated ${t.length} subtasks`),l([...j,...t])},onError:t=>{h.error("AI Generation failed"),console.error(t)}}),m=y.implementation.attachSubtaskEvidence.useMutation({onSuccess:()=>{h.success("Evidence attached"),g()},onError:t=>{h.error("Failed to attach evidence"),console.error(t)}}),k=Le.useRef(null),[i,n]=x.useState(null),[p,R]=x.useState(null),[K,S]=x.useState(!1),[I,U]=x.useState(!1),[w,J]=x.useState(null),F=y.implementation.generateSubtaskSolution.useMutation({onSuccess:t=>{R(t.content),S(!0)},onError:t=>{h.error("Failed to generate solution"),console.error(t)}}),Y=async t=>{var ve;const P=(ve=t.target.files)==null?void 0:ve[0];if(!P||!i||!s)return;new FormData;const M=new FileReader;M.onload=async()=>{try{const ne=M.result.split(",")[1],we=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:P.name,data:ne,contentType:P.type,folder:"evidence"})});if(!we.ok)throw new Error("Upload failed");const oe=await we.json();m.mutate({taskId:s.id,subtaskId:i,evidence:{filename:P.name,url:oe.url,key:oe.key}}),l(j.map(ce=>ce.id===i?{...ce,completed:!0,evidenceUrl:oe.url,filename:P.name}:ce))}catch(ne){h.error("Upload failed"),console.error(ne)}k.current&&(k.current.value=""),n(null)},M.readAsDataURL(P)},X=t=>{var P;n(t),(P=k.current)==null||P.click()},Z=t=>{if(s){if(J(t),U(!1),t.aiSolution){R(t.aiSolution),S(!0);return}h.info("AI is crafting a solution..."),F.mutate({taskId:s.id,subtaskTitle:t.title,taskTitle:s.title,taskDescription:s.description||""})}},ee=()=>{if(!w||!p)return;const t=j.map(P=>P.id===w.id?{...P,aiSolution:p}:P);l(t),S(!1),h.success("Solution attached to subtask")},se=()=>{s&&(h.info("Generating subtasks with AI..."),N.mutate({taskId:s.id,title:C||s.title,description:A||s.description,pdca:s.pdca}))},te=()=>{s&&v.mutate({taskId:s.id,title:C,description:A,subtasks:j,priority:s.priority,status:s.status,pdca:s.pdca})},ae=t=>{const P=j.map(M=>M.id===t?{...M,completed:!M.completed}:M);l(P)},a=()=>{if(!o.trim())return;const t={id:crypto.randomUUID(),title:o,completed:!1};l([...j,t]),d("")},T=t=>{l(j.filter(P=>P.id!==t))},V=j.filter(t=>t.completed).length,ie=j.length,le=ie>0?V/ie*100:0;return e.jsx(qe,{open:c,onOpenChange:r,children:e.jsxs(Ge,{className:"sm:max-w-xl w-full flex flex-col h-full bg-white p-0",children:[e.jsxs(Be,{className:"p-6 border-b border-slate-100 bg-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{variant:"outline",className:"capitalize bg-slate-50 text-slate-500 border-slate-200",children:(s==null?void 0:s.pdca)||"General"}),e.jsxs(D,{variant:"outline",className:E("capitalize border-0",(s==null?void 0:s.priority)==="high"?"bg-red-50 text-red-600":(s==null?void 0:s.priority)==="medium"?"bg-amber-50 text-amber-600":"bg-blue-50 text-blue-600"),children:[s==null?void 0:s.priority," Priority"]})]}),e.jsx(Ue,{children:e.jsx(B,{value:C,onChange:t=>f(t.target.value),className:"text-xl font-bold border-0 px-0 focus-visible:ring-0 h-auto shadow-none placeholder:text-slate-300",placeholder:"Task Title"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider",children:"Description"}),e.jsx(pe,{value:A,onChange:t=>b(t.target.value),className:"min-h-[100px] resize-none border-slate-200 focus-visible:ring-indigo-500 bg-slate-50/50 text-sm",placeholder:"Add a more detailed description..."}),s!=null&&s.controlDetails?e.jsxs("div",{className:"mt-2 bg-indigo-50/50 p-3 rounded-lg border border-indigo-100 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-3.5 h-3.5 text-indigo-500"}),e.jsx("span",{className:"text-xs font-bold text-indigo-700",children:"Related Control"}),e.jsx(D,{variant:"outline",className:"bg-white text-indigo-600 border-indigo-200 text-[10px] h-5",children:s.controlId})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-slate-800",children:s.controlDetails.name}),e.jsx("div",{className:"text-[11px] text-slate-500 mt-1 line-clamp-2",title:s.controlDetails.description,children:s.controlDetails.description})]})]}):(s==null?void 0:s.controlId)&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 bg-indigo-50/50 p-2 rounded border border-indigo-100",children:[e.jsx(Te,{className:"w-3.5 h-3.5 text-indigo-500"}),e.jsx("span",{className:"text-xs font-medium text-indigo-700",children:"Related Control:"}),e.jsx(D,{variant:"outline",className:"bg-white text-indigo-600 border-indigo-200 text-[10px] h-5",children:s.controlId})]})]}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider",children:"Subtasks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:se,disabled:N.isPending,className:"h-6 text-[10px] px-2 gap-1 text-indigo-600 border-indigo-200 hover:bg-indigo-50",children:[N.isPending?e.jsx(H,{className:"w-3 h-3 animate-spin"}):e.jsx(_,{className:"w-3 h-3"}),N.isPending?"Thinking...":"AI Generate"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-400",children:[V,"/",ie," completed"]})]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${le}%`}})}),e.jsx("div",{className:"space-y-2 mt-4",children:j.map(t=>e.jsxs("div",{className:"group flex items-center gap-3 p-2 rounded-lg hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100",children:[e.jsx(Ve,{checked:t.completed,onCheckedChange:()=>ae(t.id),className:"rounded-full data-[state=checked]:bg-indigo-600 data-[state=checked]:border-indigo-600"}),e.jsx("span",{className:E("flex-1 text-sm font-medium transition-colors",t.completed?"text-slate-400 line-through":"text-slate-700"),children:t.title}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>T(t.id),className:"h-6 w-6 opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition-opacity",children:e.jsx(He,{className:"w-3.5 h-3.5"})}),t.evidenceUrl?e.jsxs("a",{href:t.evidenceUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-[10px] bg-green-50 text-green-700 px-2 py-0.5 rounded border border-green-200 hover:underline",children:[e.jsx($e,{className:"w-3 h-3"}),"Evidence"]}):e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>X(t.id),className:"h-6 w-6 opacity-0 group-hover:opacity-100 text-slate-400 hover:text-blue-500 transition-opacity",title:"Attach Evidence",children:e.jsx(ss,{className:"w-3.5 h-3.5"})}),!t.evidenceUrl&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>Z(t),disabled:F.isPending,className:E("h-6 px-2 text-[10px] gap-1 transition-all",t.aiSolution?"bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 opacity-100":"opacity-0 group-hover:opacity-100 text-slate-400 hover:text-purple-500",F.isPending&&t.id===(w==null?void 0:w.id)&&"animate-pulse"),children:[F.isPending&&t.id===(w==null?void 0:w.id)?e.jsx(H,{className:"w-3 h-3 animate-spin"}):t.aiSolution?e.jsx(ts,{className:"w-3 h-3"}):e.jsx(G,{className:"w-3 h-3"}),t.aiSolution?"View Info":"AI Fix"]})]},t.id))}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Re,{className:"w-4 h-4 text-slate-400"}),e.jsx(B,{value:o,onChange:t=>d(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),a())},placeholder:"Add a subtask...",className:"border-0 shadow-none focus-visible:ring-0 px-0 bg-transparent placeholder:text-slate-400"})]})]})]}),e.jsxs(We,{className:"p-6 border-t border-slate-100 bg-slate-50/50",children:[e.jsx(u,{variant:"outline",onClick:()=>r(!1),className:"mr-2",children:"Cancel"}),e.jsx(u,{onClick:te,disabled:v.isLoading,className:"bg-indigo-600 hover:bg-indigo-700",children:v.isLoading?"Saving...":"Save Changes"})]}),e.jsx("input",{type:"file",ref:k,className:"hidden",onChange:Y}),e.jsx(ue,{open:K,onOpenChange:S,children:e.jsxs(ge,{className:"sm:max-w-3xl max-h-[80vh] flex flex-col p-0 overflow-hidden bg-white shadow-2xl",children:[e.jsxs(je,{className:"p-6 pb-2 border-b border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-1",children:[e.jsx(G,{className:"w-4 h-4 fill-purple-600"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-purple-500",children:"AI Remediation Result"})]}),e.jsx(fe,{className:"text-xl font-bold text-slate-900 leading-tight",children:w==null?void 0:w.title}),e.jsx(Ie,{className:"text-slate-500 text-xs",children:"Use the generated content below to complete this requirement."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50/30",children:I?e.jsx(pe,{value:p||"",onChange:t=>R(t.target.value),className:"min-h-[300px] w-full p-4 border-slate-200 focus-visible:ring-indigo-500 font-mono text-sm leading-relaxed",placeholder:"Edit AI solution content..."}):e.jsx("div",{className:"prose prose-sm max-w-none prose-slate prose-headings:text-slate-900 prose-p:text-slate-700 prose-a:text-indigo-600 prose-strong:text-slate-900",children:e.jsx(as,{children:p||""})})}),e.jsxs("div",{className:"p-4 border-t border-slate-100 bg-white flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-slate-400 font-medium italic",children:"Note: Review and customize this content before application."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>S(!1),children:"Close"}),e.jsxs(u,{variant:"secondary",size:"sm",onClick:()=>U(!I),className:E(I&&"bg-indigo-50 text-indigo-600 border-indigo-200"),children:[e.jsx(is,{className:"w-3.5 h-3.5 mr-2"}),I?"Preview":"Edit"]}),!I&&e.jsx(u,{variant:"secondary",size:"sm",onClick:()=>{navigator.clipboard.writeText(p||""),h.success("Content copied to clipboard")},children:"Copy"}),e.jsx(u,{size:"sm",onClick:ee,className:"bg-indigo-600 hover:bg-indigo-700",children:I?"Save & Attach":"Attach to Subtask"})]})]})]})})]})})}function Nt({planId:s,clientId:c}){var Y,X,Z,ee,se,te,ae;const[r,g]=x.useState("Plan"),[C,f]=x.useState(null),[A,b]=x.useState(!1),[j,l]=x.useState(!1),[o,d]=x.useState({title:"",description:"",priority:"medium",pdca:"Plan"}),v=y.useContext(),N=a=>a==="Plan"?"bg-blue-50 text-blue-800 hover:bg-blue-100 data-[state=active]:bg-blue-200 data-[state=active]:text-blue-900 border-blue-200":a==="Do"?"bg-amber-50 text-amber-800 hover:bg-amber-100 data-[state=active]:bg-amber-200 data-[state=active]:text-amber-900 border-amber-200":a==="Check"?"bg-violet-50 text-violet-800 hover:bg-violet-100 data-[state=active]:bg-violet-200 data-[state=active]:text-violet-900 border-violet-200":a==="Act"?"bg-emerald-50 text-emerald-800 hover:bg-emerald-100 data-[state=active]:bg-emerald-200 data-[state=active]:text-emerald-900 border-emerald-200":"bg-slate-50 text-slate-700 hover:bg-slate-100 border-slate-200",m=y.implementation.autoAssignPdca.useMutation({onSuccess:a=>{v.implementation.getPlan.invalidate(),h.success("Lifecycle Orchestrated",{description:`Decomposed requirements into ${a.updatedCount} PDCA tasks.`})},onError:a=>{h.error("Orchestration Failed",{description:a.message||"An unexpected error occurred."})}}),k=y.implementation.createTask.useMutation({onSuccess:()=>{v.implementation.getPlan.invalidate(),l(!1),d({title:"",description:"",priority:"medium",pdca:r==="framework"?"Plan":r}),h.success("Task created successfully")},onError:a=>{h.error("Failed to create task",{description:a.message})}}),{data:i,isLoading:n}=y.implementation.getPlan.useQuery({planId:s},{enabled:!!s}),p=(i==null?void 0:i.frameworkId)||0,{data:R,isLoading:K}=y.implementation.getFrameworkPhases.useQuery({frameworkId:p},{enabled:!!p});if(n||K)return e.jsx("div",{className:"p-10 text-center",children:"Loading plan details..."});if(!i)return e.jsx("div",{className:"p-10 text-center",children:"Plan not found"});const S=a=>{var le;const T=((le=i.tasks)==null?void 0:le.filter(t=>t.pdca===a))||[];if(T.length===0)return"upcoming";const V=T.filter(t=>t.status==="completed"||t.status==="done").length;return V===T.length?"completed":T.filter(t=>t.status==="in_progress").length>0||V>0?"current":"upcoming"},I=(R||[]).map(a=>({...a,status:S(a.name)})),U=I.length>0?I:[{id:1,name:"Plan",status:S("Plan"),description:"Establish context, scope, and risk assessment."},{id:2,name:"Do",status:S("Do"),description:"Implement risk treatment and controls."},{id:3,name:"Check",status:S("Check"),description:"Monitor, measure, analyze, and evaluate."},{id:4,name:"Act",status:S("Act"),description:"Corrective actions and continual improvement."}],w=((Y=i.tasks)==null?void 0:Y.filter(a=>a.pdca===r))||[],J=w.filter(a=>a.status==="completed"||a.status==="done").length,F=w.length>0?J/w.length*100:0;return e.jsx(es,{children:e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"border-b bg-white/50 backdrop-blur-md px-8 py-4 flex items-center justify-between sticky top-0 z-30",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(Qe,{href:`/clients/${c}/implementation`,children:e.jsxs("div",{className:"group flex items-center gap-2 text-slate-400 hover:text-indigo-600 transition-colors cursor-pointer",children:[e.jsx(ls,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Back to Plans"})]})}),e.jsx(me,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-extrabold text-slate-900 tracking-tight",children:i.title}),e.jsx(D,{className:"bg-indigo-500 text-white border-0 shadow-sm shadow-indigo-200",children:((X=i.framework)==null?void 0:X.shortCode)||"FW"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(D,{variant:"outline",className:"text-[10px] h-4 bg-slate-50 text-slate-500 border-slate-200 capitalize",children:i.status}),e.jsxs("span",{className:"text-[11px] text-slate-400 font-medium",children:[(Z=i.framework)==null?void 0:Z.name," Implementation"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{title:"PDCA Plan Manager",description:"Manage the full lifecycle of your implementation plan using PDCA methodology.",rationale:"PDCA (Plan-Do-Check-Act) ensures continuous improvement and strict control over compliance activities.",howToUse:[{step:"Plan",description:"Define objectives and assess risks."},{step:"Do",description:"Execute tasks and implement controls."},{step:"Check",description:"Monitor results and gather evidence."},{step:"Act",description:"Optimize and address non-conformities."},{step:"Orchestrate",description:"Use the 'Orchestrate AI Lifecycle' button to auto-generate tasks."}]}),e.jsx(u,{variant:"ghost",size:"sm",className:"text-slate-500 font-bold text-xs",onClick:()=>{const a=window.prompt("Update plan title:",i.title);a&&a!==i.title&&h.info("Pending title update...")},children:"Plan Details"}),e.jsx(me,{orientation:"vertical",className:"h-6"}),e.jsx(u,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg border-slate-200 shadow-sm",children:e.jsx(rs,{className:"w-4 h-4 text-slate-600"})})]})]}),e.jsx("div",{className:"flex-1 p-8 max-w-[1500px] mx-auto w-full font-sans",children:e.jsxs("div",{className:"grid grid-cols-12 gap-10 items-start",children:[e.jsx("div",{className:"col-span-12 lg:col-span-9 space-y-8",children:e.jsxs(Ke,{value:r,onValueChange:g,className:"w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 pb-2 mb-6",children:[e.jsxs(Je,{className:"bg-white/60 backdrop-blur-sm border border-slate-100 p-1 h-auto gap-2 rounded-xl shadow-sm",children:[["Plan","Do","Check","Act"].map(a=>e.jsxs(Ae,{value:a,className:E("rounded-full px-3 py-1.5 h-auto text-xs font-bold tracking-wide transition-all flex items-center gap-2 border shadow-sm",N(a)),children:[e.jsx("div",{className:E("w-2 h-2 rounded-full",S(a)==="completed"?"bg-emerald-500":S(a)==="current"?"bg-indigo-500 animate-pulse":"bg-slate-200")}),a]},a)),e.jsxs(Ae,{value:"framework",className:"rounded-full px-3 py-1.5 h-auto text-xs font-bold tracking-wide transition-all flex items-center gap-2 ml-2 border bg-slate-50 text-slate-700 hover:bg-slate-100 data-[state=active]:bg-slate-200 data-[state=active]:text-slate-900",children:[e.jsx(ns,{className:"w-4 h-4 text-indigo-500"}),"Methodology Board"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{d(a=>({...a,pdca:r==="framework"?"Plan":r})),l(!0)},className:"font-bold h-8 text-[11px] border-slate-200",children:[e.jsx(Re,{className:"w-3.5 h-3.5 mr-2"}),"Manual Add"]}),e.jsxs(u,{variant:"soft",size:"sm",onClick:()=>m.mutate({planId:s}),disabled:m.isPending,className:"bg-indigo-50 text-indigo-700 hover:bg-indigo-100 font-bold h-8 text-[11px]",children:[m.isPending?e.jsx(H,{className:"w-3.5 h-3.5 mr-2 animate-spin"}):e.jsx(_,{className:"w-3.5 h-3.5 mr-2"}),m.isPending?"Orchestrating...":"Orchestrate AI Lifecycle"]}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400",children:e.jsx(ms,{className:"w-4 h-4"})})]})]}),r!=="framework"?e.jsx(ke,{value:r,className:"mt-0 animate-in fade-in slide-in-from-left-2 duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(L,{className:"md:col-span-1 border-slate-200 shadow-sm bg-slate-50/30",children:[e.jsxs($,{children:[e.jsx(W,{className:"text-sm font-black text-slate-400 uppercase tracking-widest",children:"Phase Intelligence"}),e.jsx(he,{className:"text-xs font-medium text-slate-600 line-clamp-3 leading-relaxed",children:((ee=U.find(a=>a.name===r))==null?void 0:ee.description)||"Standard PDCA methodology phase."})]}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("span",{className:"text-3xl font-black text-slate-900 tabular-nums",children:[Math.round(F),"%"]}),e.jsxs("span",{className:"text-xs font-bold text-slate-400 uppercase",children:[J,"/",w.length," Completed"]})]}),e.jsx(be,{value:F,className:"h-2 bg-slate-100",indicatorClassName:"bg-indigo-600"})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl border border-slate-100 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-xs font-bold text-slate-900",children:"AI Readiness Probe"})]}),e.jsx("p",{className:"text-[11px] text-slate-500 leading-relaxed font-medium",children:"This phase focuses on the foundation of your ISMS. Complete the risk assessment tasks to unlock the next phase of implementation."})]})]})]}),e.jsx(L,{className:"md:col-span-2 border-slate-200 shadow-sm overflow-hidden",children:e.jsx(Ee,{className:"h-[550px]",children:e.jsx("div",{className:"divide-y divide-slate-100",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-20 text-center space-y-4",children:[e.jsx("div",{className:"p-4 bg-slate-50 rounded-full",children:e.jsx(os,{className:"w-8 h-8 text-slate-300"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"No Tasks Assigned"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add tasks manually or use the Smart Sync tool."})]})]}):w.map(a=>e.jsx("div",{onClick:()=>{f(a),b(!0)},className:"p-5 hover:bg-slate-50/50 transition-colors group cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"mt-1",children:a.status==="completed"||a.status==="done"?e.jsx(z,{className:"w-5 h-5 text-emerald-500"}):e.jsx(de,{className:"w-5 h-5 text-slate-300 group-hover:text-indigo-500 transition-colors"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:E("font-bold text-sm text-slate-900",(a.status==="completed"||a.status==="done")&&"text-slate-400 line-through"),children:a.title}),e.jsx(D,{variant:"outline",className:"text-[10px] h-4 border-slate-200 text-slate-400 capitalize bg-white",children:a.priority})]}),e.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-2",children:a.description}),a.subtasks&&a.subtasks.length>0&&e.jsx("div",{className:"flex items-center gap-1.5 mt-2.5",children:e.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded text-[10px] font-bold text-slate-500",children:[e.jsx(cs,{className:"w-3 h-3 text-slate-400"}),e.jsxs("span",{children:[a.subtasks.filter(T=>T.completed).length,"/",a.subtasks.length]})]})}),e.jsx("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-slate-50 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-[10px] font-bold text-indigo-600 hover:underline cursor-pointer",children:"Todo list"})})]})]})},a.id))})})})]})}):e.jsx(ke,{value:"framework",className:"mt-0 animate-in fade-in zoom-in-95 duration-500",children:e.jsx(gs,{planId:s,frameworkName:((se=i==null?void 0:i.framework)==null?void 0:se.name)||(i==null?void 0:i.linkedFramework)||"",tasks:(i==null?void 0:i.tasks)||[],phases:U,isLoading:n,frameworkId:p})})]})}),e.jsxs("div",{className:"col-span-12 lg:col-span-3 space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest px-1",children:"Optimization"}),e.jsx(js,{planId:s,frameworkId:i.frameworkId||0,planTitle:i.title})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest px-1",children:"Governance"}),e.jsx(fs,{clientId:s,frameworkId:i.frameworkId||0,frameworkName:((te=i.framework)==null?void 0:te.name)||"Compliance Framework"})]}),e.jsx(L,{className:"border-slate-100 shadow-sm overflow-hidden bg-slate-50/20",children:e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[11px] font-bold text-slate-500",children:"Resource Output"}),e.jsx(ds,{className:"w-3 h-3 text-slate-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Est. Effort"}),e.jsxs("span",{className:"font-bold text-slate-900",children:[(ae=i.tasks)==null?void 0:ae.reduce((a,T)=>a+(T.estimatedHours||0),0)," hrs"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-slate-400 font-medium",children:"Team Load"}),e.jsx("span",{className:"font-bold text-slate-900",children:"3 Experts"})]})]})]})}),e.jsxs(L,{className:"border-indigo-100 bg-indigo-50/20 shadow-sm",children:[e.jsx($,{className:"pb-2",children:e.jsxs(W,{className:"text-xs font-black text-indigo-900 flex items-center gap-2",children:[e.jsx(G,{className:"w-3 h-3"}),"STRATEGY PROBE"]})}),e.jsx(Q,{children:e.jsxs("p",{className:"text-[11px] text-indigo-800/80 leading-relaxed font-medium",children:["Based on your progress in the ",e.jsx("strong",{children:r})," phase, the AI suggests focusing on automated evidence collection for logic-based controls."]})})]})]})]})}),e.jsx(bs,{task:C,open:A,onOpenChange:b,onUpdate:()=>{v.implementation.getPlan.invalidate()}}),e.jsx(ue,{open:j,onOpenChange:l,children:e.jsxs(ge,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsx(fe,{children:"Add Manual Task"}),e.jsxs(Ie,{children:["Add a specific work item to your ",o.pdca," phase."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"title",children:"Task Title"}),e.jsx(B,{id:"title",placeholder:"e.g. Conduct internal vulnerability scan",value:o.title,onChange:a=>d({...o,title:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"description",children:"Description"}),e.jsx(pe,{id:"description",placeholder:"Detailed steps or requirements...",value:o.description,onChange:a=>d({...o,description:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{children:"PDCA Phase"}),e.jsxs(ye,{value:o.pdca,onValueChange:a=>d({...o,pdca:a}),children:[e.jsx(Ce,{children:e.jsx(Se,{placeholder:"Select phase"})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"Plan",children:"Plan"}),e.jsx(O,{value:"Do",children:"Do"}),e.jsx(O,{value:"Check",children:"Check"}),e.jsx(O,{value:"Act",children:"Act"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{children:"Priority"}),e.jsxs(ye,{value:o.priority,onValueChange:a=>d({...o,priority:a}),children:[e.jsx(Ce,{children:e.jsx(Se,{placeholder:"Select priority"})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"low",children:"Low"}),e.jsx(O,{value:"medium",children:"Medium"}),e.jsx(O,{value:"high",children:"High"}),e.jsx(O,{value:"critical",children:"Critical"})]})]})]})]})]}),e.jsxs(_e,{children:[e.jsx(u,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(u,{onClick:()=>k.mutate({planId:s,clientId:c,...o}),disabled:!o.title||k.isPending,children:k.isPending?"Creating...":"Create Task"})]})]})})]})})}export{Nt as default};
