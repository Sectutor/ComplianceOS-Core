import{ab as Q,b as G,r as b,t as A,i as R,j as e,x as I,z as _,c as m,C as M,d as L,e as T,m as q,aa as H,f as J,k as E,T as K,L as v,E as y,G as N,H as w,J as C,K as d,I as z}from"./index-DOc7Nwb7.js";import{T as l}from"./textarea-BtxBxzdY.js";import{P as Y}from"./progress-B-1k4ZZX.js";import{S as X}from"./separator-BWuYil37.js";import{A as Z,a as U,b as ee}from"./alert-BudCfM-X.js";import{B as se}from"./Breadcrumb-CRi3LAxS.js";import{A as ie}from"./arrow-left-CpuUojG-.js";import{C as ae}from"./clipboard-check-CQkJX5J0.js";import{S as W}from"./save-CvVmWchr.js";import{C as k}from"./circle-check-big-BSqJVrgh.js";import{C as te}from"./chevron-left-DZH-lUm7.js";import{I as re}from"./info-By5wLOUH.js";const g=[{id:"screening",title:"1. DPI Screening",description:"Identify if a DPI Assessment is mandatory"},{id:"description",title:"2. Description of Processing",description:"Nature, scope, context and purposes"},{id:"necessity",title:"3. Necessity & Proportionality",description:"Compliance and data subject rights"},{id:"risks",title:"4. Risk Identification",description:"Assessment of risks to rights and freedoms"},{id:"mitigation",title:"5. Mitigation Measures",description:"Measures to reduce or eliminate risks"},{id:"approval",title:"6. Approval / Review",description:"Final sign-off and review cycle"}];function Ce(){const{id:i,dpiaId:a}=Q(),[,s]=G(),r=parseInt(i||"0"),S=parseInt(a||"0"),[n,j]=b.useState(0),[h,D]=b.useState({}),{data:o,isLoading:B,refetch:O}=A.dpia.get.useQuery({id:S}),f=A.dpia.saveResponses.useMutation({onSuccess:()=>{R.success("Progress saved successfully"),O()},onError:c=>{R.error(`Failed to save progress: ${c.message}`)}});b.useEffect(()=>{o!=null&&o.questionnaireData&&D(o.questionnaireData)},[o]);const p=c=>{f.mutate({id:S,responses:h,status:c||(o==null?void 0:o.status)})},u=(c,x)=>{D($=>({...$,[c]:x}))},F=()=>{n<g.length-1&&(j(n+1),window.scrollTo(0,0))},V=()=>{n>0&&(j(n-1),window.scrollTo(0,0))},P=()=>Math.round((n+1)/g.length*100);return B?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-indigo-600"})}):o?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(se,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Privacy",href:`/clients/${r}/privacy`},{label:"DPIA",href:`/clients/${r}/privacy/dpia`},{label:"Assessment"}]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>s(`/clients/${r}/privacy/dpia`),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Back to DPI Assessments"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"h-6 w-6 text-indigo-600"}),(o==null?void 0:o.title)||"DPI Assessment"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comprehensive DPI Assessment"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>p(),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Save Draft"]}),e.jsx(m,{size:"sm",onClick:()=>p("under_review"),className:"bg-indigo-600 hover:bg-indigo-700",children:"Submit for Review"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"md:col-span-1 space-y-2",children:e.jsxs(M,{className:"sticky top-6",children:[e.jsxs(L,{className:"pb-3",children:[e.jsx(T,{className:"text-sm",children:"Assessment Progress"}),e.jsx(Y,{value:P(),className:"h-2 mt-2"}),e.jsxs("div",{className:"text-[10px] text-right text-muted-foreground mt-1",children:[P(),"% Complete"]})]}),e.jsx(q,{className:"p-2 pt-0",children:e.jsx("div",{className:"space-y-1",children:g.map((c,x)=>e.jsxs("button",{onClick:()=>j(x),className:`w-full text-left px-3 py-2.5 rounded-md text-sm transition-all flex items-center justify-between group ${n===x?"bg-indigo-50 text-indigo-700 font-medium border-l-4 border-indigo-600":"hover:bg-slate-50 text-slate-600 border-l-4 border-transparent"}`,children:[e.jsx("span",{className:"truncate",children:c.title}),n>x&&e.jsx(k,{className:"h-3 w-3 text-green-500"}),n===x&&e.jsx(H,{className:"h-3 w-3 text-indigo-400 group-hover:translate-x-0.5 transition-transform"})]},c.id))})})]})}),e.jsx("div",{className:"md:col-span-3 space-y-6",children:e.jsxs(M,{className:"shadow-sm border-slate-200",children:[e.jsx(L,{className:"border-b bg-slate-50/50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-xl text-slate-800",children:g[n].title}),e.jsx(J,{className:"mt-1",children:g[n].description})]}),e.jsxs(E,{variant:"outline",className:"bg-white border-slate-200 text-slate-500",children:["Section ",n+1," of 6"]})]})}),e.jsxs(q,{className:"p-8",children:[n===0&&e.jsx(ne,{responses:h,onUpdate:u}),n===1&&e.jsx(le,{responses:h,onUpdate:u,baseline:o}),n===2&&e.jsx(oe,{responses:h,onUpdate:u}),n===3&&e.jsx(ce,{responses:h,onUpdate:u}),n===4&&e.jsx(de,{responses:h,onUpdate:u,baseline:o}),n===5&&e.jsx(he,{responses:h,onUpdate:u})]}),e.jsx(X,{}),e.jsxs("div",{className:"p-4 flex justify-between items-center bg-slate-50/30",children:[e.jsxs(m,{variant:"ghost",onClick:V,disabled:n===0,className:"text-slate-500",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Previous Section"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>p(),disabled:f.isPending,children:[f.isPending?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4 mr-2"}),"Save Draft"]}),n<g.length-1?e.jsxs(m,{onClick:F,className:"bg-indigo-600 hover:bg-indigo-700 px-8",children:["Next Section",e.jsx(H,{className:"h-4 w-4 ml-1"})]}):e.jsxs(m,{onClick:()=>p("under_review"),className:"bg-green-600 hover:bg-green-700 px-8",children:["Finalize Assessment",e.jsx(k,{className:"h-4 w-4 ml-2"})]})]})]})]})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs(Z,{variant:"destructive",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(U,{children:"Error"}),e.jsx(ee,{children:"Assessment not found or you do not have permission to view it."})]})})}function t({label:i,description:a,children:s,required:r}){return e.jsxs("div",{className:"space-y-3 mb-8 last:mb-0",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(v,{className:"text-base font-semibold text-slate-800",children:[i," ",r&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a})]}),s]})}function ne({responses:i,onUpdate:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-100 p-4 rounded-lg flex gap-3 mb-6",children:[e.jsx(K,{className:"h-5 w-5 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold",children:"DPI Mandatory Triggers"}),e.jsx("p",{className:"mt-1",children:"Under GDPR, a DPI Assessment is required if the processing is likely to result in a high risk to the rights and freedoms of individuals."})]})]}),e.jsx(t,{label:"Systematic and Extensive Evaluation?",description:"Does the project involve systematic and extensive evaluation of personal aspects relating to natural persons which is based on automated processing, including profiling?",required:!0,children:e.jsx(l,{value:i.screeningEvaluation||"",onChange:s=>a("screeningEvaluation",s.target.value),placeholder:"Describe any profiling or automated decision-making..."})}),e.jsx(t,{label:"Large Scale Processing of Sensitive Data?",description:"Processing on a large scale of special categories of data (Article 9) or personal data relating to criminal convictions and offences (Article 10)?",required:!0,children:e.jsx(l,{value:i.screeningSensitive||"",onChange:s=>a("screeningSensitive",s.target.value),placeholder:"What special categories are involved? What is the scale?"})}),e.jsx(t,{label:"Systematic Monitoring of Publicly Accessible Areas?",description:"For example, CCTV or tracking of individuals in public places.",children:e.jsx(l,{value:i.screeningMonitoring||"",onChange:s=>a("screeningMonitoring",s.target.value),placeholder:"Describe any public space monitoring..."})}),e.jsx(t,{label:"New Technology?",description:"Does the project involve the use of new technologies and organizational solutions?",children:e.jsx(l,{value:i.screeningNewTech||"",onChange:s=>a("screeningNewTech",s.target.value),placeholder:"e.g. AI, Biometrics, IoT..."})})]})}function le({responses:i,onUpdate:a,baseline:s}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{label:"Nature of Processing",description:"How will you collect, use, store and delete data? What is the source of the data? Will you be sharing data with anyone?",required:!0,children:e.jsx(l,{value:i.descNature||(s==null?void 0:s.description)||"",onChange:r=>a("descNature",r.target.value),placeholder:"Describe the data flow and life cycle...",className:"min-h-[120px]"})}),e.jsx(t,{label:"Scope of Processing",description:"What is the nature of the data, and does it include special category or criminal offence data? How much data will you be collecting and using? How often?",required:!0,children:e.jsx(l,{value:i.descScope||(s==null?void 0:s.scope)||"",onChange:r=>a("descScope",r.target.value),placeholder:"Specify categories, volume, frequency, and duration...",className:"min-h-[120px]"})}),e.jsx(t,{label:"Context of Processing",description:"What is the nature of your relationship with the individuals? How much control will they have? Would they expect you to use their data in this way?",children:e.jsx(l,{value:i.descContext||"",onChange:r=>a("descContext",r.target.value),placeholder:"Expectations, vulnerability of data subjects, state of tech..."})}),e.jsx(t,{label:"Purposes of Processing",description:"What do you want to achieve? What are the intended outcomes for individuals? What are the benefits for you or for society as a whole?",children:e.jsx(l,{value:i.descPurpose||"",onChange:r=>a("descPurpose",r.target.value),placeholder:"Specific objectives and benefits..."})})]})}function oe({responses:i,onUpdate:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{label:"Compliance with Legal Basis",description:"What is your lawful basis for processing? How does the processing help to achieve your purpose? Is there another way to achieve the same outcome?",required:!0,children:e.jsx(l,{value:i.necessityBasis||"",onChange:s=>a("necessityBasis",s.target.value),placeholder:"Lawful basis (Art. 6) and necessity argument..."})}),e.jsx(t,{label:"Data Minimization and Quality",description:"How will you ensure that you only use the minimum amount of personal data? How will you help to support data quality?",required:!0,children:e.jsx(l,{value:i.necessityMinimization||"",onChange:s=>a("necessityMinimization",s.target.value),placeholder:"Steps taken to minimize data collection..."})}),e.jsx(t,{label:"Transparency and Rights",description:"How will you provide privacy information to individuals? How will you help to support their rights?",children:e.jsx(l,{value:i.necessityRights||"",onChange:s=>a("necessityRights",s.target.value),placeholder:"Privacy notices, access requests, portability..."})}),e.jsx(t,{label:"Processor Management",description:"If you use a data processor, what are your data protection arrangements with them (contractual requirements)?",children:e.jsx(l,{value:i.necessityProcessors||"",onChange:s=>a("necessityProcessors",s.target.value),placeholder:"DPA availability, sub-processor monitoring..."})})]})}function ce({responses:i,onUpdate:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 p-4 rounded-lg flex gap-3",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold",children:"Risk Methodology"}),e.jsx("p",{className:"mt-1",children:"Describe the source of risk and the nature of potential impact on individuals, then evaluate likelihood and severity."})]})]}),e.jsx(t,{label:"Identification of Risks",description:"Describe the potential for unauthorized access, data loss, identity theft, or any other impact on individuals.",required:!0,children:e.jsx(l,{value:i.riskDetails||"",onChange:s=>a("riskDetails",s.target.value),placeholder:"List specific risks to rights and freedoms...",className:"min-h-[150px]"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Likelihood of Harm"}),e.jsxs(y,{value:i.riskLikelihood||"medium",onValueChange:s=>a("riskLikelihood",s),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(d,{value:"low",children:"Low (Remote)"}),e.jsx(d,{value:"medium",children:"Medium (Possible)"}),e.jsx(d,{value:"high",children:"High (Probable)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Severity of Impact"}),e.jsxs(y,{value:i.riskSeverity||"medium",onValueChange:s=>a("riskSeverity",s),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(d,{value:"low",children:"Low (Minimal impact)"}),e.jsx(d,{value:"medium",children:"Medium (Moderate harm)"}),e.jsx(d,{value:"high",children:"High (Significant harm)"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded border border-dashed border-slate-200",children:[e.jsx(v,{className:"text-slate-500 uppercase text-[10px] tracking-wider mb-2 block",children:"Inherent Risk Rating"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(E,{className:i.riskSeverity==="high"||i.riskLikelihood==="high"?"bg-red-100 text-red-600 hover:bg-red-100":"bg-blue-100 text-blue-600 hover:bg-blue-100",children:i.riskSeverity==="high"||i.riskLikelihood==="high"?"High Risk":"Medium/Low Risk"})})]})]})}function de({responses:i,onUpdate:a,baseline:s}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{label:"Mitigation Measures",description:"What measures are in place to reduce or eliminate each of the identified risks? This includes technical (encryption) and organizational (policy) controls.",required:!0,children:e.jsx(l,{value:i.mitigationDetails||(s==null?void 0:s.mitigationMeasures)||"",onChange:r=>a("mitigationDetails",r.target.value),placeholder:"Describe specific controls and safeguards...",className:"min-h-[150px]"})}),e.jsx(t,{label:"Residual Risk Assessment",description:"After taking the above measures, is the residual risk now acceptable? Are there any remaining high risks?",children:e.jsx(l,{value:i.mitigationResidual||"",onChange:r=>a("mitigationResidual",r.target.value),placeholder:"Remaining impact after controls are applied..."})}),e.jsx(t,{label:"DPO Consultation Needed?",description:"Does the residual risk remain high such that you must consult the DPA (Supervisory Authority)?",children:e.jsxs(y,{value:i.mitigationConsultation||"no",onValueChange:r=>a("mitigationConsultation",r),children:[e.jsx(N,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(d,{value:"no",children:"No - Residual risk is low/authorized"}),e.jsx(d,{value:"yes",children:"Yes - Residual risk remains high (Article 36)"})]})]})})]})}function he({responses:i,onUpdate:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-100 p-4 rounded-lg flex gap-3",children:[e.jsx(k,{className:"h-5 w-5 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-semibold",children:"Ready for Review"}),e.jsx("p",{className:"mt-1",children:"Please ensure all mandatory fields are completed before submitting for final internal sign-off."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(t,{label:"Assigned Reviewer (DPO/CISO)",required:!0,children:e.jsx(z,{value:i.approvalReviewer||"",onChange:s=>a("approvalReviewer",s.target.value),placeholder:"Name of the person reviewing..."})}),e.jsx(t,{label:"Review Target Date",required:!0,children:e.jsx(z,{type:"date",value:i.approvalDate||"",onChange:s=>a("approvalDate",s.target.value)})})]}),e.jsx(t,{label:"DPO Recommendations",description:"Summary of the Data Protection Officer's advice (Article 35(2)).",children:e.jsx(l,{value:i.approvalDpoAdvice||"",onChange:s=>a("approvalDpoAdvice",s.target.value),placeholder:"Attach or summarize DPO feedback..."})}),e.jsx(t,{label:"Management Decision",description:"Final decision from management to proceed with the processing activity.",children:e.jsx(l,{value:i.approvalDecision||"",onChange:s=>a("approvalDecision",s.target.value),placeholder:"Record the official board or management decision..."})})]})}export{Ce as default};
