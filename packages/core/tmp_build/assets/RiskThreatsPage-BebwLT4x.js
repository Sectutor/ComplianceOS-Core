import{ab as $,u as z,b as B,r as y,ac as E,t as h,R as M,j as e,c as f,C as w,d as N,e as v,m as T,k,I as Q}from"./index-DOc7Nwb7.js";import{D as U}from"./DashboardLayout-aHnUqq57.js";import{B as G}from"./Breadcrumb-CRi3LAxS.js";import{P as q}from"./PageGuide-CPKKXXS6.js";import{A as F}from"./arrow-left-CpuUojG-.js";import{P as H}from"./plus-BaQ35Jcx.js";import{G as O}from"./globe-BMGZmoaJ.js";import{T as V}from"./trending-up-eUiO956o.js";import{S as Y}from"./search-CwuIBBPE.js";import{A as J,a as W}from"./arrow-up-B1n-fuue.js";import{A as X}from"./arrow-up-down-BDk2lJRe.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";function Fe(){const g=$(),C=g.id?Number(g.id):null,{user:Z}=z(),[_,p]=B(),[d,L]=y.useState(""),{selectedClientId:I}=E(),u=C||I,{data:o,isLoading:ee}=h.clients.get.useQuery({id:u||0},{enabled:!!u}),i=(o==null?void 0:o.id)||0,{data:x,isLoading:A,refetch:se}=h.risks.getThreats.useQuery({clientId:i},{enabled:!!i}),{data:l}=h.adversaryIntel.getSummary.useQuery(void 0,{staleTime:1e3*60*30}),b=(l==null?void 0:l.topTags)||[],R=s=>s?b.some(a=>s.toLowerCase().includes(a.tag.toLowerCase())):!1,[t,D]=y.useState(null),S=s=>{let a="asc";t&&t.key===s&&t.direction==="asc"&&(a="desc"),D({key:s,direction:a})},r=({label:s,sortKey:a})=>{const n=(t==null?void 0:t.key)===a;return e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors select-none group",onClick:()=>S(a),children:e.jsxs("div",{className:"flex items-center gap-2",children:[s,n?(t==null?void 0:t.direction)==="asc"?e.jsx(J,{className:"w-3.5 h-3.5"}):e.jsx(W,{className:"w-3.5 h-3.5"}):e.jsx(X,{className:"w-3.5 h-3.5 opacity-0 group-hover:opacity-50 transition-opacity"})]})})},j=M.useMemo(()=>{let s=(x==null?void 0:x.filter(a=>{var n;return a.name.toLowerCase().includes(d.toLowerCase())||a.threatId.toLowerCase().includes(d.toLowerCase())||((n=a.category)==null?void 0:n.toLowerCase().includes(d.toLowerCase()))}))||[];return t!==null&&s.sort((a,n)=>{let m=a[t.key],c=n[t.key];return typeof m=="string"&&(m=m.toLowerCase(),c=(c==null?void 0:c.toLowerCase())||""),m<c?t.direction==="asc"?-1:1:m>c?t.direction==="asc"?1:-1:0}),s},[x,d,t]),K=()=>{p(`/clients/${i}/risks/threats/new`)},P=s=>{p(`/clients/${i}/risks/threats/${s.id}`)};return e.jsx(U,{children:e.jsxs("div",{className:"space-y-6 w-full max-w-full p-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(G,{items:[{label:"Clients",href:"/clients"},{label:(o==null?void 0:o.name)||"Client",href:`/clients/${i}`},{label:"Risk Management",href:`/clients/${i}/risks`},{label:"Threat Library",href:`/clients/${i}/risks/threats`}]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"mt-2 -ml-3 text-muted-foreground hover:text-foreground",onClick:()=>p(`/clients/${i}/risks`),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Back to Risk Dashboard"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Threat Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage standard threat scenarios and categories."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:K,className:"bg-orange-600 hover:bg-orange-700 text-white",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Record Threat"]}),e.jsx(q,{title:"Threat Library",description:"A comprehensive database of potential threat scenarios relevant to your organization.",rationale:"Threats are the 'cause' in the risk equation (Risk = Asset x Threat x Vulnerability). Maintaining a library helps standardize risk assessments and ensures no major attack vectors are overlooked.",howToUse:[{step:"Browse Library",description:"Use the table to view potential threats like Ransomware, Insider Threats, or Floods."},{step:"Record Threats",description:"Add new custom threats or specific scenarios faced by your industry."},{step:"Analyze Trends",description:"The top cards show real-world trending attacks from global intelligence feeds."}],integrations:[{name:"Risk Assessment",description:"You will select from this library when creating new risk scenarios."},{name:"MITRE ATT&CK",description:"Threats are mapped to MITRE TTPs (Tactics, Techniques, and Procedures) for standardized classification."}]})]})]}),l&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(w,{className:"bg-gradient-to-r from-slate-900 to-slate-800 text-white border-0",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(v,{className:"text-lg flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-blue-400"}),"Global Threat Landscape"]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"Active Critical Alerts"}),e.jsx("p",{className:"text-3xl font-bold text-red-500",children:l.criticalItems})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"Total Feed Items"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:l.feedItems})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"Recent CVEs"}),e.jsx("p",{className:"text-3xl font-bold text-amber-500",children:l.recentCves.length})]})]})})]}),e.jsxs(w,{className:"border-slate-200",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(v,{className:"text-sm font-medium flex items-center gap-2 text-slate-600",children:[e.jsx(V,{className:"w-4 h-4"}),"Trending Threat Categories"]})}),e.jsx(T,{children:e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:b.slice(0,8).map(s=>e.jsxs(k,{variant:"secondary",className:"bg-slate-100 text-slate-700 hover:bg-slate-200",children:[s.tag,e.jsxs("span",{className:"ml-1.5 text-xs text-slate-400",children:["(",s.count,")"]})]},s.tag))})})]})]}),e.jsx("div",{className:"flex gap-4 items-center bg-card p-4 rounded-xl border shadow-sm",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Q,{placeholder:"Search threats...",value:d,onChange:s=>L(s.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#1C4D8D]",children:[e.jsx(r,{label:"ID",sortKey:"threatId"}),e.jsx(r,{label:"Threat Name",sortKey:"name"}),e.jsx(r,{label:"Category",sortKey:"category"}),e.jsx(r,{label:"Source/Actor",sortKey:"source"}),e.jsx(r,{label:"Likelihood",sortKey:"likelihood"}),e.jsx(r,{label:"Impact",sortKey:"potentialImpact"}),e.jsx(r,{label:"Status",sortKey:"status"}),e.jsx(r,{label:"Owner",sortKey:"owner"}),e.jsx(r,{label:"Last Review",sortKey:"lastReviewDate"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:A?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 bg-white",children:"Loading threats..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 bg-white",children:"No threats found."})}):j.map(s=>e.jsxs("tr",{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm cursor-pointer group",onDoubleClick:()=>P(s),children:[e.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-500",children:s.threatId}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-black",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[200px]",title:s.description||"",children:s.description})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200",children:s.category}),R(s.category)&&e.jsx(k,{className:"bg-red-100 text-red-600 border-red-200 hover:bg-red-100 h-5 text-[10px] px-1.5",children:"Trending"})]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[s.source," ",e.jsxs("span",{className:"text-gray-400 text-xs",children:["(",s.intent,")"]})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.likelihood}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 max-w-[200px] truncate",title:s.potentialImpact||"",children:s.potentialImpact||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium capitalize border ${s.status==="active"?"bg-orange-50 text-orange-700 border-orange-200":s.status==="monitored"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.owner||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.lastReviewDate?new Date(s.lastReviewDate).toLocaleDateString():"-"})]},s.id))})]})})})]})})}export{Fe as default};
