import{ab as $,b as F,r as x,t as M,j as e,c as w,I as V,E as v,G as b,H as y,J as k,K as t,S as h,C as E,m as z,N as H,O,P as c,Q as r,V as U,W as a,aq as _,T as q,k as p}from"./index-DOc7Nwb7.js";import{D as G}from"./DashboardLayout-aHnUqq57.js";import{B as Q}from"./Breadcrumb-CRi3LAxS.js";import{P as J}from"./PageGuide-CPKKXXS6.js";import{c as K}from"./utils-BC5CVi_C.js";import{A as W}from"./arrow-left-CpuUojG-.js";import{S as X}from"./search-CwuIBBPE.js";import{F as Y}from"./filter-Ceo--4mb.js";import{C as Z}from"./calendar-BlLJlGbj.js";import{A as ee}from"./arrow-right-M96iV-v9.js";import{B as se}from"./ban-TJUJ_p7U.js";import{C as te}from"./circle-check-big-BSqJVrgh.js";import{f as ae}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./separator-BWuYil37.js";import"./info-By5wLOUH.js";import"./differenceInCalendarDays-nctqlg7V.js";function Ke(){const u=$(),i=u.id?parseInt(u.id):0,[re,g]=F(),[n,T]=x.useState(""),[o,C]=x.useState("all"),[m,S]=x.useState("all"),{data:d,isLoading:A}=M.risks.getAllTreatments.useQuery({clientId:i},{enabled:!!i}),l=d==null?void 0:d.filter(s=>{var j,f,N;const R=((j=s.strategy)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))||((f=s.riskTitle)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))||((N=s.owner)==null?void 0:N.toLowerCase().includes(n.toLowerCase())),D=o==="all"||s.status===o,B=m==="all"||s.treatmentType===m;return R&&D&&B}),I=s=>{switch(s){case"mitigate":return e.jsx(h,{className:"w-4 h-4 text-blue-600"});case"transfer":return e.jsx(q,{className:"w-4 h-4 text-orange-600"});case"accept":return e.jsx(te,{className:"w-4 h-4 text-green-600"});case"avoid":return e.jsx(se,{className:"w-4 h-4 text-red-600"});default:return e.jsx(h,{className:"w-4 h-4 text-slate-600"})}},L=s=>{switch(s){case"completed":case"implemented":return e.jsx(p,{className:"bg-green-100 text-green-800 hover:bg-green-100 border-green-200",children:"Implemented"});case"in_progress":return e.jsx(p,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100 border-blue-200",children:"In Progress"});case"planned":default:return e.jsx(p,{variant:"outline",className:"text-slate-600",children:"Planned"})}},P=s=>s?isNaN(Number(s))?s:`$${Number(s).toLocaleString()}`:"-";return e.jsxs(G,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[" ",e.jsx(Q,{items:[{label:"Risk Management",href:`/clients/${i}/risks`},{label:"Treatment Plan"}]})]})}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs(w,{variant:"ghost",size:"sm",className:"-ml-3 text-muted-foreground hover:text-foreground",onClick:()=>g(`/clients/${i}/risks`),children:[e.jsx(W,{className:"w-4 h-4 mr-1"})," Back to Risk Dashboard"]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"Risk Treatment Plan"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track and manage risk mitigation strategies, action plans, and remediation efforts."})]}),e.jsx(J,{title:"Risk Treatment Plan",description:"Manage the actions required to reduce risk to an acceptable level.",rationale:"Identifying risk is useless without action. This plan tracks who is doing what by when.",howToUse:[{step:"Filter by Status",description:"check 'In Progress' or 'Overdue' items during weekly meetings."},{step:"Review Strategy",description:"Ensure high-priority risks are being 'Mitigated' or 'Avoided' rather than just 'Accepted'."},{step:"Track Costs",description:"Use the cost field to budget for security improvements."}],integrations:[{name:"Risk Assessments",description:"Treatments are created directly within the Risk Assessment workflow."},{name:"Tasks",description:"Treatment actions can be synced to the main task manager."}]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white p-4 rounded-lg border shadow-sm flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search treatments, risks, or owners...",value:n,onChange:s=>T(s.target.value),className:"pl-9"})]}),e.jsxs(v,{value:o,onValueChange:C,children:[e.jsxs(b,{className:"w-[180px]",children:[e.jsx(Y,{className:"w-4 h-4 mr-2 text-muted-foreground"}),e.jsx(y,{placeholder:"Status"})]}),e.jsxs(k,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"planned",children:"Planned"}),e.jsx(t,{value:"in_progress",children:"In Progress"}),e.jsx(t,{value:"implemented",children:"Implemented"})]})]}),e.jsxs(v,{value:m,onValueChange:S,children:[e.jsxs(b,{className:"w-[180px]",children:[e.jsx(h,{className:"w-4 h-4 mr-2 text-muted-foreground"}),e.jsx(y,{placeholder:"Type"})]}),e.jsxs(k,{children:[e.jsx(t,{value:"all",children:"All Types"}),e.jsx(t,{value:"mitigate",children:"Mitigate"}),e.jsx(t,{value:"transfer",children:"Transfer"}),e.jsx(t,{value:"accept",children:"Accept"}),e.jsx(t,{value:"avoid",children:"Avoid"})]})]})]}),e.jsx(E,{children:e.jsx(z,{className:"p-0",children:e.jsxs(H,{children:[e.jsx(O,{children:e.jsxs(c,{className:"bg-slate-50 hover:bg-slate-50",children:[e.jsx(r,{className:"w-[30%]",children:"Risk & Strategy"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Owner"}),e.jsx(r,{children:"Due Date"}),e.jsx(r,{children:"Cost"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"text-right",children:"Action"})]})}),e.jsx(U,{children:A?e.jsx(c,{children:e.jsx(a,{colSpan:7,className:"h-24 text-center",children:"Loading..."})}):(l==null?void 0:l.length)===0?e.jsx(c,{children:e.jsx(a,{colSpan:7,className:"h-32 text-center text-muted-foreground",children:"No treatments found matching your criteria."})}):l==null?void 0:l.map(s=>e.jsxs(c,{className:"group",children:[e.jsx(a,{className:"align-top py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-900 line-clamp-2",children:s.strategy}),e.jsx(_,{href:`/clients/${i}/risks/assessments/${s.riskAssessmentId}`,children:e.jsxs("div",{className:"text-xs text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1 cursor-pointer w-fit",children:["Risk: ",s.riskTitle," (",s.riskId,")"]})})]})}),e.jsx(a,{className:"align-top py-4",children:e.jsxs("div",{className:"flex items-center gap-2 capitalize text-sm font-medium",children:[I(s.treatmentType||""),s.treatmentType]})}),e.jsx(a,{className:"align-top py-4",children:s.owner?e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs font-semibold text-slate-600",children:s.owner.charAt(0).toUpperCase()}),s.owner]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(a,{className:"align-top py-4",children:s.dueDate?e.jsxs("div",{className:K("flex items-center gap-2 text-sm",new Date(s.dueDate)<new Date&&s.status!=="implemented"?"text-red-600 font-medium":"text-slate-600"),children:[e.jsx(Z,{className:"w-4 h-4"}),ae(new Date(s.dueDate),"MMM d, yyyy")]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(a,{className:"align-top py-4",children:e.jsx("div",{className:"text-sm font-mono text-slate-600",children:P(s.estimatedCost)})}),e.jsx(a,{className:"align-top py-4",children:L(s.status||"planned")}),e.jsx(a,{className:"align-top py-4 text-right",children:e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>g(`/clients/${i}/risks/assessments/${s.riskAssessmentId}`),children:["View Risk ",e.jsx(ee,{className:"w-4 h-4 ml-1"})]})})]},s.id))})]})})})]})}export{Ke as default};
