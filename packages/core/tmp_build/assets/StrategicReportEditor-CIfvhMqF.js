import{ab as L,r as l,t as u,i as r,j as e,x as v,aq as $,c,I as k,F as A}from"./index-DOc7Nwb7.js";import{R as F}from"./RichTextEditor-NQxhVz6n.js";import{a as T,F as I}from"./FileSaver.min-dLwv_bIh.js";import{D as O}from"./DashboardLayout-aHnUqq57.js";import{A as U}from"./arrow-left-CpuUojG-.js";import{D as _}from"./download-ByfWg1Mi.js";import{S as z}from"./save-CvVmWchr.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";function Ce(){const f=L(),d=parseInt(f.reportId||"0"),j=parseInt(f.id||"0"),[i,g]=l.useState(""),[m,p]=l.useState(""),[h,x]=l.useState(!1),{data:t,isLoading:y,refetch:N}=u.reports.getReport.useQuery({reportId:d});l.useEffect(()=>{if(t)if(g(t.title),t.content)p(t.content);else{const s=`
                    <h1>${t.title}</h1>
                    <p><strong>Version:</strong> ${t.version||"draft"}</p>
                    <p><strong>Generated:</strong> ${new Date(t.generatedAt).toLocaleDateString()}</p>
                    <hr>
                    <h2>Report Content</h2>
                    <p>This report was generated as a DOCX/PDF file. You can now edit it here in the rich text editor.</p>
                    <p>Changes you make will be saved as HTML content in the database.</p>
                    <p>You can still download the original generated file using the "Download Original" button.</p>
                `;p(s)}},[t]);const C=u.reports.updateReport.useMutation({onSuccess:()=>{r.success("Report saved successfully"),x(!1),N()},onError:s=>{r.error(`Failed to save: ${s.message}`),x(!1)}}),D=()=>{x(!0),C.mutate({reportId:d,title:i,content:m})},R=async()=>{try{const s=`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${i}</title>
                    <style>
                        body { font-family: 'Arial', sans-serif; line-height: 1.6; }
                        h1 { font-size: 24px; color: #333; }
                        h2 { font-size: 20px; color: #444; margin-top: 20px; }
                        p { margin-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    ${m}
                </body>
                </html>
            `,o=await T(s);I.saveAs(o,`${i.replace(/\s+/g,"_")}_Report.docx`),r.success("Export started")}catch(s){console.error(s),r.error("Failed to export document")}};return y?e.jsx("div",{className:"flex justify-center items-center h-screen bg-slate-50",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):t?e.jsx(O,{children:e.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 px-8 py-4 flex justify-between items-center sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx($,{href:`/clients/${j}/roadmap/reports`,children:e.jsx(c,{variant:"ghost",size:"icon",className:"text-slate-500 hover:text-slate-900",children:e.jsx(U,{className:"h-5 w-5"})})}),e.jsx("div",{className:"w-px h-8 bg-slate-200"}),e.jsxs("div",{children:[e.jsx(k,{value:i,onChange:s=>g(s.target.value),className:"text-lg font-semibold border-none shadow-none focus-visible:ring-0 px-0 h-auto"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"bg-slate-100 rounded px-1.5 py-0.5 font-medium",children:"Draft"}),e.jsxs("span",{children:["â€¢ Last saved ",new Date().toLocaleTimeString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",onClick:R,title:"Export edited content as DOCX",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Export Edited"]}),e.jsxs(c,{variant:"outline",onClick:async()=>{try{const s=await u.reports.downloadReport.query({reportId:d}),o=atob(s.data),b=new Array(o.length);for(let n=0;n<o.length;n++)b[n]=o.charCodeAt(n);const S=new Uint8Array(b),E=new Blob([S],{type:s.mimeType}),w=window.URL.createObjectURL(E),a=document.createElement("a");a.href=w,a.download=s.fileName||`${t==null?void 0:t.title.replace(/\s+/g,"_")}_${(t==null?void 0:t.version)||"v1.0"}.docx`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(w),document.body.removeChild(a),r.success("Original report downloaded successfully")}catch(s){console.error("Download failed:",s),r.error("Failed to download original report")}},title:"Download original generated file",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Download Original"]}),e.jsxs(c,{onClick:D,disabled:h,className:"min-w-[100px]",children:[h?e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(z,{className:"mr-2 h-4 w-4"}),h?"Saving...":"Save"]})]})]}),e.jsx("div",{className:"flex-1 max-w-5xl w-full mx-auto p-8",children:e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 min-h-[800px]",children:e.jsx(F,{value:m,onChange:p,className:"min-h-[800px] border-none"})})})]})}):e.jsx("div",{children:"Report not found"})}export{Ce as default};
