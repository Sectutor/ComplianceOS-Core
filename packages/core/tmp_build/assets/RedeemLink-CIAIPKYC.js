import{b as z,t as h,u as D,r as j,i as c,j as e,C as g,d as N,z as f,e as v,f as w,ay as y,c as n,aq as u,x as C,m as $,S as q,U as O,L as k,I}from"./index-DOc7Nwb7.js";import{C as W}from"./circle-check-C5kiwRoG.js";import{R as B}from"./rocket-C2MuHhsn.js";function V(){var P,F,R;const A=new URLSearchParams(window.location.search),l=A.get("token"),L=A.get("clientId"),p=L?parseInt(L,10):void 0,S=p!==void 0&&!isNaN(p)?p:void 0,[,d]=z(),{data:r}=h.users.me.useQuery(),{data:a,isLoading:E,error:o}=h.magicLinks.get.useQuery({token:l||""},{enabled:!!l}),{signIn:T}=D(),[t,m]=j.useState({name:"",password:"",email:""}),[Q,Y]=j.useState(!1);j.useEffect(()=>{a!=null&&a.email&&m(s=>({...s,email:a.email}))},[a]);const b=h.users.applyMagicLink.useMutation({onSuccess:()=>{c.success("Welcome aboard! Your benefits have been applied."),d("/dashboard")},onError:s=>{c.error(s.message)}}),x=h.users.acceptInviteAndSignup.useMutation({onSuccess:async()=>{c.success("Account created! Signing you in...");try{await T(t.email,t.password),d("/dashboard")}catch{c.error("Account created, but failed to sign in automatically. Please login."),d("/auth/login")}},onError:s=>{var i;((i=s.data)==null?void 0:i.code)==="CONFLICT"?c.error(s.message,{action:{label:"Sign In",onClick:()=>d(`/auth/login?invite=${l}&email=${encodeURIComponent(t.email)}`)},duration:1e4}):c.error(s.message)}}),M=()=>{l&&b.mutate({token:l,clientId:S})},U=s=>{s.preventDefault(),l&&x.mutate({token:l,clientId:S,name:t.name,password:t.password,email:t.email})};return l?E?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(C,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-500 animate-pulse font-medium",children:"Validating your invitation..."})]})}):o||!a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-4",children:e.jsxs(g,{className:"max-w-md w-full border-none shadow-2xl",children:[e.jsxs(N,{className:"text-center",children:[e.jsx(f,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx(v,{className:"text-2xl font-bold",children:"Link Expired or Invalid"}),e.jsx(w,{children:(o==null?void 0:o.message)||"This invitation link is no longer active or has already been used."})]}),e.jsx(y,{children:e.jsx(n,{asChild:!0,className:"w-full",children:e.jsx(u,{to:"/auth/login",children:"Back to Login"})})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-4",children:e.jsxs(g,{className:"max-w-lg w-full border-none shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"h-2 bg-gradient-to-r from-blue-600 to-indigo-600"}),e.jsxs(N,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-blue-50 h-16 w-16 rounded-full flex items-center justify-center mb-4",children:e.jsx(W,{className:"h-10 text-blue-600"})}),e.jsx(v,{className:"text-3xl font-extrabold text-slate-900 leading-tight",children:"Exclusive Invitation"}),e.jsx(w,{className:"text-base text-slate-500 mt-2",children:a.label||"You've been invited to join ComplianceOS"})]}),e.jsxs($,{className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 border border-slate-100 shadow-inner",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:"What's included"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"mt-1 p-2 bg-white rounded-lg shadow-sm",children:e.jsx(B,{className:"h-5 w-5 text-indigo-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-800 capitalize",children:[a.planTier," Plan Access"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Premium compliance features unlocked."})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"mt-1 p-2 bg-white rounded-lg shadow-sm",children:e.jsx(q,{className:"h-5 w-5 text-emerald-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-800 capitalize",children:[a.role," Permissions"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Full access to manage your compliance roadmap."})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"mt-1 p-2 bg-white rounded-lg shadow-sm",children:e.jsx(O,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-800",children:[a.maxClients," Workspace Capacity"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage multiple organizations seamlessly."})]})]})]})]}),!r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Create your account to accept this invitation."})}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"name",children:"Full Name"}),e.jsx(I,{id:"name",placeholder:"John Doe",value:t.name,onChange:s=>m(i=>({...i,name:s.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"email",children:"Email Address"}),e.jsx(I,{id:"email",type:"email",placeholder:"john@company.com",value:t.email,onChange:s=>m(i=>({...i,email:s.target.value})),disabled:!!a.email,className:a.email?"bg-slate-100 text-slate-500":"",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"password",children:"Create Password"}),e.jsx(I,{id:"password",type:"password",placeholder:"••••••••",value:t.password,onChange:s=>m(i=>({...i,password:s.target.value})),minLength:6,required:!0})]}),((F=(P=x.error)==null?void 0:P.data)==null?void 0:F.code)==="CONFLICT"&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{className:"h-5 w-5 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-amber-900",children:"Account Found"}),e.jsxs("p",{className:"text-xs text-amber-700 leading-relaxed",children:["An account already exists for ",t.email,". Please sign in to accept this invitation with your existing credentials."]})]})]}),e.jsxs(n,{type:"button",variant:"outline",className:"w-full border-amber-200 hover:bg-amber-100 text-amber-900 font-bold",onClick:()=>d(`/auth/login?invite=${l}&email=${encodeURIComponent(t.email)}`),children:["Sign In with ",t.email]})]}),e.jsx(n,{type:"submit",className:"w-full h-12 bg-blue-600 hover:bg-blue-700 font-bold shadow-md",disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):"Create Account & Redeem"})]}),e.jsxs("div",{className:"text-center border-t border-slate-100 pt-4",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Already have an account?"}),e.jsx(n,{asChild:!0,variant:"link",className:"text-blue-600 font-semibold p-0 h-auto",children:e.jsx(u,{to:`/auth/login?invite=${l}`,children:"Sign in to redeem"})})]})]}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold",children:((R=r.name)==null?void 0:R.charAt(0))||r.email.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase tracking-wider",children:"Signed in as"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 truncate max-w-[150px]",children:r.email})]})]}),e.jsx(n,{variant:"ghost",size:"sm",asChild:!0,className:"text-blue-600 hover:bg-blue-100 h-8 text-xs font-bold",children:e.jsx(u,{to:"/auth/login",children:"Not you?"})})]})]}),e.jsx(y,{className:"bg-slate-50 border-t border-slate-100 p-6",children:r?e.jsx(n,{className:"w-full h-14 text-lg font-bold bg-blue-600 hover:bg-blue-700 shadow-xl shadow-blue-200 transition-all duration-300 hover:scale-[1.02]",onClick:M,disabled:b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-5 w-5 animate-spin"}),"Applying Invitation..."]}):"Redeem Invitation Now"}):e.jsxs("div",{className:"w-full text-center py-2 text-slate-400 text-xs font-medium",children:["Token: ",l.substring(0,8),"..."]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-4",children:e.jsxs(g,{className:"max-w-md w-full border-none shadow-2xl",children:[e.jsxs(N,{className:"text-center",children:[e.jsx(f,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx(v,{className:"text-2xl font-bold",children:"Invalid Link"}),e.jsx(w,{children:"This magic link is missing a valid security token."})]}),e.jsx(y,{children:e.jsx(n,{asChild:!0,className:"w-full",children:e.jsx(u,{to:"/auth/login",children:"Go to Login"})})})]})})}export{V as default};
