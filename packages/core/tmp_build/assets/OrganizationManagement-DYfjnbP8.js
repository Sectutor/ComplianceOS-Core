import{r as h,t as g,i as d,j as e,L as r,I as b,E as z,G as E,H as T,J as F,K as i,c as x,x as R,U as L,N as V,O as B,P as w,Q as c,V as $,W as l,k as I,v as U,C as se,d as ae,e as ie,h as re,m as ne}from"./index-DOc7Nwb7.js";import{E as _}from"./enhanced-dialog-CeRPsI16.js";import{A as Q,a as q,b as W,c as G,d as J,e as K,f as X,g as Y}from"./alert-dialog-V7xGXdVc.js";import{M as le}from"./mail-xRDvl6QK.js";import{P as Z}from"./plus-BaQ35Jcx.js";import{T as ee}from"./trash-2-CFEfisbM.js";import{B as te}from"./Breadcrumb-CRi3LAxS.js";import{S as de}from"./search-CwuIBBPE.js";import{S as ce}from"./square-pen-ClRv15cM.js";import{f as oe}from"./format-H2tx8_vS.js";import"./en-US-Bfz1jvxT.js";import"./differenceInCalendarDays-nctqlg7V.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";function me({clientId:y,clientName:S,trigger:n}){const[j,o]=h.useState(!1),[p,f]=h.useState(""),[D,C]=h.useState("viewer"),[m,u]=h.useState(null),{data:t,isLoading:M,refetch:P}=g.clients.getUsers.useQuery({clientId:y},{enabled:j}),A=g.clients.inviteUser.useMutation({onSuccess:()=>{d.success("User invited successfully"),f(""),P()},onError:s=>d.error(s.message)}),v=g.users.removeFromOrganization.useMutation({onSuccess:()=>{d.success("User removed from organization"),u(null),P()},onError:s=>d.error(s.message)}),O=s=>{s.preventDefault(),A.mutate({clientId:y,email:p,role:D})};return e.jsx(_,{open:j,onOpenChange:o,trigger:n||e.jsx(x,{variant:"ghost",size:"icon",title:"Manage Users",children:e.jsx(L,{className:"h-4 w-4 text-slate-600"})}),title:`Users: ${S}`,description:"Manage users and permissions for this organization.",size:"lg",children:e.jsxs("div",{className:"space-y-6 min-h-[400px]",children:[e.jsxs("div",{className:"bg-slate-50 border rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-blue-600"}),"Invite New User"]}),e.jsxs("form",{onSubmit:O,className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"grid gap-1.5 flex-1",children:[e.jsx(r,{htmlFor:"invite-email",className:"text-xs",children:"Email Address"}),e.jsx(b,{id:"invite-email",placeholder:"colleague@company.com",value:p,onChange:s=>f(s.target.value),required:!0,type:"email",className:"bg-white"})]}),e.jsxs("div",{className:"grid gap-1.5 w-[140px]",children:[e.jsx(r,{htmlFor:"invite-role",className:"text-xs",children:"Role"}),e.jsxs(z,{value:D,onValueChange:C,children:[e.jsx(E,{id:"invite-role",className:"bg-white",children:e.jsx(T,{})}),e.jsxs(F,{children:[e.jsx(i,{value:"owner",children:"Owner"}),e.jsx(i,{value:"editor",children:"Editor"}),e.jsx(i,{value:"viewer",children:"Viewer"})]})]})]}),e.jsxs(x,{type:"submit",disabled:A.isPending,children:[A.isPending?e.jsx(R,{className:"h-4 w-4 animate-spin"}):e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Invite"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-slate-600"}),"Active Users"]}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(V,{children:[e.jsx(B,{children:e.jsxs(w,{className:"bg-slate-50",children:[e.jsx(c,{children:"User"}),e.jsx(c,{children:"Role"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx($,{children:M?e.jsx(w,{children:e.jsx(l,{colSpan:3,className:"h-24 text-center",children:e.jsx(R,{className:"h-6 w-6 animate-spin mx-auto text-muted-foreground"})})}):(t==null?void 0:t.length)===0?e.jsx(w,{children:e.jsx(l,{colSpan:3,className:"h-24 text-center text-muted-foreground italic",children:"No users assigned to this organization yet."})}):t==null?void 0:t.map(s=>e.jsxs(w,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:s.name||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.email})]})}),e.jsx(l,{children:e.jsx(I,{variant:"outline",className:s.role==="owner"?"bg-purple-50 text-purple-700 border-purple-200":s.role==="admin"?"bg-blue-50 text-blue-700 border-blue-200":"text-slate-600",children:s.role})}),e.jsx(l,{className:"text-right",children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>u(s),disabled:v.isPending||s.role==="owner",title:s.role==="owner"?"Cannot remove owner":"Remove user",children:e.jsx(ee,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(Q,{open:!!m,onOpenChange:s=>!s&&u(null),children:e.jsxs(q,{children:[e.jsxs(W,{children:[e.jsx(G,{children:"Remove User from Organization?"}),e.jsxs(J,{children:["Are you sure you want to remove ",e.jsx("b",{children:m==null?void 0:m.name})," from ",e.jsx("b",{children:S}),"? They will lose access to all data within this organization."]})]}),e.jsxs(K,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Y,{className:"bg-red-600 hover:bg-red-700",onClick:()=>{m&&v.mutate({userId:m.id,clientId:y})},disabled:v.isPending,children:v.isPending?"Removing...":"Remove User"})]})]})})]})})}const H=[{id:"risk",label:"Risk Management"},{id:"compliance",label:"Compliance & Controls"},{id:"audit",label:"Audit Management"},{id:"vendors",label:"Vendor Management (TPRM)"},{id:"federal",label:"Federal Hub (NIST/CMMC)"},{id:"billing",label:"Billing & Subscriptions"}];function Ce(){const[y,S]=h.useState(!1),[n,j]=h.useState(null),[o,p]=h.useState(null),[f,D]=h.useState(""),{data:C,isLoading:m,refetch:u}=g.clients.list.useQuery({}),t=g.clients.create.useMutation({onSuccess:()=>{d.success("Organization created successfully"),S(!1),u()},onError:s=>{d.error(s.message||"Failed to create organization")}}),M=g.clients.update.useMutation({onSuccess:()=>{d.success("Organization updated"),j(null),u()},onError:s=>d.error(s.message)}),P=g.clients.delete.useMutation({onSuccess:()=>{d.success("Organization deleted"),u()},onError:s=>d.error(s.message)}),A=s=>{s.preventDefault();const a=new FormData(s.currentTarget),N=[];a.get("fw_ISO 27001")==="on"&&N.push("ISO 27001"),a.get("fw_SOC 2")==="on"&&N.push("SOC 2"),a.get("fw_HIPAA")==="on"&&N.push("HIPAA"),t.mutate({name:a.get("name"),industry:a.get("industry"),description:a.get("description"),size:a.get("size"),adminEmail:a.get("adminEmail"),welcomeMessage:a.get("welcomeMessage"),frameworks:N})},v=s=>{s.preventDefault();const a=new FormData(s.currentTarget),N=H.filter(k=>a.get(`module_${k.id}`)==="on").map(k=>k.id);M.mutate({id:n.id,name:a.get("name"),planTier:a.get("planTier"),status:a.get("status"),activeModules:N})},O=C==null?void 0:C.filter(s=>{var a;return s.name.toLowerCase().includes(f.toLowerCase())||((a=s.industry)==null?void 0:a.toLowerCase().includes(f.toLowerCase()))});return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto animate-in fade-in duration-500 p-6",children:[e.jsx(te,{items:[{label:"Admin"},{label:"Organizations"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Organization Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage tenant organizations, subscriptions, and active modules."})]}),e.jsx(_,{open:y,onOpenChange:S,trigger:e.jsxs(x,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Create Organization"]}),title:"Create New Organization",description:"Set up a new tenant workspace and onboard the initial admin.",size:"lg",footer:e.jsx("div",{className:"flex justify-end gap-2 w-full",children:e.jsx(x,{type:"submit",form:"create-org-form",disabled:t.isPending,children:t.isPending?"Creating & Onboarding...":"Create Organization"})}),children:e.jsxs("form",{id:"create-org-form",onSubmit:A,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"Organization Name *"}),e.jsx(b,{id:"name",name:"name",required:!0,placeholder:"Acme Corp"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"industry",children:"Industry"}),e.jsxs(z,{name:"industry",children:[e.jsx(E,{children:e.jsx(T,{placeholder:"Select..."})}),e.jsxs(F,{children:[e.jsx(i,{value:"Technology",children:"Technology"}),e.jsx(i,{value:"Finance",children:"Finance"}),e.jsx(i,{value:"Healthcare",children:"Healthcare"}),e.jsx(i,{value:"Manufacturing",children:"Manufacturing"}),e.jsx(i,{value:"Retail",children:"Retail"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"size",children:"Size"}),e.jsxs(z,{name:"size",children:[e.jsx(E,{children:e.jsx(T,{placeholder:"Select..."})}),e.jsxs(F,{children:[e.jsx(i,{value:"1-10",children:"1-10 Employees"}),e.jsx(i,{value:"11-50",children:"11-50 Employees"}),e.jsx(i,{value:"51-200",children:"51-200 Employees"}),e.jsx(i,{value:"201-1000",children:"201-1000 Employees"}),e.jsx(i,{value:"1000+",children:"1000+ Employees"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"description",children:"Description"}),e.jsx(b,{id:"description",name:"description",placeholder:"Short description..."})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Onboarding & Invitation"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"adminEmail",children:"Initial Admin Email (Optional)"}),e.jsx(b,{id:"adminEmail",name:"adminEmail",type:"email",placeholder:"admin@neworg.com (Leave empty to creating for yourself)"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"If provided, this user will be made the Owner. If they don't exist, an account will be created."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"welcomeMessage",children:"Welcome Email Message"}),e.jsx("textarea",{id:"welcomeMessage",name:"welcomeMessage",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Welcome to your new ComplianceOS workspace! Here are your login details..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{children:"Frameworks to Pre-load"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"fw_iso27001",name:"fw_ISO 27001"}),e.jsx(r,{htmlFor:"fw_iso27001",className:"font-normal",children:"ISO 27001"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"fw_soc2",name:"fw_SOC 2"}),e.jsx(r,{htmlFor:"fw_soc2",className:"font-normal",children:"SOC 2"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"fw_hipaa",name:"fw_HIPAA"}),e.jsx(r,{htmlFor:"fw_hipaa",className:"font-normal",children:"HIPAA"})]})]})]})]})]})]})})]}),e.jsxs(se,{className:"shadow-sm border-muted/40",children:[e.jsx(ae,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ie,{className:"text-lg flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Organizations"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(de,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search organizations...",className:"pl-8",value:f,onChange:s=>D(s.target.value)})]})]})}),e.jsx(ne,{children:m?e.jsx("div",{className:"h-24 flex items-center justify-center text-muted-foreground",children:"Loading..."}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(V,{children:[e.jsx(B,{children:e.jsxs(w,{className:"bg-slate-50",children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Plan"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Modules"}),e.jsx(c,{children:"Created"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx($,{children:O==null?void 0:O.map(s=>e.jsxs(w,{children:[e.jsx(l,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.industry," â€¢ ",s.size]})]})}),e.jsx(l,{children:e.jsx(I,{variant:"outline",className:s.planTier==="enterprise"?"border-purple-200 bg-purple-50 text-purple-700":s.planTier==="pro"?"border-blue-200 bg-blue-50 text-blue-700":"text-slate-600",children:s.planTier?s.planTier.toUpperCase():"FREE"})}),e.jsx(l,{children:e.jsx(I,{className:s.status==="active"?"bg-green-500":"bg-slate-500",children:s.status})}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[200px]",children:[s.activeModules&&Array.isArray(s.activeModules)&&s.activeModules.slice(0,3).map(a=>e.jsx(I,{variant:"secondary",className:"text-[10px] h-5 px-1",children:a},a)),s.activeModules&&Array.isArray(s.activeModules)&&s.activeModules.length>3&&e.jsxs(I,{variant:"secondary",className:"text-[10px] h-5 px-1",children:["+",s.activeModules.length-3]})]})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.createdAt?oe(new Date(s.createdAt),"MMM d, yyyy"):"-"}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(me,{clientId:s.id,clientName:s.name}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>j(s),children:e.jsx(ce,{className:"h-4 w-4 text-blue-500"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>p(s),children:e.jsx(ee,{className:"h-4 w-4 text-red-500"})})]})})]},s.id))})]})})})]}),e.jsx(Q,{open:!!o,onOpenChange:s=>!s&&p(null),children:e.jsxs(q,{children:[e.jsxs(W,{children:[e.jsx(G,{children:"Are you absolutely sure?"}),e.jsxs(J,{children:["This action cannot be undone. This will permanently delete the organization",e.jsxs("span",{className:"font-semibold text-foreground",children:[" ",o==null?void 0:o.name," "]}),"and remove ALL related data including users, controls, and policies."]})]}),e.jsxs(K,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Y,{onClick:()=>{o&&(P.mutate({id:o.id}),p(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Organization"})]})]})}),e.jsx(_,{open:!!n,onOpenChange:s=>!s&&j(null),title:`Edit Organization: ${n==null?void 0:n.name}`,description:"Update subscription plan and active modules.",footer:e.jsx("div",{className:"flex justify-end gap-2 w-full",children:e.jsx(x,{type:"submit",form:"edit-org-form",disabled:M.isPending,children:M.isPending?"Saving...":"Save Changes"})}),children:n&&e.jsxs("form",{id:"edit-org-form",onSubmit:v,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"edit-name",children:"Name"}),e.jsx(b,{id:"edit-name",name:"name",defaultValue:n.name,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"planTier",children:"Plan Tier"}),e.jsxs(z,{name:"planTier",defaultValue:n.planTier||"free",children:[e.jsx(E,{children:e.jsx(T,{})}),e.jsxs(F,{children:[e.jsx(i,{value:"free",children:"Free"}),e.jsx(i,{value:"pro",children:"Pro"}),e.jsx(i,{value:"enterprise",children:"Enterprise"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(z,{name:"status",defaultValue:n.status||"active",children:[e.jsx(E,{children:e.jsx(T,{})}),e.jsxs(F,{children:[e.jsx(i,{value:"active",children:"Active"}),e.jsx(i,{value:"suspended",children:"Suspended"}),e.jsx(i,{value:"archived",children:"Archived"})]})]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx(r,{children:"Active Modules"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 border rounded-md p-3",children:H.map(s=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:`module_${s.id}`,name:`module_${s.id}`,defaultChecked:(a=n.activeModules)==null?void 0:a.includes(s.id)}),e.jsx(r,{htmlFor:`module_${s.id}`,className:"text-sm font-normal cursor-pointer",children:s.label})]},s.id)})})]})]})})]})}export{Ce as default};
