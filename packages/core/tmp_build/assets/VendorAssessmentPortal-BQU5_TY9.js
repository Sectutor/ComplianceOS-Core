import{ab as q,r as c,t as N,i as y,j as e,C as m,m as d,d as E,e as I,f as T,I as P,c as v}from"./index-DOc7Nwb7.js";import{C as R}from"./circle-check-big-BSqJVrgh.js";function H(){var x,h,p,j,f,b;const{token:r}=q(),[a,o]=c.useState({}),[C,w]=c.useState(!1),{data:s,isLoading:S,error:A}=N.vendorAssessments.getPublicAssessment.useQuery({token:r},{enabled:!!r,retry:!1}),i=N.vendorAssessments.submitAssessment.useMutation({onSuccess:()=>{w(!0),y.success("Assessment submitted successfully!")},onError:t=>{y.error(`Submission failed: ${t.message}`)}});c.useEffect(()=>{var t;(t=s==null?void 0:s.request)!=null&&t.responses&&o(s.request.responses)},[s]);const D=(t,l)=>{o(n=>({...n,[t]:{value:l}}))},u=t=>{i.mutate({token:r,responses:a,status:t})};if(!r)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Invalid Link"});if(S)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading Assessment..."});if(A)return e.jsx("div",{className:"min-h-screen flex items-center justify-center text-red-500",children:"Access Denied or Expired"});if(C||((x=s==null?void 0:s.request)==null?void 0:x.status)==="submitted"||((h=s==null?void 0:s.request)==null?void 0:h.status)==="completed")return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:e.jsx(m,{className:"max-w-md w-full text-center py-12",children:e.jsxs(d,{children:[e.jsx(R,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Assessment Submitted"}),e.jsx("p",{className:"text-muted-foreground",children:"Thank you for completing the assessment. The compliance team will review your responses shortly."})]})})});const k=((j=(p=s==null?void 0:s.template)==null?void 0:p.content)==null?void 0:j.sections)||[];return e.jsx("div",{className:"min-h-screen bg-slate-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:(f=s==null?void 0:s.template)==null?void 0:f.name}),e.jsxs("p",{className:"text-lg text-slate-600 mt-2",children:["Requested by ",s!=null&&s.vendorName?"Compliance Team":"Client"," for ",s==null?void 0:s.vendorName]}),((b=s==null?void 0:s.request)==null?void 0:b.dueDate)&&e.jsxs("p",{className:"text-sm text-red-500 mt-1",children:["Due Date: ",new Date(s.request.dueDate).toLocaleDateString()]})]}),k.map((t,l)=>e.jsxs(m,{children:[e.jsxs(E,{children:[e.jsx(I,{children:t.title}),t.description&&e.jsx(T,{children:t.description})]}),e.jsx(d,{className:"space-y-6",children:t.questions.map(n=>{var g;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[n.text," ",n.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),n.type==="text"&&e.jsx(P,{value:((g=a[n.id])==null?void 0:g.value)||"",onChange:L=>D(n.id,L.target.value),placeholder:"Your answer..."})]},n.id)})})]},l)),e.jsx("div",{className:"flex justify-end gap-4 sticky bottom-4",children:e.jsx(m,{className:"w-full shadow-lg border-t-2 border-primary/20",children:e.jsxs(d,{className:"flex justify-between items-center p-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Object.keys(a).length," questions answered"]}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(v,{variant:"outline",onClick:()=>u("in_progress"),disabled:i.isLoading,children:"Save Draft"}),e.jsx(v,{onClick:()=>u("submitted"),disabled:i.isLoading,children:i.isLoading?"Submitting...":"Submit Assessment"})]})]})})})]})})}export{H as default};
