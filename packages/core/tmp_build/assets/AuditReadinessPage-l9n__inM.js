import{M as me,ab as xe,r as n,t as x,i as h,j as e,x as k,c,k as d,D as pe,o as ue,p as he,q as ge,s as je,w as fe,C as P,E as Q,G as B,H as T,J as V,K as g,L as b,d as Ne,e as be,m as ve,v as we,z as Se}from"./index-DOc7Nwb7.js";import{D as $,C as Ce}from"./DashboardLayout-aHnUqq57.js";import{A as ye,a as Ae,b as Ie,c as ke}from"./accordion-BvRtf4FI.js";import{T as J}from"./textarea-BtxBxzdY.js";import{c as v}from"./utils-BC5CVi_C.js";import{E as Le}from"./EmailQuestionsDialog-uF8LYkjM.js";import{C as K}from"./ChecklistProgressWidget-BEJu_NKS.js";import{S as De}from"./save-CvVmWchr.js";import{U as Ee}from"./user-plus-DI6Ajm-6.js";import{M as Me}from"./mail-xRDvl6QK.js";import{A as Re}from"./arrow-right-M96iV-v9.js";import{B as Fe}from"./book-open-BffBrdze.js";import{C as U}from"./circle-check-big-BSqJVrgh.js";import{S as Oe}from"./send-FW7-3cjH.js";import{C as Pe}from"./circle-x-DxtMpzS7.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./enhanced-dialog-CeRPsI16.js";import"./copy-CXVMffmd.js";import"./external-link-C3PXjBR9.js";import"./progress-B-1k4ZZX.js";import"./square-check-big-BUI41YoI.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=me("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),Be=({status:L})=>{switch(L){case"implemented":return e.jsxs(d,{variant:"success",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(U,{className:"w-3 h-3 mr-1"})," Implemented"]});case"partial":return e.jsxs(d,{variant:"warning",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"})," Partial"]});case"not_implemented":return e.jsxs(d,{variant:"error",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"})," Missing"]});case"not_applicable":return e.jsxs(d,{variant:"info",className:"uppercase text-[10px] font-bold px-2.5",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"})," N/A"]});default:return e.jsx(d,{variant:"outline",className:"text-gray-500 uppercase text-[10px] px-2.5",children:"Unanswered"})}};function Ps(){const{id:L}=xe(),m=parseInt(L||"0",10),_=["ISO 27001","SOC 2","NIST CSF","GDPR","HIPAA"],[a,w]=n.useState(null),[S,W]=n.useState(_[0]),[C,z]=n.useState("All Categories"),[y,X]=n.useState(""),{data:o,refetch:Y,isLoading:Z}=x.gapAnalysis.list.useQuery({clientId:m},{enabled:!!m}),{data:r,refetch:H,isFetching:Te}=x.gapAnalysis.get.useQuery({id:parseInt(a||"0")},{enabled:!!a}),ee=[{id:1,name:"Admin User",email:"admin@example.com",role:"Admin"},{id:2,name:"John Doe",email:"john@example.com",role:"Auditor"},{id:3,name:"Jane Smith",email:"jane@example.com",role:"Viewer"},{id:4,name:"Sarah Connor",email:"sarah@example.com",role:"Security Lead"}],[se,A]=n.useState(!1),[j,te]=n.useState([]),[f,ae]=n.useState(!1),[I,q]=n.useState([]),[re,G]=n.useState(!1),le=()=>{ae(!f),q([])},ie=s=>{q(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},D=x.gapAnalysis.assign.useMutation({onSuccess:()=>{h.success("Audit assigned and notifications sent."),A(!1),H()},onError:s=>h.error("Failed to assign: "+s.message)}),ne=()=>{a&&D.mutate({assessmentId:parseInt(a),assigneeIds:j})},oe=s=>{te(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},{data:E}=x.controls.list.useQuery(),M=x.gapAnalysis.create.useMutation({onSuccess:s=>{h.success("New audit assessment started!"),Y(),w(s.id.toString())},onError:s=>h.error("Failed to start assessment: "+s.message)}),R=x.gapAnalysis.updateResponse.useMutation({onSuccess:()=>{H()}}),F=x.gapAnalysis.generateReport.useMutation({onSuccess:s=>{const t=document.createElement("a");t.href=`data:application/pdf;base64,${s.pdfBase64}`,t.download=s.filename,document.body.appendChild(t),t.click(),document.body.removeChild(t),h.success("Report downloaded successfully")},onError:s=>h.error("Failed to generate report: "+s.message)}),p=(E==null?void 0:E.filter(s=>{if(!s.framework)return!1;const t=(r==null?void 0:r.assessment.framework)||S;return t?!!(s.framework===t||t.includes(s.framework)):!1}))||[],ce=Array.from(new Set(p.map(s=>s.category||"Uncategorized"))).sort(),O=(()=>{if(!(r!=null&&r.responses))return{score:0,total:0,answered:0};const s=p.length;if(s===0)return{score:0,total:0,answered:0};const t=r.responses,i=t.length;let l=0;return t.forEach(N=>{N.currentStatus==="implemented"?l+=1:N.currentStatus==="partial"?l+=.5:N.currentStatus==="not_applicable"&&(l+=1)}),{score:Math.round(l/s*100),total:s,answered:i}})(),de=()=>{m&&M.mutate({clientId:m,name:`Audit Readiness: ${S}`,framework:S,scope:"Full Organization"})};return n.useEffect(()=>{o&&o.length>0&&!a&&w(o[0].id.toString())},[o,a]),Z?e.jsx($,{children:e.jsx("div",{className:"flex h-[80vh] items-center justify-center",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-blue-600"})})}):e.jsxs($,{children:[e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto p-2",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-slate-900",children:"Audit Readiness Assessment"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Evaluate and prove your organization's compliance readiness."})]}),e.jsx("div",{className:"flex items-center gap-2",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"outline",onClick:()=>F.mutate({id:parseInt(a)}),disabled:F.isLoading,children:[F.isLoading?e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Download Report"]}),e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(De,{className:"w-4 h-4 mr-2"})," Save Progress"]}),e.jsxs(c,{className:"bg-slate-900 hover:bg-slate-800",onClick:()=>A(!0),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"})," Assign / Send"]}),e.jsxs(c,{variant:f?"secondary":"outline",onClick:le,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),f?"Cancel Selection":"Email Questions"]}),f&&I.length>0&&e.jsxs(c,{onClick:()=>G(!0),children:["Send (",I.length,")"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 mb-6",children:e.jsx("div",{className:"p-4 rounded-xl border border-teal-200 bg-white shadow-sm flex flex-col justify-between cursor-pointer hover:border-teal-400 hover:shadow-md transition-all group md:col-span-1",onClick:()=>window.location.href=`/clients/${m}/audit-readiness/alignment-guide`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:"ISO 27001"}),e.jsx(d,{variant:"secondary",className:"text-[10px] px-1.5 h-5 bg-teal-100 text-teal-700 pointer-events-none",children:"GUIDE"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 mt-2 font-medium group-hover:text-teal-600 transition-colors",children:[e.jsx("span",{children:"View alignment"}),e.jsx(Re,{className:"w-3 h-3 group-hover:translate-x-1 transition-transform"})]})]}),e.jsx("div",{className:"p-2 rounded-lg bg-teal-50 text-teal-600 group-hover:bg-teal-100 transition-colors",children:e.jsx(Fe,{className:"w-5 h-5"})})]})})}),e.jsx(pe,{open:se,onOpenChange:A,children:e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(ge,{children:"Assign Assessment"}),e.jsx(je,{children:"Select users to assign this audit to. They will receive an email notification."})]}),e.jsx("div",{className:"py-4 space-y-2",children:ee.map(s=>e.jsxs("div",{className:v("flex items-center justify-between p-3 rounded-md border cursor-pointer hover:bg-slate-50",j.includes(s.id)?"border-blue-500 bg-blue-50":"border-slate-200"),onClick:()=>oe(s.id),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.email," â€¢ ",s.role]})]}),e.jsx("div",{className:v("w-5 h-5 rounded-full border flex items-center justify-center",j.includes(s.id)?"bg-blue-600 border-blue-600":"border-slate-300"),children:j.includes(s.id)&&e.jsx(U,{className:"w-3 h-3 text-white"})})]},s.id))}),e.jsxs(fe,{children:[e.jsx(c,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsxs(c,{onClick:ne,disabled:D.isLoading||j.length===0,children:[D.isLoading&&e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(Oe,{className:"w-4 h-4 mr-2"})," Send Assignment"]})]})]})}),o&&o.length===0&&!a?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(P,{className:"py-12 flex flex-col items-center justify-center text-center h-full",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4",children:e.jsx(U,{className:"w-8 h-8"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Start Your First Assessment"}),e.jsx("p",{className:"text-slate-500 max-w-md mt-2 mb-6",children:"Select a framework to begin evaluating your compliance posture and identifying gaps before the auditor does."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Q,{value:S,onValueChange:W,children:[e.jsx(B,{className:"w-[250px]",children:e.jsx(T,{placeholder:"Select Framework"})}),e.jsx(V,{children:_.map(s=>e.jsx(g,{value:s,children:s},s))})]}),e.jsxs(c,{onClick:de,disabled:M.isLoading,children:[M.isLoading&&e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Start Assessment"]})]})]})}),e.jsx("div",{children:e.jsx(K,{clientId:m})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"Current Assessment"}),e.jsxs(Q,{value:a||"",onValueChange:w,children:[e.jsx(B,{className:"w-[300px] h-9 border-none bg-slate-100 font-medium",children:e.jsx(T,{placeholder:"Select Assessment"})}),e.jsxs(V,{children:[o==null?void 0:o.map(s=>e.jsxs(g,{value:s.id.toString(),children:[s.name," (",new Date(s.createdAt).toLocaleDateString(),")"]},s.id)),e.jsx("div",{className:"p-2 border-t",children:e.jsx(c,{variant:"ghost",size:"sm",className:"w-full text-xs justify-start px-2",onClick:()=>{w(null)},children:"+ Start New Assessment"})})]})]})]}),r&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"Framework"}),e.jsx("div",{className:"font-semibold text-sm",children:r.assessment.framework})]})]}),r&&e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[O.score,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Readiness Score"})]}),e.jsx("div",{className:"h-10 w-px bg-slate-200"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-slate-700",children:[O.answered," / ",O.total]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Controls Audited"})]})]})]}),a&&r&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsx(K,{clientId:m}),e.jsxs(P,{children:[e.jsx(Ne,{className:"pb-3",children:e.jsx(be,{className:"text-base",children:"Categories"})}),e.jsx(ve,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{className:v("text-left px-4 py-3 text-sm font-medium border-l-2 transition-colors",C==="All Categories"?"bg-slate-50 border-blue-600 text-blue-700":"border-transparent text-slate-600 hover:bg-slate-50"),onClick:()=>z("All Categories"),children:["All Categories",e.jsx(d,{variant:"secondary",className:"ml-2 text-[10px]",children:p.length})]}),ce.map(s=>e.jsx("button",{className:v("text-left px-4 py-3 text-sm font-medium border-l-2 transition-colors",C===s?"bg-slate-50 border-blue-600 text-blue-700":"border-transparent text-slate-600 hover:bg-slate-50"),onClick:()=>z(s),children:s},s))]})})]})]}),e.jsxs("div",{className:"lg:col-span-3 space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"Search questions or controls...",className:"w-full pl-4 pr-4 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:y,onChange:s=>X(s.target.value)})}),e.jsxs("div",{className:"space-y-4",children:[p.filter(s=>C==="All Categories"||s.category===C).filter(s=>s.name.toLowerCase().includes(y.toLowerCase())||s.description.toLowerCase().includes(y.toLowerCase())||s.controlId.toLowerCase().includes(y.toLowerCase())).map(s=>{const t=r.responses.find(l=>{var u;return l.controlId===s.controlId||l.controlId===((u=s.id)==null?void 0:u.toString())}),i=t==null?void 0:t.currentStatus;return e.jsx(P,{className:v("transition-all border-l-4",i==="implemented"?"border-l-green-500":i==="not_implemented"?"border-l-red-500":"border-l-slate-200"),children:e.jsxs("div",{className:"flex",children:[f&&e.jsx("div",{className:"flex items-center justify-center px-4 border-r bg-slate-50",children:e.jsx(we,{checked:s.id?I.includes(s.id):!1,onCheckedChange:()=>s.id&&ie(s.id)})}),e.jsx("div",{className:"flex-1",children:e.jsx(ye,{type:"single",collapsible:!0,children:e.jsxs(Ae,{value:"item-1",className:"border-none",children:[e.jsxs("div",{className:"p-4 flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(d,{variant:"outline",className:"text-xs bg-slate-50 text-slate-600",children:s.controlId}),e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:s.category||"General"})]}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-1",children:s.name.endsWith("?")?s.name:`Is the ${s.name} implemented and effective?`}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2 md:line-clamp-none",children:s.description})]}),e.jsxs("div",{className:"shrink-0 flex flex-col items-end gap-2",children:[e.jsx(Be,{status:i}),e.jsx(Ie,{className:"text-xs text-blue-600 hover:no-underline py-0",children:t?"Edit Response":"Answer"})]})]}),e.jsx(ke,{className:"p-4 pt-0 bg-slate-50/50 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Implementation Status"}),e.jsxs(Q,{value:i||"",onValueChange:l=>{var u;return R.mutate({assessmentId:parseInt(a),controlId:s.controlId,currentStatus:l,targetStatus:((u=r.responses.find(N=>N.controlId===s.controlId))==null?void 0:u.targetStatus)||"required"})},children:[e.jsx(B,{children:e.jsx(T,{placeholder:"Select Status"})}),e.jsxs(V,{children:[e.jsx(g,{value:"implemented",children:"Implemented"}),e.jsx(g,{value:"partial",children:"Partial"}),e.jsx(g,{value:"not_implemented",children:"Not Implemented"}),e.jsx(g,{value:"not_applicable",children:"Not Applicable"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Evidence / Links"}),e.jsx(J,{placeholder:"Paste links to evidence or documents...",className:"h-20 resize-none",defaultValue:(t==null?void 0:t.evidenceLinks)||"",onBlur:l=>R.mutate({assessmentId:parseInt(a),controlId:s.controlId,evidenceLinks:l.target.value})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Audit Notes"}),e.jsx(J,{placeholder:"Internal notes, observation details, or remediation plans...",className:"h-32",defaultValue:(t==null?void 0:t.notes)||"",onBlur:l=>R.mutate({assessmentId:parseInt(a),controlId:s.controlId,notes:l.target.value})})]})})]})})]})})})]})},s.controlId)}),p.length===0&&e.jsx("div",{className:"text-center py-12 text-slate-500",children:e.jsx("p",{children:"No controls found for this framework."})})]})]})]})]})]}),a&&e.jsx(Le,{open:re,onOpenChange:G,assessmentId:parseInt(a),selectedControlIds:I,controls:p.filter(s=>s.id).map(s=>({id:s.id,controlId:s.controlId,name:s.name}))})]})}export{Ps as default};
