import{t as y,r as v,j as e,C as k,d as I,e as P,f as J,m as T,c as C,L as A,I as M,E as B,G as H,H as U,J as V,K as S,x as ue,N as W,O as Y,P as L,Q as w,V as Z,W as d,k as te,i as b,ac as pe,u as je,D as ie,ap as ne,o as re,p as le,q as ce,w as oe,X as de,Y as xe,S as fe,T as Ne,ab as be,aq as Ce}from"./index-DOc7Nwb7.js";import{T as G}from"./textarea-BtxBxzdY.js";import{C as ge}from"./clock-osbacZli.js";import{P as ee}from"./plus-BaQ35Jcx.js";import{k as we,S as Se,D as ae}from"./DashboardLayout-aHnUqq57.js";import{c as K}from"./utils-BC5CVi_C.js";import{S as Re}from"./shield-check-ETs8j4-d.js";import{C as me}from"./circle-check-C5kiwRoG.js";import{C as he}from"./circle-x-DxtMpzS7.js";import{M as De}from"./message-square-5hBo7zY3.js";import{S as Ae}from"./send-FW7-3cjH.js";import{T as ke,a as Ie,b as Q,c as $}from"./tabs-CBDTXbEn.js";import{S as Pe}from"./save-CvVmWchr.js";import{D as Te}from"./dollar-sign-M9UCfTjq.js";import{L as Le}from"./lock-czWF3qbC.js";import{F as Me}from"./file-check-De1wUTh7.js";import{A as Oe}from"./activity-B1F2IRm3.js";import{C as Ee}from"./calendar-BlLJlGbj.js";import{T as ve}from"./trash-2-CFEfisbM.js";import{A as Fe}from"./arrow-left-CpuUojG-.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./globe-BMGZmoaJ.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";const Be=["0-1 hour","1-4 hours","4-24 hours","1-3 days","3-7 days","> 1 week"],He=["0 (Real-time)","1 hour","4 hours","24 hours","> 24 hours"],Ue=["< 4 hours","24 hours","3 days","1 week","2 weeks","> 1 month"];function Ve({biaId:p}){const{data:s,refetch:m}=y.businessContinuity.bia.getRecoveryObjectives.useQuery({biaId:p}),r=y.businessContinuity.bia.saveRecoveryObjective.useMutation(),[l,i]=v.useState(!1),[o,h]=v.useState(""),[a,c]=v.useState("High"),[n,t]=v.useState("4-24 hours"),[j,u]=v.useState("24 hours"),[g,f]=v.useState("3 days"),[R,N]=v.useState(""),[O,_]=v.useState(""),D=async()=>{if(!o){b.error("Activity Name is required");return}try{await r.mutateAsync({biaId:p,activity:o,criticality:a,rto:n,rpo:j,mtpd:g,dependencies:R,resources:O}),b.success("Recovery requirements saved"),i(!1),se(),m()}catch(x){console.error(x),b.error("Failed to save")}},se=()=>{setActivityName(""),c("High"),t("4-24 hours"),u("24 hours"),f("3 days"),N(""),_("")};return e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{children:[e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-500"}),"Recovery Objectives & Dependencies"]}),e.jsx(J,{children:"Define the critical activities within this process and their specific recovery requirements (RTO/RPO) and dependencies."})]}),e.jsxs(T,{children:[!l&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(C,{onClick:()=>i(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"})," Add Critical Activity"]})}),l&&e.jsxs("div",{className:"border rounded-lg p-4 bg-muted/30 space-y-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Critical Activity Name"}),e.jsx(M,{placeholder:"e.g. Process Payroll Batch",value:activityName,onChange:x=>setActivityName(x.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Criticality"}),e.jsxs(B,{value:a,onValueChange:c,children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(S,{value:"Critical",children:"Critical"}),e.jsx(S,{value:"High",children:"High"}),e.jsx(S,{value:"Medium",children:"Medium"}),e.jsx(S,{value:"Low",children:"Low"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"RTO (Target Time)"}),e.jsxs(B,{value:n,onValueChange:t,children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsx(V,{children:Be.map(x=>e.jsx(S,{value:x,children:x},x))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"RPO (Data Loss)"}),e.jsxs(B,{value:j,onValueChange:u,children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsx(V,{children:He.map(x=>e.jsx(S,{value:x,children:x},x))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"MTPD (Max Outage)"}),e.jsxs(B,{value:g,onValueChange:f,children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsx(V,{children:Ue.map(x=>e.jsx(S,{value:x,children:x},x))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Dependencies (Upstream/Downstream)"}),e.jsx(G,{placeholder:"Internal apps, vendors, other depts...",value:R,onChange:x=>N(x.target.value),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Required Resources"}),e.jsx(G,{placeholder:"Staff count, laptops, office space...",value:O,onChange:x=>_(x.target.value),className:"min-h-[80px]"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"ghost",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(C,{onClick:D,disabled:r.isPending,children:[r.isPending&&e.jsx(ue,{className:"w-4 h-4 mr-2 animate-spin"}),"Save Activity"]})]})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(L,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(w,{className:"text-white font-semibold py-4",children:"Activity"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Criticality"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"RTO / RPO"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Dependencies"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Resources"})]})}),e.jsxs(Z,{children:[(s==null?void 0:s.length)===0&&e.jsx(L,{children:e.jsx(d,{colSpan:5,className:"text-center py-6 text-gray-500 bg-white",children:"No critical activities defined yet."})}),s==null?void 0:s.map(x=>e.jsxs(L,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(d,{className:"font-medium text-black py-4",children:x.activity}),e.jsx(d,{className:"py-4",children:e.jsx(te,{variant:x.criticality==="Critical"?"destructive":"secondary",children:x.criticality})}),e.jsxs(d,{className:"py-4",children:[e.jsxs("div",{className:"text-sm text-black",children:["RTO: ",e.jsx("b",{children:x.rto})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["RPO: ",x.rpo]})]}),e.jsx(d,{className:"max-w-[200px] truncate text-gray-600 py-4",title:x.dependencies||"",children:x.dependencies||"-"}),e.jsx(d,{className:"max-w-[200px] truncate text-gray-600 py-4",title:x.resources||"",children:x.resources||"-"})]},x.id))]})]})})]})]})})}function ze({entityType:p,entityId:s}){const{selectedClientId:m}=pe(),{user:r}=je(),[l,i]=v.useState(!1),[o,h]=v.useState(!1),[a,c]=v.useState(""),[n,t]=v.useState("approved"),[j,u]=v.useState(""),g=y.useContext(),{data:f,isLoading:R}=y.businessContinuity.collaboration.getApprovals.useQuery({clientId:m,entityType:p,entityId:s},{enabled:!!m}),{data:N}=y.businessContinuity.callTree.list.useQuery({clientId:m},{enabled:!!m&&l}),O=y.businessContinuity.collaboration.requestApproval.useMutation({onSuccess:()=>{b.success("Approval requested"),i(!1),g.businessContinuity.collaboration.getApprovals.invalidate()},onError:E=>b.error(E.message)}),_=y.businessContinuity.collaboration.respondToApproval.useMutation({onSuccess:()=>{b.success("Response submitted"),h(!1),g.businessContinuity.collaboration.getApprovals.invalidate()},onError:E=>b.error(E.message)}),D=f==null?void 0:f[0],se=()=>{if(!a)return b.error("Select an approver");O.mutate({clientId:m,entityType:p,entityId:s,approverId:parseInt(a)})},x=()=>{D&&_.mutate({id:D.id,status:n,comments:j})};if(R)return e.jsx("div",{className:"h-12 bg-muted/20 animate-pulse rounded-md mb-4"});if(!D)return e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-3 px-4 flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Re,{className:"h-5 w-5 text-slate-400"}),e.jsx("span",{className:"font-medium text-sm",children:"Status: Draft"})]}),e.jsxs(ie,{open:l,onOpenChange:i,children:[e.jsx(ne,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",children:"Request Approval"})}),e.jsxs(re,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Request Approval"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Select Approver"}),e.jsxs(B,{value:a,onValueChange:c,children:[e.jsx(H,{children:e.jsx(U,{placeholder:"Select a user..."})}),e.jsx(V,{children:N==null?void 0:N.internal.map(E=>e.jsx(S,{value:E.id.toString(),children:E.name},E.id))})]})]}),e.jsxs(oe,{children:[e.jsx(C,{variant:"ghost",onClick:()=>i(!1),children:"Cancel"}),e.jsx(C,{onClick:se,disabled:O.isLoading,children:"Send Request"})]})]})]})]});const F=D.status==="pending",q=D.status==="approved",z=D.status==="rejected",ye=F&&(r==null?void 0:r.id)===D.approverId;return e.jsxs("div",{className:K("rounded-lg p-4 border mb-6 flex items-center justify-between shadow-sm",F&&"bg-yellow-50 border-yellow-200",q&&"bg-green-50 border-green-200",z&&"bg-red-50 border-red-200"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F&&e.jsx(ge,{className:"h-5 w-5 text-yellow-600"}),q&&e.jsx(me,{className:"h-5 w-5 text-green-600"}),z&&e.jsx(he,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:K("font-medium",F&&"text-yellow-900",q&&"text-green-900",z&&"text-red-900"),children:[F&&"Pending Approval",q&&"Approved",z&&"Rejected"]}),e.jsxs("div",{className:K("text-xs mt-0.5",F&&"text-yellow-700",q&&"text-green-700",z&&"text-red-700"),children:[F&&`Requested on ${new Date(D.requestedAt).toLocaleDateString()}`,q&&`Approved on ${new Date(D.respondedAt).toLocaleDateString()}`,z&&`Rejected on ${new Date(D.respondedAt).toLocaleDateString()}`,D.comments&&e.jsxs("span",{className:"block mt-1 italic",children:['"',D.comments,'"']})]})]})]}),ye&&e.jsxs(ie,{open:o,onOpenChange:h,children:[e.jsx(ne,{asChild:!0,children:e.jsx(C,{size:"sm",className:K(F&&"bg-yellow-600 hover:bg-yellow-700 text-white"),children:"Review Request"})}),e.jsxs(re,{children:[e.jsx(le,{children:e.jsx(ce,{children:"Review Approval Request"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(C,{variant:n==="approved"?"default":"outline",className:K(n==="approved"?"bg-green-600 hover:bg-green-700":""),onClick:()=>t("approved"),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Approve"]}),e.jsxs(C,{variant:n==="rejected"?"destructive":"outline",onClick:()=>t("rejected"),children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," Reject"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Comments (Optional)"}),e.jsx(G,{placeholder:"Add notes...",value:j,onChange:E=>u(E.target.value)})]})]}),e.jsxs(oe,{children:[e.jsx(C,{variant:"ghost",onClick:()=>h(!1),children:"Cancel"}),e.jsx(C,{onClick:x,disabled:_.isLoading,children:"Submit Decision"})]})]})]}),z&&(r==null?void 0:r.id)!==D.approverId&&e.jsx(C,{variant:"outline",size:"sm",onClick:()=>i(!0),className:"bg-white",children:"Request Again"})]})}function Qe({entityType:p,entityId:s}){var u;const{user:m}=je(),{selectedClientId:r}=pe(),[l,i]=v.useState(""),o=r,{data:h,isLoading:a,refetch:c}=y.businessContinuity.collaboration.getComments.useQuery({clientId:o,entityType:p,entityId:s},{enabled:!!o}),n=y.businessContinuity.collaboration.addComment.useMutation({onSuccess:()=>{b.success("Comment added"),i(""),c()},onError:g=>{b.error(g.message||"Failed to add comment")}}),t=g=>{g.preventDefault(),!(!l.trim()||!o)&&n.mutate({clientId:o,entityType:p,entityId:s,content:l})},j=g=>g.split(" ").map(f=>f[0]).join("").toUpperCase().substring(0,2);return o?e.jsxs(k,{className:"mt-6 border shadow-sm",children:[e.jsx(I,{className:"py-4 bg-muted/20",children:e.jsxs(P,{className:"flex items-center gap-2 text-base font-medium",children:[e.jsx(De,{className:"h-4 w-4"}),"Discussion (",(h==null?void 0:h.length)||0,")"]})}),e.jsxs(T,{className:"space-y-6 pt-6",children:[e.jsxs("form",{onSubmit:t,className:"flex gap-3 items-start mb-6",children:[e.jsx(de,{className:"h-8 w-8 mt-1",children:e.jsx(xe,{children:j(((u=m==null?void 0:m.user_metadata)==null?void 0:u.full_name)||(m==null?void 0:m.email)||"?")})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(G,{placeholder:"Add a comment...",value:l,onChange:g=>i(g.target.value),className:"min-h-[40px] flex-1 font-sans text-sm resize-y",onKeyDown:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),t(g))}}),e.jsx(C,{type:"submit",disabled:!l.trim()||n.isLoading,size:"icon",className:"h-10 w-10 shrink-0",title:"Send Comment",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"space-y-4",children:a?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-2",children:"Loading discussion..."}):(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-4 italic",children:"No comments yet. Start the conversation!"}):h==null?void 0:h.map(g=>e.jsxs("div",{className:"flex gap-3 group",children:[e.jsx(de,{className:"h-8 w-8",children:e.jsx(xe,{className:"text-xs bg-slate-100 text-slate-600",children:j(g.userName||"User")})}),e.jsxs("div",{className:"flex-1 bg-muted/10 p-3 rounded-lg border border-transparent hover:border-border transition-colors",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-foreground",children:g.userName||"Unknown User"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:we(new Date(g.createdAt),{addSuffix:!0})})]})}),e.jsx("p",{className:"text-sm text-foreground/90 whitespace-pre-wrap",children:g.content})]})]},g.id))})]})]}):e.jsx("div",{className:"text-sm text-red-500",children:"Client context missing for comments"})}const $e=[{label:"0 - 4 Hours",key:"0-4h"},{label:"4 - 24 Hours",key:"4-24h"},{label:"1 - 3 Days",key:"1-3d"},{label:"3 - 7 Days",key:"3-7d"},{label:"> 7 Days",key:">7d"}];function qe({biaId:p}){const{data:s,refetch:m}=y.businessContinuity.bia.getImpactAssessments.useQuery({biaId:p}),r=y.businessContinuity.bia.saveImpactAssessment.useMutation(),[l,i]=v.useState({}),[o,h]=v.useState(!1);v.useEffect(()=>{if(s){const n={};s.forEach(t=>{n[t.timeInterval]={financial:t.financialRating||0,operational:t.operationalRating||0,reputation:t.reputationRating||0,legal:t.legalRating||0}}),i(n)}},[s]);const a=(n,t,j)=>{i(u=>({...u,[n]:{...u[n]||{financial:0,operational:0,reputation:0,legal:0},[t]:j[0]}}))},c=async n=>{h(!0);const t=l[n];if(t)try{await r.mutateAsync({biaId:p,timeInterval:n,financialRating:t.financial,operationalRating:t.operational,reputationRating:t.reputation,legalRating:t.legal}),b.success(`Saved impact for ${n}`),m()}catch{b.error("Failed to save")}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Impact Over Time"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assess how the impact of a disruption escalates over time. Rate from 0 (No Impact) to 10 (Catastrophic)."}),e.jsx("div",{className:"grid gap-6",children:$e.map(n=>{const t=l[n.key]||{financial:0,operational:0,reputation:0,legal:0},j=Math.max(t.financial,t.operational,t.reputation,t.legal);return e.jsxs(k,{className:"border-l-4",style:{borderLeftColor:j>=8?"#ef4444":j>=5?"#f97316":"#22c55e"},children:[e.jsx(I,{className:"py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(P,{className:"text-base",children:n.label}),e.jsxs(C,{size:"sm",variant:"ghost",onClick:()=>c(n.key),disabled:o,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"})," Save"]})]})}),e.jsxs(T,{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 pb-6",children:[e.jsx(X,{label:"Financial",value:t.financial,onChange:u=>a(n.key,"financial",u)}),e.jsx(X,{label:"Operational",value:t.operational,onChange:u=>a(n.key,"operational",u)}),e.jsx(X,{label:"Reputation",value:t.reputation,onChange:u=>a(n.key,"reputation",u)}),e.jsx(X,{label:"Legal/Compliance",value:t.legal,onChange:u=>a(n.key,"legal",u)})]})]},n.key)})})]})}function X({label:p,value:s,onChange:m}){const r=s<4?"text-green-600":s<7?"text-yellow-600":"text-red-600";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(A,{children:p}),e.jsxs("span",{className:`text-xs font-bold ${r}`,children:[s,"/10"]})]}),e.jsx(Se,{value:[s],max:10,step:1,onValueChange:m,className:s>=8?"accent-destructive":""}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground px-1",children:[e.jsx("span",{children:"None"}),e.jsx("span",{children:"Critical"})]})]})}function Ge({biaId:p}){const{data:s,refetch:m}=y.businessContinuity.bia.getFinancialImpacts.useQuery({biaId:p}),r=y.businessContinuity.bia.saveFinancialImpact.useMutation(),[l,i]=v.useState({lossCategory:"Revenue",amountPerUnit:0,unit:"Hour",description:""}),o=async()=>{if(l.amountPerUnit)try{await r.mutateAsync({biaId:p,lossCategory:l.lossCategory,amountPerUnit:l.amountPerUnit,unit:l.unit,description:l.description}),b.success("Added financial impact"),i({...l,amountPerUnit:0,description:""}),m()}catch{b.error("Failed to add impact")}},h=(s==null?void 0:s.filter(c=>c.unit==="Hour").reduce((c,n)=>c+(n.amountPerUnit||0),0))||0,a=(s==null?void 0:s.filter(c=>c.unit==="Day").reduce((c,n)=>c+(n.amountPerUnit||0),0))||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(k,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Est. Impact per Hour"})}),e.jsx(T,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["$",h.toLocaleString()]})})]}),e.jsxs(k,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Est. Impact per Day"})}),e.jsx(T,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["$",(h*24+a).toLocaleString()]})})]})]}),e.jsxs(k,{children:[e.jsx(I,{children:e.jsx(P,{className:"text-lg",children:"Add Financial Impact Factor"})}),e.jsx(T,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Category"}),e.jsxs(B,{value:l.lossCategory,onValueChange:c=>i({...l,lossCategory:c}),children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(S,{value:"Revenue",children:"Revenue Loss"}),e.jsx(S,{value:"Productivity",children:"Productivity Loss"}),e.jsx(S,{value:"Penalty",children:"Regulatory Fines"}),e.jsx(S,{value:"Recovery",children:"Recovery Costs"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Amount ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(M,{className:"pl-8",type:"number",value:l.amountPerUnit||"",onChange:c=>i({...l,amountPerUnit:parseInt(c.target.value)||0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Per Unit"}),e.jsxs(B,{value:l.unit,onValueChange:c=>i({...l,unit:c}),children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(S,{value:"Hour",children:"Per Hour"}),e.jsx(S,{value:"Day",children:"Per Day"}),e.jsx(S,{value:"Event",children:"Flat (One-time)"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(C,{className:"w-full",onClick:o,disabled:r.isPending,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"})," Add"]})})]})})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(L,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(w,{className:"text-white font-semibold py-4",children:"Category"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Impact"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Frequency"}),e.jsx(w,{className:"text-white font-semibold py-4",children:"Description"})]})}),e.jsxs(Z,{children:[s==null?void 0:s.map(c=>{var n;return e.jsxs(L,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(d,{className:"text-black py-4",children:c.lossCategory}),e.jsxs(d,{className:"font-medium text-black py-4",children:["$",(n=c.amountPerUnit)==null?void 0:n.toLocaleString()]}),e.jsx(d,{className:"text-gray-600 py-4",children:c.unit}),e.jsx(d,{className:"text-gray-500 py-4",children:c.description||"-"})]},c.id)}),(s==null?void 0:s.length)===0&&e.jsx(L,{children:e.jsx(d,{colSpan:4,className:"text-center py-6 text-gray-500 bg-white",children:"No financial impacts defined."})})]})]})})]})}function _e({biaId:p}){var n;const{data:s,refetch:m}=y.businessContinuity.bia.get.useQuery({id:p}),r=y.businessContinuity.bia.saveResponse.useMutation(),[l,i]=v.useState({}),[o,h]=v.useState({}),a=((n=s==null?void 0:s.questions)==null?void 0:n.filter(t=>t.category==="Security"))||[];v.useEffect(()=>{if(a.length>0){const t={},j={};a.forEach(u=>{t[u.id]=u.response||"",j[u.id]=u.impactLevel||"low"}),i(t),h(j)}},[s]);const c=async(t,j)=>{const u=j||o[t];try{await r.mutateAsync({questionId:t,response:l[t]||"",impactLevel:u,notes:""}),b.success("Security impact saved")}catch{b.error("Failed to save")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(k,{className:"bg-slate-50 border-blue-200",children:[e.jsx(I,{className:"pb-2",children:e.jsxs(P,{className:"flex items-center gap-2 text-base text-blue-700",children:[e.jsx(Le,{className:"w-4 h-4"})," Confidentiality"]})}),e.jsx(T,{className:"text-sm text-blue-900",children:"Protection against unauthorized access or disclosure of sensitive information."})]}),e.jsxs(k,{className:"bg-slate-50 border-green-200",children:[e.jsx(I,{className:"pb-2",children:e.jsxs(P,{className:"flex items-center gap-2 text-base text-green-700",children:[e.jsx(Me,{className:"w-4 h-4"})," Integrity"]})}),e.jsx(T,{className:"text-sm text-green-900",children:"Assurance that data is accurate, complete, and not tampered with."})]}),e.jsxs(k,{className:"bg-slate-50 border-orange-200",children:[e.jsx(I,{className:"pb-2",children:e.jsxs(P,{className:"flex items-center gap-2 text-base text-orange-700",children:[e.jsx(Oe,{className:"w-4 h-4"})," Availability"]})}),e.jsx(T,{className:"text-sm text-orange-900",children:"Reliability and timely access to data and resources for authorized users."})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-xl",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"CIA Impact Analysis Not Configured"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Security impact questions are missing for this BIA."}),e.jsx(C,{variant:"outline",children:"Initialize Security Assessment"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"(Requires backend update to add questions)"})]}):e.jsx("div",{className:"grid gap-6",children:a.map(t=>e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-base",children:t.question}),e.jsx(J,{children:t.notes})]}),e.jsxs(B,{value:o[t.id],onValueChange:j=>{h({...o,[t.id]:j}),c(t.id,j)},children:[e.jsx(H,{className:"w-[140px]",children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(S,{value:"critical",children:"Critical"}),e.jsx(S,{value:"high",children:"High"}),e.jsx(S,{value:"medium",children:"Medium"}),e.jsx(S,{value:"low",children:"Low"})]})]})]})}),e.jsxs(T,{children:[e.jsx(A,{className:"mb-2 block",children:"Impact Description & Justification"}),e.jsx(G,{className:"min-h-[100px]",placeholder:"Describe the impact scenario...",value:l[t.id],onChange:j=>i({...l,[t.id]:j.target.value}),onBlur:()=>c(t.id)})]})]},t.id))})]})}function Ke({biaId:p}){const{data:s,refetch:m}=y.businessContinuity.bia.seasonality.list.useQuery({biaId:p}),r=y.businessContinuity.bia.seasonality.create.useMutation({onSuccess:()=>{b.success("Event added"),m(),o({name:"",startDate:"",endDate:"",impactDescription:""})}}),l=y.businessContinuity.bia.seasonality.delete.useMutation({onSuccess:()=>{b.success("Event removed"),m()}}),[i,o]=v.useState({name:"",startDate:"",endDate:"",impactDescription:""}),h=()=>{i.name&&r.mutate({biaId:p,...i})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(k,{children:[e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Seasonality & Peak Periods"]}),e.jsx(J,{children:"Identify times of year when a disruption would be more severe (e.g., end-of-month processing, holiday sales)."})]}),e.jsx(T,{className:"space-y-4",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(w,{children:"Event Name"}),e.jsx(w,{children:"Start Date (approx)"}),e.jsx(w,{children:"End Date (approx)"}),e.jsx(w,{children:"Impact Description"}),e.jsx(w,{className:"w-[50px]"})]})}),e.jsxs(Z,{children:[s==null?void 0:s.map(a=>e.jsxs(L,{children:[e.jsx(d,{className:"font-medium",children:a.name}),e.jsx(d,{children:a.startDate}),e.jsx(d,{children:a.endDate}),e.jsx(d,{children:a.impactDescription}),e.jsx(d,{children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>l.mutate({id:a.id}),children:e.jsx(ve,{className:"w-4 h-4 text-red-500"})})})]},a.id)),e.jsxs(L,{children:[e.jsx(d,{children:e.jsx(M,{placeholder:"e.g. Black Friday",value:i.name,onChange:a=>o({...i,name:a.target.value})})}),e.jsx(d,{children:e.jsx(M,{placeholder:"Nov 20",value:i.startDate,onChange:a=>o({...i,startDate:a.target.value})})}),e.jsx(d,{children:e.jsx(M,{placeholder:"Dec 01",value:i.endDate,onChange:a=>o({...i,endDate:a.target.value})})}),e.jsx(d,{children:e.jsx(M,{placeholder:"Revenue hit...",value:i.impactDescription,onChange:a=>o({...i,impactDescription:a.target.value})})}),e.jsx(d,{children:e.jsx(C,{size:"sm",onClick:h,disabled:!i.name,children:e.jsx(ee,{className:"w-4 h-4"})})})]})]})]})})]}),e.jsxs(k,{className:"border-l-4 border-l-yellow-500",children:[e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-600"}),"Single Points of Failure (SPOF)"]}),e.jsx(J,{children:"List any resources (people, technology, suppliers) where no redundancy exists."})]}),e.jsx(T,{children:e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-md text-yellow-800 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Guidance:"})," Ensure you have identified keys to the kingdom, unique specialized staff, or legacy hardware."]}),e.jsxs("p",{className:"mt-2",children:["Use the ",e.jsx("strong",{children:'"Dependencies"'})," section in Qualitative Analysis to document these."]})]})})]})]})}function Je({biaId:p}){const{data:s,refetch:m}=y.businessContinuity.bia.vitalRecords.list.useQuery({biaId:p}),r=y.businessContinuity.bia.vitalRecords.create.useMutation({onSuccess:()=>{b.success("Record added"),m(),o({recordName:"",mediaType:"Digital",location:"",backupMethod:"",rto:""})}}),l=y.businessContinuity.bia.vitalRecords.delete.useMutation({onSuccess:()=>{b.success("Record removed"),m()}}),[i,o]=v.useState({recordName:"",mediaType:"Digital",location:"",backupMethod:"",rto:""}),h=()=>{i.recordName&&r.mutate({biaId:p,...i})};return e.jsxs(k,{children:[e.jsxs(I,{children:[e.jsx(P,{children:"Vital Records & Data"}),e.jsx(J,{children:"Essential documents or data required to perform this process during a disruption."})]}),e.jsx(T,{children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(w,{children:"Record Name"}),e.jsx(w,{children:"Format"}),e.jsx(w,{children:"Location / System"}),e.jsx(w,{children:"Backup / Access Method"}),e.jsx(w,{children:"RTO"}),e.jsx(w,{className:"w-[50px]"})]})}),e.jsxs(Z,{children:[s==null?void 0:s.map(a=>e.jsxs(L,{children:[e.jsx(d,{className:"font-medium",children:a.recordName}),e.jsx(d,{children:a.mediaType}),e.jsx(d,{children:a.location}),e.jsx(d,{children:a.backupMethod}),e.jsx(d,{children:a.rto}),e.jsx(d,{children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>l.mutate({id:a.id}),children:e.jsx(ve,{className:"w-4 h-4 text-red-500"})})})]},a.id)),e.jsxs(L,{children:[e.jsx(d,{children:e.jsx(M,{placeholder:"e.g. Client Contracts",value:i.recordName,onChange:a=>o({...i,recordName:a.target.value})})}),e.jsx(d,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.mediaType,onChange:a=>o({...i,mediaType:a.target.value}),children:[e.jsx("option",{value:"Digital",children:"Digital"}),e.jsx("option",{value:"Physical",children:"Physical (Paper)"}),e.jsx("option",{value:"Hybrid",children:"Hybrid"})]})}),e.jsx(d,{children:e.jsx(M,{placeholder:"SharePoint / Cabinet 3",value:i.location,onChange:a=>o({...i,location:a.target.value})})}),e.jsx(d,{children:e.jsx(M,{placeholder:"Cloud Backup / Key",value:i.backupMethod,onChange:a=>o({...i,backupMethod:a.target.value})})}),e.jsx(d,{children:e.jsx(M,{placeholder:"4 hours",value:i.rto,onChange:a=>o({...i,rto:a.target.value})})}),e.jsx(d,{children:e.jsx(C,{size:"sm",onClick:h,disabled:!i.recordName,children:e.jsx(ee,{className:"w-4 h-4"})})})]})]})]})})]})}function Us(){const p=be(),s=parseInt(p.biaId||"0"),m=parseInt(p.id||"0"),{data:r,isLoading:l,refetch:i}=y.businessContinuity.bia.get.useQuery({id:s,clientId:m},{enabled:!!s&&!!m});y.businessContinuity.bia.updateStatus.useMutation();const o=y.businessContinuity.bia.saveResponse.useMutation(),[h,a]=v.useState({}),[c,n]=v.useState({}),[t,j]=v.useState(!1);v.useEffect(()=>{if(r!=null&&r.questions){const f={},R={};r.questions.forEach(N=>{N.response&&(f[N.id]=N.response),N.notes&&(R[N.id]=N.notes)}),a(f),n(R)}},[r]);const u=async f=>{j(!0);try{await o.mutateAsync({questionId:f,response:h[f]||"",notes:c[f]||""}),b.success("Response saved")}catch{b.error("Failed to save response")}finally{j(!1)}};if(l)return e.jsx(ae,{children:e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(ue,{className:"w-8 h-8 animate-spin"})})});if(!r)return e.jsx(ae,{children:e.jsx("div",{className:"p-8",children:"BIA not found."})});const g=r.questions.reduce((f,R)=>(f[R.category||"General"]||(f[R.category||"General"]=[]),f[R.category||"General"].push(R),f),{});return e.jsx(ae,{children:e.jsxs("div",{className:"p-8 max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ce,{href:`/clients/${m}/business-continuity/bia`,children:e.jsxs(C,{variant:"ghost",size:"sm",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Back"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("span",{children:"Status:"}),e.jsx(te,{variant:r.status==="approved"?"default":"secondary",children:r.status})]})]})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsx(ze,{entityType:"bia",entityId:s}),e.jsx("div",{className:"space-y-6",children:e.jsxs(ke,{defaultValue:"questionnaire",className:"w-full",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-4",children:[e.jsx(Q,{value:"questionnaire",children:"1. Qualitative"}),e.jsx(Q,{value:"context",children:"2. Context & SPOF"}),e.jsx(Q,{value:"timebased",children:"3. Time-Based"}),e.jsx(Q,{value:"financial",children:"4. Financial"}),e.jsx(Q,{value:"records",children:"5. Vital Records"}),e.jsx(Q,{value:"security",children:"6. Security (CIA)"}),e.jsx(Q,{value:"recovery",children:"7. Recovery (RTO)"})]}),e.jsx($,{value:"questionnaire",className:"mt-6 space-y-6",children:Object.entries(g).map(([f,R])=>e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs(P,{children:[f," Impact"]})}),e.jsx(T,{className:"space-y-6",children:R.map(N=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(A,{className:"text-base font-medium",children:N.question}),e.jsxs(te,{variant:"outline",children:[N.impactLevel," Impact"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"text-xs text-muted-foreground",children:"Response"}),e.jsx(G,{placeholder:"Describe the impact...",value:h[N.id]||"",onChange:O=>a({...h,[N.id]:O.target.value}),onBlur:()=>u(N.id)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"text-xs text-muted-foreground",children:"Notes / Mitigation"}),e.jsx(M,{value:c[N.id]||"",onChange:O=>n({...c,[N.id]:O.target.value}),onBlur:()=>u(N.id),className:"h-8",placeholder:"Additional notes..."})]})]},N.id))})]},f))}),e.jsx($,{value:"context",className:"mt-6",children:e.jsx(Ke,{biaId:s})}),e.jsx($,{value:"timebased",className:"mt-6",children:e.jsx(qe,{biaId:s})}),e.jsx($,{value:"financial",className:"mt-6",children:e.jsx(Ge,{biaId:s})}),e.jsx($,{value:"records",className:"mt-6",children:e.jsx(Je,{biaId:s})}),e.jsx($,{value:"security",className:"mt-6",children:e.jsx(_e,{biaId:s})}),e.jsx($,{value:"recovery",className:"mt-6",children:e.jsx(Ve,{biaId:s})})]})}),e.jsx(Qe,{entityType:"bia",entityId:s})]})})}export{Us as default};
