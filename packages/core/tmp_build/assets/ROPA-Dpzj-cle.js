import{b as D,ac as y,t as m,j as e,C as I,d as P,e as T,F as A,f as B,m as F,c as x,r as C,i as b,a6 as M,bt as L,a7 as E,bu as k,a8 as O,a9 as R,L as d,E as p,G as u,H as j,J as g,K as i,I as f}from"./index-DOc7Nwb7.js";import{B as U}from"./Breadcrumb-CRi3LAxS.js";import{T as N}from"./textarea-BtxBxzdY.js";import{S as V}from"./scroll-area-DPaNxEJD.js";import{A as $,a as G,b as H,c as Q}from"./accordion-BvRtf4FI.js";import{P as q}from"./PageGuide-CPKKXXS6.js";import{P as z}from"./plus-BaQ35Jcx.js";import{D as J}from"./database-Bjtecw5f.js";import{T as K}from"./trash-2-CFEfisbM.js";import"./index--2vFva6Y.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";function me(){const[,l]=D(),{selectedClientId:c}=y(),{data:n,isLoading:o}=m.businessContinuity.processes.list.useQuery({clientId:c||0},{enabled:!!c});return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx(U,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Privacy",href:`/clients/${c}/privacy`},{label:"ROPA"}]}),e.jsx("div",{className:"flex items-center justify-between animate-slide-down",children:e.jsx(q,{title:"Record of Processing Activities",description:"Maintain a comprehensive inventory of personal data processing activities.",rationale:"GDPR Article 30 requires maintaining a record of processing activities under your responsibility.",howToUse:[{step:"Map",description:"Identify business processes and associate them with data flows."},{step:"Classify",description:"Detail data elements, subjects, legal basis, and retention periods."},{step:"Maintain",description:"Regularly review and update records to reflect operational changes."}]})}),e.jsxs(I,{className:"flex-1",children:[e.jsxs(P,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-purple-500"}),"Processing Activities"]}),e.jsx(B,{children:"Select a business process to view or add data flows."})]}),e.jsx(F,{children:o?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading processes..."}):!n||n.length===0?e.jsxs("div",{className:"py-12 text-center text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx("p",{children:"No business processes found."}),e.jsx(x,{variant:"link",onClick:()=>l(`/clients/${c}/business-continuity/processes`),children:"Create a process first"})]}):e.jsx($,{type:"single",collapsible:!0,className:"w-full",children:n.map((s,t)=>e.jsx(W,{process:s,value:`item-${t}`},s.id))})})]})]})}function W({process:l,value:c}){const{selectedClientId:n}=y(),[o,s]=C.useState(!1),{data:t,refetch:h}=m.privacy.getProcessDataFlows.useQuery({processId:l.id},{enabled:!1});m.useUtils();const{data:a}=m.assets.list.useQuery({clientId:n||0},{enabled:!!n}),v=m.privacy.addProcessDataFlow.useMutation({onSuccess:()=>{b.success("Data flow added"),h(),s(!1)}}),S=m.privacy.deleteProcessDataFlow.useMutation({onSuccess:()=>{b.success("Data flow removed"),h()}});return e.jsxs(G,{value:c,children:[e.jsx(H,{onClick:()=>h(),className:"hover:bg-slate-50 px-4 rounded-md",children:e.jsx("div",{className:"flex items-center gap-4 text-left",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:l.name}),e.jsx("span",{className:"font-normal text-xs text-muted-foreground",children:l.department||"No Dept"})]})})}),e.jsx(Q,{className:"px-4 pb-4 pt-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"text-xs font-semibold uppercase text-muted-foreground tracking-wider",children:"Data Flows"}),e.jsxs(M,{open:o,onOpenChange:s,children:[e.jsx(L,{asChild:!0,children:e.jsxs(x,{size:"sm",variant:"outline",className:"h-8",children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," Add Data Flow"]})}),e.jsxs(E,{className:"w-[400px] sm:w-[600px] sm:max-w-[600px]",children:[e.jsxs(k,{children:[e.jsx(O,{children:"Add Data Flow"}),e.jsxs(R,{children:["Map a data asset or data element to ",e.jsx("strong",{children:l.name}),"."]})]}),e.jsx(Y,{processId:l.id,assets:a||[],onSubmit:r=>v.mutate({...r,clientId:n}),loading:v.isPending})]})]})]}),!t||t.length===0?e.jsx("div",{className:"text-center py-6 bg-slate-50 rounded-md border border-dashed",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No data flows mapped to this process yet."})}):e.jsx("div",{className:"grid gap-3",children:t.map(({flow:r,assetName:w})=>e.jsxs("div",{className:"group flex items-start justify-between p-3 border rounded-lg bg-white shadow-sm hover:border-purple-200 transition-colors",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-sm",children:w||r.dataElements||"Unspecified Data"}),e.jsx(Badge,{variant:"secondary",className:"text-[10px] h-5",children:r.interactionType||"Use"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground pl-6 grid grid-cols-2 gap-x-8 gap-y-1 mt-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Legal Basis:"})," ",r.legalBasis||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Subjects:"})," ",r.dataSubjectType||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Retention:"})," ",r.retentionPeriod||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Transfer:"})," ",r.isCrossBorder?`Yes (${r.transferMechanism})`:"No"]})]})]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>confirm("Delete this flow?")&&S.mutate({flowId:r.id,clientId:n}),children:e.jsx(K,{className:"h-4 w-4"})})]},r.id))})]})})]})}function Y({processId:l,assets:c,onSubmit:n,loading:o}){const[s,t]=C.useState({processId:l,assetId:null,dataElements:"",interactionType:"Collection",legalBasis:"Legitimate Interests",purpose:"",dataSubjectType:"Employees",recipients:"Internal Only",isCrossBorder:!1,transferMechanism:"",retentionPeriod:"Indefinite",disposalMethod:"Deletion"}),h=()=>{n(s)};return e.jsx(V,{className:"h-[calc(100vh-140px)] pr-4 mt-6",children:e.jsxs("div",{className:"grid gap-5",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Associated Asset (Optional)"}),e.jsxs(p,{onValueChange:a=>t({...s,assetId:parseInt(a),dataElements:""}),children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select a data asset..."})}),e.jsxs(g,{children:[e.jsx(i,{value:"0",children:"-- No Specific Asset --"}),c.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id))]})]})]}),!s.assetId&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Data Elements Description"}),e.jsx(N,{placeholder:"e.g. Names, Email Addresses, IP Addresses",value:s.dataElements,onChange:a=>t({...s,dataElements:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Interaction Type"}),e.jsxs(p,{value:s.interactionType,onValueChange:a=>t({...s,interactionType:a}),children:[e.jsx(u,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(i,{value:"Collection",children:"Collection"}),e.jsx(i,{value:"Storage",children:"Storage"}),e.jsx(i,{value:"Transmission",children:"Transmission"}),e.jsx(i,{value:"Use",children:"Use"}),e.jsx(i,{value:"Deletion",children:"Deletion"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Legal Basis"}),e.jsxs(p,{value:s.legalBasis,onValueChange:a=>t({...s,legalBasis:a}),children:[e.jsx(u,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(i,{value:"Consent",children:"Consent"}),e.jsx(i,{value:"Contract",children:"Contract"}),e.jsx(i,{value:"Legal Obligation",children:"Legal Obligation"}),e.jsx(i,{value:"Vital Interests",children:"Vital Interests"}),e.jsx(i,{value:"Public Task",children:"Public Task"}),e.jsx(i,{value:"Legitimate Interests",children:"Legitimate Interests"})]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Purpose of Processing"}),e.jsx(N,{placeholder:"Why is this data being processed?",value:s.purpose,onChange:a=>t({...s,purpose:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Data Subjects"}),e.jsx(f,{value:s.dataSubjectType,onChange:a=>t({...s,dataSubjectType:a.target.value}),placeholder:"e.g. Employees, Customers, Patients"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Retention Period"}),e.jsx(f,{value:s.retentionPeriod,onChange:a=>t({...s,retentionPeriod:a.target.value}),placeholder:"e.g. 7 years, Duration of employment"})]}),e.jsxs("div",{className:"flex items-center space-x-2 my-2",children:[e.jsx("input",{type:"checkbox",id:"xcross",checked:s.isCrossBorder,onChange:a=>t({...s,isCrossBorder:a.target.checked}),className:"rounded border-gray-300"}),e.jsx(d,{htmlFor:"xcross",children:"Cross-Border Transfer?"})]}),s.isCrossBorder&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Transfer Mechanism"}),e.jsx(f,{value:s.transferMechanism,onChange:a=>t({...s,transferMechanism:a.target.value}),placeholder:"e.g. SCCs, Adequacy Decision"})]}),e.jsx(x,{className:"mt-4",onClick:h,disabled:o,children:o?"Adding...":"Add Data Flow"})]})})}export{me as default};
