import{u as ye,r as u,t as x,i as c,j as e,C as z,d as Z,e as xe,m as W,X as be,Y as De,c as p,F as Y,k as V,L as o,E as g,G as v,H as f,J as N,K as l,I as T}from"./index-DOc7Nwb7.js";import{E as oe}from"./enhanced-dialog-CeRPsI16.js";import{S as we}from"./separator-BWuYil37.js";import{T as ee}from"./textarea-BtxBxzdY.js";import{T as Se,a as Ce,b as O,c as Q}from"./tabs-CBDTXbEn.js";import{A as Ie,a as Ae,b as Ee,c as Re,d as Te,e as ke,f as Fe,g as Me}from"./alert-dialog-V7xGXdVc.js";import{M as ue}from"./message-square-5hBo7zY3.js";import{T as he}from"./trash-2-CFEfisbM.js";import{S as qe}from"./send-FW7-3cjH.js";import{k as Le,l as Pe}from"./DashboardLayout-aHnUqq57.js";import{U as me}from"./user-CqRnJLgW.js";import{U as Ue}from"./upload-BBmUECj8.js";import{D as Ve}from"./download-ByfWg1Mi.js";import{C as Oe}from"./calendar-BlLJlGbj.js";function Qe({clientId:C,entityType:k,entityId:t}){const{user:d}=ye(),[m,F]=u.useState(""),[y,b]=u.useState(null),{data:h,isLoading:M,refetch:I}=x.comments.list.useQuery({clientId:C,entityType:k,entityId:t}),A=x.comments.create.useMutation({onSuccess:()=>{c.success("Comment added"),F(""),I()},onError:n=>{c.error(n.message||"Failed to add comment")}}),D=x.comments.delete.useMutation({onSuccess:()=>{c.success("Comment deleted"),I()},onError:n=>{c.error(n.message||"Failed to delete comment")}}),w=n=>{n.preventDefault(),m.trim()&&A.mutate({clientId:C,entityType:k,entityId:t,content:m})},q=n=>{b(n)},L=()=>{y&&(D.mutate({id:y,clientId:C}),b(null))},E=n=>n.split(" ").map(se=>se[0]).join("").toUpperCase().substring(0,2);return e.jsxs(z,{className:"mt-6",children:[e.jsx(Z,{children:e.jsxs(xe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ue,{className:"h-5 w-5"}),"Comments (",(h==null?void 0:h.length)||0,")"]})}),e.jsxs(W,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:M?e.jsx("div",{className:"text-center text-muted-foreground py-4",children:"Loading comments..."}):(h==null?void 0:h.length)===0?e.jsx("div",{className:"text-center text-muted-foreground py-4",children:"No comments yet. Start the conversation!"}):h==null?void 0:h.map(n=>e.jsxs("div",{className:"flex gap-3 group",children:[e.jsx(be,{className:"h-8 w-8",children:e.jsx(De,{children:E(n.user.name||"User")})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:n.user.name||"Unknown User"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Le(new Date(n.comment.createdAt),{addSuffix:!0})})]}),((d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="owner"||(d==null?void 0:d.role)==="super_admin"||(d==null?void 0:d.id)===n.user.id)&&e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>q(n.comment.id),children:e.jsx(he,{className:"h-3 w-3 text-destructive"})})]}),e.jsx("p",{className:"text-sm leading-relaxed",children:n.comment.content})]})]},n.comment.id))}),e.jsxs("form",{onSubmit:w,className:"flex gap-2 items-start mt-4 pt-4 border-t",children:[e.jsx(ee,{placeholder:"Write a comment...",value:m,onChange:n=>F(n.target.value),className:"min-h-[80px] flex-1 font-sans",onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),w(n))}}),e.jsx(p,{type:"submit",disabled:!m.trim()||A.isPending,size:"icon",className:"h-[80px] w-12",children:e.jsx(qe,{className:"h-5 w-5"})})]})]}),e.jsx(Ie,{open:!!y,onOpenChange:n=>!n&&b(null),children:e.jsxs(Ae,{children:[e.jsxs(Ee,{children:[e.jsx(Re,{children:"Delete Comment?"}),e.jsx(Te,{children:"Are you sure you want to delete this comment?"})]}),e.jsxs(ke,{children:[e.jsx(Fe,{children:"Cancel"}),e.jsx(Me,{className:"bg-red-600 hover:bg-red-700",onClick:n=>{n.preventDefault(),L()},children:"Delete"})]})]})})]})}function ns({open:C,onOpenChange:k,clientControl:t,control:d,clientId:m,onUpdate:F}){const[y,b]=u.useState(t.implementationNotes||""),[h,M]=u.useState(t.implementationDate?new Date(t.implementationDate).toISOString().split("T")[0]:""),[I,A]=u.useState(t.status),[D,w]=u.useState("");u.useEffect(()=>{const i=(t.implementationNotes||"").match(/Monitoring Frequency: (.*)$/m);w(i?i[1]:"Manual")},[t]);const[q,L]=u.useState(t.evidenceLocation||""),[E,n]=u.useState(null),[se,ze]=u.useState(null),je=x.useUtils(),{data:r}=x.users.listWorkspaceMembers.useQuery({clientId:m}),{data:_,refetch:te}=x.evidence.list.useQuery({clientId:m}),S=_==null?void 0:_.filter(s=>{var i;return((i=s.evidence)==null?void 0:i.clientControlId)===t.id}),{data:a,refetch:ne}=x.taskAssignments.summary.useQuery({taskType:"control",taskId:t.id}),P=x.taskAssignments.assignUser.useMutation({onSuccess:()=>{c.success("RACI assignment added"),ne()},onError:s=>c.error(s.message)}),U=x.taskAssignments.remove.useMutation({onSuccess:()=>{c.success("Assignment removed"),ne()},onError:s=>c.error(s.message)}),$=x.clientControls.update.useMutation({onSuccess:()=>{c.success("Control updated successfully"),F(),je.clientControls.list.invalidate({clientId:m})},onError:s=>c.error(s.message)}),B=x.evidence.create.useMutation({onSuccess:()=>{c.success("Evidence added"),te(),document.getElementById("description").value="",document.getElementById("location").value=""},onError:s=>c.error(s.message)}),H=x.evidence.delete.useMutation({onSuccess:()=>{c.success("Evidence deleted"),te(),n(null)},onError:s=>c.error(s.message)}),{data:j}=x.clientControls.getMappings.useQuery({controlId:(t==null?void 0:t.controlId)||0},{enabled:!!t}),K=x.clientControls.sync.useMutation({onSuccess:()=>{c.success("Status and evidence synced to related controls")},onError:s=>c.error(s.message)}),[G,ae]=u.useState(!1),[J,ie]=u.useState(""),[le,pe]=u.useState(""),[de,ce]=u.useState(""),{data:R,refetch:ge}=x.evidenceRequests.list.useQuery({clientId:m,clientControlId:t.id}),X=x.evidenceRequests.create.useMutation({onSuccess:()=>{c.success("Request sent"),ae(!1),ie(""),ce(""),ge()},onError:s=>c.error(s.message)}),ve=()=>{if(!J)return c.error("Select an assignee");X.mutate({clientId:m,clientControlId:t.id,assigneeId:parseInt(J),dueDate:le,description:de})};u.useEffect(()=>{const s=t.implementationNotes||"",i=s.match(/Monitoring Frequency: (.*)$/m);w(i?i[1]:"Manual"),b(s.replace(/\n\nMonitoring Frequency: .*$/m,"").trim()),M(t.implementationDate?new Date(t.implementationDate).toISOString().split("T")[0]:""),A(t.status),L(t.evidenceLocation||"")},[t]);const fe=()=>{let s=y.trim();D&&D!=="Manual"&&(s=`${s}

Monitoring Frequency: ${D}`),$.mutate({clientId:m,id:t.id,implementationNotes:s||void 0,implementationDate:h?new Date(h):void 0,status:I,evidenceLocation:q||void 0})},Ne=s=>{s.preventDefault();const i=new FormData(s.currentTarget);B.mutate({clientId:m,clientControlId:t.id,description:i.get("description"),type:i.get("type"),location:i.get("location"),owner:i.get("evidenceOwner")}),s.currentTarget.reset()};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{open:C,onOpenChange:k,size:"lg",className:"max-w-4xl",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm text-slate-500 bg-slate-100 px-2 py-0.5 rounded border border-slate-200",children:t.clientControlId}),e.jsx("span",{children:d==null?void 0:d.name})]}),description:(d==null?void 0:d.description)||"No description available",children:e.jsxs(Se,{defaultValue:"implementation",className:"mt-4",children:[e.jsxs(Ce,{className:"grid w-full grid-cols-4",children:[e.jsxs(O,{value:"implementation",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Implementation"]}),e.jsxs(O,{value:"evidence",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Evidence (",(S==null?void 0:S.length)||0,")"]}),e.jsx(O,{value:"related",children:e.jsxs("div",{className:"flex items-center",children:["Related Controls",j&&j.length>0&&e.jsx(V,{variant:"secondary",className:"ml-2 h-5 px-1.5 text-xs",children:j.length})]})}),e.jsxs(O,{value:"discussion",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Discussion"]})]}),e.jsxs(Q,{value:"implementation",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsxs(g,{value:I,onValueChange:A,children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsxs(N,{children:[e.jsx(l,{value:"not_implemented",children:"Not Implemented"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"implemented",children:"Implemented"}),e.jsx(l,{value:"not_applicable",children:"Not Applicable"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"monitoring",children:"Monitoring Frequency"}),e.jsxs(g,{value:D,onValueChange:w,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select frequency"})}),e.jsxs(N,{children:[e.jsx(l,{value:"Manual",children:"Manual / Ad-hoc"}),e.jsx(l,{value:"Daily",children:"Daily"}),e.jsx(l,{value:"Weekly",children:"Weekly"}),e.jsx(l,{value:"Monthly",children:"Monthly"}),e.jsx(l,{value:"Quarterly",children:"Quarterly"}),e.jsx(l,{value:"Annually",children:"Annually"}),e.jsx(l,{value:"Continuous",children:"Continuous (Automated)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"implementationDate",children:"Implementation Date"}),e.jsx(T,{id:"implementationDate",type:"date",value:h,onChange:s=>M(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(o,{className:"text-base font-semibold",children:"RACI Assignments"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-red-100 text-red-800 text-xs font-bold",children:"R"}),e.jsx(o,{children:"Responsible"})]}),e.jsxs(g,{value:"",onValueChange:s=>{P.mutate({clientId:m,userId:parseInt(s),taskType:"control",taskId:t.id,raciRole:"responsible"})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Add employee..."})}),e.jsx(N,{children:r==null?void 0:r.filter(s=>!(a!=null&&a.responsible.some(i=>i.id===s.id))).map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a==null?void 0:a.responsible.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-800 rounded text-xs",children:[s.firstName," ",s.lastName,e.jsx("button",{type:"button",onClick:()=>{s.assignmentId&&U.mutate({assignmentId:s.assignmentId})},className:"hover:text-red-600",children:"×"})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-blue-100 text-blue-800 text-xs font-bold",children:"A"}),e.jsx(o,{children:"Accountable"})]}),e.jsxs(g,{value:"",onValueChange:s=>{P.mutate({clientId:m,userId:parseInt(s),taskType:"control",taskId:t.id,raciRole:"accountable"})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Add employee..."})}),e.jsx(N,{children:r==null?void 0:r.filter(s=>!(a!=null&&a.accountable.some(i=>i.id===s.id))).map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a==null?void 0:a.accountable.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:[s.firstName," ",s.lastName,e.jsx("button",{type:"button",onClick:()=>{s.assignmentId&&U.mutate({assignmentId:s.assignmentId})},className:"hover:text-blue-600",children:"×"})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-green-100 text-green-800 text-xs font-bold",children:"C"}),e.jsx(o,{children:"Consulted"})]}),e.jsxs(g,{value:"",onValueChange:s=>{P.mutate({clientId:m,userId:parseInt(s),taskType:"control",taskId:t.id,raciRole:"consulted"})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Add employee..."})}),e.jsx(N,{children:r==null?void 0:r.filter(s=>!(a!=null&&a.consulted.some(i=>i.id===s.id))).map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a==null?void 0:a.consulted.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:[s.firstName," ",s.lastName,e.jsx("button",{type:"button",onClick:()=>{s.assignmentId&&U.mutate({assignmentId:s.assignmentId})},className:"hover:text-green-600",children:"×"})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-yellow-100 text-yellow-800 text-xs font-bold",children:"I"}),e.jsx(o,{children:"Informed"})]}),e.jsxs(g,{value:"",onValueChange:s=>{P.mutate({clientId:m,userId:parseInt(s),taskType:"control",taskId:t.id,raciRole:"informed"})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Add employee..."})}),e.jsx(N,{children:r==null?void 0:r.filter(s=>!(a!=null&&a.informed.some(i=>i.id===s.id))).map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a==null?void 0:a.informed.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs",children:[s.firstName," ",s.lastName,e.jsx("button",{type:"button",onClick:()=>{s.assignmentId&&U.mutate({assignmentId:s.assignmentId})},className:"hover:text-yellow-600",children:"×"})]},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"evidenceLocation",children:"Evidence Location (URL or Path)"}),e.jsx(T,{id:"evidenceLocation",value:q,onChange:s=>L(s.target.value),placeholder:"https://drive.google.com/... or /path/to/evidence"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"implementationNotes",children:"Implementation Notes"}),e.jsx(ee,{id:"implementationNotes",value:y,onChange:s=>b(s.target.value),placeholder:"Document how this control was implemented, any exceptions, compensating controls, or relevant details...",rows:4})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{onClick:fe,disabled:$.isPending,children:$.isPending?"Saving...":"Save Changes"})})]}),e.jsxs(Q,{value:"evidence",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"})," Evidence Requests"]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>ae(!G),children:G?"Cancel":"New Request"})]}),G&&e.jsxs("div",{className:"bg-white p-4 rounded border mb-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Assignee"}),e.jsxs(g,{onValueChange:ie,value:J,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select employee..."})}),e.jsx(N,{children:r==null?void 0:r.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Due Date"}),e.jsx(T,{type:"date",value:le,onChange:s=>pe(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Instructions"}),e.jsx(ee,{placeholder:"What evidence is needed?",value:de,onChange:s=>ce(s.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{size:"sm",onClick:ve,disabled:X.isPending,children:X.isPending?"Sending...":"Send Request"})})]}),e.jsxs("div",{className:"space-y-2",children:[R==null?void 0:R.map(s=>{var i,re;return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded border text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[(i=s.assignee)==null?void 0:i.firstName," ",(re=s.assignee)==null?void 0:re.lastName]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.request.description," • Due: ",s.request.dueDate?new Date(s.request.dueDate).toLocaleDateString():"None"]})]}),e.jsx(V,{variant:s.request.status==="open"?"secondary":"outline",children:s.request.status})]},s.request.id)}),(!R||R.length===0)&&e.jsx("div",{className:"text-center text-xs text-muted-foreground py-2",children:"No active requests"})]})]}),e.jsx(we,{}),e.jsxs(z,{children:[e.jsx(Z,{children:e.jsx(xe,{className:"text-sm",children:"Upload Evidence"})}),e.jsx(W,{className:"pt-0",children:e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Description *"}),e.jsx(T,{id:"description",name:"description",required:!0,placeholder:"Evidence description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"type",children:"Type"}),e.jsxs(g,{name:"type",defaultValue:"Document",children:[e.jsx(v,{children:e.jsx(f,{})}),e.jsxs(N,{children:[e.jsx(l,{value:"Document",children:"Document"}),e.jsx(l,{value:"Screenshot",children:"Screenshot"}),e.jsx(l,{value:"Log",children:"Log"}),e.jsx(l,{value:"Configuration",children:"Configuration"}),e.jsx(l,{value:"Report",children:"Report"}),e.jsx(l,{value:"Certificate",children:"Certificate"}),e.jsx(l,{value:"Other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"location",children:"Location (URL or Path)"}),e.jsx(T,{id:"location",name:"location",placeholder:"https://... or file path"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"evidenceOwner",children:"Owner"}),e.jsxs(g,{name:"evidenceOwner",children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select owner"})}),e.jsx(N,{children:r==null?void 0:r.map(s=>e.jsx(l,{value:s.name,children:s.name},s.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{type:"submit",disabled:B.isPending,children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),B.isPending?"Adding...":"Add Evidence"]})})]})})]}),S&&S.length>0?e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsx(z,{children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.evidence.description}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-muted rounded",children:s.evidence.type})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[s.evidence.location&&e.jsxs("a",{href:s.evidence.location,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary hover:underline",children:[e.jsx(Ve,{className:"h-3 w-3"}),"View"]}),s.evidence.owner&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),s.evidence.owner]}),s.evidence.lastVerified&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),"Verified: ",new Date(s.evidence.lastVerified).toLocaleDateString()]})]})]}),e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>n(s.evidence.id),children:e.jsx(he,{className:"h-4 w-4"})})]})})},s.evidence.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No evidence attached to this control yet"}),e.jsx("p",{className:"text-sm",children:"Use the form above to add evidence"})]})]}),e.jsxs(Q,{value:"related",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-muted/50 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Cross-Framework Mappings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically propagate specific implementation details to related controls."})]}),e.jsx(p,{onClick:()=>K.mutate({sourceClientControlId:(t==null?void 0:t.id)||0}),disabled:K.isPending||((j==null?void 0:j.length)||0)===0,children:K.isPending?"Syncing...":"Sync Status & Evidence"})]}),e.jsxs("div",{className:"grid gap-4",children:[j==null?void 0:j.map(s=>e.jsxs(z,{children:[e.jsx(Z,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"outline",children:s.targetControl.framework}),e.jsx("span",{className:"font-semibold",children:s.targetControl.controlId})]}),e.jsx(V,{variant:"secondary",children:s.mapping.relationship})]})}),e.jsxs(W,{children:[e.jsx("p",{className:"text-sm font-medium",children:s.targetControl.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.targetControl.description})]})]},s.targetControl.id)),(j==null?void 0:j.length)===0&&e.jsx("div",{className:"text-center py-12 border-2 border-dashed rounded-lg text-muted-foreground",children:"No mapped controls found for this item."})]})]}),e.jsx(Q,{value:"discussion",className:"mt-4",children:e.jsx(Qe,{entityType:"control",entityId:t.id})})]})}),e.jsx(oe,{open:E!==null,onOpenChange:s=>!s&&n(null),title:"Delete Evidence",description:"Are you sure you want to delete this evidence? This action cannot be undone.",size:"sm",footer:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(p,{variant:"outline",onClick:()=>n(null),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:()=>{E&&(H.mutate({id:E}),n(null))},disabled:H.isPending,children:H.isPending?"Deleting...":"Delete Evidence"})]}),children:e.jsx("div",{className:"py-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will permanently remove the evidence file and its metadata."})})})]})}export{Qe as C,ns as a};
