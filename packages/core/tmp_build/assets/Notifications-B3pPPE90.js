import{u as Q,b as V,r as N,t as r,i as n,j as e,C as u,d as h,e as f,f as j,m as p,L as c,E as _,G as J,H as K,J as q,K as y,S as z,F as X,T as M,c as b,ao as $,k as Y}from"./index-DOc7Nwb7.js";import{D as Z}from"./DashboardLayout-aHnUqq57.js";import{B as ee}from"./Breadcrumb-CRi3LAxS.js";import{S as m}from"./switch-B74-5eCi.js";import{S as v}from"./separator-BWuYil37.js";import{B as se}from"./settings-CIu9FFiX.js";import{M as I}from"./mail-xRDvl6QK.js";import{C as L}from"./calendar-BlLJlGbj.js";import{C as ie}from"./circle-check-big-BSqJVrgh.js";import{S as te}from"./send-FW7-3cjH.js";import{C as ae}from"./clock-osbacZli.js";import{f as ne}from"./format-H2tx8_vS.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./scroll-area-DPaNxEJD.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./differenceInCalendarDays-nctqlg7V.js";function Ke(){const{user:l,loading:T}=Q(),[B]=V(),[F,H]=N.useState(""),W=r.useUtils(),A=B.match(/\/clients\/(\d+)/),t=A?parseInt(A[1],10):null,{data:g}=r.clients.get.useQuery({id:t},{enabled:!!t,staleTime:6e4});N.useEffect(()=>{g!=null&&g.name&&H(g.name)},[g]);const{data:a,isLoading:le}=r.notifications.getSettings.useQuery({clientId:t},{enabled:!!t,staleTime:6e4,keepPreviousData:!0}),{data:w,isLoading:O}=r.notifications.getLogs.useQuery({clientId:t,limit:20},{enabled:!!t,staleTime:6e4,keepPreviousData:!0}),E=r.notifications.updateSettings.useMutation({onSuccess:()=>{W.notifications.getSettings.invalidate({clientId:t}),n.success("Notification settings updated")},onError:s=>{n.error(`Failed to update settings: ${s.message}`)}}),C=r.notifications.sendOverdueAlert.useMutation({onSuccess:s=>{s.itemCount>0?n.success(`Sent overdue alert for ${s.itemCount} items`):n.info("No overdue items to notify about")},onError:s=>{n.error(`Failed to send alert: ${s.message}`)}}),k=r.notifications.sendUpcomingAlert.useMutation({onSuccess:s=>{s.itemCount>0?n.success(`Sent upcoming alert for ${s.itemCount} items`):n.info("No upcoming items to notify about")},onError:s=>{n.error(`Failed to send alert: ${s.message}`)}}),R=r.notifications.sendDailyDigest.useMutation({onSuccess:s=>{n.success(`Daily digest sent: ${s.overdueCount} overdue, ${s.upcomingCount} upcoming`)},onError:s=>{n.error(`Failed to send digest: ${s.message}`)}}),D=r.notifications.sendWeeklyDigest.useMutation({onSuccess:s=>{n.success(`Weekly digest sent: ${s.overdueCount} overdue, ${s.upcomingCount} upcoming`)},onError:s=>{n.error(`Failed to send digest: ${s.message}`)}}),[i,S]=N.useState({emailEnabled:!0,upcomingReviewDays:7,overdueEnabled:!0,dailyDigestEnabled:!1,weeklyDigestEnabled:!0,notifyControlReviews:!0,notifyPolicyRenewals:!0,notifyEvidenceExpiration:!0,notifyRiskReviews:!0});N.useEffect(()=>{a&&S({emailEnabled:!!a.emailEnabled,upcomingReviewDays:a.upcomingReviewDays||7,overdueEnabled:!!a.overdueEnabled,dailyDigestEnabled:!!a.dailyDigestEnabled,weeklyDigestEnabled:!!a.weeklyDigestEnabled,notifyControlReviews:!!a.notifyControlReviews,notifyPolicyRenewals:!!a.notifyPolicyRenewals,notifyEvidenceExpiration:!!a.notifyEvidenceExpiration,notifyRiskReviews:!!a.notifyRiskReviews})},[a]);const o=s=>{const x=!i[s];S(P=>({...P,[s]:x})),t&&E.mutate({clientId:t,[s]:x})},U=s=>{const x=parseInt(s);S(P=>({...P,upcomingReviewDays:x})),t&&E.mutate({clientId:t,upcomingReviewDays:x})};if(T)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const G=(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="owner"||(l==null?void 0:l.role)==="super_admin",d=!a||E.isPending;return e.jsx(Z,{children:e.jsxs("div",{className:"space-y-6",children:[t&&F&&e.jsx(ee,{items:[{label:"Clients",href:"/clients"},{label:F,href:`/clients/${t}`},{label:"Notifications"}]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Notification Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure how you receive compliance alerts and reminders"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"General Settings"]}),e.jsx(j,{children:"Enable or disable notifications"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"emailEnabled",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),e.jsx(m,{id:"emailEnabled",checked:i.emailEnabled,onCheckedChange:()=>o("emailEnabled"),disabled:d})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"overdueEnabled",children:"Overdue Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about overdue items"})]}),e.jsx(m,{id:"overdueEnabled",checked:i.overdueEnabled,onCheckedChange:()=>o("overdueEnabled"),disabled:d||!i.emailEnabled})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Advance Notice Period"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"How many days before due date to notify"}),e.jsxs(_,{value:String(i.upcomingReviewDays),onValueChange:U,disabled:d||!i.emailEnabled,children:[e.jsx(J,{className:"w-full",children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(y,{value:"3",children:"3 days"}),e.jsx(y,{value:"5",children:"5 days"}),e.jsx(y,{value:"7",children:"7 days (recommended)"}),e.jsx(y,{value:"14",children:"14 days"}),e.jsx(y,{value:"30",children:"30 days"})]})]})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Digest Emails"]}),e.jsx(j,{children:"Summary emails of compliance status"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"dailyDigest",children:"Daily Digest"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a daily summary"})]}),e.jsx(m,{id:"dailyDigest",checked:i.dailyDigestEnabled,onCheckedChange:()=>o("dailyDigestEnabled"),disabled:d||!i.emailEnabled})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"weeklyDigest",children:"Weekly Digest"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a weekly summary"})]}),e.jsx(m,{id:"weeklyDigest",checked:i.weeklyDigestEnabled,onCheckedChange:()=>o("weeklyDigestEnabled"),disabled:d||!i.emailEnabled})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Event Types"]}),e.jsx(j,{children:"Choose which events trigger notifications"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"controlReviews",children:"Control Reviews"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Control review deadlines"})]})]}),e.jsx(m,{id:"controlReviews",checked:i.notifyControlReviews,onCheckedChange:()=>o("notifyControlReviews"),disabled:d||!i.emailEnabled})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-purple-500"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"policyRenewals",children:"Policy Renewals"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Policy renewal deadlines"})]})]}),e.jsx(m,{id:"policyRenewals",checked:i.notifyPolicyRenewals,onCheckedChange:()=>o("notifyPolicyRenewals"),disabled:d||!i.emailEnabled})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-orange-500"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"evidenceExpiration",children:"Evidence Expiration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Evidence expiration dates"})]})]}),e.jsx(m,{id:"evidenceExpiration",checked:i.notifyEvidenceExpiration,onCheckedChange:()=>o("notifyEvidenceExpiration"),disabled:d||!i.emailEnabled})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{htmlFor:"riskReviews",children:"Risk Reviews"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Risk assessment and treatment deadlines"})]})]}),e.jsx(m,{id:"riskReviews",checked:i.notifyRiskReviews,onCheckedChange:()=>o("notifyRiskReviews"),disabled:d||!i.emailEnabled})]})]})]}),G&&e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Send Notifications"]}),e.jsx(j,{children:"Manually trigger notification emails (Admin only)"})]}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(M,{className:"h-4 w-4 mr-2 text-red-500"}),C.isPending?"Sending...":"Send Overdue Alert"]}),e.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>k.mutate({days:7}),disabled:k.isPending,children:[e.jsx(ae,{className:"h-4 w-4 mr-2 text-yellow-500"}),k.isPending?"Sending...":"Send Upcoming Alert (7 days)"]}),e.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>R.mutate(),disabled:R.isPending,children:[e.jsx(L,{className:"h-4 w-4 mr-2 text-blue-500"}),R.isPending?"Sending...":"Send Daily Digest"]}),e.jsxs(b,{variant:"outline",className:"w-full justify-start",onClick:()=>D.mutate(),disabled:D.isPending,children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-green-500"}),D.isPending?"Sending...":"Send Weekly Digest"]})]})]})]}),O?e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Recent Notifications"]}),e.jsx(j,{children:"History of sent notifications"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,x)=>e.jsx("div",{className:"h-16 w-full bg-muted rounded"},x))})})]}):w&&w.length>0?e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Recent Notifications"]}),e.jsx(j,{children:"History of sent notifications"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsxs("div",{className:"flex items-start justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(Y,{variant:s.status==="sent"?"default":s.status==="failed"?"destructive":"secondary",children:s.status}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ne(new Date(s.sentAt),"MMM d, h:mm a")})]})]},s.id))})})]}):null]})})}export{Ke as default};
