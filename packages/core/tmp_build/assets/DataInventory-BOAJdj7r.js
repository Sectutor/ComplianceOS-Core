import{b as k,ac as E,r as i,t as u,i as j,j as e,C as B,d as M,e as V,I as F,c as v,m as z,N as G,O as Q,P as f,Q as l,V as U,W as t,k as b,a6 as W,bt as J,a7 as K,bu as $,a8 as q,a9 as X,L as p,E as I,G as A,H as P,J as T,K as r}from"./index-DOc7Nwb7.js";import{B as Y}from"./Breadcrumb-CRi3LAxS.js";import{P as Z}from"./PageGuide-CPKKXXS6.js";import{A as _,h as ee,a as se,b as ae,c as te,d as ie,e as le,f as re,g as ne}from"./alert-dialog-V7xGXdVc.js";import{S as ce}from"./switch-B74-5eCi.js";import{S as de}from"./scroll-area-DPaNxEJD.js";import{D as oe}from"./database-Bjtecw5f.js";import{S as he}from"./search-CwuIBBPE.js";import{F as xe}from"./filter-Ceo--4mb.js";import{T as me}from"./trash-2-CFEfisbM.js";import"./separator-BWuYil37.js";import"./book-open-BffBrdze.js";import"./link-FmUqdGRG.js";import"./info-By5wLOUH.js";function Pe(){k();const{selectedClientId:s}=E(),[o,g]=i.useState(""),{data:c,isLoading:h}=u.assets.list.useQuery({clientId:s||0},{enabled:!!s}),n=u.useContext(),y=u.privacy.updateAssetPrivacy.useMutation({onSuccess:()=>{j.success("Asset privacy details updated"),n.assets.list.invalidate()},onError:a=>{j.error("Failed to update: "+a.message)}}),x=u.assets.delete.useMutation({onSuccess:()=>{j.success("Asset deleted successfully"),n.assets.list.invalidate()},onError:a=>{j.error("Failed to delete asset: "+a.message)}}),m=(c==null?void 0:c.filter(a=>a.name.toLowerCase().includes(o.toLowerCase())||a.isPersonalData))||[];return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx(Y,{items:[{label:"Dashboard",href:"/dashboard"},{label:"Privacy",href:`/clients/${s}/privacy`},{label:"Data Inventory"}]}),e.jsx("div",{className:"flex items-center justify-between animate-slide-down",children:e.jsx(Z,{title:"Data Inventory",description:"Catalog of all data assets and processing activities.",rationale:"Foundation for privacy compliance (RoPA) and security controls.",howToUse:[{step:"Inventory",description:"Add and categorize data assets."},{step:"Classify",description:"Set sensitivity (Public, Internal, Confidential)."},{step:"Link",description:"Associate assets with vendors and processing activities."}]})}),e.jsxs(B,{className:"flex-1 flex flex-col",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-blue-500"}),"Asset Inventory"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(he,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search assets...",className:"pl-8",value:o,onChange:a=>g(a.target.value)})]}),e.jsxs(v,{variant:"outline",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Filter PII Only"]})]})]})}),e.jsx(z,{className:"flex-1 p-0",children:e.jsx("div",{className:"rounded-md border border-x-0 border-b-0 h-[600px] overflow-auto",children:e.jsxs(G,{children:[e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(l,{children:"Asset Name"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"PII Status"}),e.jsx(l,{children:"Sensitivity"}),e.jsx(l,{children:"Format"}),e.jsx(l,{children:"Owner"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(U,{children:h?e.jsx(f,{children:e.jsx(t,{colSpan:7,className:"text-center py-8",children:"Loading assets..."})}):m.length===0?e.jsx(f,{children:e.jsx(t,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No assets found"})}):m.map(a=>e.jsx(ue,{asset:a,onUpdate:d=>y.mutateAsync({...d,clientId:s}),onDelete:d=>x.mutateAsync({id:d,clientId:s})},a.id))})]})})})]})]})}function ue({asset:s,onUpdate:o,onDelete:g}){const[c,h]=i.useState(!1),[n,y]=i.useState(s.isPersonalData||!1),[x,m]=i.useState(s.dataSensitivity||"Internal"),[a,d]=i.useState(s.dataFormat||"Digital"),[S,O]=i.useState(s.dataOwner||s.owner||""),[D,N]=i.useState(!1),[C,w]=i.useState(!1),H=async()=>{N(!0);try{await o({assetId:s.id,isPersonalData:n,dataSensitivity:x,dataFormat:a,dataOwner:S}),h(!1)}finally{N(!1)}},L=async()=>{w(!0);try{await g(s.id)}finally{w(!1)}};return e.jsxs(f,{children:[e.jsx(t,{className:"font-medium",children:s.name}),e.jsx(t,{children:s.type}),e.jsx(t,{children:s.isPersonalData?e.jsx(b,{variant:"default",className:"bg-blue-100 text-blue-700 hover:bg-blue-100",children:"Contains PII"}):e.jsx(b,{variant:"outline",className:"text-muted-foreground",children:"No PII"})}),e.jsx(t,{children:s.dataSensitivity&&e.jsx(b,{variant:"outline",className:s.dataSensitivity==="Restricted"?"border-red-200 bg-red-50 text-red-700":s.dataSensitivity==="Confidential"?"border-orange-200 bg-orange-50 text-orange-700":"border-slate-200 bg-slate-50 text-slate-700",children:s.dataSensitivity})}),e.jsx(t,{children:s.dataFormat}),e.jsx(t,{children:s.dataOwner||s.owner||"-"}),e.jsxs(t,{className:"text-right flex items-center justify-end gap-2",children:[e.jsxs(W,{open:c,onOpenChange:h,children:[e.jsx(J,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",children:"Edit Details"})}),e.jsxs(K,{className:"w-[400px] sm:w-[540px]",children:[e.jsxs($,{children:[e.jsx(q,{children:"Edit Privacy Details"}),e.jsxs(X,{children:["Classify ",s.name," usage of personal data."]})]}),e.jsx(de,{className:"h-[calc(100vh-200px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2 border p-4 rounded-lg",children:[e.jsxs(p,{htmlFor:"pii-mode",className:"flex flex-col space-y-1",children:[e.jsx("span",{children:"Contains Personal Data?"}),e.jsx("span",{className:"font-normal text-xs text-muted-foreground",children:"Does this asset store, process, or transmit PII/PHI?"})]}),e.jsx(ce,{id:"pii-mode",checked:n,onCheckedChange:y})]}),n&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-4 duration-300",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Data Sensitivity"}),e.jsxs(I,{value:x,onValueChange:m,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select sensitivity"})}),e.jsxs(T,{children:[e.jsx(r,{value:"Public",children:"Public"}),e.jsx(r,{value:"Internal",children:"Internal"}),e.jsx(r,{value:"Confidential",children:"Confidential"}),e.jsx(r,{value:"Restricted",children:"Restricted (High Risk)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Data Format"}),e.jsxs(I,{value:a,onValueChange:d,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select format"})}),e.jsxs(T,{children:[e.jsx(r,{value:"Digital",children:"Digital"}),e.jsx(r,{value:"Physical",children:"Physical (Paper, Drives)"}),e.jsx(r,{value:"Hybrid",children:"Hybrid"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Data Owner"}),e.jsx(F,{value:S,onChange:R=>O(R.target.value),placeholder:"Who is responsible for this data?"})]})]})]})}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(v,{onClick:H,disabled:D,children:D?"Saving...":"Save Changes"})})]})]}),e.jsxs(_,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Delete Asset"}),e.jsxs(ie,{children:["Are you sure you want to delete ",e.jsx("strong",{children:s.name}),"? This action cannot be undone and will remove it from your inventory."]})]}),e.jsxs(le,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(ne,{onClick:L,disabled:C,className:"bg-red-600 hover:bg-red-700",children:C?"Deleting...":"Delete"})]})]})]})]})]})}export{Pe as default};
