import{t as v,j as e,x as I,C as f,d as g,e as b,m as N,n as B,z as E,f as F,r as y,i as L,D as O,o as Q,p as U,q as G,s as H,I as V,k as T,w as q,c as h,ab as W,b as K,S as Y,ar as J,N as X,O as Z,P as R,Q as j,V as ee,W as p,aa as se}from"./index-DOc7Nwb7.js";import{D as M}from"./DashboardLayout-aHnUqq57.js";import{B as te}from"./Breadcrumb-CRi3LAxS.js";import{T as ae,a as re,b as _,c as z}from"./tabs-CBDTXbEn.js";import{C as P}from"./circle-check-C5kiwRoG.js";import{R as ie,l as le,T as ne,k as oe}from"./generateCategoricalChart-KNLgM3hn.js";import{P as de,a as ce}from"./PieChart-Lpe3cWE7.js";import{S as me}from"./scroll-area-DPaNxEJD.js";import{S as xe}from"./search-CwuIBBPE.js";import{U as pe}from"./unlink-BReNnSJu.js";import{A as he}from"./arrow-left-CpuUojG-.js";import{L as ue}from"./list-BZOuFwEg.js";import{C as je}from"./chevron-left-DZH-lUm7.js";import"./index--2vFva6Y.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./settings-CIu9FFiX.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./isEqual-D_xcZLCn.js";import"./PolarAngleAxis-BO8F-h7c.js";const D={implemented:"#22c55e",in_progress:"#3b82f6",not_implemented:"#ef4444",not_applicable:"#94a3b8"};function fe({frameworkId:s}){const{data:a,isLoading:c}=v.frameworkImports.getDashboardStats.useQuery({frameworkId:s});if(c)return e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx(I,{className:"animate-spin text-muted-foreground"})});if(!a)return null;const d=[{name:"Implemented",value:a.implemented,color:D.implemented},{name:"In Progress",value:a.inProgress,color:D.in_progress},{name:"Not Implemented",value:a.notImplemented,color:D.not_implemented},{name:"Not Applicable",value:a.notApplicable,color:D.not_applicable}].filter(l=>l.value>0);return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(P,{className:"h-4 w-4 text-primary"})]}),e.jsxs(N,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on implemented controls"})]})]}),e.jsxs(f,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Implemented"}),e.jsx(P,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.implemented}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Controls fully active"})]})]}),e.jsxs(f,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(B,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.inProgress}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Work has started"})]})]}),e.jsxs(f,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(b,{className:"text-sm font-medium",children:"Gaps"}),e.jsx(E,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.notImplemented}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require attention"})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(f,{className:"col-span-1",children:[e.jsxs(g,{children:[e.jsx(b,{children:"Implementation Status"}),e.jsx(F,{children:"Breakdown of controls by current status"})]}),e.jsx(N,{className:"h-[300px]",children:e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(de,{children:[e.jsx(ce,{data:d,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:d.map((l,n)=>e.jsx(le,{fill:l.color},`cell-${n}`))}),e.jsx(ne,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(oe,{verticalAlign:"bottom",height:36})]})})})]}),e.jsxs(f,{className:"col-span-1 border-primary/20 bg-primary/5",children:[e.jsxs(g,{children:[e.jsx(b,{className:"text-primary",children:"Readiness Assessment"}),e.jsx(F,{children:"AI-generated insights on your readiness"})]}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 bg-green-100 p-2 rounded-full",children:e.jsx(P,{className:"h-4 w-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Strong Start"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["You have imported ",a.total," controls. This provides a solid baseline for gap analysis."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 bg-blue-100 p-2 rounded-full",children:e.jsx(B,{className:"h-4 w-4 text-blue-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Next Steps"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Begin by mapping these controls to your existing policies to automatically update their status."})]})]})]})})]})]})]})}function ge({frameworkControlId:s,frameworkControlCode:a,currentMappingId:c,isOpen:d,onOpenChange:l,onSuccess:n}){const[u,C]=y.useState(""),[i,A]=y.useState(c||null),r=v.useContext(),{data:m,isLoading:k}=v.clientControls.list.useQuery(),o=v.frameworkImports.mapControl.useMutation({onSuccess:()=>{L.success("Control mapped successfully"),r.frameworkImports.getFrameworkControls.invalidate(),r.frameworkImports.getDashboardStats.invalidate(),n(),l(!1)},onError:t=>L.error(`Failed to map: ${t.message}`)}),w=v.frameworkImports.unmapControl.useMutation({onSuccess:()=>{L.success("Control unmapped"),r.frameworkImports.getFrameworkControls.invalidate(),r.frameworkImports.getDashboardStats.invalidate(),n(),l(!1)},onError:t=>L.error(`Failed to unmap: ${t.message}`)}),S=(m==null?void 0:m.filter(t=>t.controlId.toLowerCase().includes(u.toLowerCase())||t.name.toLowerCase().includes(u.toLowerCase())))||[],x=()=>{i&&o.mutate({frameworkControlId:s,clientControlId:i})},$=()=>{confirm("Are you sure you want to remove this mapping?")&&w.mutate({frameworkControlId:s})};return e.jsx(O,{open:d,onOpenChange:l,children:e.jsxs(Q,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsxs(G,{children:["Map Control: ",a]}),e.jsx(H,{children:"Link this imported control to your master control library. Status will automatically sync from the master control."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 border px-3 py-2 rounded-md",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search master controls...",className:"border-0 focus-visible:ring-0 p-0 h-auto",value:u,onChange:t=>C(t.target.value)})]}),e.jsx(me,{className:"h-[300px] border rounded-md p-2",children:k?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-2 text-muted-foreground",children:[e.jsx(I,{className:"h-6 w-6 animate-spin"}),e.jsx("p",{children:"Loading controls..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:['No controls found matching "',u,'"']}):e.jsx("div",{className:"space-y-1",children:S.map(t=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-md cursor-pointer transition-colors ${i===t.id?"bg-primary/10 border-primary/20 border":"hover:bg-muted border border-transparent"}`,onClick:()=>A(t.id),children:[e.jsx("div",{className:`mt-1 h-4 w-4 rounded-full border flex items-center justify-center ${i===t.id?"border-primary bg-primary":"border-muted-foreground"}`,children:i===t.id&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h4",{className:"font-medium text-sm",children:t.controlId}),e.jsx(T,{variant:"outline",className:"text-[10px]",children:t.status})]}),e.jsx("p",{className:"text-sm font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:t.description})]})]},t.id))})})]}),e.jsxs(q,{className:"flex justify-between sm:justify-between items-center w-full",children:[e.jsx("div",{children:c&&e.jsxs(h,{variant:"destructive",size:"sm",onClick:$,disabled:w.isLoading,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Unmap"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsxs(h,{onClick:x,disabled:!i||o.isLoading,children:[o.isLoading&&e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Save Mapping"]})]})]})]})})}function ds(){const s=W(),a=Number(s.id),[,c]=K(),[d,l]=y.useState("overview"),[n,u]=y.useState(1),[C]=y.useState(50),{data:i,isLoading:A}=v.frameworkImports.getFramework.useQuery({frameworkId:a}),{data:r,isLoading:m}=v.frameworkImports.getFrameworkControls.useQuery({frameworkId:a,page:n,limit:C}),k=Array.isArray(r),o=k?r:(r==null?void 0:r.items)||[],w=k?1:(r==null?void 0:r.totalPages)||0,S=k?r.length:(r==null?void 0:r.total)||0;return A?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})})}):i?e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{items:[{label:"Clients",href:"/clients"},{label:"Settings",href:`/clients/${i.clientId}/settings`},{label:i.name}]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>c(`/clients/${i.clientId}/settings`),children:e.jsx(he,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"h-6 w-6 text-primary"}),i.name]}),e.jsxs("p",{className:"text-muted-foreground",children:["Version ",i.version]})]})]}),e.jsxs(ae,{value:d,onValueChange:l,className:"space-y-6",children:[e.jsxs(re,{children:[e.jsxs(_,{value:"overview",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(_,{value:"controls",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Controls List"]})]}),e.jsx(z,{value:"overview",children:e.jsx(fe,{frameworkId:a})}),e.jsx(z,{value:"controls",children:e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsx(b,{children:"Controls"}),e.jsxs(F,{children:["List of controls imported from ",i.sourceFileName,"."]})]}),e.jsx(N,{className:"p-0",children:e.jsxs("div",{className:"rounded-xl border border-slate-200 shadow-lg overflow-hidden bg-white",children:[e.jsxs("div",{className:"relative",children:[m&&e.jsx("div",{className:"absolute inset-0 bg-white/50 z-10 flex items-center justify-center",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})}),e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(R,{className:"bg-[#1C4D8D] hover:bg-[#1C4D8D] border-none",children:[e.jsx(j,{className:"w-[100px] text-white font-semibold py-4",children:"ID"}),e.jsx(j,{className:"text-white font-semibold py-4",children:"Control Title"}),e.jsx(j,{className:"text-white font-semibold py-4",children:"Description"}),e.jsx(j,{className:"text-white font-semibold py-4",children:"Grouping"}),e.jsx(j,{className:"text-white font-semibold py-4",children:"Status"}),e.jsx(j,{className:"text-white font-semibold py-4",children:"Mapped To"}),e.jsx(j,{className:"w-[100px] text-white font-semibold py-4",children:"Actions"})]})}),e.jsxs(ee,{children:[o==null?void 0:o.map(x=>e.jsx(be,{control:x,clientId:i.clientId},x.id)),(o==null?void 0:o.length)===0&&!m&&e.jsx(R,{children:e.jsx(p,{colSpan:7,className:"text-center py-8 text-gray-500 bg-white",children:"No controls found for this framework."})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-t border-slate-200 bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length>0?(n-1)*C+1:0," to ",Math.min(n*C,S)," of ",S," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(x=>Math.max(1,x-1)),disabled:n===1||m,children:[e.jsx(je,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("div",{className:"text-sm font-medium",children:["Page ",n," of ",Math.max(1,w)]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(x=>Math.min(w,x+1)),disabled:n>=w||m,children:["Next",e.jsx(se,{className:"h-4 w-4"})]})]})]})]})})]})})]})]})}):e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-muted-foreground",children:"Framework not found"}),e.jsx(h,{variant:"outline",onClick:()=>c("/clients"),children:"Go Back"})]})})}function be({control:s,clientId:a}){var l;const[c,d]=y.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(R,{className:"bg-white border-b border-slate-200 transition-all duration-200 hover:bg-slate-50 hover:shadow-sm group",children:[e.jsx(p,{className:"font-medium align-top text-black py-4",children:s.controlCode}),e.jsx(p,{className:"align-top font-medium text-black py-4",children:s.title}),e.jsx(p,{className:"text-gray-500 text-sm max-w-xl py-4",children:s.description}),e.jsx(p,{className:"whitespace-nowrap align-top py-4",children:e.jsx(T,{variant:"outline",className:"bg-white border-gray-300 text-gray-700",children:s.grouping||"General"})}),e.jsx(p,{className:"py-4",children:e.jsx(T,{variant:s.status==="implemented"?"default":s.status==="in_progress"?"secondary":"outline",children:s.status==="not_implemented"?"Not Started":((l=s.status)==null?void 0:l.replace("_"," "))||"Not Started"})}),e.jsx(p,{className:"py-4",children:s.mappedControlCode?e.jsx(T,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:s.mappedControlCode}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"Unmapped"})}),e.jsx(p,{className:"py-4",children:e.jsx(h,{variant:"ghost",size:"sm",className:"hover:bg-[#1C4D8D]/10 hover:text-[#1C4D8D] transition-colors duration-200",onClick:()=>d(!0),children:s.mappedControlCode?"Edit":"Map"})})]}),e.jsx(ge,{isOpen:c,onOpenChange:d,frameworkControlId:s.id,frameworkControlCode:s.controlCode,currentMappingId:void 0,onSuccess:()=>d(!1)})]})}export{ds as default};
