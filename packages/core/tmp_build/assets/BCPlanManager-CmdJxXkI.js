import{M as Le,t as h,j as e,N as F,O as V,P as v,Q as c,V as _,W as r,i as y,r as b,C as w,d as D,e as P,f as O,m as S,c as j,I as k,D as H,o as $,p as Y,q as ee,s as Ee,x as te,w as se,L,k as W,b as Ge,au as He,R as $e,F as Je,ap as ce}from"./index-DOc7Nwb7.js";import{D as Xe}from"./DashboardLayout-aHnUqq57.js";import{T as Ze,a as Ye,b as Q,c as I}from"./tabs-CBDTXbEn.js";import{T as U}from"./textarea-BtxBxzdY.js";import{P as es,a as ss,b as ts}from"./PlanTabs-1YgtBSA6.js";import{M as as}from"./mail-xRDvl6QK.js";import{M as oe}from"./map-pin-B9L2P8nv.js";import{S as ke}from"./square-check-big-BUI41YoI.js";import{P as ns}from"./phone-BFakwHvb.js";import{T as xe}from"./trash-2-CFEfisbM.js";import{P as he}from"./plus-BaQ35Jcx.js";import{S as de}from"./sparkles-CoQ80pK2.js";import{W as is}from"./wand-sparkles-BtekNLFr.js";import{R as rs}from"./refresh-cw-Cjym1DSW.js";import{L as ls}from"./link-FmUqdGRG.js";import{A as cs}from"./arrow-left-CpuUojG-.js";import{P as ds}from"./printer-B-Q0xXOk.js";import{S as os}from"./save-CvVmWchr.js";import{G as xs}from"./git-branch-Cp8-LWxO.js";import{C as hs}from"./circle-play-B4Nb1F90.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./arrow-right-M96iV-v9.js";import"./clock-osbacZli.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=Le("Badge",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Le("Siren",[["path",{d:"M7 18v-6a5 5 0 1 1 10 0v6",key:"pcx96s"}],["path",{d:"M5 21a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2z",key:"1b4s83"}],["path",{d:"M21 12h1",key:"jtio3y"}],["path",{d:"M18.5 4.5 18 5",key:"g5sp9y"}],["path",{d:"M2 12h1",key:"1uaihz"}],["path",{d:"M12 2v1",key:"11qlp1"}],["path",{d:"m4.929 4.929.707.707",key:"1i51kw"}],["path",{d:"M12 12v6",key:"3ahymv"}]]);function Pe({plan:d,isCrisisMode:m=!1}){var u,i,a;const{data:o}=h.businessContinuity.plans.communications.list.useQuery({planId:d.id},{enabled:!!d.id}),{data:l}=h.businessContinuity.plans.logistics.list.useQuery({planId:d.id},{enabled:!!d.id});(u=d.content)!=null&&u.callList;const p=m?"bg-red-50 text-slate-900 font-sans p-8 max-w-[210mm] mx-auto min-h-screen":"bg-white text-slate-900 font-sans p-8 max-w-[210mm] mx-auto min-h-screen";return e.jsxs("div",{className:p,id:"plan-print-view",children:[e.jsxs("section",{className:"space-y-4 break-inside-avoid mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 pb-2",children:[e.jsx(as,{className:"h-6 w-6 text-slate-900"}),e.jsx("h3",{className:"text-xl font-bold uppercase tracking-wider text-slate-900",children:"2. Communications Matrix"})]}),e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{className:"font-bold text-slate-900",children:"Audience"}),e.jsx(c,{className:"font-bold text-slate-900",children:"Channel"}),e.jsx(c,{className:"font-bold text-slate-900",children:"Responsibility"}),e.jsx(c,{className:"font-bold text-slate-900",children:"Message / Frequency"})]})}),e.jsx(_,{children:o&&o.length>0?o.map(t=>e.jsxs(v,{children:[e.jsx(r,{className:"font-bold",children:t.audience}),e.jsx(r,{children:t.channel}),e.jsx(r,{children:t.responsibleRole}),e.jsxs(r,{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:t.frequency}),e.jsx("div",{className:"italic text-slate-600",children:t.messageTemplate})]})]},t.id)):e.jsx(v,{children:e.jsx(r,{colSpan:4,className:"text-center italic text-muted-foreground",children:"No communication channels defined."})})})]})]}),e.jsxs("section",{className:"space-y-4 break-inside-avoid mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 pb-2",children:[e.jsx(oe,{className:"h-6 w-6 text-slate-900"}),e.jsx("h3",{className:"text-xl font-bold uppercase tracking-wider text-slate-900",children:"3. Logistics & Sites"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l&&l.map(t=>e.jsxs("div",{className:"border border-slate-200 rounded p-4 shadow-sm bg-slate-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold text-lg",children:t.locationName}),e.jsx(Ae,{variant:"outline",className:"uppercase text-xs",children:t.type.replace("_"," ")})]}),e.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[e.jsx("strong",{children:"Address:"})," ",t.address||"N/A"]}),e.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[e.jsx("strong",{children:"Capacity:"})," ",t.capacity||"?"," people"]}),t.notes&&e.jsx("div",{className:"mt-2 text-xs bg-white p-2 rounded border text-slate-600",children:t.notes}),m&&e.jsx("div",{className:"mt-3",children:e.jsxs("a",{href:`https://maps.google.com/?q=${encodeURIComponent(t.address||t.locationName)}`,target:"_blank",rel:"noreferrer",className:"text-blue-600 text-xs hover:underline flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Get Directions"]})})]},t.id)),(!l||l.length===0)&&e.jsx("div",{className:"text-muted-foreground italic col-span-2 text-center p-4",children:"No logistics sites defined."})]})]}),e.jsxs("section",{className:"space-y-4 break-inside-avoid mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 pb-2",children:[e.jsx(ke,{className:"h-6 w-6 text-slate-900"}),e.jsx("h3",{className:"text-xl font-bold uppercase tracking-wider text-slate-900",children:"4. Activation Scenarios & Strategies"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:(i=d.scenarios)==null?void 0:i.map(t=>e.jsxs("div",{className:"border p-4 rounded-md bg-slate-50",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-800 mb-1",children:t.title}),e.jsx("p",{className:"text-slate-600 text-sm mb-2",children:t.description})]},t.id))})]}),e.jsxs("section",{className:"space-y-4 break-inside-avoid mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 pb-2",children:[e.jsx(ke,{className:"h-6 w-6 text-slate-900"}),e.jsx("h3",{className:"text-xl font-bold uppercase tracking-wider text-slate-900",children:"5. Recovery Procedures"})]}),(a=d.strategies)==null?void 0:a.map((t,n)=>e.jsxs("div",{className:"mb-8 break-inside-avoid shadow-sm border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-100 p-4 border-b border-slate-200 flex justify-between items-center",children:[e.jsxs("h4",{className:"font-bold text-lg",children:["5.",n+1," ",t.title]}),e.jsx(Ae,{variant:"outline",className:"bg-white",children:t.type})]}),e.jsxs("div",{className:"p-4 bg-white",children:[e.jsx("p",{className:"mb-4 text-slate-700",children:t.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold text-sm uppercase text-slate-500 mb-2",children:"Action Steps"}),(t.contentStepByStep||"").split(`
`).filter(x=>x.trim().length>0).map((x,g)=>e.jsxs("div",{className:"flex items-start gap-3 py-1",children:[m?e.jsx("input",{type:"checkbox",className:"w-5 h-5 mt-0.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}):e.jsx("div",{className:"w-5 h-5 border border-slate-300 rounded flex-shrink-0 mt-0.5"}),e.jsx("span",{className:x.startsWith("-")||x.startsWith("*")?"pl-2":"font-medium",children:x.replace(/^[-*]\s/,"")})]},g)),!t.contentStepByStep&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No detailed steps provided."})]}),e.jsxs("div",{className:"mt-6 flex gap-4 text-sm text-slate-600 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"RTO:"})," ",t.rto||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"RPO:"})," ",t.rpo||"N/A"]})]})]})]},t.id)),(!d.strategies||d.strategies.length===0)&&e.jsx("p",{className:"text-muted-foreground italic",children:"No recovery strategies defined."})]}),e.jsx("div",{className:"mt-8 text-center text-xs text-slate-300",children:"End of Document"})]})}function Te({planId:d,clientId:m}){const{data:o,refetch:l}=h.businessContinuity.plans.communications.list.useQuery({planId:d,clientId:m}),p=h.businessContinuity.plans.communications.create.useMutation({onSuccess:()=>{y.success("Channel added"),l(),a({audience:"",channel:"",responsibleRole:"",messageTemplate:"",frequency:"Initial"})}}),u=h.businessContinuity.plans.communications.delete.useMutation({onSuccess:()=>{y.success("Channel removed"),l()}}),[i,a]=b.useState({audience:"",channel:"",responsibleRole:"",messageTemplate:"",frequency:"Initial"}),t=()=>{i.audience&&p.mutate({planId:d,clientId:m,...i})};return e.jsxs(w,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5"}),"Communication Matrix"]}),e.jsx(O,{children:"Who needs to be contacted, how, and by whom during a disruption."})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Audience"}),e.jsx(c,{children:"Channel/Method"}),e.jsx(c,{children:"Responsible Role"}),e.jsx(c,{children:"Message Template / Key Info"}),e.jsx(c,{children:"Frequency"}),e.jsx(c,{className:"w-[50px]"})]})}),e.jsxs(_,{children:[o==null?void 0:o.map(n=>e.jsxs(v,{children:[e.jsx(r,{className:"font-medium",children:n.audience}),e.jsx(r,{children:n.channel}),e.jsx(r,{children:n.responsibleRole}),e.jsx(r,{className:"max-w-[200px] truncate",title:n.messageTemplate,children:n.messageTemplate}),e.jsx(r,{children:n.frequency}),e.jsx(r,{children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>u.mutate({id:n.id,clientId:m}),children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})})]},n.id)),e.jsxs(v,{children:[e.jsx(r,{children:e.jsx(k,{placeholder:"e.g. Employees",value:i.audience,onChange:n=>a({...i,audience:n.target.value})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"SMS / Email",value:i.channel,onChange:n=>a({...i,channel:n.target.value})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"HR Manager",value:i.responsibleRole,onChange:n=>a({...i,responsibleRole:n.target.value})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"Message content...",value:i.messageTemplate,onChange:n=>a({...i,messageTemplate:n.target.value})})}),e.jsx(r,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.frequency,onChange:n=>a({...i,frequency:n.target.value}),children:[e.jsx("option",{value:"Initial",children:"Initial Notification"}),e.jsx("option",{value:"Hourly",children:"Hourly Updates"}),e.jsx("option",{value:"Daily",children:"Daily Updates"}),e.jsx("option",{value:"Resolution",children:"Resolution Only"})]})}),e.jsx(r,{children:e.jsx(j,{size:"sm",onClick:t,disabled:!i.audience,children:e.jsx(he,{className:"w-4 h-4"})})})]})]})]})})]})}function ms({planId:d,clientId:m}){const{data:o,refetch:l}=h.businessContinuity.plans.logistics.list.useQuery({planId:d,clientId:m}),p=h.businessContinuity.plans.logistics.create.useMutation({onSuccess:()=>{y.success("Location added"),l(),a({type:"assembly_point",locationName:"",address:"",capacity:0,notes:""})}}),u=h.businessContinuity.plans.logistics.delete.useMutation({onSuccess:()=>{y.success("Location removed"),l()}}),[i,a]=b.useState({type:"assembly_point",locationName:"",address:"",capacity:0,notes:""}),t=()=>{i.locationName&&p.mutate({planId:d,clientId:m,...i})};return e.jsxs(w,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),"Logistics & Recovery Sites"]}),e.jsx(O,{children:"Physical locations for assembly, alternate work, or command centers."})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Location Name"}),e.jsx(c,{children:"Address"}),e.jsx(c,{children:"Capacity"}),e.jsx(c,{children:"Notes"}),e.jsx(c,{className:"w-[50px]"})]})}),e.jsxs(_,{children:[o==null?void 0:o.map(n=>e.jsxs(v,{children:[e.jsx(r,{className:"capitalize",children:n.type.replace("_"," ")}),e.jsx(r,{className:"font-medium",children:n.locationName}),e.jsx(r,{children:n.address}),e.jsx(r,{children:n.capacity}),e.jsx(r,{className:"max-w-[200px] truncate",children:n.notes}),e.jsx(r,{children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>u.mutate({id:n.id,clientId:m}),children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})})]},n.id)),e.jsxs(v,{children:[e.jsx(r,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.type,onChange:n=>a({...i,type:n.target.value}),children:[e.jsx("option",{value:"assembly_point",children:"Assembly Point"}),e.jsx("option",{value:"alternate_site",children:"Alternate Work Site"}),e.jsx("option",{value:"war_room",children:"Command Center (War Room)"}),e.jsx("option",{value:"shelter",children:"Shelter-in-Place"})]})}),e.jsx(r,{children:e.jsx(k,{placeholder:"e.g. Parking Lot B",value:i.locationName,onChange:n=>a({...i,locationName:n.target.value})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"123 Main St",value:i.address,onChange:n=>a({...i,address:n.target.value})})}),e.jsx(r,{children:e.jsx(k,{type:"number",placeholder:"50",value:i.capacity||"",onChange:n=>a({...i,capacity:parseInt(n.target.value)||0})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"Access codes etc.",value:i.notes,onChange:n=>a({...i,notes:n.target.value})})}),e.jsx(r,{children:e.jsx(j,{size:"sm",onClick:t,disabled:!i.locationName,children:e.jsx(he,{className:"w-4 h-4"})})})]})]})]})})]})}function J({clientId:d,planId:m,sectionKey:o,currentContent:l,onApply:p,label:u="AI Assist",variant:i="outline",size:a="sm"}){const[t,n]=b.useState(!1),[x,g]=b.useState(""),C=h.advisor.generateBcpContent.useMutation({onSuccess:M=>{g(M.content)},onError:M=>{y.error(`AI Generation Failed: ${M.message}`)}}),E=M=>{C.mutate({clientId:d,planId:m,sectionKey:o,context:l,mode:M})},z=()=>{p(x),n(!1),g(""),y.success("Content applied!")};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:i,size:a,onClick:()=>n(!0),className:"gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-purple-500"}),u]}),e.jsx(H,{open:t,onOpenChange:n,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(Y,{children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-purple-600"}),"AI Assistant"]}),e.jsx(Ee,{children:"Generate new content or improve your existing text using specific BCP best practices."})]}),e.jsxs("div",{className:"grid gap-6 py-4",children:[!x&&e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-center p-8 border-2 border-dashed rounded-lg bg-slate-50/50 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(j,{onClick:()=>E("draft"),disabled:C.isLoading,className:`gap-2 relative overflow-hidden transition-all duration-300 ${C.isLoading?"bg-purple-100 text-purple-700 border-purple-200":"bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 text-white shadow-md hover:shadow-lg hover:-translate-y-0.5"}`,children:C.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 animate-spin"}),"Drafting...",e.jsx("span",{className:"absolute inset-0 bg-white/20 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-4 h-4"}),"Draft New Content"]})}),e.jsx(j,{variant:"outline",onClick:()=>E("improve"),disabled:C.isLoading||!l,className:`gap-2 transition-all duration-300 ${l?C.isLoading?"bg-slate-100":"border-purple-200 text-purple-700 hover:bg-purple-50 hover:border-purple-300":"opacity-50 cursor-not-allowed"}`,children:C.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 animate-spin text-purple-600"}),"Improving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Improve Existing"]})})]}),!l&&e.jsx("p",{className:"text-xs text-muted-foreground animate-pulse",children:'Select "Draft New" to start from scratch.'})]}),C.isLoading&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(te,{className:"w-8 h-8 animate-spin text-purple-600 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Consulting expert knowledge base..."})]}),x&&!C.isLoading&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Generated Suggestion:"}),e.jsx(U,{value:x,onChange:M=>g(M.target.value),className:"min-h-[200px]"})]})})]}),e.jsxs(se,{children:[x&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",onClick:()=>g(""),children:"Discard"}),e.jsx(j,{onClick:z,children:"Apply to Plan"})]}),!x&&e.jsx(j,{variant:"ghost",onClick:()=>n(!1),children:"Cancel"})]})]})})]})}function ps({planId:d,clientId:m}){const{data:o,refetch:l}=h.businessContinuity.plans.sections.get.useQuery({planId:d,clientId:m}),p=h.businessContinuity.plans.sections.upsert.useMutation({onSuccess:()=>y.success("Section saved")}),[u,i]=b.useState({intro:"",scope:"",assumptions:""});b.useEffect(()=>{var t,n,x;o&&i({intro:((t=o.find(g=>g.sectionKey==="intro"))==null?void 0:t.content)||"",scope:((n=o.find(g=>g.sectionKey==="scope"))==null?void 0:n.content)||"",assumptions:((x=o.find(g=>g.sectionKey==="assumptions"))==null?void 0:x.content)||""})},[o]);const a=(t,n)=>{p.mutate({planId:d,clientId:m,sectionKey:t,content:n})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Plan Introduction"}),e.jsx(O,{children:"Define the purpose and objectives of this recovery plan."})]}),e.jsx(J,{clientId:m,planId:d,sectionKey:"intro",currentContent:u.intro,onApply:t=>{i(n=>({...n,intro:t})),a("intro",t)}})]}),e.jsx(S,{className:"space-y-4 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Purpose"}),e.jsx(U,{className:"min-h-[100px]",placeholder:"Why does this plan exist?",value:u.intro,onChange:t=>i({...u,intro:t.target.value}),onBlur:()=>a("intro",u.intro)})]})})]}),e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Scope"}),e.jsx(O,{children:"What is covered by this plan, and what is excluded?"})]}),e.jsx(J,{clientId:m,planId:d,sectionKey:"scope",currentContent:u.scope,onApply:t=>{i(n=>({...n,scope:t})),a("scope",t)}})]}),e.jsx(S,{className:"space-y-4 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Scope Statement"}),e.jsx(U,{className:"min-h-[100px]",placeholder:"Departments, systems, locations...",value:u.scope,onChange:t=>i({...u,scope:t.target.value}),onBlur:()=>a("scope",u.scope)})]})})]}),e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Assumptions & Dependencies"}),e.jsx(O,{children:"External factors or conditions assumed to be true."})]}),e.jsx(J,{clientId:m,planId:d,sectionKey:"assumptions",currentContent:u.assumptions,onApply:t=>{i(n=>({...n,assumptions:t})),a("assumptions",t)}})]}),e.jsx(S,{className:"space-y-4 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Key Assumptions"}),e.jsx(U,{className:"min-h-[100px]",placeholder:"e.g. Critical staff are available within 4 hours...",value:u.assumptions,onChange:t=>i({...u,assumptions:t.target.value}),onBlur:()=>a("assumptions",u.assumptions)})]})})]})]})}function us({planId:d,clientId:m}){const{data:o,refetch:l}=h.businessContinuity.plans.sections.get.useQuery({planId:d,clientId:m}),p=h.businessContinuity.plans.sections.upsert.useMutation({onSuccess:()=>y.success("Activation criteria saved")}),[u,i]=b.useState(""),[a,t]=b.useState("");b.useEffect(()=>{var x,g;o&&(i(((x=o.find(C=>C.sectionKey==="activation_criteria"))==null?void 0:x.content)||""),t(((g=o.find(C=>C.sectionKey==="escalation_procedures"))==null?void 0:g.content)||""))},[o]);const n=(x,g)=>{p.mutate({planId:d,clientId:m,sectionKey:x,content:g})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Activation Criteria"}),e.jsx(O,{children:"When should this plan be invoked?"})]}),e.jsx(J,{clientId:m,planId:d,sectionKey:"activation",currentContent:u,onApply:x=>{i(x),n("activation_criteria",x)}})]}),e.jsx(S,{className:"space-y-4 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Triggers"}),e.jsx(U,{className:"min-h-[150px]",placeholder:"Describe the specific events or thresholds...",value:u,onChange:x=>i(x.target.value),onBlur:()=>n("activation_criteria",u)})]})})]}),e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{children:"Escalation Procedures"}),e.jsx(O,{children:"How to escalate an incident to full crisis mode."})]}),e.jsx(J,{clientId:m,planId:d,sectionKey:"activation",currentContent:a,label:"AI Assist (Escalation)",onApply:x=>{t(x),n("escalation_procedures",x)}})]}),e.jsx(S,{className:"space-y-4 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Procedures"}),e.jsx(U,{className:"min-h-[150px]",placeholder:"Steps to contact the CMT (Crisis Management Team)...",value:a,onChange:x=>t(x.target.value),onBlur:()=>n("escalation_procedures",a)})]})})]})]})}function js({planId:d,clientId:m}){const{data:o,refetch:l}=h.businessContinuity.plans.appendices.list.useQuery({planId:d,clientId:m}),p=h.businessContinuity.plans.appendices.add.useMutation({onSuccess:()=>{y.success("Appendix added"),l(),a({title:"",type:"link",fileUrl:"",description:""})}}),u=h.businessContinuity.plans.appendices.remove.useMutation({onSuccess:()=>l()}),[i,a]=b.useState({title:"",type:"link",fileUrl:"",description:""});return e.jsxs(w,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Plan Appendices"}),e.jsx(O,{children:"Supporting documents, contact lists, and external references."})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Title"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Link/Location"}),e.jsx(c,{className:"w-[50px]"})]})}),e.jsxs(_,{children:[o==null?void 0:o.map(t=>e.jsxs(v,{children:[e.jsx(r,{className:"font-medium",children:t.title}),e.jsx(r,{children:e.jsx(W,{variant:"outline",children:t.type})}),e.jsx(r,{children:t.description}),e.jsx(r,{children:t.fileUrl&&e.jsxs("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:underline",children:[e.jsx(ls,{className:"w-3 h-3 mr-1"})," Open"]})}),e.jsx(r,{children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>u.mutate({id:t.id,clientId:m}),children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})})]},t.id)),e.jsxs(v,{children:[e.jsx(r,{children:e.jsx(k,{placeholder:"Title",value:i.title,onChange:t=>a({...i,title:t.target.value})})}),e.jsx(r,{children:e.jsxs("select",{className:"h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm",value:i.type,onChange:t=>a({...i,type:t.target.value}),children:[e.jsx("option",{value:"link",children:"Ext. Link"}),e.jsx("option",{value:"file",children:"File Ref"}),e.jsx("option",{value:"contact_list",children:"Contact List"})]})}),e.jsx(r,{children:e.jsx(k,{placeholder:"Optional description",value:i.description,onChange:t=>a({...i,description:t.target.value})})}),e.jsx(r,{children:e.jsx(k,{placeholder:"https://...",value:i.fileUrl,onChange:t=>a({...i,fileUrl:t.target.value})})}),e.jsx(r,{children:e.jsx(j,{size:"sm",onClick:()=>{i.title&&p.mutate({planId:d,clientId:m,...i})},children:e.jsx(he,{className:"w-4 h-4"})})})]})]})]})})]})}function pt(){var ve,Ne,be,fe,ye,Ce,we,Se;const[,d]=Ge(),[m,o]=He("/clients/:clientId/business-continuity/plans/:planId");if(!m||!o)return null;const l=parseInt(o.clientId),p=parseInt(o.planId),[u,i]=b.useState("overview"),{data:a,refetch:t}=h.businessContinuity.plans.get.useQuery({id:p,clientId:l}),{data:n,refetch:x}=h.businessContinuity.plans.getVersions.useQuery({planId:p,clientId:l}),{data:g,refetch:C}=h.businessContinuity.exercises.list.useQuery({planId:p,clientId:l}),{data:E}=h.businessContinuity.plans.getChangeLog.useQuery({planId:p,clientId:l}),{data:z,refetch:M}=h.businessContinuity.plans.contacts.list.useQuery({planId:p}),{data:Me}=h.businessContinuity.strategies.list.useQuery({clientId:l}),{data:Ie}=h.businessContinuity.scenarios.list.useQuery({clientId:l}),{data:Re}=h.businessContinuity.bia.list.useQuery({clientId:l}),{data:ae}=h.businessContinuity.stakeholders.searchCandidates.useQuery({}),Be=h.businessContinuity.plans.update.useMutation({onSuccess:()=>{y.success("Plan updated"),t()}}),ne=h.businessContinuity.plans.createVersion.useMutation({onSuccess:()=>{y.success("New version created"),x(),pe(!1)}}),me=h.businessContinuity.exercises.create.useMutation({onSuccess:()=>{y.success("Exercise logged"),C(),ge(!1)}}),Oe=h.businessContinuity.plans.contacts.add.useMutation({onSuccess:()=>{y.success("Contact added"),M()}}),ze=h.businessContinuity.plans.contacts.remove.useMutation({onSuccess:()=>{y.success("Contact removed"),M()}}),[K,ie]=b.useState(!1),[f,q]=b.useState(null);$e.useEffect(()=>{var s,N,A,T,G;a&&!f&&q({title:a.title,version:a.version,department:((N=(s=a.content)==null?void 0:s.metadata)==null?void 0:N.department)||"",selectedStrategyIds:((A=a.strategies)==null?void 0:A.map(B=>B.id))||[],selectedScenarioIds:((T=a.scenarios)==null?void 0:T.map(B=>B.id))||[],selectedBiaIds:((G=a.bias)==null?void 0:G.map(B=>B.id))||[]})},[a,f]);const Qe=async()=>{if(!f)return;const s=JSON.stringify({metadata:{department:f.department,generatedAt:new Date().toISOString()}},null,2);await Be.mutateAsync({id:p,clientId:l,title:f.title,version:f.version,content:s,biaIds:f.selectedBiaIds,strategyIds:f.selectedStrategyIds,scenarioIds:f.selectedScenarioIds}),ie(!1)},[Fe,pe]=b.useState(!1),[ue,Ve]=b.useState(""),[je,_e]=b.useState(""),[Ue,ge]=b.useState(!1),[R,X]=b.useState({title:"",type:"Tabletop",date:new Date().toISOString().split("T")[0],status:"Completed",notes:""}),[Ke,re]=b.useState(!1),We=()=>{window.print()},le=h.businessContinuity.plans.exportDocx.useMutation({onSuccess:s=>{const N=atob(s.base64),A=new Uint8Array(N.length);for(let Z=0;Z<N.length;Z++)A[Z]=N.charCodeAt(Z);const T=new Blob([A],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),G=URL.createObjectURL(T),B=document.createElement("a");B.href=G,B.download=s.filename,B.click(),URL.revokeObjectURL(G),y.success("Document downloaded!")},onError:s=>{y.error(`Export failed: ${s.message}`)}}),qe=()=>{y.info("Generating Word Document..."),le.mutate({id:p,clientId:l})};return a?e.jsxs(Xe,{children:[e.jsx("div",{className:"hidden print:block print:absolute print:top-0 print:left-0 print:w-full print:bg-white print:z-[9999]",children:a&&e.jsx(Pe,{plan:a})}),e.jsx(H,{open:Ke,onOpenChange:re,children:e.jsx($,{className:"max-w-[95vw] h-[95vh] overflow-y-auto bg-slate-50 p-0",children:e.jsxs("div",{className:"p-0",children:[e.jsxs("div",{className:"bg-red-600 text-white p-4 flex justify-between items-center sticky top-0 z-10 shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(De,{className:"w-6 h-6 animate-pulse"}),"CRISIS MODE ACTIVATED"]}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>re(!1),children:"Deactivate & Close"})]}),a&&e.jsx(Pe,{plan:a,isCrisisMode:!0})]})})}),e.jsxs("div",{className:"min-h-[calc(100vh-4rem)] bg-background p-6 lg:p-10 print:hidden",children:[e.jsx("div",{className:"max-w-6xl mx-auto space-y-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:e.jsxs(j,{variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>d(`/clients/${l}/business-continuity/plans`),children:[e.jsx(cs,{className:"w-4 h-4 mr-1"})," Back to Plans"]})}),e.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-foreground flex items-center gap-3",children:[a==null?void 0:a.title,e.jsxs(W,{variant:"outline",className:"text-base font-normal",children:["v",a==null?void 0:a.version]}),e.jsx(W,{variant:(a==null?void 0:a.status)==="approved"?"default":"secondary",className:"capitalize",children:a==null?void 0:a.status})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage plan details, strategies, and version history."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",onClick:We,children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Export PDF"]}),e.jsxs(j,{variant:"outline",onClick:qe,disabled:le.isPending,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),le.isPending?"Generating...":"Export DOCX"]}),e.jsxs(j,{variant:"destructive",className:"gap-2",onClick:()=>re(!0),children:[e.jsx(De,{className:"w-4 h-4"}),"Activate Crisis Mode"]}),K?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"ghost",onClick:()=>ie(!1),children:"Cancel"}),e.jsxs(j,{onClick:Qe,children:[e.jsx(os,{className:"w-4 h-4 mr-2"})," Save Changes"]})]}):e.jsx(j,{onClick:()=>ie(!0),children:"Edit Plan"})]})]})}),e.jsxs(Ze,{value:u,onValueChange:i,children:[e.jsxs(Ye,{className:"w-full justify-start border-b rounded-none h-auto p-0 bg-transparent overflow-x-auto flex-nowrap",children:[e.jsx(Q,{value:"overview",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"Overview"}),e.jsx(Q,{value:"intro",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"1. Introduction"}),e.jsx(Q,{value:"roles",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"2. Roles"}),e.jsx(Q,{value:"activation",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"3. Activation"}),e.jsx(Q,{value:"strategies",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"4. Playbooks"}),e.jsx(Q,{value:"logistics",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"Logistics"}),e.jsx(Q,{value:"appendices",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"Appendices"}),e.jsx(Q,{value:"exercises",className:"data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none px-4 py-3 shrink-0",children:"Exercises"})]}),e.jsx(I,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(w,{className:"md:col-span-2",children:[e.jsx(D,{children:e.jsx(P,{children:"Plan Details"})}),e.jsx(S,{children:K?e.jsx(es,{formData:f,setFormData:q,onNext:()=>i("intro")}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Title"}),e.jsx("span",{className:"font-medium",children:a.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Current Version"}),e.jsx("span",{className:"font-medium",children:a.version})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Department/Scope"}),e.jsx("span",{className:"font-medium",children:((Ne=(ve=a.content)==null?void 0:ve.metadata)==null?void 0:Ne.department)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Status"}),e.jsx("span",{className:"capitalize",children:a.status})]})]})})})]}),e.jsxs(w,{children:[e.jsx(D,{children:e.jsx(P,{children:"Recent Activity"})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[E==null?void 0:E.slice(0,5).map(s=>e.jsxs("div",{className:"text-sm border-b pb-2 last:border-0",children:[e.jsx("div",{className:"font-medium",children:s.action}),e.jsx("div",{className:"text-muted-foreground text-xs",children:new Date(s.createdAt).toLocaleString()}),e.jsx("div",{className:"text-xs mt-1",children:s.details})]},s.id)),(!E||E.length===0)&&e.jsx("div",{className:"text-muted-foreground text-sm",children:"No activity recorded."})]})})]})]})}),e.jsx(I,{value:"intro",className:"mt-6",children:e.jsx(ps,{planId:p,clientId:l})}),e.jsxs(I,{value:"activation",className:"mt-6 space-y-6",children:[e.jsx(us,{planId:p,clientId:l}),e.jsx(Te,{planId:p,clientId:l})]}),e.jsx(I,{value:"appendices",className:"mt-6",children:e.jsx(js,{planId:p,clientId:l})}),e.jsx(I,{value:"roles",className:"mt-6",children:e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsx(P,{children:"Plan Contacts"}),K&&e.jsxs(H,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(j,{size:"sm",children:"Add Contact"})}),e.jsxs($,{children:[e.jsx(Y,{children:e.jsx(ee,{children:"Add Contact to Plan"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"User"}),e.jsxs("select",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm",id:"user-select",children:[e.jsx("option",{value:"",children:"Select user..."}),ae==null?void 0:ae.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Role"}),e.jsx(k,{id:"role-input",placeholder:"e.g. Plan Coordinator"})]})]}),e.jsx(se,{children:e.jsx(j,{onClick:()=>{var A,T;const s=(A=document.getElementById("user-select"))==null?void 0:A.value,N=(T=document.getElementById("role-input"))==null?void 0:T.value;s&&N&&Oe.mutate({planId:p,clientId:l,userId:parseInt(s),role:N})},children:"Add Contact"})})]})]})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Primary"}),K&&e.jsx(c,{children:"Actions"})]})}),e.jsxs(_,{children:[z==null?void 0:z.map(s=>e.jsxs(v,{children:[e.jsx(r,{children:s.userName||"N/A"}),e.jsx(r,{children:s.role}),e.jsx(r,{children:s.userEmail||"N/A"}),e.jsx(r,{children:s.isPrimary&&e.jsx(W,{children:"Primary"})}),K&&e.jsx(r,{children:e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>ze.mutate({id:s.id,clientId:l}),children:"Remove"})})]},s.id)),!(z!=null&&z.length)&&e.jsx(v,{children:e.jsx(r,{colSpan:K?5:4,className:"text-center text-muted-foreground",children:"No contacts assigned."})})]})]})})]})}),e.jsx(I,{value:"strategies",className:"mt-6",children:e.jsx(w,{children:e.jsx(S,{className:"pt-6",children:K?e.jsxs("div",{className:"space-y-8",children:[e.jsx(ss,{formData:f,toggleStrategy:s=>{const N=f.selectedStrategyIds,A=N.includes(s)?N.filter(T=>T!==s):[...N,s];q({...f,selectedStrategyIds:A})},toggleScenario:s=>{const N=f.selectedScenarioIds,A=N.includes(s)?N.filter(T=>T!==s):[...N,s];q({...f,selectedScenarioIds:A})},strategies:Me||[],scenarios:Ie||[],onBack:()=>{},onNext:()=>{}}),e.jsx("div",{className:"border-t pt-8",children:e.jsx(ts,{formData:f,toggleBia:s=>{const N=f.selectedBiaIds,A=N.includes(s)?N.filter(T=>T!==s):[...N,s];q({...f,selectedBiaIds:A})},bias:Re||[],onBack:()=>{},onNext:()=>{}})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Attached Strategies"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(be=a.strategies)==null?void 0:be.map(s=>e.jsx(W,{variant:"secondary",children:s.title},s.id)),!((fe=a.strategies)!=null&&fe.length)&&e.jsx("span",{className:"text-muted-foreground",children:"None"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Addressed Scenarios"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(ye=a.scenarios)==null?void 0:ye.map(s=>e.jsx(W,{variant:"outline",children:s.title},s.id)),!((Ce=a.scenarios)!=null&&Ce.length)&&e.jsx("span",{className:"text-muted-foreground",children:"None"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Included BIAs"}),e.jsxs("ul",{className:"list-disc pl-5",children:[(we=a.bias)==null?void 0:we.map(s=>e.jsx("li",{children:s.title},s.id)),!((Se=a.bias)!=null&&Se.length)&&e.jsx("span",{className:"text-muted-foreground",children:"None"})]})]})]})})})}),e.jsx(I,{value:"comms",className:"mt-6 space-y-6",children:e.jsx(Te,{planId:parseInt(p),clientId:l})}),e.jsx(I,{value:"logistics",className:"mt-6 space-y-6",children:e.jsx(ms,{planId:parseInt(p),clientId:l})}),e.jsx(I,{value:"governance",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsx(P,{className:"text-lg",children:"Version History"}),e.jsxs(H,{open:Fe,onOpenChange:pe,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(j,{size:"sm",variant:"outline",children:[e.jsx(xs,{className:"w-4 h-4 mr-2"})," Snapshot Version"]})}),e.jsxs($,{children:[e.jsxs(Y,{children:[e.jsx(ee,{children:"Create New Version"}),e.jsx(Ee,{children:"Create a read-only snapshot of the current plan state."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Version Number"}),e.jsx(k,{placeholder:"e.g. 1.2",value:ue,onChange:s=>Ve(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Change Summary"}),e.jsx(U,{placeholder:"What changed?",value:je,onChange:s=>_e(s.target.value)})]})]}),e.jsx(se,{children:e.jsxs(j,{onClick:()=>ne.mutateAsync({planId:p,clientId:l,version:ue,changeSummary:je}),disabled:ne.isPending,children:[ne.isPending&&e.jsx(te,{className:"animate-spin mr-2 w-4 h-4"})," Create Snapshot"]})})]})]})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Version"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Summary"})]})}),e.jsxs(_,{children:[n==null?void 0:n.map(s=>e.jsxs(v,{children:[e.jsx(r,{className:"font-medium",children:s.version}),e.jsx(r,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(r,{className:"text-sm text-muted-foreground",children:s.changeSummary})]},s.id)),!(n!=null&&n.length)&&e.jsx(v,{children:e.jsx(r,{colSpan:3,className:"text-center text-muted-foreground",children:"No versions saved."})})]})]})})]}),e.jsxs(w,{children:[e.jsx(D,{children:e.jsx(P,{className:"text-lg",children:"Full Audit Log"})}),e.jsx(S,{className:"max-h-[400px] overflow-y-auto",children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Action"}),e.jsx(c,{children:"User"}),e.jsx(c,{children:"Date"})]})}),e.jsx(_,{children:E==null?void 0:E.map(s=>e.jsxs(v,{children:[e.jsxs(r,{children:[e.jsx("div",{className:"font-medium",children:s.action}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.details})]}),e.jsx(r,{children:s.userName||"System"}),e.jsx(r,{className:"text-xs",children:new Date(s.createdAt).toLocaleString()})]},s.id))})]})})]})]})}),e.jsx(I,{value:"exercises",className:"mt-6",children:e.jsxs(w,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Plan Exercises"}),e.jsx(O,{children:"Record tabletop exercises, simulations, and tests."})]}),e.jsxs(H,{open:Ue,onOpenChange:ge,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(hs,{className:"w-4 h-4 mr-2"})," Log Exercise"]})}),e.jsxs($,{children:[e.jsx(Y,{children:e.jsx(ee,{children:"Log Plan Exercise"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Title"}),e.jsx(k,{placeholder:"e.g. Q1 Tabletop",value:R.title,onChange:s=>X({...R,title:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Type"}),e.jsxs("select",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm",value:R.type,onChange:s=>X({...R,type:s.target.value}),children:[e.jsx("option",{children:"Tabletop"}),e.jsx("option",{children:"Simulation"}),e.jsx("option",{children:"Full Interruption"}),e.jsx("option",{children:"Checklist"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Date"}),e.jsx(k,{type:"date",value:R.date,onChange:s=>X({...R,date:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Outcome/Notes"}),e.jsx(U,{value:R.notes,onChange:s=>X({...R,notes:s.target.value})})]})]}),e.jsx(se,{children:e.jsx(j,{onClick:()=>me.mutateAsync({...R,clientId:l,planId:p}),disabled:me.isPending,children:"Log Exercise"})})]})]})]}),e.jsx(S,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Exercise"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Notes"})]})}),e.jsxs(_,{children:[g==null?void 0:g.map(s=>e.jsxs(v,{children:[e.jsx(r,{children:new Date(s.date).toLocaleDateString()}),e.jsx(r,{className:"font-medium",children:s.title}),e.jsx(r,{children:s.type}),e.jsx(r,{children:e.jsx(W,{variant:"outline",children:s.status})}),e.jsx(r,{className:"max-w-xs truncate text-muted-foreground",children:s.notes})]},s.id)),!(g!=null&&g.length)&&e.jsx(v,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground",children:"No exercises logged."})})]})]})})]})})]})]})]}):e.jsxs("div",{className:"p-8",children:[e.jsx(te,{className:"animate-spin"})," Loading Plan..."]})}export{pt as default};
