import{b as D,au as L,r as S,t as r,i as I,j as e,c as Q,C as $,m as E}from"./index-DOc7Nwb7.js";import{D as F}from"./DashboardLayout-aHnUqq57.js";import{T as M,a as O,b as u,c as b}from"./tabs-CBDTXbEn.js";import{B as U}from"./Breadcrumb-CRi3LAxS.js";import{P as z,a as G,b as J,c as V,d as _}from"./PlanTabs-1YgtBSA6.js";import{A as q}from"./arrow-left-CpuUojG-.js";import"./index--2vFva6Y.js";import"./search-CwuIBBPE.js";import"./filter-Ceo--4mb.js";import"./clipboard-check-CQkJX5J0.js";import"./sparkles-CoQ80pK2.js";import"./send-FW7-3cjH.js";import"./scroll-area-DPaNxEJD.js";import"./settings-CIu9FFiX.js";import"./circle-check-C5kiwRoG.js";import"./en-US-Bfz1jvxT.js";import"./getTimezoneOffsetInMilliseconds-em2BGgN1.js";import"./rocket-C2MuHhsn.js";import"./scale-BCebIfgE.js";import"./layout-grid-CGqkIAJU.js";import"./book-open-BffBrdze.js";import"./zap-B01fFOkT.js";import"./star-BTvaCCU4.js";import"./briefcase-BxorFA78.js";import"./target-cfAj3L6j.js";import"./database-Bjtecw5f.js";import"./activity-B1F2IRm3.js";import"./shield-check-ETs8j4-d.js";import"./shield-alert-iAruRy4W.js";import"./brain-C-Zi22rJ.js";import"./link-FmUqdGRG.js";import"./lock-czWF3qbC.js";import"./globe-BMGZmoaJ.js";import"./calendar-BlLJlGbj.js";import"./message-square-5hBo7zY3.js";import"./upload-BBmUECj8.js";import"./user-CqRnJLgW.js";import"./arrow-right-M96iV-v9.js";import"./clock-osbacZli.js";function Le(){const[,g]=D(),[H,h]=L("/clients/:clientId/business-continuity/plans/new"),n=h!=null&&h.clientId?parseInt(h.clientId):0,[j,l]=S.useState("details"),[v,y]=S.useState(!1),[a,c]=S.useState({title:"",version:"1.0",department:"",selectedStrategyIds:[],selectedScenarioIds:[],selectedBiaIds:[],selectedStakeholders:[]}),{data:o}=r.businessContinuity.strategies.list.useQuery({clientId:n},{enabled:!!n}),{data:p}=r.businessContinuity.scenarios.list.useQuery({clientId:n}),{data:x}=r.businessContinuity.bia.list.useQuery({clientId:n},{enabled:!!n}),{data:B}=r.businessContinuity.stakeholders.searchCandidates.useQuery({}),{data:f}=r.businessContinuity.bia.getActivitiesForBias.useQuery({biaIds:a.selectedBiaIds},{enabled:a.selectedBiaIds.length>0}),N=r.businessContinuity.plans.create.useMutation({onSuccess:()=>{I.success("Plan created successfully"),g(`/clients/${n}/business-continuity/plans`)},onError:t=>I.error(t.message)}),k=t=>{c(s=>({...s,selectedStrategyIds:s.selectedStrategyIds.includes(t)?s.selectedStrategyIds.filter(i=>i!==t):[...s.selectedStrategyIds,t]}))},C=t=>{c(s=>({...s,selectedBiaIds:s.selectedBiaIds.includes(t)?s.selectedBiaIds.filter(i=>i!==t):[...s.selectedBiaIds,t]}))},w=t=>{c(s=>({...s,selectedScenarioIds:s.selectedScenarioIds.includes(t)?s.selectedScenarioIds.filter(i=>i!==t):[...s.selectedScenarioIds,t]}))},P=t=>{a.selectedStakeholders.find(s=>s.id===t.id)||c(s=>({...s,selectedStakeholders:[...s.selectedStakeholders,{...t,role:"Plan Member"}]}))},T=t=>{c(s=>({...s,selectedStakeholders:s.selectedStakeholders.filter(i=>i.id!==t)}))},A=(t,s)=>{c(i=>({...i,selectedStakeholders:i.selectedStakeholders.map(d=>d.id===t?{...d,role:s}:d)}))},R=async()=>{y(!0);try{const t=o==null?void 0:o.filter(m=>a.selectedStrategyIds.includes(m.id)),s=p==null?void 0:p.filter(m=>a.selectedScenarioIds.includes(m.id)),i=x==null?void 0:x.filter(m=>a.selectedBiaIds.includes(m.id)),d=JSON.stringify({metadata:{department:a.department,generatedAt:new Date().toISOString()},strategies:t,scenarios:s,bias:i,criticalActivities:f||[],callList:a.selectedStakeholders},null,2);await N.mutateAsync({clientId:n,title:a.title,version:a.version,status:"draft",content:d,biaIds:a.selectedBiaIds,strategyIds:a.selectedStrategyIds,scenarioIds:a.selectedScenarioIds})}catch(t){console.error(t)}finally{y(!1)}};return e.jsx(F,{children:e.jsxs("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(U,{items:[{label:"Clients",href:"/clients"},{label:"Business Continuity",href:`/clients/${n}/business-continuity`},{label:"Recovery Plans",href:`/clients/${n}/business-continuity/plans`},{label:"New Plan",href:`/clients/${n}/business-continuity/plans/new`}]}),e.jsx("div",{className:"flex items-center mt-2",children:e.jsxs(Q,{variant:"ghost",size:"sm",className:"-ml-3",onClick:()=>g(`/clients/${n}/business-continuity/plans`),children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Back to Plans"]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"New Recovery Plan"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Generate a comprehensive BCP document using existing data."})]}),e.jsxs(M,{value:j,onValueChange:l,className:"w-full space-y-6",children:[e.jsxs(O,{className:"grid w-full grid-cols-5",children:[e.jsx(u,{value:"details",children:"1. Details"}),e.jsx(u,{value:"strategies",children:"2. Strategies"}),e.jsx(u,{value:"activities",children:"3. Activities"}),e.jsx(u,{value:"contacts",children:"4. Contacts"}),e.jsx(u,{value:"review",children:"5. Review"})]}),e.jsx($,{children:e.jsxs(E,{className:"pt-6",children:[e.jsx(b,{value:"details",className:"mt-0",children:e.jsx(z,{formData:a,setFormData:c,onNext:()=>l("strategies")})}),e.jsx(b,{value:"strategies",className:"mt-0",children:e.jsx(G,{formData:a,toggleStrategy:k,toggleScenario:w,strategies:o||[],scenarios:p||[],onBack:()=>l("details"),onNext:()=>l("activities")})}),e.jsx(b,{value:"activities",className:"mt-0",children:e.jsx(J,{formData:a,toggleBia:C,bias:x||[],onBack:()=>l("strategies"),onNext:()=>l("contacts")})}),e.jsx(b,{value:"contacts",className:"mt-0",children:e.jsx(V,{formData:a,availableUsers:B||[],addStakeholder:P,removeStakeholder:T,updateStakeholderRole:A,onBack:()=>l("activities"),onNext:()=>l("review")})}),e.jsx(b,{value:"review",className:"mt-0",children:e.jsx(_,{formData:a,strategies:o||[],criticalActivities:f||[],isSubmitting:v,onSubmit:R,onBack:()=>l("contacts")})})]})})]})]})})}export{Le as default};
